{"version":3,"file":"typewriter.esm.js","sources":["../src/event-dispatcher.js","../src/diff.js","../src/equal.js","../src/delta.js","../src/editor.js","../src/view/vdom.js","../src/view/dom-utils.js","../src/view/blocks.js","../src/view/markups.js","../src/view/embeds.js","../src/view/defaultPaper.js","../src/view/selection.js","../src/escape-html.js","../src/paper.js","../src/view/dom.js","../src/shortcut-string.js","../src/view.js","../src/modules/input.js","../src/modules/key-shortcuts.js","../src/modules/history.js","../src/modules/placeholder.js","../src/modules/smart-entry.js","../src/modules/smart-quotes.js","../node_modules/svelte/shared.js","../src/ui/HoverMenu.html","../src/modules/hover-menu.js","../src/index.js"],"sourcesContent":["const dispatcherEvents = new WeakMap();\n\n\nexport default class EventDispatcher {\n\n  on(type, listener) {\n    getEventListeners(this, type, true).add(listener);\n  }\n\n  off(type, listener) {\n    const events = getEventListeners(this, type);\n    events && events.delete(listener);\n  }\n\n  once(type, listener) {\n    function once(...args) {\n      this.off(type, once);\n      listener.apply(this, args);\n    }\n    this.on(type, once);\n  }\n\n  fire(type, ...args) {\n    let uncanceled = true;\n    const events = getEventListeners(this, type);\n    if (events) events.forEach(listener => {\n      uncanceled && listener.apply(this, args) !== false || (uncanceled = false);\n    });\n    return uncanceled;\n  }\n}\n\n\nfunction getEventListeners(obj, type, autocreate) {\n  let events = dispatcherEvents.get(obj);\n  if (!events && autocreate) dispatcherEvents.set(obj, events = Object.create(null));\n  return events && events[type] || autocreate && (events[type] = new Set());\n}\n","/**\n * This library modifies the diff-patch-match library by Neil Fraser\n * by removing the patch and match functionality and certain advanced\n * options in the diff function. The original license is as follows:\n *\n * ===\n *\n * Diff Match and Patch\n *\n * Copyright 2006 Google Inc.\n * http://code.google.com/p/google-diff-match-patch/\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The data structure representing a diff is an array of tuples:\n * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n */\nvar DIFF_DELETE = -1;\nvar DIFF_INSERT = 1;\nvar DIFF_EQUAL = 0;\n\n\n/**\n * Find the differences between two texts.  Simplifies the problem by stripping\n * any common prefix or suffix off the texts before diffing.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {Int} cursor_pos Expected edit position in text1 (optional)\n * @return {Array} Array of diff tuples.\n */\nexport default function diff(text1, text2, cursor_pos) {\n  // Check for equality (speedup).\n  if (text1 == text2) {\n    if (text1) {\n      return [[DIFF_EQUAL, text1]];\n    }\n    return [];\n  }\n\n  // Check cursor_pos within bounds\n  if (cursor_pos < 0 || text1.length < cursor_pos) {\n    cursor_pos = null;\n  }\n\n  // Trim off common prefix (speedup).\n  var commonlength = diff_commonPrefix(text1, text2);\n  var commonprefix = text1.substring(0, commonlength);\n  text1 = text1.substring(commonlength);\n  text2 = text2.substring(commonlength);\n\n  // Trim off common suffix (speedup).\n  commonlength = diff_commonSuffix(text1, text2);\n  var commonsuffix = text1.substring(text1.length - commonlength);\n  text1 = text1.substring(0, text1.length - commonlength);\n  text2 = text2.substring(0, text2.length - commonlength);\n\n  // Compute the diff on the middle block.\n  var diffs = diff_compute_(text1, text2);\n\n  // Restore the prefix and suffix.\n  if (commonprefix) {\n    diffs.unshift([DIFF_EQUAL, commonprefix]);\n  }\n  if (commonsuffix) {\n    diffs.push([DIFF_EQUAL, commonsuffix]);\n  }\n  diff_cleanupMerge(diffs);\n  if (cursor_pos != null) {\n    diffs = fix_cursor(diffs, cursor_pos);\n  }\n  diffs = fix_emoji(diffs);\n  return diffs;\n};\n\n\n/**\n * Find the differences between two texts.  Assumes that the texts do not\n * have any common prefix or suffix.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_compute_(text1, text2) {\n  var diffs;\n\n  if (!text1) {\n    // Just add some text (speedup).\n    return [[DIFF_INSERT, text2]];\n  }\n\n  if (!text2) {\n    // Just delete some text (speedup).\n    return [[DIFF_DELETE, text1]];\n  }\n\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  var i = longtext.indexOf(shorttext);\n  if (i != -1) {\n    // Shorter text is inside the longer text (speedup).\n    diffs = [[DIFF_INSERT, longtext.substring(0, i)],\n             [DIFF_EQUAL, shorttext],\n             [DIFF_INSERT, longtext.substring(i + shorttext.length)]];\n    // Swap insertions for deletions if diff is reversed.\n    if (text1.length > text2.length) {\n      diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n    }\n    return diffs;\n  }\n\n  if (shorttext.length == 1) {\n    // Single character string.\n    // After the previous speedup, the character can't be an equality.\n    return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n  }\n\n  // Check to see if the problem can be split in two.\n  var hm = diff_halfMatch_(text1, text2);\n  if (hm) {\n    // A half-match was found, sort out the return data.\n    var text1_a = hm[0];\n    var text1_b = hm[1];\n    var text2_a = hm[2];\n    var text2_b = hm[3];\n    var mid_common = hm[4];\n    // Send both pairs off for separate processing.\n    var diffs_a = diff(text1_a, text2_a);\n    var diffs_b = diff(text1_b, text2_b);\n    // Merge the results.\n    return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n  }\n\n  return diff_bisect_(text1, text2);\n};\n\n\n/**\n * Find the 'middle snake' of a diff, split the problem in two\n * and return the recursively constructed diff.\n * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n * @private\n */\nfunction diff_bisect_(text1, text2) {\n  // Cache the text lengths to prevent multiple calls.\n  var text1_length = text1.length;\n  var text2_length = text2.length;\n  var max_d = Math.ceil((text1_length + text2_length) / 2);\n  var v_offset = max_d;\n  var v_length = 2 * max_d;\n  var v1 = new Array(v_length);\n  var v2 = new Array(v_length);\n  // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n  // integers and undefined.\n  for (var x = 0; x < v_length; x++) {\n    v1[x] = -1;\n    v2[x] = -1;\n  }\n  v1[v_offset + 1] = 0;\n  v2[v_offset + 1] = 0;\n  var delta = text1_length - text2_length;\n  // If the total number of characters is odd, then the front path will collide\n  // with the reverse path.\n  var front = (delta % 2 != 0);\n  // Offsets for start and end of k loop.\n  // Prevents mapping of space beyond the grid.\n  var k1start = 0;\n  var k1end = 0;\n  var k2start = 0;\n  var k2end = 0;\n  for (var d = 0; d < max_d; d++) {\n    // Walk the front path one step.\n    for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n      var k1_offset = v_offset + k1;\n      var x1;\n      if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n        x1 = v1[k1_offset + 1];\n      } else {\n        x1 = v1[k1_offset - 1] + 1;\n      }\n      var y1 = x1 - k1;\n      while (x1 < text1_length && y1 < text2_length &&\n             text1.charAt(x1) == text2.charAt(y1)) {\n        x1++;\n        y1++;\n      }\n      v1[k1_offset] = x1;\n      if (x1 > text1_length) {\n        // Ran off the right of the graph.\n        k1end += 2;\n      } else if (y1 > text2_length) {\n        // Ran off the bottom of the graph.\n        k1start += 2;\n      } else if (front) {\n        var k2_offset = v_offset + delta - k1;\n        if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {\n          // Mirror x2 onto top-left coordinate system.\n          var x2 = text1_length - v2[k2_offset];\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n\n    // Walk the reverse path one step.\n    for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n      var k2_offset = v_offset + k2;\n      var x2;\n      if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n        x2 = v2[k2_offset + 1];\n      } else {\n        x2 = v2[k2_offset - 1] + 1;\n      }\n      var y2 = x2 - k2;\n      while (x2 < text1_length && y2 < text2_length &&\n             text1.charAt(text1_length - x2 - 1) ==\n             text2.charAt(text2_length - y2 - 1)) {\n        x2++;\n        y2++;\n      }\n      v2[k2_offset] = x2;\n      if (x2 > text1_length) {\n        // Ran off the left of the graph.\n        k2end += 2;\n      } else if (y2 > text2_length) {\n        // Ran off the top of the graph.\n        k2start += 2;\n      } else if (!front) {\n        var k1_offset = v_offset + delta - k2;\n        if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n          var x1 = v1[k1_offset];\n          var y1 = v_offset + x1 - k1_offset;\n          // Mirror x2 onto top-left coordinate system.\n          x2 = text1_length - x2;\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n  }\n  // Diff took too long and hit the deadline or\n  // number of diffs equals number of characters, no commonality at all.\n  return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n};\n\n\n/**\n * Given the location of the 'middle snake', split the diff in two parts\n * and recurse.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {number} x Index of split point in text1.\n * @param {number} y Index of split point in text2.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_bisectSplit_(text1, text2, x, y) {\n  var text1a = text1.substring(0, x);\n  var text2a = text2.substring(0, y);\n  var text1b = text1.substring(x);\n  var text2b = text2.substring(y);\n\n  // Compute both diffs serially.\n  var diffs = diff(text1a, text2a);\n  var diffsb = diff(text1b, text2b);\n\n  return diffs.concat(diffsb);\n};\n\n\n/**\n * Determine the common prefix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the start of each\n *     string.\n */\nfunction diff_commonPrefix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerstart = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(pointerstart, pointermid) ==\n        text2.substring(pointerstart, pointermid)) {\n      pointermin = pointermid;\n      pointerstart = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Determine the common suffix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the end of each string.\n */\nfunction diff_commonSuffix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 ||\n      text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerend = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n        text2.substring(text2.length - pointermid, text2.length - pointerend)) {\n      pointermin = pointermid;\n      pointerend = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Do the two texts share a substring which is at least half the length of the\n * longer text?\n * This speedup can produce non-minimal diffs.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {Array.<string>} Five element Array, containing the prefix of\n *     text1, the suffix of text1, the prefix of text2, the suffix of\n *     text2 and the common middle.  Or null if there was no match.\n */\nfunction diff_halfMatch_(text1, text2) {\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n    return null;  // Pointless.\n  }\n\n  /**\n   * Does a substring of shorttext exist within longtext such that the substring\n   * is at least half the length of longtext?\n   * Closure, but does not reference any external variables.\n   * @param {string} longtext Longer string.\n   * @param {string} shorttext Shorter string.\n   * @param {number} i Start index of quarter length substring within longtext.\n   * @return {Array.<string>} Five element Array, containing the prefix of\n   *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n   *     of shorttext and the common middle.  Or null if there was no match.\n   * @private\n   */\n  function diff_halfMatchI_(longtext, shorttext, i) {\n    // Start with a 1/4 length substring at position i as a seed.\n    var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n    var j = -1;\n    var best_common = '';\n    var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;\n    while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n      var prefixLength = diff_commonPrefix(longtext.substring(i),\n                                           shorttext.substring(j));\n      var suffixLength = diff_commonSuffix(longtext.substring(0, i),\n                                           shorttext.substring(0, j));\n      if (best_common.length < suffixLength + prefixLength) {\n        best_common = shorttext.substring(j - suffixLength, j) +\n            shorttext.substring(j, j + prefixLength);\n        best_longtext_a = longtext.substring(0, i - suffixLength);\n        best_longtext_b = longtext.substring(i + prefixLength);\n        best_shorttext_a = shorttext.substring(0, j - suffixLength);\n        best_shorttext_b = shorttext.substring(j + prefixLength);\n      }\n    }\n    if (best_common.length * 2 >= longtext.length) {\n      return [best_longtext_a, best_longtext_b,\n              best_shorttext_a, best_shorttext_b, best_common];\n    } else {\n      return null;\n    }\n  }\n\n  // First check if the second quarter is the seed for a half-match.\n  var hm1 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 4));\n  // Check again based on the third quarter.\n  var hm2 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 2));\n  var hm;\n  if (!hm1 && !hm2) {\n    return null;\n  } else if (!hm2) {\n    hm = hm1;\n  } else if (!hm1) {\n    hm = hm2;\n  } else {\n    // Both matched.  Select the longest.\n    hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n  }\n\n  // A half-match was found, sort out the return data.\n  var text1_a, text1_b, text2_a, text2_b;\n  if (text1.length > text2.length) {\n    text1_a = hm[0];\n    text1_b = hm[1];\n    text2_a = hm[2];\n    text2_b = hm[3];\n  } else {\n    text2_a = hm[0];\n    text2_b = hm[1];\n    text1_a = hm[2];\n    text1_b = hm[3];\n  }\n  var mid_common = hm[4];\n  return [text1_a, text1_b, text2_a, text2_b, mid_common];\n};\n\n\n/**\n * Reorder and merge like edit sections.  Merge equalities.\n * Any edit section can move as long as it doesn't cross an equality.\n * @param {Array} diffs Array of diff tuples.\n */\nfunction diff_cleanupMerge(diffs) {\n  diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.\n  var pointer = 0;\n  var count_delete = 0;\n  var count_insert = 0;\n  var text_delete = '';\n  var text_insert = '';\n  var commonlength;\n  while (pointer < diffs.length) {\n    switch (diffs[pointer][0]) {\n      case DIFF_INSERT:\n        count_insert++;\n        text_insert += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_DELETE:\n        count_delete++;\n        text_delete += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_EQUAL:\n        // Upon reaching an equality, check for prior redundancies.\n        if (count_delete + count_insert > 1) {\n          if (count_delete !== 0 && count_insert !== 0) {\n            // Factor out any common prefixies.\n            commonlength = diff_commonPrefix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              if ((pointer - count_delete - count_insert) > 0 &&\n                  diffs[pointer - count_delete - count_insert - 1][0] ==\n                  DIFF_EQUAL) {\n                diffs[pointer - count_delete - count_insert - 1][1] +=\n                    text_insert.substring(0, commonlength);\n              } else {\n                diffs.splice(0, 0, [DIFF_EQUAL,\n                                    text_insert.substring(0, commonlength)]);\n                pointer++;\n              }\n              text_insert = text_insert.substring(commonlength);\n              text_delete = text_delete.substring(commonlength);\n            }\n            // Factor out any common suffixies.\n            commonlength = diff_commonSuffix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              diffs[pointer][1] = text_insert.substring(text_insert.length -\n                  commonlength) + diffs[pointer][1];\n              text_insert = text_insert.substring(0, text_insert.length -\n                  commonlength);\n              text_delete = text_delete.substring(0, text_delete.length -\n                  commonlength);\n            }\n          }\n          // Delete the offending records and add the merged ones.\n          if (count_delete === 0) {\n            diffs.splice(pointer - count_insert,\n                count_delete + count_insert, [DIFF_INSERT, text_insert]);\n          } else if (count_insert === 0) {\n            diffs.splice(pointer - count_delete,\n                count_delete + count_insert, [DIFF_DELETE, text_delete]);\n          } else {\n            diffs.splice(pointer - count_delete - count_insert,\n                count_delete + count_insert, [DIFF_DELETE, text_delete],\n                [DIFF_INSERT, text_insert]);\n          }\n          pointer = pointer - count_delete - count_insert +\n                    (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;\n        } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n          // Merge this equality with the previous one.\n          diffs[pointer - 1][1] += diffs[pointer][1];\n          diffs.splice(pointer, 1);\n        } else {\n          pointer++;\n        }\n        count_insert = 0;\n        count_delete = 0;\n        text_delete = '';\n        text_insert = '';\n        break;\n    }\n  }\n  if (diffs[diffs.length - 1][1] === '') {\n    diffs.pop();  // Remove the dummy entry at the end.\n  }\n\n  // Second pass: look for single edits surrounded on both sides by equalities\n  // which can be shifted sideways to eliminate an equality.\n  // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n  var changes = false;\n  pointer = 1;\n  // Intentionally ignore the first and last element (don't need checking).\n  while (pointer < diffs.length - 1) {\n    if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL) {\n      // This is a single edit surrounded by equalities.\n      if (diffs[pointer][1].substring(diffs[pointer][1].length -\n          diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {\n        // Shift the edit over the previous equality.\n        diffs[pointer][1] = diffs[pointer - 1][1] +\n            diffs[pointer][1].substring(0, diffs[pointer][1].length -\n                                        diffs[pointer - 1][1].length);\n        diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n        diffs.splice(pointer - 1, 1);\n        changes = true;\n      } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n          diffs[pointer + 1][1]) {\n        // Shift the edit over the next equality.\n        diffs[pointer - 1][1] += diffs[pointer + 1][1];\n        diffs[pointer][1] =\n            diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n            diffs[pointer + 1][1];\n        diffs.splice(pointer + 1, 1);\n        changes = true;\n      }\n    }\n    pointer++;\n  }\n  // If shifts were made, the diff needs reordering and another shift sweep.\n  if (changes) {\n    diff_cleanupMerge(diffs);\n  }\n};\n\n\ndiff.INSERT = DIFF_INSERT;\ndiff.DELETE = DIFF_DELETE;\ndiff.EQUAL = DIFF_EQUAL;\n\n/*\n * Modify a diff such that the cursor position points to the start of a change:\n * E.g.\n *   cursor_normalize_diff([[DIFF_EQUAL, 'abc']], 1)\n *     => [1, [[DIFF_EQUAL, 'a'], [DIFF_EQUAL, 'bc']]]\n *   cursor_normalize_diff([[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xyz']], 2)\n *     => [2, [[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xy'], [DIFF_DELETE, 'z']]]\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} A tuple [cursor location in the modified diff, modified diff]\n */\nfunction cursor_normalize_diff (diffs, cursor_pos) {\n  if (cursor_pos === 0) {\n    return [DIFF_EQUAL, diffs];\n  }\n  for (var current_pos = 0, i = 0; i < diffs.length; i++) {\n    var d = diffs[i];\n    if (d[0] === DIFF_DELETE || d[0] === DIFF_EQUAL) {\n      var next_pos = current_pos + d[1].length;\n      if (cursor_pos === next_pos) {\n        return [i + 1, diffs];\n      } else if (cursor_pos < next_pos) {\n        // copy to prevent side effects\n        diffs = diffs.slice();\n        // split d into two diff changes\n        var split_pos = cursor_pos - current_pos;\n        var d_left = [d[0], d[1].slice(0, split_pos)];\n        var d_right = [d[0], d[1].slice(split_pos)];\n        diffs.splice(i, 1, d_left, d_right);\n        return [i + 1, diffs];\n      } else {\n        current_pos = next_pos;\n      }\n    }\n  }\n  throw new Error('cursor_pos is out of bounds!')\n}\n\n/*\n * Modify a diff such that the edit position is \"shifted\" to the proposed edit location (cursor_position).\n *\n * Case 1)\n *   Check if a naive shift is possible:\n *     [0, X], [ 1, Y] -> [ 1, Y], [0, X]    (if X + Y === Y + X)\n *     [0, X], [-1, Y] -> [-1, Y], [0, X]    (if X + Y === Y + X) - holds same result\n * Case 2)\n *   Check if the following shifts are possible:\n *     [0, 'pre'], [ 1, 'prefix'] -> [ 1, 'pre'], [0, 'pre'], [ 1, 'fix']\n *     [0, 'pre'], [-1, 'prefix'] -> [-1, 'pre'], [0, 'pre'], [-1, 'fix']\n *         ^            ^\n *         d          d_next\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} Array of diff tuples\n */\nfunction fix_cursor (diffs, cursor_pos) {\n  var norm = cursor_normalize_diff(diffs, cursor_pos);\n  var ndiffs = norm[1];\n  var cursor_pointer = norm[0];\n  var d = ndiffs[cursor_pointer];\n  var d_next = ndiffs[cursor_pointer + 1];\n\n  if (d == null) {\n    // Text was deleted from end of original string,\n    // cursor is now out of bounds in new string\n    return diffs;\n  } else if (d[0] !== DIFF_EQUAL) {\n    // A modification happened at the cursor location.\n    // This is the expected outcome, so we can return the original diff.\n    return diffs;\n  } else {\n    if (d_next != null && d[1] + d_next[1] === d_next[1] + d[1]) {\n      // Case 1)\n      // It is possible to perform a naive shift\n      ndiffs.splice(cursor_pointer, 2, d_next, d)\n      return merge_tuples(ndiffs, cursor_pointer, 2)\n    } else if (d_next != null && d_next[1].indexOf(d[1]) === 0) {\n      // Case 2)\n      // d[1] is a prefix of d_next[1]\n      // We can assume that d_next[0] !== 0, since d[0] === 0\n      // Shift edit locations..\n      ndiffs.splice(cursor_pointer, 2, [d_next[0], d[1]], [0, d[1]]);\n      var suffix = d_next[1].slice(d[1].length);\n      if (suffix.length > 0) {\n        ndiffs.splice(cursor_pointer + 2, 0, [d_next[0], suffix]);\n      }\n      return merge_tuples(ndiffs, cursor_pointer, 3)\n    } else {\n      // Not possible to perform any modification\n      return diffs;\n    }\n  }\n}\n\n/*\n * Check diff did not split surrogate pairs.\n * Ex. [0, '\\uD83D'], [-1, '\\uDC36'], [1, '\\uDC2F'] -> [-1, '\\uD83D\\uDC36'], [1, '\\uD83D\\uDC2F']\n *     '\\uD83D\\uDC36' === '🐶', '\\uD83D\\uDC2F' === '🐯'\n *\n * @param {Array} diffs Array of diff tuples\n * @return {Array} Array of diff tuples\n */\nfunction fix_emoji (diffs) {\n  var compact = false;\n  var starts_with_pair_end = function(str) {\n    return str.charCodeAt(0) >= 0xDC00 && str.charCodeAt(0) <= 0xDFFF;\n  }\n  var ends_with_pair_start = function(str) {\n    return str.charCodeAt(str.length-1) >= 0xD800 && str.charCodeAt(str.length-1) <= 0xDBFF;\n  }\n  for (var i = 2; i < diffs.length; i += 1) {\n    if (diffs[i-2][0] === DIFF_EQUAL && ends_with_pair_start(diffs[i-2][1]) &&\n        diffs[i-1][0] === DIFF_DELETE && starts_with_pair_end(diffs[i-1][1]) &&\n        diffs[i][0] === DIFF_INSERT && starts_with_pair_end(diffs[i][1])) {\n      compact = true;\n\n      diffs[i-1][1] = diffs[i-2][1].slice(-1) + diffs[i-1][1];\n      diffs[i][1] = diffs[i-2][1].slice(-1) + diffs[i][1];\n\n      diffs[i-2][1] = diffs[i-2][1].slice(0, -1);\n    }\n  }\n  if (!compact) {\n    return diffs;\n  }\n  var fixed_diffs = [];\n  for (var i = 0; i < diffs.length; i += 1) {\n    if (diffs[i][1].length > 0) {\n      fixed_diffs.push(diffs[i]);\n    }\n  }\n  return fixed_diffs;\n}\n\n/*\n * Try to merge tuples with their neigbors in a given range.\n * E.g. [0, 'a'], [0, 'b'] -> [0, 'ab']\n *\n * @param {Array} diffs Array of diff tuples.\n * @param {Int} start Position of the first element to merge (diffs[start] is also merged with diffs[start - 1]).\n * @param {Int} length Number of consecutive elements to check.\n * @return {Array} Array of merged diff tuples.\n */\nfunction merge_tuples (diffs, start, length) {\n  // Check from (start-1) to (start+length).\n  for (var i = start + length - 1; i >= 0 && i >= start - 1; i--) {\n    if (i + 1 < diffs.length) {\n      var left_d = diffs[i];\n      var right_d = diffs[i+1];\n      if (left_d[0] === right_d[1]) {\n        diffs.splice(i, 2, [left_d[0], left_d[1] + right_d[1]]);\n      }\n    }\n  }\n  return diffs;\n}\n","\nexport function shallowEqual(objA, objB) {\n  return valueEqual(objA, objB, strictEqual);\n}\n\nexport function deepEqual(objA, objB) {\n  return valueEqual(objA, objB, valueEqual);\n}\n\nfunction strictEqual(valueA, valueB) {\n  return valueA === valueB;\n}\n\nfunction valueEqual(valueA, valueB, propEqual) {\n  if (valueA === valueB) return true;\n  if (valueA instanceof Date && valueB instanceof Date) return valueA.getTime() === valueB.getTime();\n  if (!valueA || !valueB || typeof valueA !== 'object' && typeof valueB !== 'object')\n    return valueA === valueB;\n  return objectEqual(valueA, valueB, propEqual);\n}\n\nfunction objectEqual(objA, objB, propEqual) {\n  if (objA.prototype !== objB.prototype) return false;\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n  if (keysA.length !== keysB.length) return false;\n  return keysA.every((key, i) => key === keysB[i] && propEqual(objA[key], objB[key], propEqual));\n}\n","import diff from './diff';\nimport { deepEqual } from './equal';\n\nconst NULL_CHARACTER = String.fromCharCode(0);  // Placeholder char for embed in diff()\n\nexport default class Delta {\n\n  constructor(ops = []) {\n    this.ops = ops;\n  }\n\n  /**\n   * Appends an insert operation. Returns this for chainability.\n   *\n   * @param {String|Object} text Represents text or embed to insert\n   * @param {Object} attributes Optional attributes to apply\n   */\n  insert(text, attributes) {\n    var newOp = {};\n    if (text.length === 0) return this;\n    newOp.insert = text;\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Appends a delete operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to delete\n   */\n  delete(length) {\n    if (length <= 0) return this;\n    return this._push({ delete: length });\n  }\n\n  /**\n   * Appends a retain operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to retain\n   * @param {Object} attributes Optional attributes to apply\n   * @returns {Delta} This delta\n   */\n  retain(length, attributes) {\n    if (length <= 0) return this;\n    var newOp = { retain: length };\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Freezes delta from future modifications. Returns this for chainability.\n   *\n   * @returns {Delta} This delta\n   */\n  freeze() {\n    this._push = () => this;\n    return this;\n  }\n\n  /**\n   * Adds a new operation. Returns this for chainability.\n   *\n   * @param {Object} newOp A new operation\n   * @returns {Delta} This delta\n   */\n  _push(newOp) {\n    var index = this.ops.length;\n    var lastOp = this.ops[index - 1];\n    if (typeof lastOp === 'object') {\n      if (typeof newOp.delete === 'number' && typeof lastOp.delete === 'number') {\n        this.ops[index - 1] = { delete: lastOp.delete + newOp.delete };\n        return this;\n      }\n      // Since it does not matter if we insert before or after deleting at the same index,\n      // always prefer to insert first\n      if (typeof lastOp.delete === 'number' && newOp.insert != null) {\n        index -= 1;\n        lastOp = this.ops[index - 1];\n        if (typeof lastOp !== 'object') {\n          this.ops.unshift(newOp);\n          return this;\n        }\n      }\n      if (deepEqual(newOp.attributes, lastOp.attributes)) {\n        if (typeof newOp.insert === 'string' && typeof lastOp.insert === 'string') {\n          this.ops[index - 1] = { insert: lastOp.insert + newOp.insert };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        } else if (typeof newOp.retain === 'number' && typeof lastOp.retain === 'number') {\n          this.ops[index - 1] = { retain: lastOp.retain + newOp.retain };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        }\n      }\n    }\n    if (index === this.ops.length) {\n      this.ops.push(newOp);\n    } else {\n      this.ops.splice(index, 0, newOp);\n    }\n    return this;\n  }\n\n  /**\n   * Chops off trailing retain instructions to make the delta concise.\n   *\n   * @returns {Delta} This delta\n   */\n  chop() {\n    var lastOp = this.ops[this.ops.length - 1];\n    if (lastOp && lastOp.retain && !lastOp.attributes) {\n      this.ops.pop();\n    }\n    return this;\n  }\n\n  /**\n   * Returns an iterator to iterate over the operations of this delta.\n   *\n   * @returns {Iterator} An operation iterator with methods hasNext, next, peek, peekLength, & peekType\n   */\n  iterator() {\n    return new Iterator(this.ops);\n  }\n\n  /**\n   * Returns an array of operations that passes a given function.\n   *\n   * @param {Function} predicate Function to test each operation against. Return true to keep the operation, false\n   *                             otherwise\n   * @returns {Array} Filtered resulting array\n   */\n  filter(predicate) {\n    return this.ops.filter(predicate);\n  }\n\n  /**\n   * Iterates through operations, calling the provided function for each operation.\n   *\n   * @param {Function} predicate Function to call during iteration, passing in the current operation\n   */\n  forEach(predicate) {\n    this.ops.forEach(predicate);\n  }\n\n  /**\n   * Returns a new array with the results of calling provided function on each operation.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning an element of the new\n   *                             array to be returned\n   * @returns {Array} A new array with each element being the result of the given function\n   */\n  map(predicate) {\n    return this.ops.map(predicate);\n  }\n\n  /**\n   * Create an array of two arrays, the first with operations that pass the given function, the other that failed.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning whether that operation\n   *                             passed\n   * @returns {Array} A new array of two Arrays, the first with passed operations, the other with failed operations\n   */\n  partition(predicate) {\n    var passed = [], failed = [];\n    this.forEach(op => {\n      var target = predicate(op) ? passed : failed;\n      target.push(op);\n    });\n    return [passed, failed];\n  }\n\n  /**\n   * Applies given function against an accumulator and each operation to reduce to a single value.\n   *\n   * @param {Function} predicate Function to call per iteration, returning an accumulated value\n   * @param {*} initial Initial value to pass to first call to predicate\n   * @returns {*} The accumulated value\n   */\n  reduce(predicate, initial) {\n    return this.ops.reduce(predicate, initial);\n  }\n\n  changeLength() {\n    return this.reduce((length, entry) => {\n      if (entry.insert) {\n        return length + getOpLength(entry);\n      } else if (entry.delete) {\n        return length - entry.delete;\n      }\n      return length;\n    }, 0);\n  }\n\n  /**\n   * Returns length of a Delta, which is the sum of the lengths of its operations.\n   *\n   * @returns {Number} The length of this delta\n   */\n  length() {\n    return this.reduce((length, entry) => {\n      return length + getOpLength(entry);\n    }, 0);\n  }\n\n  /**\n   * Returns copy of delta with subset of operations.\n   *\n   * @param {Number} start Start index of subset, defaults to 0\n   * @param {Number} end End index of subset, defaults to rest of operations\n   * @returns {Array} An array slice of the operations\n   */\n  slice(start = 0, end) {\n    if (typeof end !== 'number') end = Infinity;\n    var ops = [];\n    var iter = this.iterator();\n    var index = 0;\n    while (index < end && iter.hasNext()) {\n      var nextOp;\n      if (index < start) {\n        nextOp = iter.next(start - index);\n      } else {\n        nextOp = iter.next(end - index);\n        ops.push(nextOp);\n      }\n      index += getOpLength(nextOp);\n    }\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns a Delta that is equivalent to applying the operations of own Delta, followed by another Delta.\n   *\n   * @param {Delta} other Delta to compose\n   */\n  compose(other) {\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else if (thisIter.peekType() === 'delete') {\n        delta._push(thisIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (typeof otherOp.retain === 'number') {\n          var newOp = {};\n          if (typeof thisOp.retain === 'number') {\n            newOp.retain = length;\n          } else {\n            newOp.insert = thisOp.insert;\n          }\n          // Preserve null when composing with a retain, otherwise remove it for inserts\n          var attributes = composeAttributes(thisOp.attributes, otherOp.attributes, typeof thisOp.retain === 'number');\n          if (attributes) newOp.attributes = attributes;\n          delta._push(newOp);\n\n          // Optimization if rest of other is just retain\n          if (!otherIter.hasNext() && deepEqual(delta.ops[delta.ops.length - 1], newOp)) {\n            var rest = new Delta(thisIter.rest());\n            return delta.concat(rest).chop();\n          }\n\n        // Other op should be delete, we could be an insert or retain\n        // Insert + delete cancels out\n        } else if (typeof otherOp.delete === 'number' && typeof thisOp.retain === 'number') {\n          delta._push(otherOp);\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Returns a new Delta representing the concatenation of this and another document Delta's operations.\n   *\n   * @param {Delta} other Document Delta to concatenate\n   * @returns {Delta} Concatenated document Delta\n   */\n  concat(other) {\n    var delta = new Delta(this.ops.slice());\n    if (other.ops.length > 0) {\n      delta._push(other.ops[0]);\n      delta.ops = delta.ops.concat(other.ops.slice(1));\n    }\n    return delta;\n  }\n\n  /**\n   * Returns a Delta representing the difference between two documents. Optionally, accepts a suggested index where\n   * change took place, often representing a cursor position before change.\n   *\n   * @param {Delta} other Document Delta to diff against\n   * @param {Number} index Suggested index where change took place\n   * @returns {Delta} Difference between the two documents\n   */\n  diff(other, index) {\n    if (this.ops === other.ops) {\n      return new Delta();\n    }\n    var strings = [this, other].map((delta) => {\n      return delta.map((op) => {\n        if (op.insert != null) {\n          return typeof op.insert === 'string' ? op.insert : NULL_CHARACTER;\n        }\n        var prep = (delta === other) ? 'on' : 'with';\n        throw new Error('diff() called ' + prep + ' non-document');\n      }).join('');\n    });\n    var delta = new Delta();\n    var diffResult = diff(strings[0], strings[1], index);\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    diffResult.forEach((component) => {\n      var length = component[1].length;\n      while (length > 0) {\n        var opLength = 0;\n        switch (component[0]) {\n          case diff.INSERT:\n            opLength = Math.min(otherIter.peekLength(), length);\n            delta._push(otherIter.next(opLength));\n            break;\n          case diff.DELETE:\n            opLength = Math.min(length, thisIter.peekLength());\n            thisIter.next(opLength);\n            delta.delete(opLength);\n            break;\n          case diff.EQUAL:\n            opLength = Math.min(thisIter.peekLength(), otherIter.peekLength(), length);\n            var thisOp = thisIter.next(opLength);\n            var otherOp = otherIter.next(opLength);\n            if (deepEqual(thisOp.insert, otherOp.insert)) {\n              delta.retain(opLength, diffAttributes(thisOp.attributes, otherOp.attributes));\n            } else {\n              delta._push(otherOp).delete(opLength);\n            }\n            break;\n        }\n        length -= opLength;\n      }\n    });\n    return delta.chop();\n  }\n\n  /**\n   * Iterates through document Delta, calling a given function with a Delta and attributes object, representing the line\n   * segment.\n   *\n   * @param {Function} predicate Function to call on each line group\n   * @param {String} newline Newline character, defaults to \\n\n   */\n  eachLine(predicate, newline = '\\n') {\n    var iter = this.iterator();\n    var ops = new Delta();\n    var index = 0;\n    var lineStart = 0;\n    var currentIndex = 0;\n\n    while (iter.hasNext()) {\n      if (iter.peekType() !== 'insert') return;\n\n      var op = iter.peek();\n      var nextLength = iter.peekLength();\n      var start = getOpLength(op) - nextLength;\n      var newlineIndex = typeof op.insert === 'string' ? op.insert.indexOf(newline, start) - start : -1;\n\n      if (newlineIndex < 0) {\n        currentIndex += nextLength;\n        ops._push(iter.next());\n      } else if (newlineIndex > 0) {\n        currentIndex += newlineIndex;\n        ops._push(iter.next(newlineIndex));\n      } else {\n        currentIndex += 1;\n        var attributes = iter.next(1).attributes || {};\n        var line = { ops, attributes, start: lineStart, end: currentIndex, index: index };\n        if (predicate(line, index) === false) {\n          return;\n        }\n        index += 1;\n        lineStart = currentIndex;\n        ops = new Delta();\n      }\n    }\n    if (ops.length() > 0) {\n      var line = { ops, attributes: {}, start: lineStart, end: currentIndex, index };\n      predicate(line, index);\n    }\n  }\n\n  // Extends Delta, get the lines from `from` to `to`.\n  getLines(from = 0, to = Infinity, newline) {\n    const lines = [];\n    this.eachLine(line => {\n      if (line.start > to || (line.start === to && from !== to)) return false;\n      if (line.end > from) {\n        lines.push(line);\n      }\n    }, newline);\n    return lines;\n  }\n\n  // Extends Delta, get the line at `at`.\n  getLine(at, newline) {\n    return this.getLines(at, at, newline)[0];\n  }\n\n  // Extends Delta, get the ops from `from` to `to`.\n  getOps(from, to) {\n    let start = 0;\n    const ops = [];\n    this.ops.some(op => {\n      if (start >= to) return true;\n      const end = start + getOpLength(op);\n      if (end > from || (from === to && end === to)) {\n        ops.push({ op, start, end });\n      }\n      start = end;\n    });\n    return ops;\n  }\n\n  // Extends Delta, get the op at `at`.\n  getOp(at) {\n    return this.getOps(at, at)[0];\n  }\n\n  /**\n   * Transform given Delta against own operations. Used as an alias for transformPosition when called with a number.\n   *\n   * @param {Delta} other Delta to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Delta} Transformed Delta\n   */\n  transform(other, priority = false) {\n    if (typeof other === 'number') {\n      return this.transformPosition(other, priority);\n    }\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (thisIter.peekType() === 'insert' && (priority || otherIter.peekType() !== 'insert')) {\n        delta.retain(getOpLength(thisIter.next()));\n      } else if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (thisOp.delete) {\n          // Our delete either makes their delete redundant or removes their retain\n          continue;\n        } else if (otherOp.delete) {\n          delta._push(otherOp);\n        } else {\n          // We retain either their retain or insert\n          delta.retain(length, transformAttributes(thisOp.attributes, otherOp.attributes, priority));\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Transform an index against the delta. Useful for representing cursor/selection positions.\n   *\n   * @param {Number} index Index to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Number} Transformed index\n   */\n  transformPosition(index, priority = false) {\n    var thisIter = this.iterator();\n    var offset = 0;\n    while (thisIter.hasNext() && offset <= index) {\n      var length = thisIter.peekLength();\n      var nextType = thisIter.peekType();\n      thisIter.next();\n      if (nextType === 'delete') {\n        index -= Math.min(length, index - offset);\n        continue;\n      } else if (nextType === 'insert' && (offset < index || !priority)) {\n        index += length;\n      }\n      offset += length;\n    }\n    return index;\n  }\n\n}\n\n\n/**\n * Create an attributes object that is equivalent to applying the attributes of the target followed by the source.\n *\n * @param {Object} target Target attributes object which will have the source applied to\n * @param {Object} source Source attributes object being applied to the target\n * @param {Boolean} keepNull Whether to keep null values from source\n * @returns {Object} A new attributes object (or undefined if empty) with both\n */\nexport function composeAttributes(target = {}, source = {}, keepNull) {\n  var attributes = { ...target, ...source };\n\n  if (!keepNull) Object.keys(attributes).forEach(key => {\n    if (attributes[key] == null) delete attributes[key];\n  });\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Finds the difference between two attributes objects. Returns the source attributes that are different from the\n * target attributes.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @returns {Object} The difference between the two attribute objects or undefined if there is none\n */\nexport function diffAttributes(target = {}, source = {}) {\n  var attributes = Object.keys(target).concat(Object.keys(source)).reduce((attributes, key) => {\n    if (!deepEqual(target[key], source[key])) {\n      attributes[key] = source[key] === undefined ? null : source[key];\n    }\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Transforms the attributes of source over target (or the other way around if priority is set). Will return an\n * attributes object which has all the values from source if priority if false or will have the values from source that\n * are set on target.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @param {Boolean} priority If target has priority over source\n */\nexport function transformAttributes(target, source, priority) {\n  if (typeof target !== 'object') return source;\n  if (typeof source !== 'object') return undefined;\n  if (!priority) return source;  // b simply overwrites us without priority\n\n  var attributes = Object.keys(source).reduce((attributes, key) => {\n    if (target[key] === undefined) attributes[key] = source[key];  // null is a valid value\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Determines the length of a Delta operation.\n *\n * @param {Object} op An operation entry from a Delta object\n * @returns {Number} The length of the op\n */\nexport function getOpLength(op) {\n  if (typeof op.delete === 'number') {\n    return op.delete;\n  } else if (typeof op.retain === 'number') {\n    return op.retain;\n  } else {\n    return typeof op.insert === 'string' ? op.insert.length : 1;\n  }\n}\n\n/**\n * An iterator to handle iterating over a list of Delta operations efficiently.\n */\nexport class Iterator {\n\n  constructor(ops) {\n    this.ops = ops;\n    this.index = 0;\n    this.offset = 0;\n  }\n\n  /**\n   * Determine if there will be another operation returned by `next`.\n   *\n   * @returns {Boolean} Whether there are more operations to iterate over\n   */\n  hasNext() {\n    return this.peekLength() < Infinity;\n  }\n\n  /**\n   * Get the next operation, optionally limited/sliced by length. If an operation is sliced by length, the next call to\n   * `next` will return more of that operation until it is returned in full.\n   *\n   * @param {Number} length Optionally limit the returned operation by length, slicing it down as needed\n   */\n  next(length = Infinity) {\n    var nextOp = this.ops[this.index];\n    if (!nextOp) return { retain: Infinity };\n\n    var offset = this.offset;\n    var opLength = getOpLength(nextOp);\n\n    // Update index and offset\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n\n    if (typeof nextOp.delete === 'number') {\n      return { delete: length };\n    } else {\n      var retOp = {};\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n      return retOp;\n    }\n  }\n\n  /**\n   * Return the next entry.\n   *\n   * @returns {Object} The next entry in the ops array.\n   */\n  peek() {\n    return this.ops[this.index];\n  }\n\n  /**\n   * Check the length of the next entry.\n   *\n   * @returns {Number} The length of the next entry or Infinity if there is no next entry\n   */\n  peekLength() {\n    if (this.ops[this.index]) {\n      // Should never return 0 if our index is being managed correctly\n      return getOpLength(this.ops[this.index]) - this.offset;\n    } else {\n      return Infinity;\n    }\n  }\n\n  /**\n   * Check the type of the next entry, delete, retain, or insert.\n   *\n   * @returns {String} The type of the next entry\n   */\n  peekType() {\n    if (this.ops[this.index]) {\n      if (typeof this.ops[this.index].delete === 'number') {\n        return 'delete';\n      } else if (typeof this.ops[this.index].retain === 'number') {\n        return 'retain';\n      } else {\n        return 'insert';\n      }\n    }\n    return 'retain';\n  }\n\n  rest() {\n    if (!this.hasNext()) {\n      return [];\n    } else if (this.offset === 0) {\n      return this.ops.slice(this.index);\n    } else {\n      var offset = this.offset;\n      var index = this.index;\n      var next = this.next();\n      var rest = this.ops.slice(this.index);\n      this.offset = offset;\n      this.index = index;\n      return [next].concat(rest);\n    }\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport { shallowEqual, deepEqual } from './equal';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst empty = {};\n\n/**\n * Event for text changes, called before the change has occurred. If a listener returns false the change will be\n * canceled and not committed.\n *\n * @event Editor#text-changing\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for text changes, called after the change has occurred.\n *\n * @event Editor#text-change\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for selection changes. If part of a text change the `change`, `content`, and `oldContent` properties will be\n * set. Otherwise they will not be set.\n *\n * @event Editor#selection-change\n * @type  {Object}\n * @property {Delta} change       [ Optional ] The change which is being applied to the content\n * @property {Delta} content      [ Optional ] The new content after the change\n * @property {Delta} oldContent   [ Optional ] The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * A Typewriter Editor handles the logic for selection and editing of contents. It has no dependency on browser APIs\n * and can be used in Node.js as easily as the browser. It has no logic to limit formatting (i.e. it does not disallow\n * using bold, headers, links, or FOOBAR), that will need to be limited outside of the editor itself.\n *\n * @fires Editor#text-changing\n * @fires Editor#text-change\n * @fires Editor#selection-change\n *\n * @readonly @property {Delta}  contents      The data model for the text editor\n * @readonly @property {Number} length        The length of the contents\n * @readonly @property {String} text          The text of the contents\n * @readonly @property {Array}  selection     The current editor selection, a tuple of `[ from, to ]` or `null`\n * @readonly @property {Object} activeFormats The currently active formats (formats that will apply on the next insert)\n */\nexport default class Editor extends EventDispatcher {\n\n  /**\n   * Create a new Typewriter editor.\n   *\n   * @param {Object} options Options for this editor include initial `contents` and `modules`:\n   * @param {Delta}  options.contents The initial contents of this editor\n   * @param {Array}  options.modules  An array of functions which will be executed with the editor being passed as an\n   *                                  argument.\n   */\n  constructor(options = {}) {\n    super();\n    this.contents = null;\n    this.length = 0;\n    this.selection = null;\n    this.activeFormats = empty;\n    setContents(this, options.contents || this.delta().insert('\\n'));\n    this.modules = {};\n    this._queuedEvents = []; // Event queuing ensure they are fired in order\n    if (options.modules) Object.keys(options.modules).forEach(key => this.modules[key] = options.modules[key](this));\n  }\n\n  /**\n   * Convenience method for creating a new delta (allows other modules to not need to require Delta). Used for creating\n   * change deltas for updating the contents.\n   *\n   * @param {Array} ops [Optional] The initial ops for the delta\n   * @returns {Delta}   A new Delta object\n   */\n  delta(ops) {\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns the contents or a slice of them.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {Delta}     The contents of this editor\n   */\n  getContents(from = 0, to = this.length) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.contents.slice(from, to);\n  }\n\n  /**\n   * Returns the text for the editor or a slice of it.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor\n   */\n  getText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .filter(op => typeof op.insert === 'string')\n      .map(op => op.insert)\n      .join('');\n  }\n\n  /**\n   * Returns the text for the editor with null characters in place of embeds. This can be used to determine the index of\n   * given words or lines of text within the contents.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor with embed spaces\n   */\n  getExactText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .map(op => typeof op.insert === 'string' ? op.insert : '\\0')\n      .join('');\n  }\n\n  /**\n   * Set the selection to a new location (or null for no selection). Will return false if the new selection is the same\n   * as the old selection. Dispatches \"selection-change\" once the selection is changed. This \"selection-change\" event\n   * won't have { contents, oldContnts, change } in it since the selection is changing without any content updates.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Boolean}        Whether the selection changed or not\n   */\n  setSelection(from, to, source = SOURCE_USER) {\n    const oldSelection = this.selection;\n    let selection;\n\n    if (from === null) {\n      selection = null;\n      if (typeof to === 'string') source = to;\n    } else {\n      [from, to, source ] = this._normalizeSelection(from, to, source);\n      selection = [ from, to ].map(i => Math.min(i, this.length - 1));\n    }\n\n    if (shallowEqual(oldSelection, selection)) return false;\n\n    // Reset the active formats when selection changes (do this before setting selection)\n    this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n    this.selection = selection;\n    const event = { selection, oldSelection, source };\n\n    if (source !== SOURCE_SILENT) this.fire('selection-change', event);\n    this.fire('editor-change', event);\n    return true;\n  }\n\n  /**\n   * The method that all other methods use to update the contents (even setContents & setText). This method will\n   * dispatch the event \"text-changing\". If a listener returns `false` then the change will be canceled and null will\n   * be returned. Otherwise, the change will be successful and if the `source` is not \"silent\" a \"text-change\" event\n   * will be fired with an event object containing `{ contents, oldContents, selection, oldSelection, source }`. If the\n   * selection has changed as part of this update a \"selection-change\" event will also be fired with the same event\n   * object.\n   *\n   * @param {Delta} change    A delta change to the document\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  updateContents(change, source = SOURCE_API, selection) {\n    if (!change.chop().ops.length) return null;\n\n    const oldContents = this.contents;\n    const contents = normalizeContents(oldContents.compose(change));\n    const length = contents.length();\n    const oldSelection = this.selection;\n    if (!selection) selection = oldSelection ? oldSelection.map(i => change.transform(i)) : oldSelection;\n    selection = selection && this.getSelectedRange(selection, length - 1);\n\n    const changeEvent = { contents, oldContents, change, selection, oldSelection, source };\n    const selectionChanged = !shallowEqual(oldSelection, selection);\n\n    if (!this.fire('text-changing', changeEvent)) return null;\n\n    setContents(this, contents);\n\n    if (selection) {\n      // Reset the active formats when selection changes (do this before setting selection)\n      this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n      this.selection = selection;\n    }\n\n    const events = [];\n    if (source !== SOURCE_SILENT) {\n      events.push([ 'text-change', changeEvent ]);\n      if (selectionChanged) events.push([ 'selection-change', changeEvent ]);\n    }\n    events.push([ 'editor-change', changeEvent ]);\n    this._queueEvents(events);\n    return change;\n  }\n\n  /**\n   * Sets the entire contents of the editor. This will calculate the difference between the old content and the new and\n   * only apply the difference, if any.\n   *\n   * @param {Delta} newContents The contents of the editor, as a delta object\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  setContents(newContents, source, selection) {\n    const change = this.contents.diff(normalizeContents(newContents));\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Sets the text content of the editor, removing existing contents and formatting.\n   *\n   * @param {String} text     Set the contents of this editor as text\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  setText(text, source, selection) {\n    return this.setContents(this.delta().insert(text + '\\n'), source, selection);\n  }\n\n  /**\n   * Inserts text into the content of the editor, removing text between from and to if provided. If `text` is a newline\n   * (\"\\n\") then the formats will apply to the line, otherwise they will apply to the text only (even if there are\n   * newlines in the text).\n   *\n   * @param {Number} from      Insert the text at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} text      The text to insert into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertText(from, to, text, formats, source, selection) {\n    [ from, to, text, formats, source, selection ] =\n      this._normalizeRange(from, to, text, formats, source, selection);\n\n    // If we are not inserting a newline, make sure from and to are within the selectable range\n    if (text !== '\\n') [ from, to ] = this.getSelectedRange([ from, to ]);\n\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (selection == null && this.selection !== null) selection = from + text.length;\n    let change = this.delta().retain(from).delete(to - from);\n\n    if (text === '\\n') {\n      change.insert('\\n', formats || this.getLineFormat(from));\n    } else {\n      const lineFormat = text.indexOf('\\n') === -1 ? null : this.getLineFormat(from);\n      const textFormat = formats || this.getTextFormat(from);\n      text.split('\\n').forEach((line, i) => {\n        if (i) change.insert('\\n', lineFormat);\n        line.length && change.insert(line, textFormat);\n      });\n    }\n\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Inserts an embed into the content of the editor, removing text between from and to if provided.\n   *\n   * @param {Number} from      Insert the embed at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} embed     Insert the text into the editor's contents\n   * @param {mixed}  value     Insert the text into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertEmbed(from, to, embed, value, formats, source, selection) {\n    [ from, to, embed, value, source, selection ] =\n      this._normalizeRange(from, to, embed, value, source, selection);\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (from >= this.length) from = this.length - 1;\n    if (to >= this.length) to = this.length - 1;\n    if (selection == null && this.selection !== null) selection = from + 1;\n    const textFormat = formats || this.getTextFormat(from);\n    let change = this.delta().retain(from).delete(to - from).insert({ [embed]: value }, textFormat);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Deletes text from `from` to `to`.\n   *\n   * @param {Number} from      Insert the text as this index, can also be a range Array tuple, default 0\n   * @param {Number} to        Will delete the text between `from` and `to`\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  deleteText(from, to, source, selection) {\n    [ from, to, source, selection ] = this._normalizeRange(from, to, source, selection);\n    if (from === to) return null;\n    if (selection == null && this.selection !== null) selection = from;\n    let change = this.delta().retain(from).delete(to - from);\n    change = cleanDelete(this, from, to, change);\n\n    // Keep the active format of the text to the right of the cursor when deleting\n    let activeFormats;\n    if (selection === from) activeFormats = this.getTextFormat(from, from + 1);\n\n    const result = this.updateContents(change, source, selection);\n\n    if (result && activeFormats) this.activeFormats = activeFormats;\n    return result;\n  }\n\n  /**\n   * Get the line formats for the line that `from` is in to the line that `to` is in. Returns only the common formats\n   * between all the lines. If `from` equals `to` (or `to` is not provided) the formats will be all of those for the\n   * line `from` is on. If two lines are touched and they have different formats, an empty object will be returned.\n   *\n   * @param {Number} from Getting line formats starting at `from`\n   * @param {Number} to   Getting line formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines which intersect from and to\n   */\n  getLineFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!line.attributes) formats = {};\n      else if (!formats) formats = { ...line.attributes };\n      else formats = combineFormats(formats, line.attributes);\n    });\n\n    return formats;\n  }\n\n  /**\n   * Get the text formats for all the text from `from` to `to`. Returns only the common formats between the two indexes.\n   * Will also return the `activeFormats`. Active formats are those which are toggled on when the selection is collapsed\n   * (from and to are equal) indicating inserted text should use (or not use) those formats.\n   *\n   * @param {Number} from Getting text formats starting at `from`\n   * @param {Number} to   Getting text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the text\n   */\n  getTextFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    // optimize for current selection\n    const seleciton = this.selection;\n    if (from === to && shallowEqual(this.selection, [ from, to ])) {\n      return this.activeFormats;\n    }\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      if (/^\\n+$/.test(op.insert)) return;\n      if (!op.attributes) formats = {};\n      else if (!formats) formats = { ...op.attributes };\n      else formats = combineFormats(formats, op.attributes);\n    });\n\n    if (!formats) formats = {};\n\n    return formats;\n  }\n\n  /**\n   * Get the text and line formats for all the lines and text from `from` to `to`.\n   *\n   * @param {Number} from Getting line and text formats starting at `from`\n   * @param {Number} to   Getting line and text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines and text which intersect from and to\n   */\n  getFormat(from, to) {\n    return { ...this.getTextFormat(from, to), ...this.getLineFormat(from, to) };\n  }\n\n  /**\n   * Formats the lines intersected by `from` and `to` with the given line formats. To remove an existing format pass in\n   * `null` or `false` to turn it off (e.g. `{ blockquote: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatLine(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    const change = this.delta();\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      // Clear out old formats on the line\n      Object.keys(line.attributes).forEach(name => !formats[name] && (formats[name] = null));\n      change.retain(1, formats);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Adds additional attributes or classes to the lines intersected by `from` and `to`. Markups are easy to nest to add\n   * additional attributes/classes, but you cannot do that with lines/blocks.\n   * Setting a class to false will remove a previous decoration, but it will not remove a class which is part of the\n   * block definition. This method is a cross-over with HTML view and should be used sparingly.\n   *\n   * Example:\n   * ```js\n   * editor.decorateLine(0, {\n   *   attributes: { 'data-placeholder': 'Enter Text' },\n   *   classes: { active: true, empty: true }\n   * });\n   * // <p data-placeholder=\"Enter Text\" class=\"active empty\">\n   * ```\n   *\n   * @param {Number} from        The starting index\n   * @param {Number} to          The ending index\n   * @param {String} decorations The attributes/classes for the line.\n   * @param {String} source      The source of the change, user, api, or silent\n   * @returns {Delta}            Returns the change when successful, or null if not\n   */\n  decorateLine(from, to, decorations, source) {\n    [ from, to, decorations, source ] = this._normalizeRange(from, to, decorations, source);\n    const change = this.delta();\n\n    if (decorations.attributes) {\n      Object.keys(decorations.attributes).forEach(name => {\n        if (decorations.attributes[name] === '') decorations.attributes[name] = true;\n      });\n    }\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      let { attributes, classes } = decorations;\n\n      // Merge with any existing formats on the line\n      if (attributes) {\n        if (line.attributes.attributes) {\n          decorations = { ...decorations, attributes: { ...line.attributes.attributes, ...attributes }};\n        }\n\n        Object.keys(attributes).forEach(name => {\n          const value = attributes[name];\n          if (value == null || value === false) delete decorations.attributes[name];\n        });\n\n        if (!Object.keys(decorations.attributes).length) {\n          decorations = { ...decorations, attributes: null };\n        }\n      }\n      if (classes) {\n        if (line.attributes.classes) {\n          decorations = { ...decorations, classes: { ...line.attributes.classes, ...classes }};\n        }\n\n        Object.keys(classes).forEach(name => {\n          if (!classes[name]) delete decorations.classes[name];\n        });\n\n        if (!Object.keys(decorations.classes).length) {\n          decorations = { ...decorations, classes: null };\n        }\n      }\n\n      change.retain(1, decorations);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Formats the text from `from` to `to` with the given text formats. To remove an existing format pass in `null` or\n   * `false` to turn it off (e.g. `{ bold: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatText(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    if (from === to) {\n      if (this.activeFormats === empty) this.activeFormats = {};\n      Object.keys(formats).forEach(key => {\n        const value = formats[key];\n        if (value == null || value === false) delete this.activeFormats[key];\n        else this.activeFormats[key] = value;\n      });\n      return;\n    }\n    Object.keys(formats).forEach(name => formats[name] === false && (formats[name] = null));\n    const change = this.delta().retain(from);\n    this.getText(from, to).split('\\n').forEach(line => {\n      line.length && change.retain(line.length, formats);\n      change.retain(1);\n    });\n    change.chop();\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Toggles the line formats from `from` to `to` with the given line formats. If the line has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleLineFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getLineFormat(from, to);\n    if (deepEqual(existing, format)) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatLine(from, to, format, source);\n  }\n\n  /**\n   * Toggles the text formats from `from` to `to` with the given text formats. If the text has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleTextFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getTextFormat(from, to);\n    const isSame = Object.keys(format).every(key => format[key] === existing[key]);\n    if (isSame) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatText(from, to, format, source);\n  }\n\n  /**\n   * Removes all formatting, text and line formats, for the text and lines from `from` to `to`.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  removeFormat(from, to, source) {\n    [ from, to, source ] = this._normalizeRange(from, to, source);\n    const formats = {};\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      op.attributes && Object.keys(op.attributes).forEach(key => formats[key] = null);\n    });\n\n    let change = this.delta().retain(from).retain(to - from, formats);\n\n    // If the last block was not captured be sure to clear that too\n    this.contents.getLines(from, to).forEach(line => {\n      const formats = {};\n      Object.keys(line.attributes).forEach(key => formats[key] = null);\n      change = change.compose(this.delta().retain(line.end - 1).retain(1, formats));\n    });\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Create a change delta calling one or more methods on the editor. The changes will not be applied as normal but will\n   * be collated into a single change delta and returned from this methnod. Example:\n   * ```js\n   * var change = editor.getChange(function() {\n   *   editor.deleteText(0, 5);\n   *   editor.insertText('\\n', { blockquote: true });\n   *   editor.formatText(10, 20, { bold: true });\n   * });\n   *\n   * editor.updateContents(change, 'user');\n   * ```\n   *\n   * @param {Function} producer A function in which to call methods on the editor to produce a change\n   * @returns {Delta}           The sum of all the changes made within the producer\n   */\n  getChange(producer) {\n    let change = this.delta();\n    this.updateContents = singleChange => {\n      if (singleChange.ops.length) {\n        change = change.compose(singleChange);\n        return singleChange;\n      } else {\n        return null;\n      }\n    };\n    producer(this);\n    delete this.updateContents;\n    return change;\n  }\n\n  /**\n   * Make several changes to the editor apply all at one in one commit. Changes made with the transaction will be\n   * applied all together and the \"text-changing\", \"text-change\", and \"selection-change\" events will be dispatched only\n   * once. Use this to combine multiple changes into one.\n   *\n   * @param {Function} producer A function which should make changes with the editor\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  transaction(producer, source, selection) {\n    const change = this.getChange(producer);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Returns the selected range (or the provided range) in index order (lowest number first) and within the bounds of\n   * the content, between 0 and content.length() - 1 (the selection cannot be past the trailing newline).\n   *\n   * @param {Array} range Optional range, defaults to current selection\n   * @param {Number} max  The maxium number the range can be\n   */\n  getSelectedRange(range = this.selection, max = this.length - 1) {\n    if (range == null) return range;\n    if (typeof range === 'number') range = [ range, range ];\n    if (range[0] > range[1]) [range[0], range[1]] = [range[1], range[0]];\n    return range.map(index => Math.max(0, Math.min(max, index)));\n  }\n\n  _queueEvents(events) {\n    const alreadyRunning = this._queuedEvents.length;\n    this._queuedEvents.push(...events);\n    if (alreadyRunning) return;\n    while (this._queuedEvents.length) {\n      const event = this._queuedEvents.shift();\n      this.fire(...event);\n    }\n  }\n\n  /**\n   * Normalizes range values to a proper range if it is not already. A range is a `from` and a `to` index, e.g. 0, 4.\n   * This will ensure the lower index is first. Example usage:\n   * editor._normalizeRange(5); // [5, 5]\n   * editor._normalizeRange(-4, 100); // for a doc with length 10, [0, 10]\n   * editor._normalizeRange(25, 18); // [18, 25]\n   * editor._normalizeRange([12, 13]); // [12, 13]\n   * editor._normalizeRange(5, { bold: true }); // [5, 5, { bold: true }]\n   */\n  _normalizeRange(from, to, ...rest) {\n    [ from, to, ...rest ] = this._normalizeSelection(from, to, ...rest);\n    if (from > to) {\n      const toValue = from;\n      from = to;\n      to = toValue;\n    }\n    return [from, to].concat(rest);\n  }\n\n  _normalizeSelection(from, to, ...rest) {\n    if (Array.isArray(from)) {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      [from, to] = from;\n      if (to === undefined) to = from;\n    } else if (typeof from !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      if (from !== undefined || rest.length) rest.unshift(from);\n      from = to = 0;\n    } else if (typeof to !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      to = from;\n    }\n    from = Math.max(0, Math.min(this.length, Math.floor(from)));\n    to = Math.max(0, Math.min(this.length, Math.floor(to)));\n    return [from, to].concat(rest);\n  }\n}\n\n// Ensures the format for the current line in a delete remains the same when multiple lines are deleted. This is needed\n// because the last line holds the formatting after a delete, but the first line is expected to be the retained format\nfunction cleanDelete(editor, from, to, change) {\n  if (from !== to) {\n    const line = editor.contents.getLine(from);\n    if (!line.ops.length() && to === from + 1) return change;\n    const lineFormat = editor.getLineFormat(from);\n    if (!deepEqual(lineFormat, editor.getLineFormat(to))) {\n      const lineChange = editor.getChange(() => editor.formatLine(to, lineFormat))\n      change = change.compose(change.transform(lineChange));\n    }\n  }\n  return change;\n}\n\n// Ensures contents end with a newline\nfunction normalizeContents(contents) {\n  // Contents only have inserts. Deletes and retains belong to changes only.\n  contents.ops = contents.ops.filter(op => op.insert);\n  const lastOp = contents.ops[contents.ops.length - 1];\n  if (!lastOp || typeof lastOp.insert !== 'string' || lastOp.insert.slice(-1) !== '\\n') contents.insert('\\n');\n  return contents;\n}\n\n// Delta no operation method\nfunction deltaNoop() {\n  return this;\n}\n\n// Sets the contents onto the editor after ensuring they end in a newline, freezes the contents from change, and\n// updates the length and text of the editor to the latest\nfunction setContents(editor, contents) {\n  contents = normalizeContents(contents);\n  contents.freeze();\n  editor.contents = contents;\n  editor.length = contents.length();\n}\n\n// Combine formats removing ones that don't exist in both and creating an array for those with multiple values\nfunction combineFormats(formats, combined) {\n  return Object.keys(combined).reduce(function(merged, name) {\n    if (formats[name] == null) return merged;\n    if (combined[name] === formats[name]) {\n      merged[name] = combined[name];\n    } else if (Array.isArray(combined[name])) {\n      if (combined[name].indexOf(formats[name]) < 0) {\n        merged[name] = combined[name].concat([formats[name]]);\n      }\n    } else {\n      merged[name] = [combined[name], formats[name]];\n    }\n    return merged;\n  }, {});\n}\n","// Based off of https://github.com/jorgebucaran/ultradom/ MIT licensed\n\nexport function h(name, attributes) {\n  var rest = [];\n  var children = [];\n  var length = arguments.length;\n\n  while (length-- > 2) rest.push(arguments[length]);\n\n  while (rest.length) {\n    var node = rest.pop();\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length]);\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node);\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        name,\n        attributes: attributes || {},\n        children: children\n      };\n}\n\nexport function render(node, element) {\n  element = element ?\n    patch(element.parentNode, element, node) :\n    patch(null, null, node);\n  return element;\n}\n\nexport function renderChildren(node, element) {\n  patchChildren(element, node.children);\n}\n\n\nfunction clone(target, source) {\n  var obj = {};\n\n  for (var i in target) obj[i] = target[i];\n  for (var i in source) obj[i] = source[i];\n\n  return obj;\n}\n\nfunction eventListener(event) {\n  return event.currentTarget.events[event.type](event);\n}\n\nfunction updateAttribute(element, name, value, isSvg) {\n  if (name[0] === \"o\" && name[1] === \"n\") {\n    if (!element.events) {\n      element.events = {};\n    }\n    name = name.slice(2);\n    const oldValue = element.events[name];\n    element.events[name] = value;\n    if (value) {\n      if (!oldValue) {\n        element.addEventListener(name, eventListener);\n      }\n    } else {\n      element.removeEventListener(name, eventListener);\n    }\n  } else if (name in element && name !== \"list\" && !isSvg) {\n    element[name] = value == null ? \"\" : value;\n  } else if (value != null && value !== false) {\n    element.setAttribute(name, value === true ? '' : value);\n  }\n\n  if (value == null || value === false) {\n    element.removeAttribute(name);\n  }\n}\n\nfunction createElement(node, isSvg) {\n  var element =\n    typeof node === \"string\" || typeof node === \"number\"\n      ? document.createTextNode(node)\n      : (isSvg = isSvg || node.name === \"svg\")\n        ? document.createElementNS(\n            \"http://www.w3.org/2000/svg\",\n            node.name\n          )\n        : document.createElement(node.name);\n\n  var attributes = node.attributes;\n  if (attributes) {\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSvg));\n    }\n\n    for (var name in attributes) {\n      updateAttribute(element, name, attributes[name], isSvg);\n    }\n  }\n\n  return element;\n}\n\nfunction getElementAttributes(element, isSvg) {\n  var attributes = {};\n  for (var i = 0; i < element.attributes.length; i++) {\n    var { name, value } = element.attributes[i];\n    if (name in element && name !== \"list\" && !isSvg) {\n      attributes[name] = element[name];\n    } else {\n      attributes[name] = value === '' ? true : value;\n    }\n  }\n  return attributes;\n}\n\nfunction updateElement(element, attributes, isSvg) {\n  var oldAttributes = getElementAttributes(element);\n  for (var name in clone(oldAttributes, attributes)) {\n    if (\n      attributes[name] !==\n      (name === \"value\" || name === \"checked\"\n        ? element[name]\n        : oldAttributes[name])\n    ) {\n      updateAttribute(\n        element,\n        name,\n        attributes[name],\n        isSvg\n      )\n    }\n  }\n}\n\nfunction removeElement(parent, element) {\n  parent.removeChild(element);\n}\n\nfunction patchChildren(element, children, isSvg) {\n  var i = 0;\n\n  while (i < children.length) {\n    patch(element, element.childNodes[i], children[i], isSvg);\n    i++;\n  }\n\n  while (i < element.childNodes.length) {\n    removeElement(element, element.childNodes[i]);\n  }\n}\n\nfunction patch(parent, element, node, isSvg) {\n  var name = element && element.nodeName !== '#text' ? element.nodeName.toLowerCase() : undefined;\n  if (element == null || name !== node.name) {\n    var newElement = createElement(node, isSvg);\n\n    if (parent) {\n      parent.insertBefore(newElement, element);\n      if (element != null) {\n        removeElement(parent, element);\n      }\n    }\n\n    element = newElement;\n  } else if (name == null) {\n    if (element.nodeValue !== node) element.nodeValue = node;\n  } else {\n    updateElement(\n      element,\n      node.attributes,\n      (isSvg = isSvg || node.name === \"svg\")\n    );\n\n    patchChildren(element, node.children, isSvg);\n  }\n  return element;\n}\n","\n\nexport function decorateBlock(vdom, attr) {\n  if (!attr.attributes && !attr.classes) return vdom;\n  const { attributes, classes } = attr;\n  if (attributes) {\n    Object.keys(attributes).forEach(name => {\n      vdom.attributes[name] = attributes[name];\n    });\n  }\n  if (classes) {\n    const classArray = Object.keys(classes);\n    if (classArray.length) {\n      if (vdom.attributes.class) classArray.unshift(vdom.attributes.class);\n      vdom.attributes.class = classArray.join(' ');\n    }\n  }\n  return vdom;\n}\n\nexport function undecorateBlock(node, block, attr) {\n  const ignoreClasses = {};\n  const ignoreAttributes = { class: true };\n  block.selector.replace(/\\.([-\\w])/, (_, name) => ignoreClasses[name] = true);\n  block.selector.replace(/\\[([-\\w])[^\\]]\\]/, (_, name) => ignoreAttributes[name] = true);\n  let attrLength = node.attributes.length;\n\n  if (node.classList.length) {\n    attrLength--;\n    const classes = {};\n    let match = false;\n\n    for (let i = 0; i < node.classList.length; i++) {\n      const name = node.classList.item(i);\n      if (!ignoreClasses[name]) {\n        match = true;\n        classes[name] = true;\n      }\n    }\n    if (match) attr.classes = classes;\n  }\n\n  if (attrLength) {\n    const attributes = {};\n    let match = false;\n\n    for (let i = 0; i < node.attributes.length; i++) {\n      const attribute = node.attributes[i];\n      if (!ignoreAttributes[attribute.name]) {\n        match = true;\n        attributes[attribute.name] = attribute.value || true;\n      }\n    }\n    if (match) attr.attributes = attributes;\n  }\n  return attr;\n}\n","import { h } from './vdom';\nimport { decorateBlock } from './dom-utils';\n\n\nexport const paragraph = {\n  name: 'paragraph',\n  selector: 'p',\n  vdom: children => <p>{children}</p>,\n};\n\n\nexport const header = {\n  name: 'header',\n  selector: 'h1, h2, h3, h4, h5, h6',\n  defaultFollows: true,\n  dom: node => ({ header: parseInt(node.nodeName.replace('H', '')) }),\n  vdom: (children, attr) => {\n    const H = `h${attr.header}`;\n    return <H>{children}</H>;\n  },\n};\n\n\nexport const list = {\n  name: 'list',\n  selector: 'ul > li, ol > li',\n  optimize: true,\n  dom: node => {\n    let indent = -1, parent = node.parentNode;\n    const list = parent.nodeName === 'OL' ? 'ordered' : 'bullet';\n    while (parent) {\n      if (/^UL|OL$/.test(parent.nodeName)) indent++;\n      else if (parent.nodeName !== 'LI') break;\n      parent = parent.parentNode;\n    }\n    const attr = { list };\n    if (indent) attr.indent = indent;\n    return attr;\n  },\n  vdom: lists => {\n    const topLevelChildren = [];\n    const levels = [];\n    // e.g. levels = [ul, li, ul, li]\n\n    lists.forEach(([children, attr]) => {\n      const List = attr.list === 'ordered' ? 'ol' : 'ul';\n      const index = Math.min((attr.indent || 0) * 2, levels.length);\n      const item = decorateBlock(<li>{children}</li>, attr);\n      let list = levels[index];\n      if (list && list.name === List) {\n        list.children.push(item);\n      } else {\n        list = <List>{item}</List>;\n        const childrenArray = index ? levels[index - 1].children : topLevelChildren;\n        childrenArray.push(list);\n        levels[index] = list;\n      }\n      levels[index + 1] = item;\n      levels.length = index + 2;\n    });\n\n    return topLevelChildren;\n  },\n};\n\nexport const blockquote = {\n  name: 'blockquote',\n  selector: 'blockquote p',\n  optimize: true,\n  vdom: quotes => {\n    return <blockquote>{quotes.map(([children, attr]) => decorateBlock(<p>{children}</p>, attr))}</blockquote>;\n  },\n};\n\nexport const codeblock = {\n  name: 'code-block',\n  selector: 'pre code, pre',\n  optimize: true,\n  vdom: lines => {\n    return <pre>{lines.map(([children, attr]) => [children, '\\n'])}</pre>;\n  },\n};\n\nexport const hr = {\n  name: 'hr',\n  selector: 'hr',\n  vdom: () => <hr/>,\n};\n","import { h } from './vdom';\n\n\nexport const bold = {\n  name: 'bold',\n  selector: 'strong, b',\n  styleSelector: '[style*=\"bold\"]',\n  vdom: children => <strong>{children}</strong>,\n};\n\n\nexport const italic = {\n  name: 'italic',\n  selector: 'em, i',\n  styleSelector: '[style*=\"italic\"]',\n  vdom: children => <em>{children}</em>,\n};\n\n\nexport const code = {\n  name: 'code',\n  selector: 'code',\n  vdom: children => <code>{children}</code>,\n};\n\n\nexport const link = {\n  name: 'link',\n  selector: 'a[href]',\n  dom: node => node.href,\n  vdom: (children, attr) => <a href={attr.link} target=\"_blank\">{children}</a>,\n};\n","import { h } from './vdom';\n\n\nexport const image = {\n  name: 'image',\n  selector: 'img',\n  dom: node => node.src,\n  vdom: value => <img src={value}/>,\n};\n\nexport const br = {\n  name: 'br',\n  selector: 'br',\n  vdom: value => <br/>,\n};\n\n// To represent a collaborator's cursor, for use in decorators\nexport const cursor = {\n  name: 'cursor',\n  selector: 'span.cursor',\n  dom: node => ({ name: node.dataset.name, color: node.style.backgroundColor }),\n  vdom: value => {\n    return <span class=\"cursor\" data-name={value.name} style={ `background-color: ${value.color}` }></span>\n  },\n};\n","import { paragraph, header, list, blockquote, codeblock, hr } from './blocks';\nimport { bold, italic, code, link } from './markups';\nimport { image, br } from './embeds';\n\n\nexport default {\n  blocks: [ paragraph, header, list, blockquote, hr ],\n  markups: [ italic, bold, link ],\n  embeds: [ image, br ],\n};\n","const indexOf = [].indexOf;\n\n// Get the range (a tuple of indexes) for this view from the browser selection\nexport function getSelection(view, range) {\n  const root = view.root;\n  const selection = !range ? root.ownerDocument.getSelection() : {\n    anchorNode: range.startContainer, anchorOffset: range.startOffset,\n    focusNode: range.endContainer, focusOffset: range.endOffset,\n    isCollapsed: range.collapsed,\n  };\n\n  if (!root.contains(selection.anchorNode)) {\n    return null;\n  } else {\n    const anchorIndex = getNodeAndOffsetIndex(view, selection.anchorNode, selection.anchorOffset);\n    const isCollapsed = selection.anchorNode === selection.focusNode && selection.anchorOffset === selection.focusOffset;\n    // selection.isCollapsed causes a layout on Chrome. ?? Manual detection does not.\n    let focusIndex = isCollapsed ?\n      anchorIndex :\n      getNodeAndOffsetIndex(view, selection.focusNode, selection.focusOffset);\n\n    return [ anchorIndex, focusIndex ];\n  }\n}\n\n// Set the browser selection to the range (a tuple of indexes) of this view\nexport function setSelection(view, range) {\n  const root = view.root;\n  const selection = root.ownerDocument.getSelection();\n  const hasFocus = selection.anchorNode && root.contains(selection.anchorNode);\n\n  if (range == null) {\n    if (hasFocus) {\n      root.blur();\n      selection.removeAllRanges();\n    }\n  } else {\n    const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n    if (anchorNode && focusNode) {\n      selection.setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset);\n    }\n    if (!hasFocus) root.focus();\n  }\n}\n\n// Get a browser range object for the given editor range tuple\nexport function getBrowserRange(view, range) {\n  if (range[0] > range[1]) range = [ range[1], range[0] ];\n  const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n  const browserRange = document.createRange();\n  if (anchorNode && focusNode) {\n    browserRange.setStart(anchorNode, anchorOffset);\n    browserRange.setEnd(focusNode, focusOffset);\n  }\n  return browserRange;\n}\n\n\n// Get the browser nodes and offsets for the range (a tuple of indexes) of this view\nexport function getNodesForRange(view, range) {\n  if (range == null) {\n    return [ null, 0, null, 0 ];\n  } else {\n    const [ anchorNode, anchorOffset ] = getNodeAndOffset(view, range[0]);\n    const [ focusNode, focusOffset ] = range[0] === range[1] ?\n          [ anchorNode, anchorOffset ] : getNodeAndOffset(view, range[1]);\n\n    return [ anchorNode, anchorOffset, focusNode, focusOffset ];\n  }\n}\n\nexport function getNodeAndOffset(view, index) {\n  const root = view.root;\n  const inDom = root.ownerDocument.contains(root);\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || inDom) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  let count = 0, node, firstBlockSeen = false;\n  walker.currentNode = root;\n  while ((node = walker.nextNode())) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      const size = node.nodeValue.length\n      if (index <= count + size) return [ node, index - count ];\n      count += size;\n    } else if (embeds.matches(node) && !isBRPlaceholder(view, node)) {\n      count += 1;\n      // If the selection lands after this embed, and the next node isn't a text node, place the selection\n      if (count === index && (!node.nextSibling || node.nextSibling.nodeType !== Node.TEXT_NODE)) {\n        return [ node.parentNode, indexOf.call(node.parentNode.childNodes, node) + 1 ];\n      }\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) count += 1;\n      else firstBlockSeen = true;\n\n      // If the selection lands at the beginning of a block, and the first node isn't a text node, place the selection\n      if (count === index && (!node.firstChild || node.firstChild.nodeType !== Node.TEXT_NODE)) {\n        return [ node, 0 ];\n      }\n    }\n  }\n  return [ null, 0 ];\n}\n\nexport function getNodeAndOffsetIndex(view, node, offset) {\n  if (node.nodeType === Node.ELEMENT_NODE && offset > 0) {\n    node = node.childNodes[offset - 1];\n    offset = node.nodeType === Node.ELEMENT_NODE ? 0 : node.nodeValue.length;\n  }\n  return getNodeIndex(view, node) + offset;\n}\n\n// Get the index the node starts at in the content\nexport function getNodeIndex(view, node) {\n  const root = view.root;\n  const inDom = root.ownerDocument.contains(root);\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || inDom) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  walker.currentNode = node;\n  let index = node.nodeType === Node.ELEMENT_NODE ? 0 : -1;\n  while ((node = walker.previousNode())) {\n    if (node === root) continue;\n    else if (node.nodeType === Node.TEXT_NODE) index += node.nodeValue.length;\n    else if (embeds.matches(node) && !isBRPlaceholder(view, node)) index++;\n    else if (blocks.matches(node)) index++;\n  }\n  return index;\n}\n\n// Determines if a node is actually a BR in our content or if is just the placeholder BR which appears in an empty block\n// or at the end of a block\nexport function isBRPlaceholder(view, node) {\n  if (node.nodeName !== 'BR') return false;\n  const { blocks } = view.paper;\n  if (node.nextSibling) {\n    return node.nextSibling.nodeType !== Node.TEXT_NODE && blocks.matches(node.nextSibling);\n  }\n  return blocks.matches(node.parentNode);\n}\n","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\nconst matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nexport default function escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}","import { h } from './view/vdom';\n\nexport default class Paper {\n  constructor(types) {\n    this.blocks = new Types();\n    this.markups = new Types();\n    this.embeds = new Types();\n    this.container = types.container || container;\n    if (types && types.blocks) types.blocks.forEach(block => this.blocks.add(block));\n    if (types && types.markups) types.markups.forEach(markup => this.markups.add(markup));\n    if (types && types.embeds) types.embeds.forEach(embed => this.embeds.add(embed));\n  }\n}\n\n\nexport function container(children, paper) {\n  return <div class=\"typewriter-editor\" contentEditable=\"true\">\n    {children && children.length ? children : paper.blocks.getDefault().vdom()}\n  </div>;\n}\n\n\nclass Types {\n  constructor() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  add(definition, index) {\n    if (!definition.name || !definition.selector || !definition.vdom) {\n      throw new Error('DOMType definitions must include a name, selector, and vdom function');\n    }\n    if (this.types[definition.name]) this.remove(definition.name);\n    this.selector += (this.selector ? ', ' : '') + definition.selector;\n    this.types[definition.name] = definition;\n    if (typeof index !== 'number') {\n      this.priorities[name] = this.array.length;\n      this.array.push(definition);\n    } else {\n      this.array.splice(i, 0, definition);\n      this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    }\n  }\n\n  remove(name) {\n    if (!this.types[name]) return;\n    delete this.types[name];\n    this.array = this.array.filter(domType => domType.name !== name);\n    this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    this.selector = this.array.map(type => type.selector).join(', ');\n  }\n\n  clear() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  get(name) {\n    return this.types[name];\n  }\n\n  priority(name) {\n    return this.priorities[name];\n  }\n\n  getDefault() {\n    return this.array[0];\n  }\n\n  matches(node) {\n    if (node.nodeType) {\n      return this.selector ? node.matches(this.selector) : false;\n    } else {\n      throw new Error('Cannot match against ' + node);\n    }\n  }\n\n  find(nodeOrAttr) {\n    if (nodeOrAttr.nodeType) {\n      let i = this.array.length;\n      while (i--) {\n        let domType = this.array[i];\n        if (nodeOrAttr.matches(domType.selector)) return domType;\n      }\n    } else if (nodeOrAttr && typeof nodeOrAttr === 'object') {\n      let domType;\n      const keys = Object.keys(nodeOrAttr);\n      keys.length ? keys.some(name => domType = this.get(name)) : (domType = this.getDefault());\n      return domType;\n    }\n  }\n}\n","import Delta from '../delta';\nimport { deepEqual } from '../equal';\nimport escape from '../escape-html';\nimport { h } from './vdom';\nimport { isBRPlaceholder } from './selection';\nimport { decorateBlock, undecorateBlock } from './dom-utils';\nimport defaultPaper from './defaultPaper';\nimport Paper from '../paper';\nconst nodeMarkup = new WeakMap();\n\nconst BR = <br/>;\nconst VOID_ELEMENTS = {\n  area: true, base: true, br: true, col: true, embed: true, hr: true, img: true, input: true,\n  link: true, meta: true, param: true, source: true, track: true, wbr: true\n};\nconst SKIP_ELEMENTS = {\n  STYLE: true, SCRIPT: true, LINK: true, META: true, TITLE: true\n};\nconst BLOCK_ELEMENTS = 'address, article, aside, blockquote, canvas, dd, div, dl, dt, fieldset, figcaption, figure, footer, form, header, hr, li, main, nav, noscript, ol, output, p, pre, section, table, tfoot, ul, video';\n\n\nexport function deltaToVdom(delta, paper = new Paper(defaultPaper)) {\n  const { blocks, markups, embeds, container } = paper;\n  const blockData = [];\n\n  delta.eachLine(({ ops, attributes }) => {\n    let inlineChildren = [];\n\n    // Collect block children\n    ops.forEach((op, i, array) => {\n      if (op.insert) {\n        let children = [];\n        if (typeof op.insert === 'string') {\n          const prev = array[i - 1];\n          const next = array[i + 1];\n          let text = op.insert.replace(/  /g, '\\xA0 ');\n          if (!prev) text = text.replace(/^ /, '\\xA0');\n          if (!next || (typeof next.insert === 'string' && next.insert[0] === ' ')) text = text.replace(/ $/, '\\xA0');\n          children.push(text);\n        } else {\n          const embed = embeds.find(op.insert);\n          if (embed) {\n            const node = embed.vdom(op.insert[embed.name], paper);\n            children.push(node);\n          }\n        }\n\n        if (op.attributes) {\n          // Sort them by the order found in markups and be efficient\n          Object.keys(op.attributes).sort((a, b) => markups.priority(b) - markups.priority(a)).forEach(name => {\n            const markup = markups.get(name);\n            if (markup) {\n              const node = markup.vdom(children, op.attributes, paper);\n              nodeMarkup.set(node, markup); // Store for merging\n              children = [ node ];\n            }\n          });\n        }\n        inlineChildren.push.apply(inlineChildren, children);\n      }\n    });\n\n    // Merge markups to optimize\n    inlineChildren = mergeChildren(inlineChildren);\n    const lastChild = inlineChildren[inlineChildren.length - 1];\n    if (!inlineChildren.length || (lastChild && lastChild.name === 'br')) {\n      inlineChildren.push(BR);\n    }\n\n    let block = blocks.find(attributes);\n    if (!block) block = blocks.getDefault();\n\n    blockData.push([ block, inlineChildren, attributes ]);\n  });\n\n  // If a block has optimize=true on it, vdom will be called with all sibling nodes of the same block\n  let blockChildren = [], prevBlock;\n  let collect = [];\n  blockData.forEach((data, i) => {\n    const [ block, children, attr ] = data;\n    if (block.optimize) {\n      collect.push([ children, attr ]);\n      const next = blockData[i + 1];\n      if (!next || next[0] !== block) {\n        const children = block.vdom.call(paper, collect);\n        blockChildren = blockChildren.concat(children);\n        collect = [];\n      }\n    } else {\n      const node = block.vdom.call(paper, children, attr);\n      decorateBlock(node, attr);\n      blockChildren.push(node);\n    }\n  });\n\n  return container(blockChildren, paper);\n}\n\n\nexport function deltaFromDom(view, root = view.root, opts) {\n  const inDom = root.ownerDocument.contains(root);\n  const paper = view.paper;\n  const { blocks, markups, embeds } = paper;\n\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      if (SKIP_ELEMENTS[node.nodeName]) {\n        return NodeFilter.FILTER_REJECT;\n      } else if (node.nodeType === Node.TEXT_NODE || (!opts || opts.notInDom) || inDom) {\n        return NodeFilter.FILTER_ACCEPT;\n      } else {\n        return NodeFilter.FILTER_REJECT;\n      }\n    }\n  });\n  const delta = new Delta();\n  let currentBlock, firstBlockSeen = false, unknownBlock = false, empty = true, node;\n\n  walker.currentNode = root;\n\n  while ((node = walker.nextNode())) {\n\n    if (isBRPlaceholder(view, node)) {\n      empty = false;\n    } else if (node.nodeType === Node.TEXT_NODE) {\n      // non-breaking spaces are a space, newlines may exist with pasted content but should only be acknowledged within\n      // text\n      if (node.nodeValue.replace(/\\n+/g, '') === '') continue;\n      const text = node.nodeValue.replace(/\\xA0/g, ' ').replace(/\\n+/g, ' ');\n      if (!text || (text === ' ' && node.parentNode.classList.contains('EOP'))) continue;\n      let parent = node.parentNode, attr = {};\n\n      while (parent && !blocks.matches(parent) && parent !== root) {\n        if (markups.matches(parent)) {\n          const markup = markups.find(parent);\n          attr[markup.name] = markup.dom ? markup.dom(parent, paper) : true;\n        } else if (parent.hasAttribute('style')) {\n          markups.array.forEach(markup => {\n            if (markup.styleSelector && parent.matches(markup.styleSelector)) {\n              attr[markup.name] = markup.dom ? markup.dom(parent, paper) : true;\n            }\n          })\n        }\n        parent = parent.parentNode;\n      }\n\n      empty = false;\n      delta.insert(text, attr);\n    } else if (embeds.matches(node)) {\n      const embed = embeds.find(node);\n      if (embed) {\n        delta.insert({ [embed.name]: embed.dom ? embed.dom(node, paper) : true });\n      }\n    } else if (blocks.matches(node) || (node.matches && node.matches(BLOCK_ELEMENTS))) {\n      unknownBlock = !blocks.matches(node);\n\n      if (!blocks.matches(node)) {\n        let parent = node.parentNode;\n        while (parent && !blocks.matches(parent) && parent !== root) {\n          parent = parent.parentNode;\n        }\n        // If this block element is inside a recognized block, ignore it\n        if (parent !== root && blocks.matches(parent)) {\n          continue;\n        }\n      }\n\n      const block = blocks.find(node) || blocks.getDefault();\n      // Skip paragraphs/divs inside blockquotes and list items etc.\n      if (block === blocks.getDefault() && blocks.matches(node.parentNode)) {\n        continue;\n      }\n\n      if (firstBlockSeen) {\n        if (!unknownBlock || !empty) {\n          delta.insert('\\n', currentBlock);\n          empty = true;\n        }\n      } else {\n        firstBlockSeen = true;\n      }\n\n      if (block !== blocks.getDefault()) {\n        currentBlock = block.dom ? block.dom(node, paper) : { [block.name]: true };\n      } else {\n        currentBlock = {};\n      }\n      if (!opts || !opts.ignoreAttributes) {\n        currentBlock = undecorateBlock(node, block, currentBlock);\n      }\n    }\n  }\n  if (!unknownBlock || !empty) {\n    delta.insert('\\n', currentBlock);\n  }\n  return delta;\n}\n\n/**\n * Converts a delta object into an HTML string based off of the supplied Paper definition.\n */\nexport function deltaToHTML(delta, paper) {\n  return childrenToHTML(deltaToVdom(delta, paper).children);\n}\n\n/**\n * Converts an HTML string into a delta object based off of the supplied Paper definition.\n */\nexport function deltaFromHTML(view, html) {\n  const template = document.createElement('template');\n  template.innerHTML = '<div>' + html + '</div>';\n  return deltaFromDom(view, template.content.firstChild, { notInDom: true });\n}\n\n\n// Joins adjacent markup nodes\nfunction mergeChildren(oldChildren) {\n  const children = [];\n  oldChildren.forEach((next, i) => {\n    const prev = children[children.length - 1];\n\n    if (prev && typeof prev !== 'string' && typeof next !== 'string' && nodeMarkup.get(prev) &&\n      nodeMarkup.get(prev) === nodeMarkup.get(next) && deepEqual(prev.attributes, next.attributes))\n    {\n      prev.children = prev.children.concat(next.children);\n    } else {\n      children.push(next);\n    }\n  });\n  return children;\n}\n\n// vdom node to HTML string\nfunction nodeToHTML(node) {\n  const attr = Object.keys(node.attributes)\n    .reduce((attr, name) =>\n      `${attr} ${escape(name)}=\"${escape(node.attributes[name])}\"`, '');\n  const children = childrenToHTML(node.children);\n  const closingTag = children || !VOID_ELEMENTS[node.name] ? `</${node.name}>` : '';\n  return `<${node.name}${attr}>${children}${closingTag}`;\n}\n\n// vdom children to HTML string\nfunction childrenToHTML(children) {\n  if (!children || !children.length) return '';\n  return children.reduce((html, child) => html + (child.name ? nodeToHTML(child) : escape(child).replace(/\\xA0/g, '&nbsp;')), '');\n}\n","const modifierKeys = {\n  Control: true,\n  Meta: true,\n  Shift: true,\n  Alt: true\n};\n\n\n/**\n * Returns the textual representation of a shortcut given a keyboard event. Examples of shortcuts:\n * Cmd+L\n * Cmd+Shift+M\n * Ctrl+O\n * Backspace\n * T\n * Right\n * Shift+Down\n * Shift+F1\n * Space\n */\nexport function shortcutFromEvent(event) {\n  const shortcutArray = [];\n  let key = event.key;\n  if (!key) return '';\n  if (key === ' ') key = 'Space';\n\n  if (event.metaKey) shortcutArray.push('Cmd');\n  if (event.ctrlKey) shortcutArray.push('Ctrl');\n  if (event.altKey) shortcutArray.push('Alt');\n  if (event.shiftKey) shortcutArray.push('Shift');\n\n  if (!modifierKeys[key]) {\n    // a and A, b and B, should be the same shortcut\n    if (key.length === 1) key = key.toUpperCase();\n    shortcutArray.push(key);\n  }\n\n  return shortcutArray.join('+');\n}\n","import EventDispatcher from './event-dispatcher';\nimport Editor from './editor';\nimport { renderChildren } from './view/vdom';\nimport defaultPaper from './view/defaultPaper';\nimport { getSelection, setSelection, getBrowserRange } from './view/selection';\nimport { deltaToVdom, deltaFromDom, deltaToHTML, deltaFromHTML } from './view/dom';\nimport Paper from './paper';\nimport { shortcutFromEvent } from './shortcut-string';\nimport { shallowEqual } from './equal';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst isMac = navigator.userAgent.indexOf('Macintosh') !== -1;\nconst modExpr = isMac ? /Cmd/ : /Ctrl/;\n\n/**\n * Triggers before each render inside an editor transaction. Use this event to alter the contents of the editor with\n * decorators which will only be visible in the view and will not save to the editor. To add decorators, simply use the\n * editor APIs to format text, insert embeds, etc.\n *\n * @event View#decorate\n */\n\n/**\n * Triggers right before the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#rendering\n */\n\n/**\n * Triggers when the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#render\n */\n\n/**\n * Triggers on a keydown event, calling listeners with the keydown event and a shortcut string. These shortcut strings\n * will contain all the modifiers being pressed along with the key. Examples are:\n * Ctrl+B, Ctrl+Shift+Tab, Alt+A, Enter, Shift+Enter, Cmd+Enter, Cmd+Backspace, Space, Tab, Ctrl+Shift+Alt+F11, Ctrl++\n *\n * In addition to the normal modifiers, Cmd, Ctrl, Alt, and Shift, a special modifier called Mod can be used to match\n * Cmd on Mac and Ctrl on other OSes. This allows Mod+B to be used for bold and work correctly on all systems.\n *\n * You can listen for all shortcuts using the \"shortcut\" event, or you can listen for a specific shortcut using\n * \"shortcut:{shortcut}\".\n *\n * @event View#shortcut\n * @event View#shortcut:{shortcut} E.g. \"shortcut:Mod+Bold\"\n */\n\n/**\n * The Typewriter View displays and Editor's contents and selection. The contents are displayed as HTML using a tiny\n * virtual dom implementation and Paper to describe the HTML. The selection is displayed with the native browser\n * selection.\n *\n * View also sends changes to the editor using contenteditable and a mutation observer to capture text entry, keyboard\n * shortcuts to capture other types of edits, and the native selectionchange event to update selection.\n */\nexport default class View extends EventDispatcher {\n\n  /**\n   * Create a new View to display an Editor's contents.\n   *\n   * @param {Editor} editor  A Typewriter editor this View will display the contents for\n   * @param {Object} options Options include:\n   *   @param {HTMLElement} root   The root HTML element of this view. If not provided, you must append view.root to the\n   *                               DOM yourself\n   *   @param {Object} paper       The blocks, markups, embeds, and/or container to be used in this editor\n   *   @param {Object} modules     Modules which can be used with this view\n   */\n  constructor(editor, options = {}) {\n    super();\n    if (!editor) throw new Error('Editor view requires an editor');\n    this.editor = editor;\n    this.root = options.root || document.createElement('div');\n    if (!options.root) this.root.className = 'typewriter-editor';\n    this.paper = new Paper({ ...defaultPaper, ...options.paper });\n    this.enable();\n    this.isMac = isMac;\n    this._settingEditorSelection = false;\n    this._settingBrowserSelection = false;\n    this.modules = {};\n    this.options = options;\n    this.init();\n  }\n\n  /**\n   * Returns whether or not the view has browser focus.\n   *\n   * @returns {Boolean} Whether the view has focus\n   */\n  hasFocus() {\n    const selection = this.root.ownerDocument.getSelection();\n    return selection.anchorNode && this.root.contains(selection.anchorNode);\n  }\n\n  /**\n   * Focuses the view using the last known selection.\n   */\n  focus() {\n    if (this.lastSelection) this.editor.setSelection(this.lastSelection);\n    else this.root.focus();\n  }\n\n  /**\n   * Removes focus from the view.\n   */\n  blur() {\n    this.root.blur();\n  }\n\n  /**\n   * Disables view text entry and key shortcuts.\n   */\n  disable() {\n    this.enable(false);\n  }\n\n  /**\n   * Enables (or disables) view text entry and key shortcuts.\n   *\n   * @param {Boolean} enabled Whether to make it enabled or disabled, default being true\n   */\n  enable(enabled = true) {\n    this.enabled = enabled;\n    this.root.contentEditable = enabled;\n  }\n\n  /**\n   * Get the position and size of a range as it is displayed in the DOM relative to the top left of visible document.\n   * You can use `getBounds(editor.selection)` to find the coordinates of the current selection and display a popup at\n   * that location.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRect}   A native DOMRect object with the bounds of the range\n   */\n  getBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      try {\n        browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n      } catch(e) {}\n    }\n    return browserRange.getBoundingClientRect();\n  }\n\n  /**\n   * Get all positions and sizes of a range as it is displayed in the DOM relative to the top left of visible document.\n   * This is different from `getBounds` because instead of a single bounding box you may get multiple rects such as when\n   * the selection is split across lines. You can use `getAllBounds` to draw a highlight behind the text within this\n   * range.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRectList}   A native DOMRect object with the bounds of the range\n   */\n  getAllBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getClientRects();\n  }\n\n  /**\n   * Get the HTML text of the View (minus any decorators). You could use this to store the HTML contents rather than\n   * storing the editor contents. If you don't care about collaborative editing this may be easier than storing Deltas.\n   *\n   * @returns {String} A string of HTML\n   */\n  getHTML() {\n    return deltaToHTML(this.editor.contents, this.paper);\n  }\n\n  /**\n   * Set a string of HTML to be the contents of the editor. It will be parsed using Paper so incorrectly formatted HTML\n   * cannot be set in Typewriter.\n   *\n   * @param {String} html A string of HTML to set in the editor\n   * @param {*} source    The source of the change being made, api, user, or silent\n   */\n  setHTML(html, source) {\n    this.editor.setContents(deltaFromHTML(this, html), source);\n  }\n\n  /**\n   * Re-render the current editor state to the DOM.\n   */\n  render(changeEvent) {\n    let contents = this.editor.contents;\n    this.decorators = this.editor.getChange(() => this.fire('decorate', this.editor, changeEvent));\n    if (this.decorators.ops.length) {\n      contents = contents.compose(this.decorators);\n      this.reverseDecorators = contents.diff(this.editor.contents);\n    } else {\n      this.reverseDecorators = this.decorators;\n    }\n    const vdom = deltaToVdom(contents, this.paper);\n    if (!this.enabled) vdom.attributes.contenteditable = undefined;\n    const renderEvent = { changeEvent, vdom };\n    this.fire('rendering', renderEvent);\n    renderChildren(vdom, this.root);\n    if (this.hasFocus()) this.updateBrowserSelection();\n    this.fire('render', renderEvent);\n  }\n\n  /**\n   * Update the browser's selection to match the editor's selection.\n   */\n  updateBrowserSelection() {\n    if (this._settingEditorSelection) return;\n    this._settingBrowserSelection = true;\n    this.setSelection(this.editor.selection);\n    setTimeout(() => this._settingBrowserSelection = false, 20); // sad hack :(\n  }\n\n  /**\n   * Update the editor's selection to match the browser's selection.\n   *\n   * @param {String} source The source of the selection change, api, user, or silent\n   */\n  updateEditorSelection(source = SOURCE_API) {\n    if (this._settingBrowserSelection) return this._settingBrowserSelection = false;\n    const range = this.getSelection();\n\n    // Store the last non-null selection for restoration on focus()\n    if (range) this.lastSelection = range;\n\n    this._settingEditorSelection = true;\n    this.editor.setSelection(range, source);\n    this._settingEditorSelection = false;\n\n    // If the selection was adjusted when set then update the browser's selection\n    if (!shallowEqual(range, this.editor.selection)) this.updateBrowserSelection();\n  }\n\n  /**\n   * Get the mapped editor range from the current browser selection.\n   *\n   * @returns {Array} A range (or null) that represents the current browser selection\n   */\n  getSelection(nativeRange) {\n    let range = getSelection(this, nativeRange);\n    if (range && this.reverseDecorators.ops.length) {\n      range = range.map(i => this.reverseDecorators.transform(i));\n    }\n    return range;\n  }\n\n  /**\n   * Set's the browser selection to the given range.\n   *\n   * @param {Array} range The range to set selection to\n   */\n  setSelection(range) {\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const currentRange = getSelection(this);\n    if (!shallowEqual(currentRange, range)) {\n      setSelection(this, range);\n    }\n  }\n\n  /**\n   * Initializes the view, setting up listeners in the DOM and on the editor.\n   */\n  init() {\n    // already inited\n    if (this.hasOwnProperty('uninit')) return;\n    let defaultParagraphSet = false;\n\n    const onKeyDown = event => {\n      let shortcut = shortcutFromEvent(event);\n      this.fire(`shortcut:${shortcut}`, event, shortcut);\n      this.fire(`shortcut`, event, shortcut);\n      if (modExpr.test(shortcut)) {\n        shortcut = shortcut.replace(modExpr, 'Mod');\n        this.fire(`shortcut:${shortcut}`, event, shortcut);\n        this.fire(`shortcut`, event, shortcut);\n      }\n    };\n\n    // The browser does a better job of adding the text correctly\n    // const onPaste = event => {\n    //   const html = event.clipboardData.getData('text/html');\n    //   if (!html || !this.editor.selection) return;\n    //   event.preventDefault();\n    //   const root = document.createElement('div');\n    //   root.innerHTML = html;\n    //   let delta = deltaFromDom(this, root, { ignoreAttributes: true, notInDom: true });\n    //   const [ from , to ] = this.editor.selection;\n    //   const change = this.editor.delta().retain(from).delete(to - from);\n    //   change.ops.push(...delta.ops);\n    //   this.editor.updateContents(change, SOURCE_USER, change.length());\n    // };\n\n    const onSelectionChange = () => {\n      this.updateEditorSelection(SOURCE_USER);\n\n      if (!defaultParagraphSet && this.editor.selection) {\n        defaultParagraphSet = true;\n        this.root.ownerDocument.execCommand('defaultParagraphSeparator', false, this.paper.blocks.getDefault().selector);\n      }\n    };\n\n    const onTextChanging = ({ contents }) => {\n      // Prevent incorrect formats\n      return !contents.ops.some(op => {\n        if (typeof op.insert === 'object') {\n          return !this.paper.embeds.find(op.insert);\n        } else if (op.attributes) {\n          // If attributes is empty except for classes/attributes than it is the default block\n          if (!Object.keys(op.attributes).filter(key => key !== 'classes' && key !== 'attributes').length) return;\n          return !(this.paper.blocks.find(op.attributes) || this.paper.markups.find(op.attributes));\n        }\n      });\n    };\n\n    const onEditorChange = event => {\n      if (event.change) this.render(event);\n      this.updateBrowserSelection();\n    };\n\n    // Use mutation tracking during development to catch errors\n    // TODO delete this mutation observer when we're confident in core (or put it behind a development flag)\n    // let checking = 0;\n    // const devObserver = new MutationObserver(list => {\n    //   if (checking) clearTimeout(checking);\n    //   checking = setTimeout(() => {\n    //     checking = 0;\n    //     const diff = this.editor.contents.compose(this.decorators).diff(deltaFromDom(this));\n    //     if (diff.length()) {\n    //       console.error('Delta out of sync with DOM:', diff, this.editor.contents, deltaFromDom(this), this.decorators);\n    //     }\n    //   }, 20);\n    // });\n    // devObserver.observe(this.root, { characterData: true, characterDataOldValue: true, childList: true, attributes: true, subtree: true });\n\n\n    this.root.addEventListener('keydown', onKeyDown);\n    // this.root.addEventListener('paste', onPaste);\n    this.root.ownerDocument.addEventListener('selectionchange', onSelectionChange);\n    this.editor.on('text-changing', onTextChanging);\n    this.editor.on('editor-change', onEditorChange);\n\n    if (this.options.modules) {\n      Object.keys(this.options.modules).forEach(key => this.modules[key] = this.options.modules[key](this));\n    }\n\n    this.render();\n\n    this.uninit = () => {\n      // devObserver.disconnect();\n      this.root.removeEventListener('keydown', onKeyDown);\n      // this.root.removeEventListener('paste', onPaste);\n      this.root.ownerDocument.removeEventListener('selectionchange', onSelectionChange);\n      this.editor.off('text-changing', onTextChanging);\n      this.editor.off('editor-change', onEditorChange);\n      Object.keys(this.modules).forEach(key => {\n        const api = this.modules[key];\n        if (api && typeof api.destroy === 'function') api.destroy();\n        delete this.modules[key];\n      });\n      delete this.uninit;\n    }\n  }\n\n  /**\n   * Cleans up the listeners on the DOM and editor after they have been added.\n   */\n  uninit() {\n    // This is overwritten inside `init`\n  }\n\n  /**\n   * Clean up and allow modules to clean up before the editor is removed from the DOM.\n   */\n  destroy() {\n    this.uninit();\n    this.fire('destroy');\n  }\n}\n","import { getNodeIndex } from '../view/selection';\nimport { deltaFromDom } from '../view/dom';\nimport diff from '../diff';\n\nconst SOURCE_USER = 'user';\nconst lastWord = /\\w+[^\\w]*$/;\nconst firstWord = /^[^\\w]*\\w+/;\nconst lastLine = /[^\\n]*$/;\nconst firstLine = /^[^\\n]*/;\nlet pasteMutation = false;\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function input() {\n  return view => {\n    const editor = view.editor;\n    const mutationOptions = {\n      characterData: true,\n      characterDataOldValue: true,\n      subtree: true,\n      childList: true,\n      attributes: true\n    };\n\n    // Detects changes from spell-check and the user typing\n    function onMutate(list) {\n      list = list.filter(m => m.target !== view.root);\n      if (!list.length) return;\n\n      const selection = view.getSelection();\n      const textChange = getTextChange(list);\n\n      // Only one text node has been altered. Optimize for view most common case, which is typing in a paragraph.\n      if (textChange) {\n        if (textChange.ops.length) {\n          // console.log('changing a little', textChange);\n          if (!editor.updateContents(textChange, SOURCE_USER, selection)) {\n            view.render();\n          }\n        }\n      } else {\n        let contents = deltaFromDom(view, view.root, { ignoreAttributes: true });\n        if (pasteMutation) {\n          const from = editor.selection ? editor.selection[0] : undefined;\n          const to = selection ? selection[1] : undefined;\n          const event = { contents, from, to };\n          view.fire('paste', event);\n          if (event.contents !== contents && event.contents.ops) {\n            contents.ops = event.contents.ops;\n          }\n        }\n        contents = contents.compose(view.reverseDecorators);\n        // Decorators may extend beyond the text, pull those out\n        contents.ops = contents.ops.filter(op => op.insert);\n        const change = editor.contents.diff(contents);\n        // console.log('changing a lot (possibly)', change);\n        if (!editor.updateContents(change, SOURCE_USER, selection)) {\n          view.render();\n        }\n      }\n    }\n\n\n    function onEnter(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n\n      const line = editor.contents.getLine(from);\n      let attributes = line.attributes;\n      const block = view.paper.blocks.find(attributes);\n      const isDefault = !block || block === view.paper.blocks.getDefault();\n      const length = line.end - line.start - 1;\n      const atEnd = to === line.end - 1;\n      if (atEnd && !isDefault && block.defaultFollows) {\n        attributes = {};\n      }\n      const activeFormats = editor.activeFormats;\n      if (!length && !isDefault && !block.defaultFollows && from === to) {\n        editor.formatLine(from, to, {}, SOURCE_USER);\n      } else {\n        let selection = from + 1;\n        editor.insertText(from, to, '\\n', attributes, SOURCE_USER, selection);\n      }\n      editor.activeFormats = activeFormats;\n    }\n\n\n    function onShiftEnter(event) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n      editor.insertEmbed(from, to, 'br', true, null, SOURCE_USER);\n    }\n\n\n    function onBackspace(event, shortcut) {\n      if (event.defaultPrevented || shortcut === 'Alt+Backspace' || shortcut === 'Mod+Backspace') return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from + to === 0) {\n        const line = editor.contents.getLine(from);\n        const block = view.paper.blocks.find(line.attributes);\n        if (block) editor.formatLine(0, {}, SOURCE_USER);\n      } else {\n        // The \"from\" block needs to stay the same. The \"to\" block gets merged into it\n        if (from === to) {\n          if ((shortcut === 'Alt+Backspace' && view.isMac) || (shortcut === 'Mod+Backspace' && !view.isMac)) {\n            const match = editor.getText().slice(0, from).match(lastWord);\n            if (match) from -= match[0].length;\n          } else if (shortcut === 'Mod+Backspace' && view.isMac) {\n            const match = editor.getText().slice(0, from).match(lastLine);\n            if (match) from -= match[0].length;\n          } else {\n            const line = editor.contents.getLine(from);\n            if (from === line.start) {\n              const blocks = view.paper.blocks;\n              const block = blocks.find(line.attributes);\n              if (block && block !== blocks.getDefault() && !block.defaultFollows) {\n                editor.formatLine(from, {}, SOURCE_USER);\n                return;\n              }\n            }\n\n            from--;\n          }\n        }\n        editor.deleteText(from, to, SOURCE_USER);\n      }\n    }\n\n    function onDelete(event, shortcut) {\n      if (event.defaultPrevented || shortcut === 'Alt+Delete') return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from === to && from === editor.length) return;\n\n      if (from === to) {\n        if (shortcut === 'Alt+Delete' && view.isMac) {\n          const match = editor.getText().slice(from).match(firstWord);\n          if (match) to += match[0].length;\n        } else {\n          to++;\n        }\n      }\n      editor.deleteText(from, to, SOURCE_USER);\n    }\n\n    function onTab(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      const direction = shortcut === 'Tab' || shortcut === 'Mod+]' ? 1 : -1;\n      const [ from, to ] = editor.getSelectedRange();\n      const lines = editor.contents.getLines(from, to);\n\n      editor.transaction(() => {\n        lines.forEach((line, i) => {\n          if (line.attributes.list) {\n            let prevLine = lines[i -1];\n            if (!prevLine && line.index > 0) prevLine = editor.contents.getLine(line.start - 1);\n            const prevIndent = prevLine && prevLine.attributes.list ? prevLine.attributes.indent || 0 : -1;\n\n            let indent = line.attributes.indent || 0;\n            indent += direction;\n            if (indent > prevIndent + 1) return console.log('will not indent too much');\n            if (indent < 0) {\n              editor.formatLine(line.start, {});\n            } else {\n              const attributes = { ...line.attributes, indent };\n              editor.formatLine(line.start, attributes);\n            }\n          }\n        });\n      }, SOURCE_USER);\n    }\n\n\n    function getTextChange(mutations) {\n      const mutation = getTextChangeMutation(mutations);\n      if (!mutation) return;\n\n      const change = editor.delta();\n      const node = mutation.type === 'characterData' ? mutation.target : mutation.addedNodes[0];\n      const index = view.reverseDecorators.transform(getNodeIndex(view, node));\n      change.retain(index);\n\n      if (mutation.type === 'characterData') {\n        const diffs = diff(mutation.oldValue.replace(/\\xA0/g, ' '), mutation.target.nodeValue.replace(/\\xA0/g, ' '));\n        diffs.forEach(([ action, string ]) => {\n          if (action === diff.EQUAL) change.retain(string.length);\n          else if (action === diff.DELETE) change.delete(string.length);\n          else if (action === diff.INSERT) {\n            change.insert(string, editor.activeFormats);\n          }\n        });\n        change.chop();\n      } else {\n        change.insert(node.nodeValue.replace(/\\xA0/g, ' '), editor.activeFormats);\n      }\n\n      return change;\n    }\n\n    function getTextChangeMutation(mutations) {\n      const seen = new Set();\n      mutations = mutations.filter(m => {\n        if (m.type !== 'characterData') return true;\n        if (seen.has(m.target)) return false;\n        seen.add(m.target);\n        return true;\n      });\n\n      if (mutations.length > 3) return;\n\n      const first = mutations[0];\n      const second = mutations[1];\n      const third = mutations[2];\n      const added = first.addedNodes[0];\n      const removed = second && second.removedNodes[0];\n\n      if (mutations.length === 1) {\n        if (first.type === 'characterData') {\n          return first;\n        } else if (first.type === 'childList' && added && added.nodeType === Node.TEXT_NODE) {\n          return first;\n        }\n      } else {\n        if (first.type === 'childList' && added && added.nodeType === Node.TEXT_NODE) {\n          const textNode = third || second;\n          if (removed && removed.nodeName !== 'BR') return;\n          if (textNode.type === 'characterData' && textNode.target === added) {\n            return first;\n          }\n        }\n      }\n    }\n\n    function onPaste() {\n      pasteMutation = true;\n      setTimeout(() => {\n        pasteMutation = false;\n      }, 50);\n    }\n\n\n    const observer = new MutationObserver(onMutate);\n    observer.observe(view.root, mutationOptions);\n\n    // Don't observe the changes that occur when the view updates, we only want to respond to changes that happen\n    // outside of our API to read them back in\n    function onRendering() {\n      observer.disconnect();\n    }\n\n    // Once the view update is complete, continue observing for changes\n    function onRender() {\n      observer.observe(view.root, mutationOptions);\n    }\n\n    view.on('rendering', onRendering);\n    view.on('render', onRender);\n    view.on('shortcut:Enter', onEnter);\n    view.on('shortcut:Shift+Enter', onShiftEnter);\n    view.on('shortcut:Backspace', onBackspace);\n    view.on('shortcut:Alt+Backspace', onBackspace);\n    view.on('shortcut:Mod+Backspace', onBackspace);\n    view.on('shortcut:Delete', onDelete);\n    view.on('shortcut:Alt+Delete', onDelete);\n    view.on('shortcut:Tab', onTab);\n    view.on('shortcut:Shift+Tab', onTab);\n    view.root.addEventListener('paste', onPaste);\n\n    return {\n      destroy() {\n        observer.disconnect();\n        view.off('rendering', onRendering);\n        view.off('render', onRender);\n        view.off('shortcut:Enter', onEnter);\n        view.off('shortcut:Shift+Enter', onShiftEnter);\n        view.off('shortcut:Backspace', onBackspace);\n        view.off('shortcut:Alt+Backspace', onBackspace);\n        view.off('shortcut:Mod+Backspace', onBackspace);\n        view.off('shortcut:Delete', onDelete);\n        view.off('shortcut:Alt+Delete', onDelete);\n        view.off('shortcut:Tab', onTab);\n        view.off('shortcut:Shift+Tab', onTab);\n        view.root.removeEventListener('paste', onPaste);\n      }\n    }\n  }\n}\n\n\n","const SOURCE_USER = 'user';\n\n\nexport const keymap = {\n  'Mod+B': editor => editor.toggleTextFormat(editor.selection, { bold: true }, SOURCE_USER),\n  'Mod+I': editor => editor.toggleTextFormat(editor.selection, { italic: true }, SOURCE_USER),\n  'Mod+1': editor => editor.toggleLineFormat(editor.selection, { header: 1 }, SOURCE_USER),\n  'Mod+2': editor => editor.toggleLineFormat(editor.selection, { header: 2 }, SOURCE_USER),\n  'Mod+3': editor => editor.toggleLineFormat(editor.selection, { header: 3 }, SOURCE_USER),\n  'Mod+4': editor => editor.toggleLineFormat(editor.selection, { header: 4 }, SOURCE_USER),\n  'Mod+5': editor => editor.toggleLineFormat(editor.selection, { header: 5 }, SOURCE_USER),\n  'Mod+6': editor => editor.toggleLineFormat(editor.selection, { header: 6 }, SOURCE_USER),\n  'Mod+0': editor => editor.formatLine(editor.selection, { }, SOURCE_USER),\n};\n\nexport const macKeymap = { ...keymap };\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function keyShortcuts(customShortcuts = {}) {\n  return view => {\n    const shortcuts = { ...(view.isMac ? macKeymap : keymap), ...customShortcuts };\n    const editor = view.editor;\n\n    function onShortcut(event, shortcut) {\n      if (event.defaultPrevented) return;\n      if (shortcut in shortcuts) {\n        event.preventDefault();\n        shortcuts[shortcut](editor);\n      }\n    }\n\n    view.on('shortcut', onShortcut);\n\n    return {\n      destroy() {\n        view.off('shortcut', onShortcut);\n      }\n    }\n  };\n}\n","const SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst defaultOptions = {\n  delay: 0,\n  maxStack: 500,\n};\n\n/**\n * History is a view module for storing user changes.\n *\n * Stores history for all user-generated changes. Like-changes will be combined until a selection or a delay timeout\n * cuts off the combining. E.g. if a user types \"Hello\" the 5 changes will be combined into one history entry. If\n * the user moves the cursor somewhere and then back to the end and types \" World\" the next 6 changes are combined\n * separately from the first 5 because selection changes add a cutoff history entries.\n *\n * The default options can be overridden by passing alternatives to history. To add a timeout to force a cutoff after\n * so many milliseconds set a delay like this:\n * ```js\n * view = new View(editor, {\n *   modules: {\n *     history: history({ delay: 4000 })\n *   }\n * })\n * ```\n */\nexport default function history(options = {}) {\n\n  return view => {\n    const editor = view.editor;\n    options = { ...defaultOptions, ...options };\n\n    const stack = options.stack || {\n      undo: [],\n      redo: [],\n    };\n    let lastRecorded = 0;\n    let lastAction;\n    let ignoreChange = false;\n\n    function undo(event) {\n      action(event, 'undo', 'redo');\n    }\n\n    function redo(event) {\n      action(event, 'redo', 'undo');\n    }\n\n    function cutoff() {\n      lastRecorded = 0;\n    }\n\n    function clear() {\n      stack.undo.length = 0;\n      stack.redo.length = 0;\n    }\n\n    function action(event, source, dest) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      if (stack[source].length === 0) return;\n      let entry = stack[source].pop();\n      stack[dest].push(entry);\n      cutoff();\n      ignoreChange = true;\n      if (typeof entry[source] === 'function') {\n        entry[source]();\n      } else {\n        editor.updateContents(entry[source], SOURCE_USER, entry[source + 'Selection']);\n      }\n      ignoreChange = false;\n    }\n\n    function record(change, contents, oldContents, selection, oldSelection) {\n      const timestamp = Date.now();\n      const action = getAction(change);\n      stack.redo.length = 0;\n\n      let undoChange = contents.diff(oldContents);\n      // Break combining if actions are different (e.g. a delete then an insert should break it)\n      if (!action || lastAction !== action) cutoff();\n      lastAction = action;\n\n      if (lastRecorded && (!options.delay || lastRecorded + options.delay > timestamp) && stack.undo.length > 0) {\n        // Combine with the last change\n        let entry = stack.undo.pop();\n        oldSelection = entry.undoSelection;\n        undoChange = undoChange.compose(entry.undo);\n        change = entry.redo.compose(change);\n      } else {\n        lastRecorded = timestamp;\n      }\n\n      stack.undo.push({\n        redo: change,\n        undo: undoChange,\n        redoSelection: selection,\n        undoSelection: oldSelection,\n      });\n\n      if (stack.undo.length > options.maxStack) {\n        stack.undo.shift();\n      }\n    }\n\n\n    function transform(change) {\n      stack.undo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n      stack.redo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n    }\n\n\n    function onTextChange({ change, contents, oldContents, selection, oldSelection, source }) {\n      if (ignoreChange) return;\n      if (source === SOURCE_USER) {\n        record(change, contents, oldContents, selection, oldSelection);\n      } else {\n        transform(change);\n      }\n    }\n\n    function onSelectionChange({ change }) {\n      if (change) return;\n      // Break the history merging when selection changes without a text change\n      cutoff();\n    }\n\n\n    editor.on('text-change', onTextChange);\n    editor.on('selection-change', onSelectionChange);\n    if (view.isMac) {\n      view.on('shortcut:Cmd+Z', undo);\n      view.on('shortcut:Cmd+Shift+Z', redo);\n    } else {\n      view.on('shortcut:Ctrl+Z', undo);\n      view.on('shortcut:Ctrl+Y', redo);\n    }\n\n    return {\n      undo,\n      redo,\n      cutoff,\n      options,\n      destroy() {\n        editor.off('text-change', onTextChange);\n        editor.off('selection-change', onSelectionChange);\n        if (view.isMac) {\n          view.off('shortcut:Cmd+Z', undo);\n          view.off('shortcut:Cmd+Shift+Z', redo);\n        } else {\n          view.off('shortcut:Ctrl+Z', undo);\n          view.off('shortcut:Ctrl+Y', redo);\n        }\n      }\n    }\n  }\n}\n\nfunction getAction(change) {\n  if (change.ops.length === 1 || change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes) {\n    const changeOp = change.ops[change.ops.length - 1];\n    if (changeOp.delete) return 'delete';\n    if (changeOp.insert === '\\n') return 'newline';\n    if (changeOp.insert) return 'insert';\n  }\n  return '';\n}\n","import { h } from '../view/vdom';\n\nexport default function placeholder(placeholder) {\n  return view => {\n\n    view.paper.markups.add({\n      name: 'placeholder',\n      selector: 'span.placholder',\n      vdom: children => <span class=\"placeholder\" style={{pointerEvents: 'none'}}>{children}</span>,\n    });\n\n    function onDecorate(editor) {\n      if (editor.length === 1) {\n        editor.insertText(placeholder, { placeholder: true });\n      }\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n","const SOURCE_USER = 'user';\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into a formatted block with the attributes returned by the\n * function. The function's argument will be the captured text from the regular expression.\n */\nexport const blockReplacements = [\n  [ /^(#{1,6}) $/, capture => ({ header: capture.length }) ],\n  [ /^[-*] $/, () => ({ list: 'bullet' }) ],\n  [ /^1\\. $/, () => ({ list: 'ordered' }) ], // Use /^(-?\\d+)\\. $/ to support lists starting at something other than 1.\n  [ /^> $/, () => ({ blockquote: true }) ],\n];\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into another string of text which is returned by the function.\n * The function's argument will be the captured text from the regular expression.\n */\nexport const textReplacements = [\n  [ /--$/, () => '—' ],\n  [ /\\.\\.\\.$/, () => '…' ],\n];\n\n/**\n * Allow text representations to format a block\n */\nexport function blockReplace(editor, index, prefix) {\n  return blockReplacements.some(([ regexp, getAttributes ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      const attributes = getAttributes(match[1]);\n      const change = editor.getChange(() => {\n        editor.formatLine(index, attributes);\n        editor.deleteText(index - prefix.length, index);\n      });\n      editor.updateContents(change, SOURCE_USER, index - prefix.length);\n      return true;\n    }\n  });\n}\n\nexport function textReplace(editor, index, prefix) {\n  return textReplacements.some(([ regexp, replaceWith ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      editor.insertText(index - match[0].length, index, replaceWith(match[1]), null, SOURCE_USER);\n      return true;\n    }\n  });\n}\n\nexport const defaultHandlers = [ blockReplace, textReplace ];\n\n\nexport default function(handlers = defaultHandlers) {\n\n  return view => {\n    const editor = view.editor;\n    let ignore = false;\n\n    function onTextChange({ change, source }) {\n      if (ignore || source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n      const index = editor.selection[1];\n      const text = editor.getExactText();\n      const lineStart = text.lastIndexOf('\\n', index - 1) + 1;\n      const prefix = text.slice(lineStart, index);\n\n      ignore = true;\n      handlers.some(handler => handler(editor, index, prefix));\n      ignore = false;\n    }\n\n    editor.on('text-change', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-change', onTextChange);\n      }\n    }\n  };\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","\n/**\n * Replaces regular quotes with smart quotes as they are typed. Does not affect pasted content.\n * Uses the text-changing event to prevent the original change and replace it with the new one. This makes the smart-\n * quotes act more seemlessly and includes them as part of regular text undo/redo instead of breaking it like the smart-\n * entry conversions do.\n */\nexport default function smartQuotes() {\n  return view => {\n    const editor = view.editor;\n\n    function onTextChange({ change, source, selection }) {\n      if (source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n\n      const index = editor.selection[1];\n      const lastOp = change.ops[change.ops.length - 1];\n      const lastChars = editor.getText(index - 1, index) + lastOp.insert.slice(-1);\n\n      const replaced = lastChars.replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(\")$/, '“')\n              .replace(/\"$/, '”')\n              .replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(')$/, '‘')\n              .replace(/'$/, '’');\n\n      if (replaced !== lastChars) {\n        const quote = replaced.slice(-1);\n        lastOp.insert = lastOp.insert.slice(0, -1) + quote;\n        editor.updateContents(change, source, selection);\n        return false;\n      }\n    }\n\n    editor.on('text-changing', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-changing', onTextChange);\n      }\n    }\n  }\n}\n\n\n/**\n * Adds smartquotes to a document as a decorator. This does not affect the source, allowing you to store regular quotes\n * in your source data but display smart quotes to the user. Use this as an alternative to the module above, not in\n * addition to it.\n */\nexport function smartQuotesDecorator() {\n  return view => {\n    const quotes = [\n      [ /(^|\\s)\"/g, /(^|\\s)\"/, '$1“' ],\n      [ /\"/g, /\"/, '”'],\n      [ /\\b'/g, /'/, '’'],\n      [ /'/g, /'/, '‘'],\n    ];\n\n    function onDecorate(editor) {\n      let { text } = editor;\n      quotes.forEach(([ expr, replacer, replaceWith ]) => {\n        let match;\n        while ((match = expr.exec(text))) {\n          const replacement = match[0].replace(replacer, replaceWith);\n          text = text.slice(0, match.index) + replacement + text.slice(expr.lastIndex);\n          editor.insertText(match.index, expr.lastIndex, replacement);\n        }\n      });\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    typeof change.ops[change.ops.length - 1].insert === 'string' &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","function noop() {}\n\nfunction assign(tar, src) {\n\tfor (var k in src) tar[k] = src[k];\n\treturn tar;\n}\n\nfunction assignTrue(tar, src) {\n\tfor (var k in src) tar[k] = 1;\n\treturn tar;\n}\n\nfunction isPromise(value) {\n\treturn value && typeof value.then === 'function';\n}\n\nfunction callAfter(fn, i) {\n\tif (i === 0) fn();\n\treturn () => {\n\t\tif (!--i) fn();\n\t};\n}\n\nfunction addLoc(element, file, line, column, char) {\n\telement.__svelte_meta = {\n\t\tloc: { file, line, column, char }\n\t};\n}\n\nfunction exclude(src, prop) {\n\tconst tar = {};\n\tfor (const k in src) k === prop || (tar[k] = src[k]);\n\treturn tar;\n}\n\nfunction run(fn) {\n\tfn();\n}\n\nfunction append(target, node) {\n\ttarget.appendChild(node);\n}\n\nfunction insert(target, node, anchor) {\n\ttarget.insertBefore(node, anchor);\n}\n\nfunction detachNode(node) {\n\tnode.parentNode.removeChild(node);\n}\n\nfunction detachBetween(before, after) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction detachBefore(after) {\n\twhile (after.previousSibling) {\n\t\tafter.parentNode.removeChild(after.previousSibling);\n\t}\n}\n\nfunction detachAfter(before) {\n\twhile (before.nextSibling) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction reinsertBetween(before, after, target) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\ttarget.appendChild(before.parentNode.removeChild(before.nextSibling));\n\t}\n}\n\nfunction reinsertChildren(parent, target) {\n\twhile (parent.firstChild) target.appendChild(parent.firstChild);\n}\n\nfunction reinsertAfter(before, target) {\n\twhile (before.nextSibling) target.appendChild(before.nextSibling);\n}\n\nfunction reinsertBefore(after, target) {\n\tvar parent = after.parentNode;\n\twhile (parent.firstChild !== after) target.appendChild(parent.firstChild);\n}\n\nfunction destroyEach(iterations, detach) {\n\tfor (var i = 0; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].d(detach);\n\t}\n}\n\nfunction createFragment() {\n\treturn document.createDocumentFragment();\n}\n\nfunction createElement(name) {\n\treturn document.createElement(name);\n}\n\nfunction createSvgElement(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nfunction createText(data) {\n\treturn document.createTextNode(data);\n}\n\nfunction createComment() {\n\treturn document.createComment('');\n}\n\nfunction addListener(node, event, handler, options) {\n\tnode.addEventListener(event, handler, options);\n}\n\nfunction removeListener(node, event, handler, options) {\n\tnode.removeEventListener(event, handler, options);\n}\n\nfunction setAttribute(node, attribute, value) {\n\tif (value == null) node.removeAttribute(attribute);\n\telse node.setAttribute(attribute, value);\n}\n\nfunction setAttributes(node, attributes) {\n\tfor (var key in attributes) {\n\t\tif (key === 'style') {\n\t\t\tnode.style.cssText = attributes[key];\n\t\t} else if (key in node) {\n\t\t\tnode[key] = attributes[key];\n\t\t} else {\n\t\t\tsetAttribute(node, key, attributes[key]);\n\t\t}\n\t}\n}\n\nfunction setCustomElementData(node, prop, value) {\n\tif (prop in node) {\n\t\tnode[prop] = value;\n\t} else if (value) {\n\t\tsetAttribute(node, prop, value);\n\t} else {\n\t\tnode.removeAttribute(prop);\n\t}\n}\n\nfunction setXlinkAttribute(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\nfunction getBindingGroupValue(group) {\n\tvar value = [];\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.push(group[i].__value);\n\t}\n\treturn value;\n}\n\nfunction toNumber(value) {\n\treturn value === '' ? undefined : +value;\n}\n\nfunction timeRangesToArray(ranges) {\n\tvar array = [];\n\tfor (var i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\nfunction children (element) {\n\treturn Array.from(element.childNodes);\n}\n\nfunction claimElement (nodes, name, attributes, svg) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeName === name) {\n\t\t\tfor (var j = 0; j < node.attributes.length; j += 1) {\n\t\t\t\tvar attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) node.removeAttribute(attribute.name);\n\t\t\t}\n\t\t\treturn nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n\t\t}\n\t}\n\n\treturn svg ? createSvgElement(name) : createElement(name);\n}\n\nfunction claimText (nodes, data) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeType === 3) {\n\t\t\tnode.data = data;\n\t\t\treturn nodes.splice(i, 1)[0];\n\t\t}\n\t}\n\n\treturn createText(data);\n}\n\nfunction setData(text, data) {\n\ttext.data = '' + data;\n}\n\nfunction setInputType(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {}\n}\n\nfunction setStyle(node, key, value) {\n\tnode.style.setProperty(key, value);\n}\n\nfunction selectOption(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\n\t\tif (option.__value === value) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nfunction selectOptions(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\t\toption.selected = ~value.indexOf(option.__value);\n\t}\n}\n\nfunction selectValue(select) {\n\tvar selectedOption = select.querySelector(':checked') || select.options[0];\n\treturn selectedOption && selectedOption.__value;\n}\n\nfunction selectMultipleValue(select) {\n\treturn [].map.call(select.querySelectorAll(':checked'), function(option) {\n\t\treturn option.__value;\n\t});\n}\n\nfunction addResizeListener(element, fn) {\n\tif (getComputedStyle(element).position === 'static') {\n\t\telement.style.position = 'relative';\n\t}\n\n\tconst object = document.createElement('object');\n\tobject.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;');\n\tobject.type = 'text/html';\n\n\tlet win;\n\n\tobject.onload = () => {\n\t\twin = object.contentDocument.defaultView;\n\t\twin.addEventListener('resize', fn);\n\t};\n\n\tif (/Trident/.test(navigator.userAgent)) {\n\t\telement.appendChild(object);\n\t\tobject.data = 'about:blank';\n\t} else {\n\t\tobject.data = 'about:blank';\n\t\telement.appendChild(object);\n\t}\n\n\treturn {\n\t\tcancel: () => {\n\t\t\twin && win.removeEventListener && win.removeEventListener('resize', fn);\n\t\t\telement.removeChild(object);\n\t\t}\n\t};\n}\n\nfunction toggleClass(element, name, toggle) {\n\telement.classList.toggle(name, !!toggle);\n}\n\nfunction linear(t) {\n\treturn t;\n}\n\nfunction generateRule({ a, b, delta, duration }, ease, fn) {\n\tconst step = 16.666 / duration;\n\tlet keyframes = '{\\n';\n\n\tfor (let p = 0; p <= 1; p += step) {\n\t\tconst t = a + delta * ease(p);\n\t\tkeyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n\t}\n\n\treturn keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n}\n\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n\tlet hash = 5381;\n\tlet i = str.length;\n\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn hash >>> 0;\n}\n\nfunction wrapTransition(component, node, fn, params, intro) {\n\tlet obj = fn.call(component, node, params);\n\tlet duration;\n\tlet ease;\n\tlet cssText;\n\n\tlet initialised = false;\n\n\treturn {\n\t\tt: intro ? 0 : 1,\n\t\trunning: false,\n\t\tprogram: null,\n\t\tpending: null,\n\n\t\trun(b, callback) {\n\t\t\tif (typeof obj === 'function') {\n\t\t\t\ttransitionManager.wait().then(() => {\n\t\t\t\t\tobj = obj();\n\t\t\t\t\tthis._run(b, callback);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._run(b, callback);\n\t\t\t}\n\t\t},\n\n\t\t_run(b, callback) {\n\t\t\tduration = obj.duration || 300;\n\t\t\tease = obj.easing || linear;\n\n\t\t\tconst program = {\n\t\t\t\tstart: window.performance.now() + (obj.delay || 0),\n\t\t\t\tb,\n\t\t\t\tcallback: callback || noop\n\t\t\t};\n\n\t\t\tif (intro && !initialised) {\n\t\t\t\tif (obj.css && obj.delay) {\n\t\t\t\t\tcssText = node.style.cssText;\n\t\t\t\t\tnode.style.cssText += obj.css(0, 1);\n\t\t\t\t}\n\n\t\t\t\tif (obj.tick) obj.tick(0, 1);\n\t\t\t\tinitialised = true;\n\t\t\t}\n\n\t\t\tif (!b) {\n\t\t\t\tprogram.group = outros.current;\n\t\t\t\toutros.current.remaining += 1;\n\t\t\t}\n\n\t\t\tif (obj.delay) {\n\t\t\t\tthis.pending = program;\n\t\t\t} else {\n\t\t\t\tthis.start(program);\n\t\t\t}\n\n\t\t\tif (!this.running) {\n\t\t\t\tthis.running = true;\n\t\t\t\ttransitionManager.add(this);\n\t\t\t}\n\t\t},\n\n\t\tstart(program) {\n\t\t\tcomponent.fire(`${program.b ? 'intro' : 'outro'}.start`, { node });\n\n\t\t\tprogram.a = this.t;\n\t\t\tprogram.delta = program.b - program.a;\n\t\t\tprogram.duration = duration * Math.abs(program.b - program.a);\n\t\t\tprogram.end = program.start + program.duration;\n\n\t\t\tif (obj.css) {\n\t\t\t\tif (obj.delay) node.style.cssText = cssText;\n\n\t\t\t\tconst rule = generateRule(program, ease, obj.css);\n\t\t\t\ttransitionManager.addRule(rule, program.name = '__svelte_' + hash(rule));\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(anim => anim && (program.delta < 0 || !/__svelte/.test(anim)))\n\t\t\t\t\t.concat(`${program.name} ${program.duration}ms linear 1 forwards`)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tthis.program = program;\n\t\t\tthis.pending = null;\n\t\t},\n\n\t\tupdate(now) {\n\t\t\tconst program = this.program;\n\t\t\tif (!program) return;\n\n\t\t\tconst p = now - program.start;\n\t\t\tthis.t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (obj.tick) obj.tick(this.t, 1 - this.t);\n\t\t},\n\n\t\tdone() {\n\t\t\tconst program = this.program;\n\t\t\tthis.t = program.b;\n\n\t\t\tif (obj.tick) obj.tick(this.t, 1 - this.t);\n\n\t\t\tcomponent.fire(`${program.b ? 'intro' : 'outro'}.end`, { node });\n\n\t\t\tif (!program.b && !program.invalidated) {\n\t\t\t\tprogram.group.callbacks.push(() => {\n\t\t\t\t\tprogram.callback();\n\t\t\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\t\t});\n\n\t\t\t\tif (--program.group.remaining === 0) {\n\t\t\t\t\tprogram.group.callbacks.forEach(run);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\t}\n\n\t\t\tthis.running = !!this.pending;\n\t\t},\n\n\t\tabort(reset) {\n\t\t\tif (this.program) {\n\t\t\t\tif (reset && obj.tick) obj.tick(1, 0);\n\t\t\t\tif (obj.css) transitionManager.deleteRule(node, this.program.name);\n\t\t\t\tthis.program = this.pending = null;\n\t\t\t\tthis.running = false;\n\t\t\t}\n\t\t},\n\n\t\tinvalidate() {\n\t\t\tif (this.program) {\n\t\t\t\tthis.program.invalidated = true;\n\t\t\t}\n\t\t}\n\t};\n}\n\nlet outros = {};\n\nfunction groupOutros() {\n\toutros.current = {\n\t\tremaining: 0,\n\t\tcallbacks: []\n\t};\n}\n\nvar transitionManager = {\n\trunning: false,\n\ttransitions: [],\n\tbound: null,\n\tstylesheet: null,\n\tactiveRules: {},\n\tpromise: null,\n\n\tadd(transition) {\n\t\tthis.transitions.push(transition);\n\n\t\tif (!this.running) {\n\t\t\tthis.running = true;\n\t\t\trequestAnimationFrame(this.bound || (this.bound = this.next.bind(this)));\n\t\t}\n\t},\n\n\taddRule(rule, name) {\n\t\tif (!this.stylesheet) {\n\t\t\tconst style = createElement('style');\n\t\t\tdocument.head.appendChild(style);\n\t\t\ttransitionManager.stylesheet = style.sheet;\n\t\t}\n\n\t\tif (!this.activeRules[name]) {\n\t\t\tthis.activeRules[name] = true;\n\t\t\tthis.stylesheet.insertRule(`@keyframes ${name} ${rule}`, this.stylesheet.cssRules.length);\n\t\t}\n\t},\n\n\tnext() {\n\t\tthis.running = false;\n\n\t\tconst now = window.performance.now();\n\t\tlet i = this.transitions.length;\n\n\t\twhile (i--) {\n\t\t\tconst transition = this.transitions[i];\n\n\t\t\tif (transition.program && now >= transition.program.end) {\n\t\t\t\ttransition.done();\n\t\t\t}\n\n\t\t\tif (transition.pending && now >= transition.pending.start) {\n\t\t\t\ttransition.start(transition.pending);\n\t\t\t}\n\n\t\t\tif (transition.running) {\n\t\t\t\ttransition.update(now);\n\t\t\t\tthis.running = true;\n\t\t\t} else if (!transition.pending) {\n\t\t\t\tthis.transitions.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (this.running) {\n\t\t\trequestAnimationFrame(this.bound);\n\t\t} else if (this.stylesheet) {\n\t\t\tlet i = this.stylesheet.cssRules.length;\n\t\t\twhile (i--) this.stylesheet.deleteRule(i);\n\t\t\tthis.activeRules = {};\n\t\t}\n\t},\n\n\tdeleteRule(node, name) {\n\t\tnode.style.animation = node.style.animation\n\t\t\t.split(', ')\n\t\t\t.filter(anim => anim && anim.indexOf(name) === -1)\n\t\t\t.join(', ');\n\t},\n\n\twait() {\n\t\tif (!transitionManager.promise) {\n\t\t\ttransitionManager.promise = Promise.resolve();\n\t\t\ttransitionManager.promise.then(() => {\n\t\t\t\ttransitionManager.promise = null;\n\t\t\t});\n\t\t}\n\n\t\treturn transitionManager.promise;\n\t}\n};\n\nfunction wrapAnimation(node, from, fn, params) {\n\tif (!from) return;\n\n\tconst to = node.getBoundingClientRect();\n\tif (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom) return;\n\n\tconst info = fn(node, { from, to }, params);\n\n\tconst duration = 'duration' in info ? info.duration : 300;\n\tconst delay = 'delay' in info ? info.delay : 0;\n\tconst ease = info.easing || linear;\n\tconst start = window.performance.now() + delay;\n\tconst end = start + duration;\n\n\tconst program = {\n\t\ta: 0,\n\t\tt: 0,\n\t\tb: 1,\n\t\tdelta: 1,\n\t\tduration,\n\t\tstart,\n\t\tend\n\t};\n\n\tconst cssText = node.style.cssText;\n\n\tconst animation = {\n\t\tpending: delay ? program : null,\n\t\tprogram: delay ? null : program,\n\t\trunning: true,\n\n\t\tstart() {\n\t\t\tif (info.css) {\n\t\t\t\tif (delay) node.style.cssText = cssText;\n\n\t\t\t\tconst rule = generateRule(program, ease, info.css);\n\t\t\t\tprogram.name = `__svelte_${hash(rule)}`;\n\n\t\t\t\ttransitionManager.addRule(rule, program.name);\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(anim => anim && (program.delta < 0 || !/__svelte/.test(anim)))\n\t\t\t\t\t.concat(`${program.name} ${program.duration}ms linear 1 forwards`)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tanimation.program = program;\n\t\t\tanimation.pending = null;\n\t\t},\n\n\t\tupdate: now => {\n\t\t\tconst p = now - program.start;\n\t\t\tconst t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (info.tick) info.tick(t, 1 - t);\n\t\t},\n\n\t\tdone() {\n\t\t\tif (info.tick) info.tick(1, 0);\n\t\t\tanimation.stop();\n\t\t},\n\n\t\tstop() {\n\t\t\tif (info.css) transitionManager.deleteRule(node, program.name);\n\t\t\tanimation.running = false;\n\t\t}\n\t};\n\n\ttransitionManager.add(animation);\n\n\tif (info.tick) info.tick(0, 1);\n\n\tif (delay) {\n\t\tif (info.css) node.style.cssText += info.css(0, 1);\n\t} else {\n\t\tanimation.start();\n\t}\n\n\treturn animation;\n}\n\nfunction fixPosition(node) {\n\tconst style = getComputedStyle(node);\n\n\tif (style.position !== 'absolute' && style.position !== 'fixed') {\n\t\tconst { width, height } = style;\n\t\tconst a = node.getBoundingClientRect();\n\t\tnode.style.position = 'absolute';\n\t\tnode.style.width = width;\n\t\tnode.style.height = height;\n\t\tconst b = node.getBoundingClientRect();\n\n\t\tif (a.left !== b.left || a.top !== b.top) {\n\t\t\tconst style = getComputedStyle(node);\n\t\t\tconst transform = style.transform === 'none' ? '' : style.transform;\n\n\t\t\tnode.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n\t\t}\n\t}\n}\n\nfunction handlePromise(promise, info) {\n\tvar token = info.token = {};\n\n\tfunction update(type, index, key, value) {\n\t\tif (info.token !== token) return;\n\n\t\tinfo.resolved = key && { [key]: value };\n\n\t\tconst child_ctx = assign(assign({}, info.ctx), info.resolved);\n\t\tconst block = type && (info.current = type)(info.component, child_ctx);\n\n\t\tif (info.block) {\n\t\t\tif (info.blocks) {\n\t\t\t\tinfo.blocks.forEach((block, i) => {\n\t\t\t\t\tif (i !== index && block) {\n\t\t\t\t\t\tgroupOutros();\n\t\t\t\t\t\tblock.o(() => {\n\t\t\t\t\t\t\tblock.d(1);\n\t\t\t\t\t\t\tinfo.blocks[i] = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tinfo.block.d(1);\n\t\t\t}\n\n\t\t\tblock.c();\n\t\t\tblock[block.i ? 'i' : 'm'](info.mount(), info.anchor);\n\n\t\t\tinfo.component.root.set({}); // flush any handlers that were created\n\t\t}\n\n\t\tinfo.block = block;\n\t\tif (info.blocks) info.blocks[index] = block;\n\t}\n\n\tif (isPromise(promise)) {\n\t\tpromise.then(value => {\n\t\t\tupdate(info.then, 1, info.value, value);\n\t\t}, error => {\n\t\t\tupdate(info.catch, 2, info.error, error);\n\t\t});\n\n\t\t// if we previously had a then/catch block, destroy it\n\t\tif (info.current !== info.pending) {\n\t\t\tupdate(info.pending, 0);\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (info.current !== info.then) {\n\t\t\tupdate(info.then, 1, info.value, promise);\n\t\t\treturn true;\n\t\t}\n\n\t\tinfo.resolved = { [info.value]: promise };\n\t}\n}\n\nfunction destroyBlock(block, lookup) {\n\tblock.d(1);\n\tlookup[block.key] = null;\n}\n\nfunction outroAndDestroyBlock(block, lookup) {\n\tblock.o(function() {\n\t\tdestroyBlock(block, lookup);\n\t});\n}\n\nfunction fixAndOutroAndDestroyBlock(block, lookup) {\n\tblock.f();\n\toutroAndDestroyBlock(block, lookup);\n}\n\nfunction updateKeyedEach(old_blocks, component, changed, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, intro_method, next, get_context) {\n\tvar o = old_blocks.length;\n\tvar n = list.length;\n\n\tvar i = o;\n\tvar old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\n\tvar new_blocks = [];\n\tvar new_lookup = {};\n\tvar deltas = {};\n\n\tvar i = n;\n\twhile (i--) {\n\t\tvar child_ctx = get_context(ctx, list, i);\n\t\tvar key = get_key(child_ctx);\n\t\tvar block = lookup[key];\n\n\t\tif (!block) {\n\t\t\tblock = create_each_block(component, key, child_ctx);\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\tblock.p(changed, child_ctx);\n\t\t}\n\n\t\tnew_blocks[i] = new_lookup[key] = block;\n\n\t\tif (key in old_indexes) deltas[key] = Math.abs(i - old_indexes[key]);\n\t}\n\n\tvar will_move = {};\n\tvar did_move = {};\n\n\tfunction insert(block) {\n\t\tblock[intro_method](node, next);\n\t\tlookup[block.key] = block;\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\n\twhile (o && n) {\n\t\tvar new_block = new_blocks[n - 1];\n\t\tvar old_block = old_blocks[o - 1];\n\t\tvar new_key = new_block.key;\n\t\tvar old_key = old_block.key;\n\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t}\n\n\t\telse if (!new_lookup[old_key]) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t}\n\n\t\telse if (!lookup[new_key] || will_move[new_key]) {\n\t\t\tinsert(new_block);\n\t\t}\n\n\t\telse if (did_move[old_key]) {\n\t\t\to--;\n\n\t\t} else if (deltas[new_key] > deltas[old_key]) {\n\t\t\tdid_move[new_key] = true;\n\t\t\tinsert(new_block);\n\n\t\t} else {\n\t\t\twill_move[old_key] = true;\n\t\t\to--;\n\t\t}\n\t}\n\n\twhile (o--) {\n\t\tvar old_block = old_blocks[o];\n\t\tif (!new_lookup[old_block.key]) destroy(old_block, lookup);\n\t}\n\n\twhile (n) insert(new_blocks[n - 1]);\n\n\treturn new_blocks;\n}\n\nfunction measure(blocks) {\n\tconst rects = {};\n\tlet i = blocks.length;\n\twhile (i--) rects[blocks[i].key] = blocks[i].node.getBoundingClientRect();\n\treturn rects;\n}\n\nfunction animate(blocks, rects, fn, params) {\n\tlet i = blocks.length;\n\twhile (i--) {\n\t\tconst block = blocks[i];\n\t\tconst from = rects[block.key];\n\n\t\tif (!from) continue;\n\t\tconst to = block.node.getBoundingClientRect();\n\n\t\tif (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom) continue;\n\n\n\t}\n}\n\nfunction getSpreadUpdate(levels, updates) {\n\tvar update = {};\n\n\tvar to_null_out = {};\n\tvar accounted_for = {};\n\n\tvar i = levels.length;\n\twhile (i--) {\n\t\tvar o = levels[i];\n\t\tvar n = updates[i];\n\n\t\tif (n) {\n\t\t\tfor (var key in o) {\n\t\t\t\tif (!(key in n)) to_null_out[key] = 1;\n\t\t\t}\n\n\t\t\tfor (var key in n) {\n\t\t\t\tif (!accounted_for[key]) {\n\t\t\t\t\tupdate[key] = n[key];\n\t\t\t\t\taccounted_for[key] = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlevels[i] = n;\n\t\t} else {\n\t\t\tfor (var key in o) {\n\t\t\t\taccounted_for[key] = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (var key in to_null_out) {\n\t\tif (!(key in update)) update[key] = undefined;\n\t}\n\n\treturn update;\n}\n\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nconst invalidAttributeNameCharacter = /[\\s'\">\\/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n\nfunction spread(args) {\n\tconst attributes = Object.assign({}, ...args);\n\tlet str = '';\n\n\tObject.keys(attributes).forEach(name => {\n\t\tif (invalidAttributeNameCharacter.test(name)) return;\n\n\t\tconst value = attributes[name];\n\t\tif (value === undefined) return;\n\t\tif (value === true) str += \" \" + name;\n\n\t\tconst escaped = String(value)\n\t\t\t.replace(/\"/g, '&#34;')\n\t\t\t.replace(/'/g, '&#39;');\n\n\t\tstr += \" \" + name + \"=\" + JSON.stringify(escaped);\n\t});\n\n\treturn str;\n}\n\nconst escaped = {\n\t'\"': '&quot;',\n\t\"'\": '&#39;',\n\t'&': '&amp;',\n\t'<': '&lt;',\n\t'>': '&gt;'\n};\n\nfunction escape(html) {\n\treturn String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\n\nfunction each(items, assign, fn) {\n\tlet str = '';\n\tfor (let i = 0; i < items.length; i += 1) {\n\t\tstr += fn(assign(items[i], i));\n\t}\n\treturn str;\n}\n\nconst missingComponent = {\n\t_render: () => ''\n};\n\nfunction validateSsrComponent(component, name) {\n\tif (!component || !component._render) {\n\t\tif (name === 'svelte:component') name += ' this={...}';\n\t\tthrow new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n\t}\n\n\treturn component;\n}\n\nfunction debug(file, line, column, values) {\n\tconsole.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`);\n\tconsole.log(values);\n\treturn '';\n}\n\nfunction blankObject() {\n\treturn Object.create(null);\n}\n\nfunction destroy(detach) {\n\tthis.destroy = noop;\n\tthis.fire('destroy');\n\tthis.set = noop;\n\n\tthis._fragment.d(detach !== false);\n\tthis._fragment = null;\n\tthis._state = {};\n}\n\nfunction destroyDev(detach) {\n\tdestroy.call(this, detach);\n\tthis.destroy = function() {\n\t\tconsole.warn('Component was already destroyed');\n\t};\n}\n\nfunction _differs(a, b) {\n\treturn a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\n\nfunction _differsImmutable(a, b) {\n\treturn a != a ? b == b : a !== b;\n}\n\nfunction fire(eventName, data) {\n\tvar handlers =\n\t\teventName in this._handlers && this._handlers[eventName].slice();\n\tif (!handlers) return;\n\n\tfor (var i = 0; i < handlers.length; i += 1) {\n\t\tvar handler = handlers[i];\n\n\t\tif (!handler.__calling) {\n\t\t\ttry {\n\t\t\t\thandler.__calling = true;\n\t\t\t\thandler.call(this, data);\n\t\t\t} finally {\n\t\t\t\thandler.__calling = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction flush(component) {\n\tcomponent._lock = true;\n\tcallAll(component._beforecreate);\n\tcallAll(component._oncreate);\n\tcallAll(component._aftercreate);\n\tcomponent._lock = false;\n}\n\nfunction get() {\n\treturn this._state;\n}\n\nfunction init(component, options) {\n\tcomponent._handlers = blankObject();\n\tcomponent._slots = blankObject();\n\tcomponent._bind = options._bind;\n\tcomponent._staged = {};\n\n\tcomponent.options = options;\n\tcomponent.root = options.root || component;\n\tcomponent.store = options.store || component.root.store;\n\n\tif (!options.root) {\n\t\tcomponent._beforecreate = [];\n\t\tcomponent._oncreate = [];\n\t\tcomponent._aftercreate = [];\n\t}\n}\n\nfunction on(eventName, handler) {\n\tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n\thandlers.push(handler);\n\n\treturn {\n\t\tcancel: function() {\n\t\t\tvar index = handlers.indexOf(handler);\n\t\t\tif (~index) handlers.splice(index, 1);\n\t\t}\n\t};\n}\n\nfunction set(newState) {\n\tthis._set(assign({}, newState));\n\tif (this.root._lock) return;\n\tflush(this.root);\n}\n\nfunction _set(newState) {\n\tvar oldState = this._state,\n\t\tchanged = {},\n\t\tdirty = false;\n\n\tnewState = assign(this._staged, newState);\n\tthis._staged = {};\n\n\tfor (var key in newState) {\n\t\tif (this._differs(newState[key], oldState[key])) changed[key] = dirty = true;\n\t}\n\tif (!dirty) return;\n\n\tthis._state = assign(assign({}, oldState), newState);\n\tthis._recompute(changed, this._state);\n\tif (this._bind) this._bind(changed, this._state);\n\n\tif (this._fragment) {\n\t\tthis.fire(\"state\", { changed: changed, current: this._state, previous: oldState });\n\t\tthis._fragment.p(changed, this._state);\n\t\tthis.fire(\"update\", { changed: changed, current: this._state, previous: oldState });\n\t}\n}\n\nfunction _stage(newState) {\n\tassign(this._staged, newState);\n}\n\nfunction setDev(newState) {\n\tif (typeof newState !== 'object') {\n\t\tthrow new Error(\n\t\t\tthis._debugName + '.set was called without an object of data key-values to update.'\n\t\t);\n\t}\n\n\tthis._checkReadOnly(newState);\n\tset.call(this, newState);\n}\n\nfunction callAll(fns) {\n\twhile (fns && fns.length) fns.shift()();\n}\n\nfunction _mount(target, anchor) {\n\tthis._fragment[this._fragment.i ? 'i' : 'm'](target, anchor || null);\n}\n\nvar PENDING = {};\nvar SUCCESS = {};\nvar FAILURE = {};\n\nfunction removeFromStore() {\n\tthis.store._remove(this);\n}\n\nvar proto = {\n\tdestroy,\n\tget,\n\tfire,\n\ton,\n\tset,\n\t_recompute: noop,\n\t_set,\n\t_stage,\n\t_mount,\n\t_differs\n};\n\nvar protoDev = {\n\tdestroy: destroyDev,\n\tget,\n\tfire,\n\ton,\n\tset: setDev,\n\t_recompute: noop,\n\t_set,\n\t_stage,\n\t_mount,\n\t_differs\n};\n\nexport { blankObject, destroy, destroyDev, _differs, _differsImmutable, fire, flush, get, init, on, set, _set, _stage, setDev, callAll, _mount, PENDING, SUCCESS, FAILURE, removeFromStore, proto, protoDev, wrapAnimation, fixPosition, handlePromise, append, insert, detachNode, detachBetween, detachBefore, detachAfter, reinsertBetween, reinsertChildren, reinsertAfter, reinsertBefore, destroyEach, createFragment, createElement, createSvgElement, createText, createComment, addListener, removeListener, setAttribute, setAttributes, setCustomElementData, setXlinkAttribute, getBindingGroupValue, toNumber, timeRangesToArray, children, claimElement, claimText, setData, setInputType, setStyle, selectOption, selectOptions, selectValue, selectMultipleValue, addResizeListener, toggleClass, destroyBlock, outroAndDestroyBlock, fixAndOutroAndDestroyBlock, updateKeyedEach, measure, animate, getSpreadUpdate, invalidAttributeNameCharacter, spread, escaped, escape, each, missingComponent, validateSsrComponent, debug, linear, generateRule, hash, wrapTransition, outros, groupOutros, transitionManager, noop, assign, assignTrue, isPromise, callAfter, addLoc, exclude, run };\n","<div\n  ref:menu\n  style=\"top: {pos.top}px; left: {pos.left}px\"\n  class=\"menu{active ? ' active' : ''}{inputMode ? ' input-mode' : ''}\">\n  <div class=\"items\">\n    {#each items as item}\n      {#if item}\n        <button class=\"editor-menu-{item.name}{item.active ? ' active' : ''}\" on:click=\"onClick(item)\" disabled={item.disabled}>\n          <i class=\"typewriter-icon typewriter-{item.icon || item.name}\"></i>\n        </button>\n      {:else}\n        <div class=\"typewriter-separator\"></div>\n      {/if}\n    {/each}\n  </div>\n  <div class=\"link-input\">\n    <input ref:input bind:value=\"href\" on:keydown=\"onKeyDown(event)\" on:blur=\"exitInput()\" placeholder=\"https://example.com/\">\n    <i on:click=\"exitInput()\" class=\"close\">×</i>\n  </div>\n</div>\n\n<script>\n  const SOURCE_USER = 'user';\n\n  export default {\n    data() {\n      return {\n        view: null,\n        active: false,\n        inputMode: false,\n        pos: { left: 0, top: 0 },\n        href: '',\n      };\n    },\n\n    oncreate() {\n      this.reposition();\n    },\n\n    onstate({ changed, current }) {\n      if (this.refs.menu && (changed.view || changed.range)) {\n        this.reposition();\n      }\n    },\n\n    computed: {\n      items: ({ view, range }) => {\n        if (!view) return [];\n\n        const editor = view.editor;\n        const { blocks, markups } = view.paper;\n        const { header, blockquote } = blocks.types;\n        const { bold, italic, link } = markups.types;\n        const format = editor.getFormat(range);\n        const items = [];\n\n        if (bold) {\n          items.push({\n            name: 'bold',\n            active: format.bold,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (italic) {\n          items.push({\n            name: 'italic',\n            active: format.italic,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (link) {\n          items.push({\n            name: 'link',\n            active: format.link,\n            action: 'onLinkClick'\n          });\n        }\n\n        if (items.length && (header || blockquote)) {\n          items.push(null);\n        }\n\n        if (header) {\n          items.push({\n            name: 'header',\n            icon: 'heading1',\n            active: format.header === 2,\n            action: 'onBlockClick',\n            value: 2\n          }, {\n            name: 'header',\n            icon: 'heading2',\n            active: format.header === 3,\n            action: 'onBlockClick',\n            value: 3\n          });\n        }\n\n        if (blockquote) {\n          items.push({\n            name: 'blockquote',\n            active: format.blockquote,\n            action: 'onBlockClick'\n          });\n        }\n\n        return items;\n      }\n    },\n\n    methods: {\n      reposition() {\n        const { view, range } = this.get();\n        let pos;\n        if (!view || !range) {\n          pos = { top: -100000, left: -100000 };\n        } else {\n          const menu = this.refs.menu;\n          if (!menu.offsetParent) return; // Removed from DOM\n          const container = menu.offsetParent.getBoundingClientRect();\n          const target = view.getBounds(range);\n          pos = {\n            top: target.top - container.top - menu.offsetHeight,\n            left: target.left - container.left + target.width / 2 - menu.offsetWidth / 2,\n          };\n        }\n        this.set({ pos });\n      },\n\n      inputLink() {\n        this.set({ inputMode: true, href: '' });\n        this.refs.input.focus();\n      },\n\n      exitInput() {\n        let { view } = this.get();\n        this.set({ inputMode: false, href: '' });\n        view.focus();\n      },\n\n      createLink() {\n        let { href, view, range } = this.get();\n        href = href.trim();\n        if (href) {\n          view.editor.formatText(range, { link: href }, SOURCE_USER);\n        }\n        view.focus();\n        this.exitInput();\n      },\n\n      onMarkupClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleTextFormat(range, { [item.name]: true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onBlockClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleLineFormat(range, { [item.name]: item.value || true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onLinkClick() {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onHeaderClick(item) {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onClick(item) {\n        if (typeof this[item.action] === 'function') {\n          this[item.action](item);\n        }\n      },\n\n      onKeyDown(event) {\n        if (event.keyCode === 27) {\n          event.preventDefault();\n          this.exitInput();\n        } else if (event.keyCode === 13) {\n          event.preventDefault();\n          this.createLink();\n        }\n      }\n    }\n  }\n</script>\n\n<style>\n  @import url(https://fonts.googleapis.com/icon?family=Material+Icons);\n  .menu {\n    position: absolute;\n    background-image: linear-gradient(to bottom, rgba(49, 49, 47, .99), #262625);\n    border-radius: .25rem;\n    opacity: 0;\n    z-index: 10000;\n    margin-top: -7px;\n    white-space: nowrap;\n  }\n  .menu.active {\n    opacity: 1;\n    animation: pop-upwards 180ms forwards linear;\n    transition: top 75ms ease-out, left 75ms ease-out;\n  }\n  .menu::after {\n    content: '';\n    position: absolute;\n    bottom: -13px;\n    left: 50%;\n    margin-left: -7px;\n    border: 7px solid transparent;\n    border-top-color: #262625;\n  }\n  button {\n    height: 42px;\n    line-height: 42px;\n    vertical-align: middle;\n    border: none;\n    padding: 0 8px;\n    color: #fff;\n    background: none;\n    outline: none;\n    cursor: pointer;\n  }\n  button:first-child {\n    padding-left: 14px;\n  }\n  button:last-child {\n    padding-right: 14px;\n  }\n  button.active {\n    color: #74b6ff;\n  }\n  button[disabled] {\n    opacity: .5;\n    cursor: default;\n  }\n  .typewriter-icon {\n    display: inline-block;\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: inherit;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n  .typewriter-icon.typewriter-bold::before {\n    content: '\\E238';\n  }\n  .typewriter-icon.typewriter-italic::before {\n    content: '\\E23F';\n  }\n  .typewriter-icon.typewriter-link::before {\n    content: '\\E250';\n  }\n  .typewriter-icon.typewriter-heading1::before {\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-heading2::before {\n    font-size: .75em;\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-blockquote::before {\n    content: '\\E244';\n  }\n  .typewriter-separator {\n    display: inline-block;\n    vertical-align: middle;\n    width: 1px;\n    margin: 0 6px;\n    height: 24px;\n    background: rgba(0, 0, 0, .2);\n    box-shadow: 1px 0 rgba(255, 255, 255, .2);\n  }\n  @keyframes pop-upwards {\n    0% {\n      transform: matrix(.97, 0, 0, 1, 0, 12);\n      opacity: 0\n    }\n    20% {\n      transform: matrix(.99, 0, 0, 1, 0, 2);\n      opacity: .7\n    }\n    40% {\n      transform: matrix(1, 0, 0, 1, 0, -1);\n      opacity: 1\n    }\n    70% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n    100% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n  }\n\n  .link-input {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 100%;\n  }\n  .link-input input {\n    width: 100%;\n    height: 100%;\n    background: none;\n    border: none;\n    color: #f7f7f9;\n    padding: 10px 24px 10px 12px;\n    font-size: .875rem;\n    outline: none;\n    box-sizing: border-box;\n  }\n  .link-input .close {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    color: #f7f7f9;\n    opacity: .5;\n  }\n  .link-input .close:hover {\n    color: #f7f7f9;\n    opacity: 1;\n  }\n  .menu:not(.input-mode) .link-input {\n    display: none;\n  }\n  .menu.input-mode .items {\n    opacity: 0;\n  }\n</style>\n","import HoverMenu from '../ui/HoverMenu.html';\n\nexport default function hoverMenu() {\n\n  return view => {\n    const editor = view.editor;\n    let menu, mousedown = false;\n\n\n    function show(range = editor.selection) {\n      if (!menu) {\n        menu = new HoverMenu({\n          target: view.root.parentNode,\n          data: { view, range },\n        });\n        if (menu.get().items.length) {\n          requestAnimationFrame(() => menu && menu.set({ active: true }));\n        }\n      } else {\n        menu.set({ range });\n      }\n    }\n\n    function hide() {\n      if (menu) menu.destroy();\n      menu = null;\n    }\n\n    function update() {\n      const selection = editor.selection;\n      const validSelection = selection && selection[0] !== selection[1];\n      const inputMode = menu && menu.get().inputMode;\n      if (!validSelection || !view.enabled) {\n        if (!inputMode) hide();\n        return;\n      }\n      show();\n    }\n\n    function onEditorChange() {\n      if (!mousedown) update();\n    }\n\n    function onMouseDown() {\n      view.root.ownerDocument.addEventListener('mouseup', onMouseUp);\n      mousedown = true;\n    }\n\n    function onMouseUp() {\n      mousedown = false;\n      setTimeout(update);\n    }\n\n    editor.on('editor-change', onEditorChange);\n    view.root.addEventListener('mousedown', onMouseDown);\n\n    return {\n      show,\n      hide,\n      destroy() {\n        editor.off('editor-change', onEditorChange);\n        view.root.removeEventListener('mousedown', onMouseDown);\n        view.root.ownerDocument.removeEventListener('mouseup', onMouseUp);\n        hide();\n      }\n    }\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport Editor from './editor';\nimport View from './view';\nimport Paper, { container } from './paper';\nimport * as blocks from './view/blocks';\nimport * as markups from './view/markups';\nimport * as embeds from './view/embeds';\nimport defaultPaper from './view/defaultPaper';\n\nexport  { h } from './view/vdom';\nexport { shortcutFromEvent } from './shortcut-string';\nexport { deltaToVdom, deltaFromDom, deltaToHTML, deltaFromHTML } from './view/dom';\n\nimport input from './modules/input';\nimport keyShortcuts from './modules/key-shortcuts';\nimport history from './modules/history';\nimport placeholder from './modules/placeholder';\nimport smartEntry from './modules/smart-entry';\nimport smartQuotes, { smartQuotesDecorator } from './modules/smart-quotes';\nimport hoverMenu from './modules/hover-menu';\n\nconst defaultViewModules = {\n  input: input(),\n  keyShortcuts: keyShortcuts(),\n  history: history(),\n};\n\nexport {\n  EventDispatcher,\n  Delta,\n  Editor,\n  View,\n  Paper,\n  defaultPaper,\n  container,\n  blocks,\n  markups,\n  embeds,\n  input,\n  keyShortcuts,\n  history,\n  placeholder,\n  smartEntry,\n  smartQuotes,\n  smartQuotesDecorator,\n  hoverMenu,\n  defaultViewModules,\n};\n"],"names":["dispatcherEvents","WeakMap","EventDispatcher","type","listener","getEventListeners","add","events","delete","once","off","args","apply","on","uncanceled","forEach","obj","autocreate","get","set","Object","create","Set","DIFF_DELETE","DIFF_INSERT","DIFF_EQUAL","diff","text1","text2","cursor_pos","length","commonlength","diff_commonPrefix","commonprefix","substring","diff_commonSuffix","commonsuffix","diffs","diff_compute_","unshift","push","diff_cleanupMerge","fix_cursor","fix_emoji","longtext","shorttext","i","indexOf","hm","diff_halfMatch_","text1_a","text1_b","text2_a","text2_b","mid_common","diffs_a","diffs_b","concat","diff_bisect_","text1_length","text2_length","max_d","Math","ceil","v_offset","v_length","v1","Array","v2","x","delta","front","k1start","k1end","k2start","k2end","d","k1","k1_offset","x1","y1","charAt","k2_offset","x2","diff_bisectSplit_","k2","y2","y","text1a","text2a","text1b","text2b","diffsb","pointermin","pointermax","min","pointermid","pointerstart","floor","pointerend","diff_halfMatchI_","seed","j","best_common","best_longtext_a","best_longtext_b","best_shorttext_a","best_shorttext_b","prefixLength","suffixLength","hm1","hm2","pointer","count_delete","count_insert","text_delete","text_insert","splice","pop","changes","INSERT","DELETE","EQUAL","cursor_normalize_diff","current_pos","next_pos","slice","split_pos","d_left","d_right","Error","norm","ndiffs","cursor_pointer","d_next","merge_tuples","suffix","compact","starts_with_pair_end","str","charCodeAt","ends_with_pair_start","fixed_diffs","start","left_d","right_d","shallowEqual","objA","objB","valueEqual","strictEqual","deepEqual","valueA","valueB","propEqual","Date","getTime","objectEqual","prototype","keysA","keys","keysB","every","key","NULL_CHARACTER","String","fromCharCode","Delta","ops","text","attributes","newOp","insert","_push","retain","index","lastOp","Iterator","predicate","filter","map","passed","failed","op","target","initial","reduce","entry","getOpLength","end","Infinity","iter","iterator","hasNext","nextOp","next","other","thisIter","otherIter","peekType","peekLength","thisOp","otherOp","composeAttributes","rest","chop","strings","prep","join","diffResult","component","opLength","diffAttributes","newline","lineStart","currentIndex","peek","nextLength","newlineIndex","line","from","to","lines","eachLine","at","getLines","some","getOps","priority","transformPosition","transformAttributes","offset","nextType","source","keepNull","undefined","retOp","substr","SOURCE_API","SOURCE_USER","SOURCE_SILENT","empty","Editor","options","contents","selection","activeFormats","setContents","modules","_queuedEvents","_normalizeRange","getContents","oldSelection","_normalizeSelection","getTextFormat","event","fire","change","oldContents","normalizeContents","compose","transform","getSelectedRange","changeEvent","selectionChanged","_queueEvents","newContents","updateContents","formats","getLineFormat","lineFormat","textFormat","split","cleanDelete","embed","value","result","combineFormats","seleciton","test","name","decorations","classes","getText","format","existing","formatLine","isSame","formatText","producer","singleChange","getChange","range","max","alreadyRunning","shift","toValue","isArray","editor","getLine","lineChange","freeze","combined","merged","h","children","arguments","node","renderChildren","element","patchChildren","clone","eventListener","currentTarget","updateAttribute","isSvg","oldValue","addEventListener","removeEventListener","setAttribute","removeAttribute","createElement","document","createTextNode","createElementNS","appendChild","getElementAttributes","updateElement","oldAttributes","removeElement","parent","removeChild","patch","childNodes","nodeName","toLowerCase","newElement","insertBefore","nodeValue","decorateBlock","vdom","attr","classArray","class","undecorateBlock","block","ignoreClasses","ignoreAttributes","selector","replace","_","attrLength","classList","match","item","attribute","paragraph","header","defaultFollows","dom","parseInt","H","list","optimize","indent","parentNode","lists","topLevelChildren","levels","List","childrenArray","blockquote","quotes","codeblock","hr","bold","styleSelector","italic","code","link","href","image","src","br","cursor","dataset","color","style","backgroundColor","blocks","markups","embeds","getSelection","view","root","ownerDocument","anchorNode","startContainer","anchorOffset","startOffset","focusNode","endContainer","focusOffset","endOffset","isCollapsed","collapsed","contains","anchorIndex","getNodeAndOffsetIndex","focusIndex","setSelection","hasFocus","blur","removeAllRanges","getNodesForRange","setBaseAndExtent","focus","getBrowserRange","browserRange","createRange","setStart","setEnd","getNodeAndOffset","inDom","paper","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","acceptNode","nodeType","Node","TEXT_NODE","FILTER_ACCEPT","FILTER_REJECT","count","firstBlockSeen","currentNode","nextNode","size","matches","isBRPlaceholder","nextSibling","call","firstChild","ELEMENT_NODE","getNodeIndex","previousNode","matchHtmlRegExp","escapeHtml","string","exec","escape","html","lastIndex","Paper","types","Types","container","markup","getDefault","array","priorities","definition","remove","domType","nodeOrAttr","nodeMarkup","BR","VOID_ELEMENTS","area","base","col","img","input","meta","param","track","wbr","SKIP_ELEMENTS","STYLE","SCRIPT","LINK","META","TITLE","BLOCK_ELEMENTS","deltaToVdom","defaultPaper","blockData","inlineChildren","prev","find","sort","a","b","mergeChildren","lastChild","blockChildren","collect","data","deltaFromDom","opts","notInDom","currentBlock","unknownBlock","hasAttribute","deltaToHTML","childrenToHTML","deltaFromHTML","template","innerHTML","content","oldChildren","nodeToHTML","closingTag","child","modifierKeys","Control","Meta","Shift","Alt","shortcutFromEvent","shortcutArray","metaKey","ctrlKey","altKey","shiftKey","toUpperCase","isMac","navigator","userAgent","modExpr","View","className","enable","_settingEditorSelection","_settingBrowserSelection","init","lastSelection","enabled","contentEditable","decorators","e","getBoundingClientRect","getClientRects","reverseDecorators","contenteditable","renderEvent","updateBrowserSelection","setTimeout","nativeRange","currentRange","hasOwnProperty","defaultParagraphSet","onKeyDown","shortcut","onSelectionChange","updateEditorSelection","execCommand","onTextChanging","onEditorChange","render","uninit","api","destroy","lastWord","firstWord","lastLine","pasteMutation","mutationOptions","characterData","characterDataOldValue","subtree","childList","onMutate","m","textChange","getTextChange","onEnter","defaultPrevented","preventDefault","isDefault","atEnd","insertText","onShiftEnter","insertEmbed","onBackspace","deleteText","onDelete","onTab","direction","transaction","prevLine","prevIndent","console","log","mutations","mutation","getTextChangeMutation","addedNodes","action","seen","has","first","second","third","added","removed","removedNodes","textNode","onPaste","observer","MutationObserver","observe","onRendering","disconnect","onRender","keymap","toggleTextFormat","toggleLineFormat","macKeymap","keyShortcuts","customShortcuts","shortcuts","onShortcut","defaultOptions","delay","maxStack","history","stack","undo","redo","lastRecorded","lastAction","ignoreChange","cutoff","dest","record","timestamp","now","getAction","undoChange","undoSelection","redoSelection","onTextChange","changeOp","placeholder","pointerEvents","onDecorate","blockReplacements","capture","textReplacements","blockReplace","prefix","regexp","getAttributes","textReplace","replaceWith","defaultHandlers","handlers","ignore","isTextEntry","getExactText","lastIndexOf","handler","smartQuotes","lastChars","replaced","quote","smartQuotesDecorator","expr","replacer","replacement","_set","hoverMenu","menu","mousedown","show","HoverMenu","items","requestAnimationFrame","active","hide","update","validSelection","inputMode","onMouseDown","onMouseUp","defaultViewModules"],"mappings":"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"}