{"version":3,"file":"typewriter.esm.js","sources":["../src/event-dispatcher.js","../src/diff.js","../src/equal.js","../src/delta.js","../src/editor.js","../src/view/vdom.js","../src/escape-html.js","../src/view/selection.js","../src/view/dom.js","../src/view/blocks.js","../src/view/markups.js","../src/view/embeds.js","../src/view/defaultPaper.js","../src/paper.js","../src/shortcut-string.js","../src/view.js","../src/modules/input.js","../src/modules/key-shortcuts.js","../src/modules/history.js","../src/modules/placeholder.js","../src/modules/smart-entry.js","../src/modules/smart-quotes.js","../node_modules/svelte/shared.js","../src/ui/HoverMenu.html","../src/modules/hover-menu.js","../src/index.js"],"sourcesContent":["const dispatcherEvents = new WeakMap();\n\n\nexport default class EventDispatcher {\n\n  on(type, listener) {\n    getEventListeners(this, type, true).add(listener);\n  }\n\n  off(type, listener) {\n    const events = getEventListeners(this, type);\n    events && events.delete(listener);\n  }\n\n  once(type, listener) {\n    function once(...args) {\n      this.off(type, once);\n      listener.apply(this, args);\n    }\n    this.on(type, once);\n  }\n\n  fire(type, ...args) {\n    let uncanceled = true;\n    const events = getEventListeners(this, type);\n    if (events) events.forEach(listener => {\n      uncanceled && listener.apply(this, args) !== false || (uncanceled = false);\n    });\n    return uncanceled;\n  }\n}\n\n\nfunction getEventListeners(obj, type, autocreate) {\n  let events = dispatcherEvents.get(obj);\n  if (!events && autocreate) dispatcherEvents.set(obj, events = Object.create(null));\n  return events && events[type] || autocreate && (events[type] = new Set());\n}\n","/**\n * This library modifies the diff-patch-match library by Neil Fraser\n * by removing the patch and match functionality and certain advanced\n * options in the diff function. The original license is as follows:\n *\n * ===\n *\n * Diff Match and Patch\n *\n * Copyright 2006 Google Inc.\n * http://code.google.com/p/google-diff-match-patch/\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The data structure representing a diff is an array of tuples:\n * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n */\nvar DIFF_DELETE = -1;\nvar DIFF_INSERT = 1;\nvar DIFF_EQUAL = 0;\n\n\n/**\n * Find the differences between two texts.  Simplifies the problem by stripping\n * any common prefix or suffix off the texts before diffing.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {Int} cursor_pos Expected edit position in text1 (optional)\n * @return {Array} Array of diff tuples.\n */\nexport default function diff(text1, text2, cursor_pos) {\n  // Check for equality (speedup).\n  if (text1 == text2) {\n    if (text1) {\n      return [[DIFF_EQUAL, text1]];\n    }\n    return [];\n  }\n\n  // Check cursor_pos within bounds\n  if (cursor_pos < 0 || text1.length < cursor_pos) {\n    cursor_pos = null;\n  }\n\n  // Trim off common prefix (speedup).\n  var commonlength = diff_commonPrefix(text1, text2);\n  var commonprefix = text1.substring(0, commonlength);\n  text1 = text1.substring(commonlength);\n  text2 = text2.substring(commonlength);\n\n  // Trim off common suffix (speedup).\n  commonlength = diff_commonSuffix(text1, text2);\n  var commonsuffix = text1.substring(text1.length - commonlength);\n  text1 = text1.substring(0, text1.length - commonlength);\n  text2 = text2.substring(0, text2.length - commonlength);\n\n  // Compute the diff on the middle block.\n  var diffs = diff_compute_(text1, text2);\n\n  // Restore the prefix and suffix.\n  if (commonprefix) {\n    diffs.unshift([DIFF_EQUAL, commonprefix]);\n  }\n  if (commonsuffix) {\n    diffs.push([DIFF_EQUAL, commonsuffix]);\n  }\n  diff_cleanupMerge(diffs);\n  if (cursor_pos != null) {\n    diffs = fix_cursor(diffs, cursor_pos);\n  }\n  diffs = fix_emoji(diffs);\n  return diffs;\n};\n\n\n/**\n * Find the differences between two texts.  Assumes that the texts do not\n * have any common prefix or suffix.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_compute_(text1, text2) {\n  var diffs;\n\n  if (!text1) {\n    // Just add some text (speedup).\n    return [[DIFF_INSERT, text2]];\n  }\n\n  if (!text2) {\n    // Just delete some text (speedup).\n    return [[DIFF_DELETE, text1]];\n  }\n\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  var i = longtext.indexOf(shorttext);\n  if (i != -1) {\n    // Shorter text is inside the longer text (speedup).\n    diffs = [[DIFF_INSERT, longtext.substring(0, i)],\n             [DIFF_EQUAL, shorttext],\n             [DIFF_INSERT, longtext.substring(i + shorttext.length)]];\n    // Swap insertions for deletions if diff is reversed.\n    if (text1.length > text2.length) {\n      diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n    }\n    return diffs;\n  }\n\n  if (shorttext.length == 1) {\n    // Single character string.\n    // After the previous speedup, the character can't be an equality.\n    return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n  }\n\n  // Check to see if the problem can be split in two.\n  var hm = diff_halfMatch_(text1, text2);\n  if (hm) {\n    // A half-match was found, sort out the return data.\n    var text1_a = hm[0];\n    var text1_b = hm[1];\n    var text2_a = hm[2];\n    var text2_b = hm[3];\n    var mid_common = hm[4];\n    // Send both pairs off for separate processing.\n    var diffs_a = diff(text1_a, text2_a);\n    var diffs_b = diff(text1_b, text2_b);\n    // Merge the results.\n    return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n  }\n\n  return diff_bisect_(text1, text2);\n};\n\n\n/**\n * Find the 'middle snake' of a diff, split the problem in two\n * and return the recursively constructed diff.\n * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n * @private\n */\nfunction diff_bisect_(text1, text2) {\n  // Cache the text lengths to prevent multiple calls.\n  var text1_length = text1.length;\n  var text2_length = text2.length;\n  var max_d = Math.ceil((text1_length + text2_length) / 2);\n  var v_offset = max_d;\n  var v_length = 2 * max_d;\n  var v1 = new Array(v_length);\n  var v2 = new Array(v_length);\n  // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n  // integers and undefined.\n  for (var x = 0; x < v_length; x++) {\n    v1[x] = -1;\n    v2[x] = -1;\n  }\n  v1[v_offset + 1] = 0;\n  v2[v_offset + 1] = 0;\n  var delta = text1_length - text2_length;\n  // If the total number of characters is odd, then the front path will collide\n  // with the reverse path.\n  var front = (delta % 2 != 0);\n  // Offsets for start and end of k loop.\n  // Prevents mapping of space beyond the grid.\n  var k1start = 0;\n  var k1end = 0;\n  var k2start = 0;\n  var k2end = 0;\n  for (var d = 0; d < max_d; d++) {\n    // Walk the front path one step.\n    for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n      var k1_offset = v_offset + k1;\n      var x1;\n      if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n        x1 = v1[k1_offset + 1];\n      } else {\n        x1 = v1[k1_offset - 1] + 1;\n      }\n      var y1 = x1 - k1;\n      while (x1 < text1_length && y1 < text2_length &&\n             text1.charAt(x1) == text2.charAt(y1)) {\n        x1++;\n        y1++;\n      }\n      v1[k1_offset] = x1;\n      if (x1 > text1_length) {\n        // Ran off the right of the graph.\n        k1end += 2;\n      } else if (y1 > text2_length) {\n        // Ran off the bottom of the graph.\n        k1start += 2;\n      } else if (front) {\n        var k2_offset = v_offset + delta - k1;\n        if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {\n          // Mirror x2 onto top-left coordinate system.\n          var x2 = text1_length - v2[k2_offset];\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n\n    // Walk the reverse path one step.\n    for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n      var k2_offset = v_offset + k2;\n      var x2;\n      if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n        x2 = v2[k2_offset + 1];\n      } else {\n        x2 = v2[k2_offset - 1] + 1;\n      }\n      var y2 = x2 - k2;\n      while (x2 < text1_length && y2 < text2_length &&\n             text1.charAt(text1_length - x2 - 1) ==\n             text2.charAt(text2_length - y2 - 1)) {\n        x2++;\n        y2++;\n      }\n      v2[k2_offset] = x2;\n      if (x2 > text1_length) {\n        // Ran off the left of the graph.\n        k2end += 2;\n      } else if (y2 > text2_length) {\n        // Ran off the top of the graph.\n        k2start += 2;\n      } else if (!front) {\n        var k1_offset = v_offset + delta - k2;\n        if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n          var x1 = v1[k1_offset];\n          var y1 = v_offset + x1 - k1_offset;\n          // Mirror x2 onto top-left coordinate system.\n          x2 = text1_length - x2;\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n  }\n  // Diff took too long and hit the deadline or\n  // number of diffs equals number of characters, no commonality at all.\n  return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n};\n\n\n/**\n * Given the location of the 'middle snake', split the diff in two parts\n * and recurse.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {number} x Index of split point in text1.\n * @param {number} y Index of split point in text2.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_bisectSplit_(text1, text2, x, y) {\n  var text1a = text1.substring(0, x);\n  var text2a = text2.substring(0, y);\n  var text1b = text1.substring(x);\n  var text2b = text2.substring(y);\n\n  // Compute both diffs serially.\n  var diffs = diff(text1a, text2a);\n  var diffsb = diff(text1b, text2b);\n\n  return diffs.concat(diffsb);\n};\n\n\n/**\n * Determine the common prefix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the start of each\n *     string.\n */\nfunction diff_commonPrefix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerstart = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(pointerstart, pointermid) ==\n        text2.substring(pointerstart, pointermid)) {\n      pointermin = pointermid;\n      pointerstart = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Determine the common suffix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the end of each string.\n */\nfunction diff_commonSuffix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 ||\n      text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerend = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n        text2.substring(text2.length - pointermid, text2.length - pointerend)) {\n      pointermin = pointermid;\n      pointerend = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Do the two texts share a substring which is at least half the length of the\n * longer text?\n * This speedup can produce non-minimal diffs.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {Array.<string>} Five element Array, containing the prefix of\n *     text1, the suffix of text1, the prefix of text2, the suffix of\n *     text2 and the common middle.  Or null if there was no match.\n */\nfunction diff_halfMatch_(text1, text2) {\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n    return null;  // Pointless.\n  }\n\n  /**\n   * Does a substring of shorttext exist within longtext such that the substring\n   * is at least half the length of longtext?\n   * Closure, but does not reference any external variables.\n   * @param {string} longtext Longer string.\n   * @param {string} shorttext Shorter string.\n   * @param {number} i Start index of quarter length substring within longtext.\n   * @return {Array.<string>} Five element Array, containing the prefix of\n   *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n   *     of shorttext and the common middle.  Or null if there was no match.\n   * @private\n   */\n  function diff_halfMatchI_(longtext, shorttext, i) {\n    // Start with a 1/4 length substring at position i as a seed.\n    var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n    var j = -1;\n    var best_common = '';\n    var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;\n    while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n      var prefixLength = diff_commonPrefix(longtext.substring(i),\n                                           shorttext.substring(j));\n      var suffixLength = diff_commonSuffix(longtext.substring(0, i),\n                                           shorttext.substring(0, j));\n      if (best_common.length < suffixLength + prefixLength) {\n        best_common = shorttext.substring(j - suffixLength, j) +\n            shorttext.substring(j, j + prefixLength);\n        best_longtext_a = longtext.substring(0, i - suffixLength);\n        best_longtext_b = longtext.substring(i + prefixLength);\n        best_shorttext_a = shorttext.substring(0, j - suffixLength);\n        best_shorttext_b = shorttext.substring(j + prefixLength);\n      }\n    }\n    if (best_common.length * 2 >= longtext.length) {\n      return [best_longtext_a, best_longtext_b,\n              best_shorttext_a, best_shorttext_b, best_common];\n    } else {\n      return null;\n    }\n  }\n\n  // First check if the second quarter is the seed for a half-match.\n  var hm1 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 4));\n  // Check again based on the third quarter.\n  var hm2 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 2));\n  var hm;\n  if (!hm1 && !hm2) {\n    return null;\n  } else if (!hm2) {\n    hm = hm1;\n  } else if (!hm1) {\n    hm = hm2;\n  } else {\n    // Both matched.  Select the longest.\n    hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n  }\n\n  // A half-match was found, sort out the return data.\n  var text1_a, text1_b, text2_a, text2_b;\n  if (text1.length > text2.length) {\n    text1_a = hm[0];\n    text1_b = hm[1];\n    text2_a = hm[2];\n    text2_b = hm[3];\n  } else {\n    text2_a = hm[0];\n    text2_b = hm[1];\n    text1_a = hm[2];\n    text1_b = hm[3];\n  }\n  var mid_common = hm[4];\n  return [text1_a, text1_b, text2_a, text2_b, mid_common];\n};\n\n\n/**\n * Reorder and merge like edit sections.  Merge equalities.\n * Any edit section can move as long as it doesn't cross an equality.\n * @param {Array} diffs Array of diff tuples.\n */\nfunction diff_cleanupMerge(diffs) {\n  diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.\n  var pointer = 0;\n  var count_delete = 0;\n  var count_insert = 0;\n  var text_delete = '';\n  var text_insert = '';\n  var commonlength;\n  while (pointer < diffs.length) {\n    switch (diffs[pointer][0]) {\n      case DIFF_INSERT:\n        count_insert++;\n        text_insert += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_DELETE:\n        count_delete++;\n        text_delete += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_EQUAL:\n        // Upon reaching an equality, check for prior redundancies.\n        if (count_delete + count_insert > 1) {\n          if (count_delete !== 0 && count_insert !== 0) {\n            // Factor out any common prefixies.\n            commonlength = diff_commonPrefix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              if ((pointer - count_delete - count_insert) > 0 &&\n                  diffs[pointer - count_delete - count_insert - 1][0] ==\n                  DIFF_EQUAL) {\n                diffs[pointer - count_delete - count_insert - 1][1] +=\n                    text_insert.substring(0, commonlength);\n              } else {\n                diffs.splice(0, 0, [DIFF_EQUAL,\n                                    text_insert.substring(0, commonlength)]);\n                pointer++;\n              }\n              text_insert = text_insert.substring(commonlength);\n              text_delete = text_delete.substring(commonlength);\n            }\n            // Factor out any common suffixies.\n            commonlength = diff_commonSuffix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              diffs[pointer][1] = text_insert.substring(text_insert.length -\n                  commonlength) + diffs[pointer][1];\n              text_insert = text_insert.substring(0, text_insert.length -\n                  commonlength);\n              text_delete = text_delete.substring(0, text_delete.length -\n                  commonlength);\n            }\n          }\n          // Delete the offending records and add the merged ones.\n          if (count_delete === 0) {\n            diffs.splice(pointer - count_insert,\n                count_delete + count_insert, [DIFF_INSERT, text_insert]);\n          } else if (count_insert === 0) {\n            diffs.splice(pointer - count_delete,\n                count_delete + count_insert, [DIFF_DELETE, text_delete]);\n          } else {\n            diffs.splice(pointer - count_delete - count_insert,\n                count_delete + count_insert, [DIFF_DELETE, text_delete],\n                [DIFF_INSERT, text_insert]);\n          }\n          pointer = pointer - count_delete - count_insert +\n                    (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;\n        } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n          // Merge this equality with the previous one.\n          diffs[pointer - 1][1] += diffs[pointer][1];\n          diffs.splice(pointer, 1);\n        } else {\n          pointer++;\n        }\n        count_insert = 0;\n        count_delete = 0;\n        text_delete = '';\n        text_insert = '';\n        break;\n    }\n  }\n  if (diffs[diffs.length - 1][1] === '') {\n    diffs.pop();  // Remove the dummy entry at the end.\n  }\n\n  // Second pass: look for single edits surrounded on both sides by equalities\n  // which can be shifted sideways to eliminate an equality.\n  // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n  var changes = false;\n  pointer = 1;\n  // Intentionally ignore the first and last element (don't need checking).\n  while (pointer < diffs.length - 1) {\n    if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL) {\n      // This is a single edit surrounded by equalities.\n      if (diffs[pointer][1].substring(diffs[pointer][1].length -\n          diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {\n        // Shift the edit over the previous equality.\n        diffs[pointer][1] = diffs[pointer - 1][1] +\n            diffs[pointer][1].substring(0, diffs[pointer][1].length -\n                                        diffs[pointer - 1][1].length);\n        diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n        diffs.splice(pointer - 1, 1);\n        changes = true;\n      } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n          diffs[pointer + 1][1]) {\n        // Shift the edit over the next equality.\n        diffs[pointer - 1][1] += diffs[pointer + 1][1];\n        diffs[pointer][1] =\n            diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n            diffs[pointer + 1][1];\n        diffs.splice(pointer + 1, 1);\n        changes = true;\n      }\n    }\n    pointer++;\n  }\n  // If shifts were made, the diff needs reordering and another shift sweep.\n  if (changes) {\n    diff_cleanupMerge(diffs);\n  }\n};\n\n\ndiff.INSERT = DIFF_INSERT;\ndiff.DELETE = DIFF_DELETE;\ndiff.EQUAL = DIFF_EQUAL;\n\n/*\n * Modify a diff such that the cursor position points to the start of a change:\n * E.g.\n *   cursor_normalize_diff([[DIFF_EQUAL, 'abc']], 1)\n *     => [1, [[DIFF_EQUAL, 'a'], [DIFF_EQUAL, 'bc']]]\n *   cursor_normalize_diff([[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xyz']], 2)\n *     => [2, [[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xy'], [DIFF_DELETE, 'z']]]\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} A tuple [cursor location in the modified diff, modified diff]\n */\nfunction cursor_normalize_diff (diffs, cursor_pos) {\n  if (cursor_pos === 0) {\n    return [DIFF_EQUAL, diffs];\n  }\n  for (var current_pos = 0, i = 0; i < diffs.length; i++) {\n    var d = diffs[i];\n    if (d[0] === DIFF_DELETE || d[0] === DIFF_EQUAL) {\n      var next_pos = current_pos + d[1].length;\n      if (cursor_pos === next_pos) {\n        return [i + 1, diffs];\n      } else if (cursor_pos < next_pos) {\n        // copy to prevent side effects\n        diffs = diffs.slice();\n        // split d into two diff changes\n        var split_pos = cursor_pos - current_pos;\n        var d_left = [d[0], d[1].slice(0, split_pos)];\n        var d_right = [d[0], d[1].slice(split_pos)];\n        diffs.splice(i, 1, d_left, d_right);\n        return [i + 1, diffs];\n      } else {\n        current_pos = next_pos;\n      }\n    }\n  }\n  throw new Error('cursor_pos is out of bounds!')\n}\n\n/*\n * Modify a diff such that the edit position is \"shifted\" to the proposed edit location (cursor_position).\n *\n * Case 1)\n *   Check if a naive shift is possible:\n *     [0, X], [ 1, Y] -> [ 1, Y], [0, X]    (if X + Y === Y + X)\n *     [0, X], [-1, Y] -> [-1, Y], [0, X]    (if X + Y === Y + X) - holds same result\n * Case 2)\n *   Check if the following shifts are possible:\n *     [0, 'pre'], [ 1, 'prefix'] -> [ 1, 'pre'], [0, 'pre'], [ 1, 'fix']\n *     [0, 'pre'], [-1, 'prefix'] -> [-1, 'pre'], [0, 'pre'], [-1, 'fix']\n *         ^            ^\n *         d          d_next\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} Array of diff tuples\n */\nfunction fix_cursor (diffs, cursor_pos) {\n  var norm = cursor_normalize_diff(diffs, cursor_pos);\n  var ndiffs = norm[1];\n  var cursor_pointer = norm[0];\n  var d = ndiffs[cursor_pointer];\n  var d_next = ndiffs[cursor_pointer + 1];\n\n  if (d == null) {\n    // Text was deleted from end of original string,\n    // cursor is now out of bounds in new string\n    return diffs;\n  } else if (d[0] !== DIFF_EQUAL) {\n    // A modification happened at the cursor location.\n    // This is the expected outcome, so we can return the original diff.\n    return diffs;\n  } else {\n    if (d_next != null && d[1] + d_next[1] === d_next[1] + d[1]) {\n      // Case 1)\n      // It is possible to perform a naive shift\n      ndiffs.splice(cursor_pointer, 2, d_next, d)\n      return merge_tuples(ndiffs, cursor_pointer, 2)\n    } else if (d_next != null && d_next[1].indexOf(d[1]) === 0) {\n      // Case 2)\n      // d[1] is a prefix of d_next[1]\n      // We can assume that d_next[0] !== 0, since d[0] === 0\n      // Shift edit locations..\n      ndiffs.splice(cursor_pointer, 2, [d_next[0], d[1]], [0, d[1]]);\n      var suffix = d_next[1].slice(d[1].length);\n      if (suffix.length > 0) {\n        ndiffs.splice(cursor_pointer + 2, 0, [d_next[0], suffix]);\n      }\n      return merge_tuples(ndiffs, cursor_pointer, 3)\n    } else {\n      // Not possible to perform any modification\n      return diffs;\n    }\n  }\n}\n\n/*\n * Check diff did not split surrogate pairs.\n * Ex. [0, '\\uD83D'], [-1, '\\uDC36'], [1, '\\uDC2F'] -> [-1, '\\uD83D\\uDC36'], [1, '\\uD83D\\uDC2F']\n *     '\\uD83D\\uDC36' === '🐶', '\\uD83D\\uDC2F' === '🐯'\n *\n * @param {Array} diffs Array of diff tuples\n * @return {Array} Array of diff tuples\n */\nfunction fix_emoji (diffs) {\n  var compact = false;\n  var starts_with_pair_end = function(str) {\n    return str.charCodeAt(0) >= 0xDC00 && str.charCodeAt(0) <= 0xDFFF;\n  }\n  var ends_with_pair_start = function(str) {\n    return str.charCodeAt(str.length-1) >= 0xD800 && str.charCodeAt(str.length-1) <= 0xDBFF;\n  }\n  for (var i = 2; i < diffs.length; i += 1) {\n    if (diffs[i-2][0] === DIFF_EQUAL && ends_with_pair_start(diffs[i-2][1]) &&\n        diffs[i-1][0] === DIFF_DELETE && starts_with_pair_end(diffs[i-1][1]) &&\n        diffs[i][0] === DIFF_INSERT && starts_with_pair_end(diffs[i][1])) {\n      compact = true;\n\n      diffs[i-1][1] = diffs[i-2][1].slice(-1) + diffs[i-1][1];\n      diffs[i][1] = diffs[i-2][1].slice(-1) + diffs[i][1];\n\n      diffs[i-2][1] = diffs[i-2][1].slice(0, -1);\n    }\n  }\n  if (!compact) {\n    return diffs;\n  }\n  var fixed_diffs = [];\n  for (var i = 0; i < diffs.length; i += 1) {\n    if (diffs[i][1].length > 0) {\n      fixed_diffs.push(diffs[i]);\n    }\n  }\n  return fixed_diffs;\n}\n\n/*\n * Try to merge tuples with their neigbors in a given range.\n * E.g. [0, 'a'], [0, 'b'] -> [0, 'ab']\n *\n * @param {Array} diffs Array of diff tuples.\n * @param {Int} start Position of the first element to merge (diffs[start] is also merged with diffs[start - 1]).\n * @param {Int} length Number of consecutive elements to check.\n * @return {Array} Array of merged diff tuples.\n */\nfunction merge_tuples (diffs, start, length) {\n  // Check from (start-1) to (start+length).\n  for (var i = start + length - 1; i >= 0 && i >= start - 1; i--) {\n    if (i + 1 < diffs.length) {\n      var left_d = diffs[i];\n      var right_d = diffs[i+1];\n      if (left_d[0] === right_d[1]) {\n        diffs.splice(i, 2, [left_d[0], left_d[1] + right_d[1]]);\n      }\n    }\n  }\n  return diffs;\n}\n","\nexport function shallowEqual(objA, objB) {\n  return valueEqual(objA, objB, strictEqual);\n}\n\nexport function deepEqual(objA, objB) {\n  return valueEqual(objA, objB, valueEqual);\n}\n\nfunction strictEqual(valueA, valueB) {\n  return valueA === valueB;\n}\n\nfunction valueEqual(valueA, valueB, propEqual) {\n  if (valueA === valueB) return true;\n  if (valueA instanceof Date && valueB instanceof Date) return valueA.getTime() === valueB.getTime();\n  if (!valueA || !valueB || typeof valueA !== 'object' && typeof valueB !== 'object')\n    return valueA === valueB;\n  return objectEqual(valueA, valueB, propEqual);\n}\n\nfunction objectEqual(objA, objB, propEqual) {\n  if (objA.prototype !== objB.prototype) return false;\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n  if (keysA.length !== keysB.length) return false;\n  return keysA.every((key, i) => key === keysB[i] && propEqual(objA[key], objB[key], propEqual));\n}\n","import diff from './diff';\nimport { deepEqual } from './equal';\n\nconst NULL_CHARACTER = String.fromCharCode(0);  // Placeholder char for embed in diff()\n\nexport default class Delta {\n\n  constructor(ops = []) {\n    this.ops = ops;\n  }\n\n  /**\n   * Appends an insert operation. Returns this for chainability.\n   *\n   * @param {String|Object} text Represents text or embed to insert\n   * @param {Object} attributes Optional attributes to apply\n   */\n  insert(text, attributes) {\n    var newOp = {};\n    if (text.length === 0) return this;\n    newOp.insert = text;\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Appends a delete operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to delete\n   */\n  delete(length) {\n    if (length <= 0) return this;\n    return this._push({ delete: length });\n  }\n\n  /**\n   * Appends a retain operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to retain\n   * @param {Object} attributes Optional attributes to apply\n   * @returns {Delta} This delta\n   */\n  retain(length, attributes) {\n    if (length <= 0) return this;\n    var newOp = { retain: length };\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Freezes delta from future modifications. Returns this for chainability.\n   *\n   * @returns {Delta} This delta\n   */\n  freeze() {\n    this._push = () => this;\n    return this;\n  }\n\n  /**\n   * Adds a new operation. Returns this for chainability.\n   *\n   * @param {Object} newOp A new operation\n   * @returns {Delta} This delta\n   */\n  _push(newOp) {\n    var index = this.ops.length;\n    var lastOp = this.ops[index - 1];\n    if (typeof lastOp === 'object') {\n      if (typeof newOp.delete === 'number' && typeof lastOp.delete === 'number') {\n        this.ops[index - 1] = { delete: lastOp.delete + newOp.delete };\n        return this;\n      }\n      // Since it does not matter if we insert before or after deleting at the same index,\n      // always prefer to insert first\n      if (typeof lastOp.delete === 'number' && newOp.insert != null) {\n        index -= 1;\n        lastOp = this.ops[index - 1];\n        if (typeof lastOp !== 'object') {\n          this.ops.unshift(newOp);\n          return this;\n        }\n      }\n      if (deepEqual(newOp.attributes, lastOp.attributes)) {\n        if (typeof newOp.insert === 'string' && typeof lastOp.insert === 'string') {\n          this.ops[index - 1] = { insert: lastOp.insert + newOp.insert };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        } else if (typeof newOp.retain === 'number' && typeof lastOp.retain === 'number') {\n          this.ops[index - 1] = { retain: lastOp.retain + newOp.retain };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        }\n      }\n    }\n    if (index === this.ops.length) {\n      this.ops.push(newOp);\n    } else {\n      this.ops.splice(index, 0, newOp);\n    }\n    return this;\n  }\n\n  /**\n   * Chops off trailing retain instructions to make the delta concise.\n   *\n   * @returns {Delta} This delta\n   */\n  chop() {\n    var lastOp = this.ops[this.ops.length - 1];\n    if (lastOp && lastOp.retain && !lastOp.attributes) {\n      this.ops.pop();\n    }\n    return this;\n  }\n\n  /**\n   * Returns an iterator to iterate over the operations of this delta.\n   *\n   * @returns {Iterator} An operation iterator with methods hasNext, next, peek, peekLength, & peekType\n   */\n  iterator() {\n    return new Iterator(this.ops);\n  }\n\n  /**\n   * Returns an array of operations that passes a given function.\n   *\n   * @param {Function} predicate Function to test each operation against. Return true to keep the operation, false\n   *                             otherwise\n   * @returns {Array} Filtered resulting array\n   */\n  filter(predicate) {\n    return this.ops.filter(predicate);\n  }\n\n  /**\n   * Iterates through operations, calling the provided function for each operation.\n   *\n   * @param {Function} predicate Function to call during iteration, passing in the current operation\n   */\n  forEach(predicate) {\n    this.ops.forEach(predicate);\n  }\n\n  /**\n   * Returns a new array with the results of calling provided function on each operation.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning an element of the new\n   *                             array to be returned\n   * @returns {Array} A new array with each element being the result of the given function\n   */\n  map(predicate) {\n    return this.ops.map(predicate);\n  }\n\n  /**\n   * Create an array of two arrays, the first with operations that pass the given function, the other that failed.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning whether that operation\n   *                             passed\n   * @returns {Array} A new array of two Arrays, the first with passed operations, the other with failed operations\n   */\n  partition(predicate) {\n    var passed = [], failed = [];\n    this.forEach(op => {\n      var target = predicate(op) ? passed : failed;\n      target.push(op);\n    });\n    return [passed, failed];\n  }\n\n  /**\n   * Applies given function against an accumulator and each operation to reduce to a single value.\n   *\n   * @param {Function} predicate Function to call per iteration, returning an accumulated value\n   * @param {*} initial Initial value to pass to first call to predicate\n   * @returns {*} The accumulated value\n   */\n  reduce(predicate, initial) {\n    return this.ops.reduce(predicate, initial);\n  }\n\n  changeLength() {\n    return this.reduce((length, entry) => {\n      if (entry.insert) {\n        return length + getOpLength(entry);\n      } else if (entry.delete) {\n        return length - entry.delete;\n      }\n      return length;\n    }, 0);\n  }\n\n  /**\n   * Returns length of a Delta, which is the sum of the lengths of its operations.\n   *\n   * @returns {Number} The length of this delta\n   */\n  length() {\n    return this.reduce((length, entry) => {\n      return length + getOpLength(entry);\n    }, 0);\n  }\n\n  /**\n   * Returns copy of delta with subset of operations.\n   *\n   * @param {Number} start Start index of subset, defaults to 0\n   * @param {Number} end End index of subset, defaults to rest of operations\n   * @returns {Array} An array slice of the operations\n   */\n  slice(start = 0, end) {\n    if (typeof end !== 'number') end = Infinity;\n    var ops = [];\n    var iter = this.iterator();\n    var index = 0;\n    while (index < end && iter.hasNext()) {\n      var nextOp;\n      if (index < start) {\n        nextOp = iter.next(start - index);\n      } else {\n        nextOp = iter.next(end - index);\n        ops.push(nextOp);\n      }\n      index += getOpLength(nextOp);\n    }\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns a Delta that is equivalent to applying the operations of own Delta, followed by another Delta.\n   *\n   * @param {Delta} other Delta to compose\n   */\n  compose(other) {\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else if (thisIter.peekType() === 'delete') {\n        delta._push(thisIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (typeof otherOp.retain === 'number') {\n          var newOp = {};\n          if (typeof thisOp.retain === 'number') {\n            newOp.retain = length;\n          } else {\n            newOp.insert = thisOp.insert;\n          }\n          // Preserve null when composing with a retain, otherwise remove it for inserts\n          var attributes = composeAttributes(thisOp.attributes, otherOp.attributes, typeof thisOp.retain === 'number');\n          if (attributes) newOp.attributes = attributes;\n          delta._push(newOp);\n        // Other op should be delete, we could be an insert or retain\n        // Insert + delete cancels out\n        } else if (typeof otherOp.delete === 'number' && typeof thisOp.retain === 'number') {\n          delta._push(otherOp);\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Returns a new Delta representing the concatenation of this and another document Delta's operations.\n   *\n   * @param {Delta} other Document Delta to concatenate\n   * @returns {Delta} Concatenated document Delta\n   */\n  concat(other) {\n    var delta = new Delta(this.ops.slice());\n    if (other.ops.length > 0) {\n      delta._push(other.ops[0]);\n      delta.ops = delta.ops.concat(other.ops.slice(1));\n    }\n    return delta;\n  }\n\n  /**\n   * Returns a Delta representing the difference between two documents. Optionally, accepts a suggested index where\n   * change took place, often representing a cursor position before change.\n   *\n   * @param {Delta} other Document Delta to diff against\n   * @param {Number} index Suggested index where change took place\n   * @returns {Delta} Difference between the two documents\n   */\n  diff(other, index) {\n    if (this.ops === other.ops) {\n      return new Delta();\n    }\n    var strings = [this, other].map((delta) => {\n      return delta.map((op) => {\n        if (op.insert != null) {\n          return typeof op.insert === 'string' ? op.insert : NULL_CHARACTER;\n        }\n        var prep = (delta === other) ? 'on' : 'with';\n        throw new Error('diff() called ' + prep + ' non-document');\n      }).join('');\n    });\n    var delta = new Delta();\n    var diffResult = diff(strings[0], strings[1], index);\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    diffResult.forEach((component) => {\n      var length = component[1].length;\n      while (length > 0) {\n        var opLength = 0;\n        switch (component[0]) {\n          case diff.INSERT:\n            opLength = Math.min(otherIter.peekLength(), length);\n            delta._push(otherIter.next(opLength));\n            break;\n          case diff.DELETE:\n            opLength = Math.min(length, thisIter.peekLength());\n            thisIter.next(opLength);\n            delta.delete(opLength);\n            break;\n          case diff.EQUAL:\n            opLength = Math.min(thisIter.peekLength(), otherIter.peekLength(), length);\n            var thisOp = thisIter.next(opLength);\n            var otherOp = otherIter.next(opLength);\n            if (deepEqual(thisOp.insert, otherOp.insert)) {\n              delta.retain(opLength, diffAttributes(thisOp.attributes, otherOp.attributes));\n            } else {\n              delta._push(otherOp).delete(opLength);\n            }\n            break;\n        }\n        length -= opLength;\n      }\n    });\n    return delta.chop();\n  }\n\n  /**\n   * Iterates through document Delta, calling a given function with a Delta and attributes object, representing the line\n   * segment.\n   *\n   * @param {Function} predicate Function to call on each line group\n   * @param {String} newline Newline character, defaults to \\n\n   */\n  eachLine(predicate, newline = '\\n') {\n    var iter = this.iterator();\n    var ops = new Delta();\n    var index = 0;\n    var lineStart = 0;\n    var currentIndex = 0;\n\n    while (iter.hasNext()) {\n      if (iter.peekType() !== 'insert') return;\n\n      var op = iter.peek();\n      var nextLength = iter.peekLength();\n      var start = getOpLength(op) - nextLength;\n      var newlineIndex = typeof op.insert === 'string' ? op.insert.indexOf(newline, start) - start : -1;\n\n      if (newlineIndex < 0) {\n        currentIndex += nextLength;\n        ops._push(iter.next());\n      } else if (newlineIndex > 0) {\n        currentIndex += newlineIndex;\n        ops._push(iter.next(newlineIndex));\n      } else {\n        currentIndex += 1;\n        var attributes = iter.next(1).attributes || {};\n        var line = { ops, attributes, start: lineStart, end: currentIndex, index: index };\n        if (predicate(line, index) === false) {\n          return;\n        }\n        index += 1;\n        lineStart = currentIndex;\n        ops = new Delta();\n      }\n    }\n    if (ops.length() > 0) {\n      var line = { ops, attributes: {}, start: lineStart, end: currentIndex, index };\n      predicate(line, index);\n    }\n  }\n\n  // Extends Delta, get the lines from `from` to `to`.\n  getLines(from = 0, to = Infinity, newline) {\n    const lines = [];\n    this.eachLine(line => {\n      if (line.start > to || (line.start === to && from !== to)) return false;\n      if (line.end > from) {\n        lines.push(line);\n      }\n    }, newline);\n    return lines;\n  }\n\n  // Extends Delta, get the line at `at`.\n  getLine(at, newline) {\n    return this.getLines(at, at, newline)[0];\n  }\n\n  // Extends Delta, get the ops from `from` to `to`.\n  getOps(from, to) {\n    let start = 0;\n    const ops = [];\n    this.ops.some(op => {\n      if (start >= to) return true;\n      const end = start + getOpLength(op);\n      if (end > from || (from === to && end === to)) {\n        ops.push({ op, start, end });\n      }\n      start = end;\n    });\n    return ops;\n  }\n\n  // Extends Delta, get the op at `at`.\n  getOp(at) {\n    return this.getOps(at, at)[0];\n  }\n\n  /**\n   * Transform given Delta against own operations. Used as an alias for transformPosition when called with a number.\n   *\n   * @param {Delta} other Delta to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Delta} Transformed Delta\n   */\n  transform(other, priority = false) {\n    if (typeof other === 'number') {\n      return this.transformPosition(other, priority);\n    }\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (thisIter.peekType() === 'insert' && (priority || otherIter.peekType() !== 'insert')) {\n        delta.retain(getOpLength(thisIter.next()));\n      } else if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (thisOp.delete) {\n          // Our delete either makes their delete redundant or removes their retain\n          continue;\n        } else if (otherOp.delete) {\n          delta._push(otherOp);\n        } else {\n          // We retain either their retain or insert\n          delta.retain(length, transformAttributes(thisOp.attributes, otherOp.attributes, priority));\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Transform an index against the delta. Useful for representing cursor/selection positions.\n   *\n   * @param {Number} index Index to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Number} Transformed index\n   */\n  transformPosition(index, priority = false) {\n    var thisIter = this.iterator();\n    var offset = 0;\n    while (thisIter.hasNext() && offset <= index) {\n      var length = thisIter.peekLength();\n      var nextType = thisIter.peekType();\n      thisIter.next();\n      if (nextType === 'delete') {\n        index -= Math.min(length, index - offset);\n        continue;\n      } else if (nextType === 'insert' && (offset < index || !priority)) {\n        index += length;\n      }\n      offset += length;\n    }\n    return index;\n  }\n\n}\n\n\n/**\n * Create an attributes object that is equivalent to applying the attributes of the target followed by the source.\n *\n * @param {Object} target Target attributes object which will have the source applied to\n * @param {Object} source Source attributes object being applied to the target\n * @param {Boolean} keepNull Whether to keep null values from source\n * @returns {Object} A new attributes object (or undefined if empty) with both\n */\nexport function composeAttributes(target = {}, source = {}, keepNull) {\n  var attributes = { ...target, ...source };\n\n  if (!keepNull) Object.keys(attributes).forEach(key => {\n    if (attributes[key] == null) delete attributes[key];\n  });\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Finds the difference between two attributes objects. Returns the source attributes that are different from the\n * target attributes.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @returns {Object} The difference between the two attribute objects or undefined if there is none\n */\nexport function diffAttributes(target = {}, source = {}) {\n  var attributes = Object.keys(target).concat(Object.keys(source)).reduce((attributes, key) => {\n    if (!deepEqual(target[key], source[key])) {\n      attributes[key] = source[key] === undefined ? null : source[key];\n    }\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Transforms the attributes of source over target (or the other way around if priority is set). Will return an\n * attributes object which has all the values from source if priority if false or will have the values from source that\n * are set on target.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @param {Boolean} priority If target has priority over source\n */\nexport function transformAttributes(target, source, priority) {\n  if (typeof target !== 'object') return source;\n  if (typeof source !== 'object') return undefined;\n  if (!priority) return source;  // b simply overwrites us without priority\n\n  var attributes = Object.keys(source).reduce((attributes, key) => {\n    if (target[key] === undefined) attributes[key] = source[key];  // null is a valid value\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Determines the length of a Delta operation.\n *\n * @param {Object} op An operation entry from a Delta object\n * @returns {Number} The length of the op\n */\nexport function getOpLength(op) {\n  if (typeof op.delete === 'number') {\n    return op.delete;\n  } else if (typeof op.retain === 'number') {\n    return op.retain;\n  } else {\n    return typeof op.insert === 'string' ? op.insert.length : 1;\n  }\n}\n\n/**\n * An iterator to handle iterating over a list of Delta operations efficiently.\n */\nexport class Iterator {\n\n  constructor(ops) {\n    this.ops = ops;\n    this.index = 0;\n    this.offset = 0;\n  }\n\n  /**\n   * Determine if there will be another operation returned by `next`.\n   *\n   * @returns {Boolean} Whether there are more operations to iterate over\n   */\n  hasNext() {\n    return this.peekLength() < Infinity;\n  }\n\n  /**\n   * Get the next operation, optionally limited/sliced by length. If an operation is sliced by length, the next call to\n   * `next` will return more of that operation until it is returned in full.\n   *\n   * @param {Number} length Optionally limit the returned operation by length, slicing it down as needed\n   */\n  next(length = Infinity) {\n    var nextOp = this.ops[this.index];\n    if (!nextOp) return { retain: Infinity };\n\n    var offset = this.offset;\n    var opLength = getOpLength(nextOp);\n\n    // Update index and offset\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n\n    if (typeof nextOp.delete === 'number') {\n      return { delete: length };\n    } else {\n      var retOp = {};\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n      return retOp;\n    }\n  }\n\n  /**\n   * Return the next entry.\n   *\n   * @returns {Object} The next entry in the ops array.\n   */\n  peek() {\n    return this.ops[this.index];\n  }\n\n  /**\n   * Check the length of the next entry.\n   *\n   * @returns {Number} The length of the next entry or Infinity if there is no next entry\n   */\n  peekLength() {\n    if (this.ops[this.index]) {\n      // Should never return 0 if our index is being managed correctly\n      return getOpLength(this.ops[this.index]) - this.offset;\n    } else {\n      return Infinity;\n    }\n  }\n\n  /**\n   * Check the type of the next entry, delete, retain, or insert.\n   *\n   * @returns {String} The type of the next entry\n   */\n  peekType() {\n    if (this.ops[this.index]) {\n      if (typeof this.ops[this.index].delete === 'number') {\n        return 'delete';\n      } else if (typeof this.ops[this.index].retain === 'number') {\n        return 'retain';\n      } else {\n        return 'insert';\n      }\n    }\n    return 'retain';\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport { shallowEqual, deepEqual } from './equal';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst empty = {};\n\n/**\n * Event for text changes, called before the change has occurred. If a listener returns false the change will be\n * canceled and not committed.\n *\n * @event Editor#text-changing\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for text changes, called after the change has occurred.\n *\n * @event Editor#text-change\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for selection changes. If part of a text change the `change`, `content`, and `oldContent` properties will be\n * set. Otherwise they will not be set.\n *\n * @event Editor#selection-change\n * @type  {Object}\n * @property {Delta} change       [ Optional ] The change which is being applied to the content\n * @property {Delta} content      [ Optional ] The new content after the change\n * @property {Delta} oldContent   [ Optional ] The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * A Typewriter Editor handles the logic for selection and editing of contents. It has no dependency on browser APIs\n * and can be used in Node.js as easily as the browser. It has no logic to limit formatting (i.e. it does not disallow\n * using bold, headers, links, or FOOBAR), that will need to be limited outside of the editor itself.\n *\n * @fires Editor#text-changing\n * @fires Editor#text-change\n * @fires Editor#selection-change\n *\n * @readonly @property {Delta}  contents      The data model for the text editor\n * @readonly @property {Number} length        The length of the contents\n * @readonly @property {String} text          The text of the contents\n * @readonly @property {Array}  selection     The current editor selection, a tuple of `[ from, to ]` or `null`\n * @readonly @property {Object} activeFormats The currently active formats (formats that will apply on the next insert)\n */\nexport default class Editor extends EventDispatcher {\n\n  /**\n   * Create a new Typewriter editor.\n   *\n   * @param {Object} options Options for this editor include initial `contents` and `modules`:\n   * @param {Delta}  options.contents The initial contents of this editor\n   * @param {Array}  options.modules  An array of functions which will be executed with the editor being passed as an\n   *                                  argument.\n   */\n  constructor(options = {}) {\n    super();\n    this.contents = null;\n    this.length = 0;\n    this.selection = null;\n    this.activeFormats = empty;\n    setContents(this, options.contents || this.delta().insert('\\n'));\n    this.modules = {};\n    if (options.modules) Object.keys(options.modules).forEach(key => this.modules[key] = options.modules[key](this));\n  }\n\n  /**\n   * Convenience method for creating a new delta (allows other modules to not need to require Delta). Used for creating\n   * change deltas for updating the contents.\n   *\n   * @param {Array} ops [Optional] The initial ops for the delta\n   * @returns {Delta}   A new Delta object\n   */\n  delta(ops) {\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns the contents or a slice of them.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {Delta}     The contents of this editor\n   */\n  getContents(from = 0, to = this.length) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.contents.slice(from, to);\n  }\n\n  /**\n   * Returns the text for the editor or a slice of it.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor\n   */\n  getText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .filter(op => typeof op.insert === 'string')\n      .map(op => op.insert)\n      .join('');\n  }\n\n  /**\n   * Returns the text for the editor with spaces in place of embeds. This can be used to determine the index of given\n   * words or lines of text within the contents.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor with embed spaces\n   */\n  getExactText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .map(op => typeof op.insert === 'string' ? op.insert : ' ')\n      .join('');\n  }\n\n  /**\n   * Set the selection to a new location (or null for no selection). Will return false if the new selection is the same\n   * as the old selection. Dispatches \"selection-change\" once the selection is changed. This \"selection-change\" event\n   * won't have { contents, oldContnts, change } in it since the selection is changing without any content updates.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Boolean}        Whether the selection changed or not\n   */\n  setSelection(from, to, source = SOURCE_USER) {\n    const oldSelection = this.selection;\n    let selection;\n\n    if (from === null) {\n      selection = null;\n      if (typeof to === 'string') source = to;\n    } else {\n      [from, to, source ] = this._normalizeSelection(from, to, source);\n      selection = [ from, to ].map(i => Math.min(i, this.length - 1));\n    }\n\n    if (shallowEqual(oldSelection, selection)) return false;\n\n    // Reset the active formats when selection changes (do this before setting selection)\n    this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n    this.selection = selection;\n    const event = { selection, oldSelection, source };\n\n    if (source !== SOURCE_SILENT) this.fire('selection-change', event);\n    this.fire('editor-change', event);\n    return true;\n  }\n\n  /**\n   * The method that all other methods use to update the contents (even setContents & setText). This method will\n   * dispatch the event \"text-changing\". If a listener returns `false` then the change will be canceled and null will\n   * be returned. Otherwise, the change will be successful and if the `source` is not \"silent\" a \"text-change\" event\n   * will be fired with an event object containing `{ contents, oldContents, selection, oldSelection, source }`. If the\n   * selection has changed as part of this update a \"selection-change\" event will also be fired with the same event\n   * object.\n   *\n   * @param {Delta} change    A delta change to the document\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  updateContents(change, source = SOURCE_API, selection) {\n    if (!change.chop().ops.length) return null;\n\n    const oldContents = this.contents;\n    const contents = normalizeContents(oldContents.compose(change));\n    const length = contents.length();\n    const oldSelection = this.selection;\n    if (!selection) selection = oldSelection ? oldSelection.map(i => change.transform(i)) : oldSelection;\n    selection = selection && this.getSelectedRange(selection, length - 1);\n\n    const changeEvent = { contents, oldContents, change, selection, oldSelection, source };\n    const selectionChanged = !shallowEqual(oldSelection, selection);\n\n    if (!this.fire('text-changing', changeEvent)) return null;\n\n    setContents(this, contents);\n\n    if (selection) {\n      // Reset the active formats when selection changes (do this before setting selection)\n      this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n      this.selection = selection;\n    }\n\n    if (source !== SOURCE_SILENT) {\n      this.fire('text-change', changeEvent);\n      if (selectionChanged) this.fire('selection-change', changeEvent);\n    }\n    this.fire('editor-change', changeEvent);\n    return change;\n  }\n\n  /**\n   * Sets the entire contents of the editor. This will calculate the difference between the old content and the new and\n   * only apply the difference, if any.\n   *\n   * @param {Delta} newContents The contents of the editor, as a delta object\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  setContents(newContents, source, selection) {\n    const change = this.contents.diff(normalizeContents(newContents));\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Sets the text content of the editor, removing existing contents and formatting.\n   *\n   * @param {String} text     Set the contents of this editor as text\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  setText(text, source, selection) {\n    return this.setContents(this.delta().insert(text + '\\n'), source, selection);\n  }\n\n  /**\n   * Inserts text into the content of the editor, removing text between from and to if provided. If `text` is a newline\n   * (\"\\n\") then the formats will apply to the line, otherwise they will apply to the text only (even if there are\n   * newlines in the text).\n   *\n   * @param {Number} from      Insert the text at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} text      The text to insert into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertText(from, to, text, formats, source, selection) {\n    [ from, to, text, formats, source, selection ] =\n      this._normalizeRange(from, to, text, formats, source, selection);\n\n    // If we are not inserting a newline, make sure from and to are within the selectable range\n    if (text !== '\\n') [ from, to ] = this.getSelectedRange([ from, to ]);\n\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (selection == null && this.selection !== null) selection = from + text.length;\n    let change = this.delta().retain(from).delete(to - from);\n\n    if (text === '\\n') {\n      change.insert('\\n', formats || this.getLineFormat(from));\n    } else {\n      const lineFormat = text.indexOf('\\n') === -1 ? null : this.getLineFormat(from);\n      const textFormat = formats || this.getTextFormat(from);\n      text.split('\\n').forEach((line, i) => {\n        if (i) change.insert('\\n', lineFormat);\n        line.length && change.insert(line, textFormat);\n      });\n    }\n\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Inserts an embed into the content of the editor, removing text between from and to if provided.\n   *\n   * @param {Number} from      Insert the embed at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} embed     Insert the text into the editor's contents\n   * @param {mixed}  value     Insert the text into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertEmbed(from, to, embed, value, formats, source, selection) {\n    [ from, to, embed, value, source, selection ] =\n      this._normalizeRange(from, to, embed, value, source, selection);\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (from >= this.length) from = this.length - 1;\n    if (to >= this.length) to = this.length - 1;\n    if (selection == null && this.selection !== null) selection = from + 1;\n    const textFormat = formats || this.getTextFormat(from);\n    let change = this.delta().retain(from).delete(to - from).insert({ [embed]: value }, textFormat);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Deletes text from `from` to `to`.\n   *\n   * @param {Number} from      Insert the text as this index, can also be a range Array tuple, default 0\n   * @param {Number} to        Will delete the text between `from` and `to`\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  deleteText(from, to, source, selection) {\n    [ from, to, source, selection ] = this._normalizeRange(from, to, source, selection);\n    if (from === to) return null;\n    if (selection == null && this.selection !== null) selection = from;\n    let change = this.delta().retain(from).delete(to - from);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Get the line formats for the line that `from` is in to the line that `to` is in. Returns only the common formats\n   * between all the lines. If `from` equals `to` (or `to` is not provided) the formats will be all of those for the\n   * line `from` is on. If two lines are touched and they have different formats, an empty object will be returned.\n   *\n   * @param {Number} from Getting line formats starting at `from`\n   * @param {Number} to   Getting line formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines which intersect from and to\n   */\n  getLineFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!line.attributes) formats = {};\n      else if (!formats) formats = { ...line.attributes };\n      else formats = combineFormats(formats, line.attributes);\n    });\n\n    return formats;\n  }\n\n  /**\n   * Get the text formats for all the text from `from` to `to`. Returns only the common formats between the two indexes.\n   * Will also return the `activeFormats`. Active formats are those which are toggled on when the selection is collapsed\n   * (from and to are equal) indicating inserted text should use (or not use) those formats.\n   *\n   * @param {Number} from Getting text formats starting at `from`\n   * @param {Number} to   Getting text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the text\n   */\n  getTextFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    // optimize for current selection\n    const seleciton = this.selection;\n    if (from === to && shallowEqual(this.selection, [ from, to ])) {\n      return this.activeFormats;\n    }\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      if (/^\\n+$/.test(op.insert)) return;\n      if (!op.attributes) formats = {};\n      else if (!formats) formats = { ...op.attributes };\n      else formats = combineFormats(formats, op.attributes);\n    });\n\n    if (!formats) formats = {};\n\n    return formats;\n  }\n\n  /**\n   * Get the text and line formats for all the lines and text from `from` to `to`.\n   *\n   * @param {Number} from Getting line and text formats starting at `from`\n   * @param {Number} to   Getting line and text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines and text which intersect from and to\n   */\n  getFormat(from, to) {\n    return { ...this.getTextFormat(from, to), ...this.getLineFormat(from, to) };\n  }\n\n  /**\n   * Formats the lines intersected by `from` and `to` with the given line formats. To remove an existing format pass in\n   * `null` or `false` to turn it off (e.g. `{ blockquote: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatLine(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    const change = this.delta();\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      // Clear out old formats on the line\n      Object.keys(line.attributes).forEach(name => !formats[name] && (formats[name] = null));\n      change.retain(1, formats);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Adds additional attributes or classes to the lines intersected by `from` and `to`. Markups are easy to nest to add\n   * additional attributes/classes, but you cannot do that with lines/blocks.\n   * Setting a class to false will remove a previous decoration, but it will not remove a class which is part of the\n   * block definition. This method is a cross-over with HTML view and should be used sparingly.\n   *\n   * Example:\n   * ```js\n   * editor.decorateLine(0, {\n   *   attributes: { 'data-placeholder': 'Enter Text' },\n   *   classes: { active: true, empty: true }\n   * });\n   * // <p data-placeholder=\"Enter Text\" class=\"active empty\">\n   * ```\n   *\n   * @param {Number} from        The starting index\n   * @param {Number} to          The ending index\n   * @param {String} decorations The attributes/classes for the line.\n   * @param {String} source      The source of the change, user, api, or silent\n   * @returns {Delta}            Returns the change when successful, or null if not\n   */\n  decorateLine(from, to, decorations, source) {\n    [ from, to, decorations, source ] = this._normalizeRange(from, to, decorations, source);\n    const change = this.delta();\n\n    if (decorations.attributes) {\n      Object.keys(decorations.attributes).forEach(name => {\n        if (decorations.attributes[name] === '') decorations.attributes[name] = true;\n      });\n    }\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      let { attributes, classes } = decorations;\n\n      // Merge with any existing formats on the line\n      if (attributes) {\n        if (line.attributes.attributes) {\n          decorations = { ...decorations, attributes: { ...line.attributes.attributes, ...attributes }};\n        }\n\n        Object.keys(attributes).forEach(name => {\n          const value = attributes[name];\n          if (value == null || value === false) delete decorations.attributes[name];\n        });\n\n        if (!Object.keys(decorations.attributes).length) {\n          decorations = { ...decorations, attributes: null };\n        }\n      }\n      if (classes) {\n        if (line.attributes.classes) {\n          decorations = { ...decorations, classes: { ...line.attributes.classes, ...classes }};\n        }\n\n        Object.keys(classes).forEach(name => {\n          if (!classes[name]) delete decorations.classes[name];\n        });\n\n        if (!Object.keys(decorations.classes).length) {\n          decorations = { ...decorations, classes: null };\n        }\n      }\n\n      change.retain(1, decorations);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Formats the text from `from` to `to` with the given text formats. To remove an existing format pass in `null` or\n   * `false` to turn it off (e.g. `{ bold: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatText(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    if (from === to) {\n      if (this.activeFormats === empty) this.activeFormats = {};\n      Object.keys(formats).forEach(key => {\n        const value = formats[key];\n        if (value == null || value === false) delete this.activeFormats[key];\n        else this.activeFormats[key] = value;\n      });\n      return;\n    }\n    Object.keys(formats).forEach(name => formats[name] === false && (formats[name] = null));\n    const change = this.delta().retain(from);\n    this.getText(from, to).split('\\n').forEach(line => {\n      line.length && change.retain(line.length, formats).retain(1);\n    });\n    change.chop();\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Toggles the line formats from `from` to `to` with the given line formats. If the line has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleLineFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getLineFormat(from, to);\n    if (deepEqual(existing, format)) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatLine(from, to, format, source);\n  }\n\n  /**\n   * Toggles the text formats from `from` to `to` with the given text formats. If the text has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleTextFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getTextFormat(from, to);\n    const isSame = Object.keys(format).every(key => format[key] === existing[key]);\n    if (isSame) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatText(from, to, format, source);\n  }\n\n  /**\n   * Removes all formatting, text and line formats, for the text and lines from `from` to `to`.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  removeFormat(from, to, source) {\n    [ from, to, source ] = this._normalizeRange(from, to, source);\n    const formats = {};\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      op.attributes && Object.keys(op.attributes).forEach(key => formats[key] = null);\n    });\n\n    let change = this.delta().retain(from).retain(to - from, formats);\n\n    // If the last block was not captured be sure to clear that too\n    this.contents.getLines(from, to).forEach(line => {\n      const formats = {};\n      Object.keys(line.attributes).forEach(key => formats[key] = null);\n      change = change.compose(this.delta().retain(line.end - 1).retain(1, formats));\n    });\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Create a change delta calling one or more methods on the editor. The changes will not be applied as normal but will\n   * be collated into a single change delta and returned from this methnod. Example:\n   * ```js\n   * var change = editor.getChange(function() {\n   *   editor.deleteText(0, 5);\n   *   editor.insertText('\\n', { blockquote: true });\n   *   editor.formatText(10, 20, { bold: true });\n   * });\n   *\n   * editor.updateContents(change, 'user');\n   * ```\n   *\n   * @param {Function} producer A function in which to call methods on the editor to produce a change\n   * @returns {Delta}           The sum of all the changes made within the producer\n   */\n  getChange(producer) {\n    let change = this.delta();\n    this.updateContents = singleChange => {\n      if (singleChange.ops.length) {\n        change = change.compose(singleChange);\n        return singleChange;\n      } else {\n        return null;\n      }\n    };\n    producer(this);\n    delete this.updateContents;\n    return change;\n  }\n\n  /**\n   * Make several changes to the editor apply all at one in one commit. Changes made with the transaction will be\n   * applied all together and the \"text-changing\", \"text-change\", and \"selection-change\" events will be dispatched only\n   * once. Use this to combine multiple changes into one.\n   *\n   * @param {Function} producer A function which should make changes with the editor\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  transaction(producer, source, selection) {\n    const change = this.getChange(producer);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Returns the selected range (or the provided range) in index order (lowest number first) and within the bounds of\n   * the content, between 0 and content.length() - 1 (the selection cannot be past the trailing newline).\n   *\n   * @param {Array} range Optional range, defaults to current selection\n   * @param {Number} max  The maxium number the range can be\n   */\n  getSelectedRange(range = this.selection, max = this.length - 1) {\n    if (range == null) return range;\n    if (typeof range === 'number') range = [ range, range ];\n    if (range[0] > range[1]) [range[0], range[1]] = [range[1], range[0]];\n    return range.map(index => Math.max(0, Math.min(max, index)));\n  }\n\n  /**\n   * Normalizes range values to a proper range if it is not already. A range is a `from` and a `to` index, e.g. 0, 4.\n   * This will ensure the lower index is first. Example usage:\n   * editor._normalizeRange(5); // [5, 5]\n   * editor._normalizeRange(-4, 100); // for a doc with length 10, [0, 10]\n   * editor._normalizeRange(25, 18); // [18, 25]\n   * editor._normalizeRange([12, 13]); // [12, 13]\n   * editor._normalizeRange(5, { bold: true }); // [5, 5, { bold: true }]\n   */\n  _normalizeRange(from, to, ...rest) {\n    [ from, to, ...rest ] = this._normalizeSelection(from, to, ...rest);\n    if (from > to) [from, to] = [to, from];\n    return [from, to].concat(rest);\n  }\n\n  _normalizeSelection(from, to, ...rest) {\n    if (Array.isArray(from)) {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      [from, to] = from;\n      if (to === undefined) to = from;\n    } else if (typeof from !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      if (from !== undefined || rest.length) rest.unshift(from);\n      from = to = 0;\n    } else if (typeof to !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      to = from;\n    }\n    from = Math.max(0, Math.min(this.length, ~~from));\n    to = Math.max(0, Math.min(this.length, ~~to));\n    return [from, to].concat(rest);\n  }\n}\n\n// Ensures the format for the current line in a delete remains the same when multiple lines are deleted. This is needed\n// because the last line holds the formatting after a delete, but the first line is expected to be the retained format\nfunction cleanDelete(editor, from, to, change) {\n  if (from !== to) {\n    const line = editor.contents.getLine(from);\n    if (!line.ops.length() && to === from + 1) return change;\n    const lineFormat = editor.getLineFormat(from);\n    if (!deepEqual(lineFormat, editor.getLineFormat(to))) {\n      const lineChange = editor.getChange(() => editor.formatLine(to, lineFormat))\n      change = change.compose(change.transform(lineChange));\n    }\n  }\n  return change;\n}\n\n// Ensures contents end with a newline\nfunction normalizeContents(contents) {\n  // Contents only have inserts. Deletes and retains belong to changes only.\n  contents.ops = contents.ops.filter(op => op.insert);\n  const lastOp = contents.ops[contents.ops.length - 1];\n  if (!lastOp || typeof lastOp.insert !== 'string' || lastOp.insert.slice(-1) !== '\\n') contents.insert('\\n');\n  return contents;\n}\n\n// Delta no operation method\nfunction deltaNoop() {\n  return this;\n}\n\n// Sets the contents onto the editor after ensuring they end in a newline, freezes the contents from change, and\n// updates the length and text of the editor to the latest\nfunction setContents(editor, contents) {\n  contents = normalizeContents(contents);\n  contents.freeze();\n  editor.contents = contents;\n  editor.length = contents.length();\n}\n\n// Combine formats removing ones that don't exist in both and creating an array for those with multiple values\nfunction combineFormats(formats, combined) {\n  return Object.keys(combined).reduce(function(merged, name) {\n    if (formats[name] == null) return merged;\n    if (combined[name] === formats[name]) {\n      merged[name] = combined[name];\n    } else if (Array.isArray(combined[name])) {\n      if (combined[name].indexOf(formats[name]) < 0) {\n        merged[name] = combined[name].concat([formats[name]]);\n      }\n    } else {\n      merged[name] = [combined[name], formats[name]];\n    }\n    return merged;\n  }, {});\n}\n","// Based off of https://github.com/jorgebucaran/ultradom/ MIT licensed\n\nexport function h(name, attributes) {\n  var rest = [];\n  var children = [];\n  var length = arguments.length;\n\n  while (length-- > 2) rest.push(arguments[length]);\n\n  while (rest.length) {\n    var node = rest.pop();\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length]);\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node);\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        name,\n        attributes: attributes || {},\n        children: children\n      };\n}\n\nexport function render(node, element) {\n  element = element ?\n    patch(element.parentNode, element, node) :\n    patch(null, null, node);\n  return element;\n}\n\nexport function renderChildren(node, element) {\n  patchChildren(element, node.children);\n}\n\n\nfunction clone(target, source) {\n  var obj = {};\n\n  for (var i in target) obj[i] = target[i];\n  for (var i in source) obj[i] = source[i];\n\n  return obj;\n}\n\nfunction eventListener(event) {\n  return event.currentTarget.events[event.type](event);\n}\n\nfunction updateAttribute(element, name, value, isSvg) {\n  if (name[0] === \"o\" && name[1] === \"n\") {\n    if (!element.events) {\n      element.events = {};\n    }\n    name = name.slice(2);\n    const oldValue = element.events[name];\n    element.events[name] = value;\n    if (value) {\n      if (!oldValue) {\n        element.addEventListener(name, eventListener);\n      }\n    } else {\n      element.removeEventListener(name, eventListener);\n    }\n  } else if (name in element && name !== \"list\" && !isSvg) {\n    element[name] = value == null ? \"\" : value;\n  } else if (value != null && value !== false) {\n    element.setAttribute(name, value === true ? '' : value);\n  }\n\n  if (value == null || value === false) {\n    element.removeAttribute(name);\n  }\n}\n\nfunction createElement(node, isSvg) {\n  var element =\n    typeof node === \"string\" || typeof node === \"number\"\n      ? document.createTextNode(node)\n      : (isSvg = isSvg || node.name === \"svg\")\n        ? document.createElementNS(\n            \"http://www.w3.org/2000/svg\",\n            node.name\n          )\n        : document.createElement(node.name);\n\n  var attributes = node.attributes;\n  if (attributes) {\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSvg));\n    }\n\n    for (var name in attributes) {\n      updateAttribute(element, name, attributes[name], isSvg);\n    }\n  }\n\n  return element;\n}\n\nfunction getElementAttributes(element, isSvg) {\n  var attributes = {};\n  for (var i = 0; i < element.attributes.length; i++) {\n    var { name, value } = element.attributes[i];\n    if (name in element && name !== \"list\" && !isSvg) {\n      attributes[name] = element[name];\n    } else {\n      attributes[name] = value === '' ? true : value;\n    }\n  }\n  return attributes;\n}\n\nfunction updateElement(element, attributes, isSvg) {\n  var oldAttributes = getElementAttributes(element);\n  for (var name in clone(oldAttributes, attributes)) {\n    if (\n      attributes[name] !==\n      (name === \"value\" || name === \"checked\"\n        ? element[name]\n        : oldAttributes[name])\n    ) {\n      updateAttribute(\n        element,\n        name,\n        attributes[name],\n        isSvg\n      )\n    }\n  }\n}\n\nfunction removeElement(parent, element) {\n  parent.removeChild(element);\n}\n\nfunction patchChildren(element, children, isSvg) {\n  var i = 0;\n\n  while (i < children.length) {\n    patch(element, element.childNodes[i], children[i], isSvg);\n    i++;\n  }\n\n  while (i < element.childNodes.length) {\n    removeElement(element, element.childNodes[i]);\n  }\n}\n\nfunction patch(parent, element, node, isSvg) {\n  var name = element && element.nodeName !== '#text' ? element.nodeName.toLowerCase() : undefined;\n  if (element == null || name !== node.name) {\n    var newElement = createElement(node, isSvg);\n\n    if (parent) {\n      parent.insertBefore(newElement, element);\n      if (element != null) {\n        removeElement(parent, element);\n      }\n    }\n\n    element = newElement;\n  } else if (name == null) {\n    if (element.nodeValue !== node) element.nodeValue = node;\n  } else {\n    updateElement(\n      element,\n      node.attributes,\n      (isSvg = isSvg || node.name === \"svg\")\n    );\n\n    patchChildren(element, node.children, isSvg);\n  }\n  return element;\n}\n","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\nconst matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nexport default function escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}","const indexOf = [].indexOf;\n\n// Get the range (a tuple of indexes) for this view from the browser selection\nexport function getSelection(view, range) {\n  const root = view.root;\n  const selection = !range ? root.ownerDocument.defaultView.getSelection() : {\n    anchorNode: range.startContainer, anchorOffset: range.startOffset,\n    focusNode: range.endContainer, focusOffset: range.endOffset,\n    isCollapsed: range.collapsed,\n  };\n\n  if (!root.contains(selection.anchorNode)) {\n    return null;\n  } else {\n    const anchorIndex = getNodeAndOffsetIndex(view, selection.anchorNode, selection.anchorOffset);\n    let focusIndex = selection.isCollapsed ?\n      anchorIndex :\n      getNodeAndOffsetIndex(view, selection.focusNode, selection.focusOffset);\n\n    return [ anchorIndex, focusIndex ];\n  }\n}\n\n// Set the browser selection to the range (a tuple of indexes) of this view\nexport function setSelection(view, range) {\n  const root = view.root;\n  const selection = root.ownerDocument.defaultView.getSelection();\n  const hasFocus = root.contains(root.ownerDocument.activeElement);\n\n  if (range == null) {\n    if (hasFocus) {\n      root.blur();\n      selection.setBaseAndExtent(null, 0, null, 0);\n    }\n  } else {\n    const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n    selection.setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset);\n    if (!hasFocus) root.focus();\n  }\n}\n\n// Get a browser range object for the given editor range tuple\nexport function getBrowserRange(view, range) {\n  if (range[0] > range[1]) range = [ range[1], range[0] ];\n  const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n  const browserRange = document.createRange();\n  browserRange.setStart(anchorNode, anchorOffset);\n  browserRange.setEnd(focusNode, focusOffset);\n  return browserRange;\n}\n\n\n// Get the browser nodes and offsets for the range (a tuple of indexes) of this view\nexport function getNodesForRange(view, range) {\n  if (range == null) {\n    return [ null, 0, null, 0 ];\n  } else {\n    const [ anchorNode, anchorOffset ] = getNodeAndOffset(view, range[0]);\n    const [ focusNode, focusOffset ] = range[0] === range[1] ?\n          [ anchorNode, anchorOffset ] : getNodeAndOffset(view, range[1]);\n\n    return [ anchorNode, anchorOffset, focusNode, focusOffset ];\n  }\n}\n\nexport function getNodeAndOffset(view, index) {\n  const root = view.root;\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  let count = 0, node, firstBlockSeen = false;\n  walker.currentNode = root;\n  while ((node = walker.nextNode())) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      const size = node.nodeValue.length\n      if (index <= count + size) return [ node, index - count ];\n      count += size;\n    } else if (embeds.matches(node)) {\n      count += 1;\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) count += 1;\n      else firstBlockSeen = true;\n\n      // If the selection lands at the beginning of a block, and the first node isn't a text node, place the selection\n      if (count === index && (!node.firstChild || node.firstChild.nodeType !== Node.TEXT_NODE)) {\n        return [ node, 0 ];\n      }\n    } else if (isBRNode(view, node)) {\n      count += 1;\n      // If the selection lands after this br, and the next node isn't a text node, place the selection\n      if (count === index && (!node.nextSibling || node.nextSibling.nodeType !== Node.TEXT_NODE)) {\n        return [ node.parentNode, indexOf.call(node.parentNode.childNodes, node) + 1 ];\n      }\n    }\n  }\n  return [ null, 0 ];\n}\n\nexport function getNodeAndOffsetIndex(view, node, offset) {\n  if (node.nodeType === Node.ELEMENT_NODE && offset > 0) {\n    node = node.childNodes[offset - 1];\n    offset = 0;\n  }\n  return getNodeIndex(view, node) + offset;\n}\n\n// Get the index the node starts at in the content\nexport function getNodeIndex(view, node) {\n  const root = view.root;\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  walker.currentNode = node;\n  let index = node.nodeType === Node.ELEMENT_NODE ? 0 : -1;\n  while ((node = walker.previousNode())) {\n    if (node.nodeType === Node.TEXT_NODE) index += node.nodeValue.length;\n    else if (isBRNode(view, node)) index++;\n    else if (embeds.matches(node)) index++;\n    else if (node !== root && blocks.matches(node)) index++;\n  }\n  return index;\n}\n\n// Determines if a node is actually a BR in our content or if is just the placeholder BR which appears in an empty block\nexport function isBRNode(view, node) {\n  return node.nodeName === 'BR' && node.parentNode.lastChild !== node &&\n    ( // Check if the next node is an inline node (e.g. not another block such as a list)\n      node.nextSibling.nodeType === Node.TEXT_NODE ||\n      node.nextSibling.nodeName === 'BR' ||\n      view.paper.markups.matches(node.nextSibling) ||\n      view.paper.embeds.matches(node.nextSibling)\n    );\n}\n","import Delta from '../delta';\nimport { deepEqual } from '../equal';\nimport escape from '../escape-html';\nimport { h } from './vdom';\nimport { isBRNode } from './selection';\nconst nodeMarkup = new WeakMap();\n\nconst br = <br/>;\nconst voidElements = {\n  area: true, base: true, br: true, col: true, embed: true, hr: true, img: true, input: true,\n  link: true, meta: true, param: true, source: true, track: true, wbr: true\n};\n\n\nexport function deltaToVdom(view, delta) {\n  const paper = view.paper;\n  const { blocks, markups, embeds, container } = paper;\n  const blockData = [];\n\n  delta.eachLine(({ ops, attributes }) => {\n    let inlineChildren = [];\n\n    // Collect block children\n    ops.forEach(op => {\n      if (op.insert) {\n        let children = [];\n        if (typeof op.insert === 'string') {\n          op.insert.split(/\\r/).forEach((child, i) => {\n            if (i !== 0) children.push(br);\n            child && children.push(child.replace(/  /g, '\\xA0 ').replace(/^ | $/g, '\\xA0'));\n          });\n        } else {\n          const embed = embeds.find(op.insert);\n          if (embed) {\n            const node = embed.vdom.call(paper, op.insert[embed.name]);\n            children.push(node);\n          }\n        }\n\n        if (op.attributes) {\n          // Sort them by the order found in markups and be efficient\n          Object.keys(op.attributes).sort((a, b) => markups.priority(b) - markups.priority(a)).forEach(name => {\n            const markup = markups.get(name);\n            if (markup) {\n              const node = markup.vdom.call(paper, children, op.attributes);\n              nodeMarkup.set(node, markup); // Store for merging\n              children = [ node ];\n            }\n          });\n        }\n        inlineChildren.push.apply(inlineChildren, children);\n      }\n    });\n\n    // Merge markups to optimize\n    inlineChildren = mergeChildren(inlineChildren);\n    if (!inlineChildren.length || inlineChildren[inlineChildren.length - 1] === br) {\n      inlineChildren.push(br);\n    }\n\n    let block = blocks.find(attributes);\n    if (!block) block = blocks.getDefault();\n\n    blockData.push([ block, inlineChildren, attributes ]);\n  });\n\n  // If a block has optimize=true on it, vdom will be called with all sibling nodes of the same block\n  let blockChildren = [], prevBlock;\n  let collect = [];\n  blockData.forEach((data, i) => {\n    const [ block, children, attr ] = data;\n    if (block.optimize) {\n      collect.push([ children, attr ]);\n      const next = blockData[i + 1];\n      if (!next || next[0] !== block) {\n        const children = block.vdom.call(paper, collect);\n        blockChildren = blockChildren.concat(children);\n        collect = [];\n      }\n    } else {\n      const node = block.vdom.call(paper, children, attr);\n      decorateBlock(node, attr);\n      blockChildren.push(node);\n    }\n  });\n\n  return container.call(paper, blockChildren, view);\n}\n\n\nexport function decorateBlock(vdom, attr) {\n  if (!attr.attributes && !attr.classes) return vdom;\n  const { attributes, classes } = attr;\n  if (attributes) {\n    Object.keys(attributes).forEach(name => {\n      vdom.attributes[name] = attributes[name];\n    });\n  }\n  if (classes) {\n    const classArray = Object.keys(classes);\n    if (classArray.length) {\n      if (vdom.attributes.class) classArray.unshift(vdom.attributes.class);\n      vdom.attributes.class = classArray.join(' ');\n    }\n  }\n  return vdom;\n}\n\nfunction undecorateBlock(node, block, attr) {\n  const ignoreClasses = {};\n  const ignoreAttributes = { class: true };\n  block.selector.replace(/\\.([-\\w])/, (_, name) => ignoreClasses[name] = true);\n  block.selector.replace(/\\[([-\\w])[^\\]]\\]/, (_, name) => ignoreAttributes[name] = true);\n  const attributes = {};\n  let attrLength = node.attributes.length;\n\n  if (node.classList.length) {\n    attrLength--;\n    const classes = {};\n    let match = false;\n\n    for (let i = 0; i < node.classList.length; i++) {\n      const name = node.classList.item(i);\n      if (!ignoreClasses[name]) {\n        match = true;\n        classes[name] = true;\n      }\n    }\n    if (match) attr.classes = classes;\n  }\n\n  if (attrLength) {\n    const attributes = {};\n    let match = false;\n\n    for (let i = 0; i < node.attributes.length; i++) {\n      const attribute = node.attributes[i];\n      if (!ignoreAttributes[attribute.name]) {\n        match = true;\n        attributes[attribute.name] = attribute.value || true;\n      }\n    }\n    if (match) attr.attributes = attributes;\n  }\n  return attr;\n}\n\n\nexport function deltaFromDom(view, root = view.root, opts) {\n  const paper = view.paper;\n  const { blocks, markups, embeds } = paper;\n\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || (!opts || opts.notInDom) || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n  const delta = new Delta();\n  let currentBlock, firstBlockSeen = false, node;\n\n  walker.currentNode = root;\n\n  while ((node = walker.nextNode())) {\n    const isBr = isBRNode(view, node);\n\n    if (node.nodeType === Node.TEXT_NODE || isBr) {\n      // BRs are represented with \\r, non-breaking spaces are space, and newlines should not exist\n      const text = isBr ? '\\r' : node.nodeValue.replace(/\\xA0/g, ' ').replace(/\\n/g, '');\n      if (!text) continue;\n      let parent = node.parentNode, attr = {};\n\n      while (parent && !blocks.matches(parent) && parent !== root) {\n        if (markups.matches(parent)) {\n          const markup = markups.find(parent);\n          attr[markup.name] = markup.dom ? markup.dom.call(paper, parent) : true;\n        }\n        parent = parent.parentNode;\n      }\n\n      // If the text was not inside a block, ignore it (space between block perhaps)\n      if (parent !== root) {\n        delta.insert(text, attr);\n      }\n    } else if (embeds.matches(node)) {\n      const embed = embeds.find(node);\n      if (embed) {\n        delta.insert({ [embed.name]: embed.dom.call(paper, node) });\n      }\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) delta.insert('\\n', currentBlock);\n      else firstBlockSeen = true;\n      const block = blocks.find(node);\n      if (block !== blocks.getDefault()) {\n        currentBlock = block.dom ? block.dom.call(paper, node) : { [block.name]: true };\n      } else {\n        currentBlock = {};\n      }\n      if (!opts || !opts.ignoreAttributes) {\n        currentBlock = undecorateBlock(node, block, currentBlock);\n      }\n    }\n  }\n  delta.insert('\\n', currentBlock);\n  return delta;\n}\n\n/**\n * Converts a delta object into an HTML string based off of the supplied Paper definition.\n */\nexport function deltaToHTML(view, delta) {\n  return childrenToHTML(deltaToVdom(view, delta).children);\n}\n\n/**\n * Converts an HTML string into a delta object based off of the supplied Paper definition.\n */\nexport function deltaFromHTML(view, html) {\n  const template = document.createElement('template');\n  template.innerHTML = '<div>' + html + '</div>';\n  return deltaFromDom(view, template.content.firstChild, { notInDom: true });\n}\n\n\n// Joins adjacent markup nodes\nfunction mergeChildren(oldChildren) {\n  const children = [];\n  oldChildren.forEach((next, i) => {\n    const prev = children[children.length - 1];\n\n    if (prev && typeof prev !== 'string' && typeof next !== 'string' && nodeMarkup.get(prev) &&\n      nodeMarkup.get(prev) === nodeMarkup.get(next) && deepEqual(prev.attributes, next.attributes))\n    {\n      prev.children = prev.children.concat(next.children);\n    } else {\n      children.push(next);\n    }\n  });\n  return children;\n}\n\n// vdom node to HTML string\nfunction nodeToHTML(node) {\n  const attr = Object.keys(node.attributes)\n    .reduce((attr, name) =>\n      `${attr} ${escape(name)}=\"${escape(node.attributes[name])}\"`, '');\n  const children = childrenToHTML(node.children);\n  const closingTag = children || !voidElements[node.name] ? `</${node.name}>` : '';\n  return `<${node.name}${attr}>${children}${closingTag}`;\n}\n\n// vdom children to HTML string\nfunction childrenToHTML(children) {\n  if (!children || !children.length) return '';\n  return children.reduce((html, child) => html + (child.name ? nodeToHTML(child) : escape(child).replace(/\\xA0/g, '&nbsp;')), '');\n}\n","import { h } from './vdom';\nimport { decorateBlock } from './dom';\n\n\nexport const paragraph = {\n  name: 'paragraph',\n  selector: 'p',\n  vdom: children => <p>{children}</p>,\n};\n\n\nexport const header = {\n  name: 'header',\n  selector: 'h1, h2, h3, h4, h5, h6',\n  defaultFollows: true,\n  dom: node => ({ header: parseInt(node.nodeName.replace('H', '')) }),\n  vdom: (children, attr) => {\n    const H = `h${attr.header}`;\n    return <H>{children}</H>;\n  },\n};\n\n\nexport const list = {\n  name: 'list',\n  selector: 'ul > li, ol > li',\n  optimize: true,\n  dom: node => {\n    let indent = -1, parent = node.parentNode;\n    const list = parent.nodeName === 'OL' ? 'ordered' : 'bullet';\n    while (parent) {\n      if (/^UL|OL$/.test(parent.nodeName)) indent++;\n      else if (parent.nodeName !== 'LI') break;\n      parent = parent.parentNode;\n    }\n    const attr = { list };\n    if (indent) attr.indent = indent;\n    return attr;\n  },\n  vdom: lists => {\n    const topLevelChildren = [];\n    const levels = [];\n    // e.g. levels = [ul, li, ul, li]\n\n    lists.forEach(([children, attr]) => {\n      const List = attr.list === 'ordered' ? 'ol' : 'ul';\n      const index = Math.min((attr.indent || 0) * 2, levels.length);\n      const item = decorateBlock(<li>{children}</li>, attr);\n      let list = levels[index];\n      if (list && list.name === List) {\n        list.children.push(item);\n      } else {\n        list = <List>{item}</List>;\n        const childrenArray = index ? levels[index - 1].children : topLevelChildren;\n        childrenArray.push(list);\n        levels[index] = list;\n      }\n      levels[index + 1] = item;\n      levels.length = index + 2;\n    });\n\n    return topLevelChildren;\n  },\n};\n\nexport const blockquote = {\n  name: 'blockquote',\n  selector: 'blockquote p',\n  optimize: true,\n  vdom: quotes => {\n    return <blockquote>{quotes.map(([children, attr]) => decorateBlock(<p>{children}</p>, attr))}</blockquote>;\n  },\n};\n","import { h } from './vdom';\n\n\nexport const bold = {\n  name: 'bold',\n  selector: 'strong, b',\n  vdom: children => <strong>{children}</strong>,\n};\n\n\nexport const italics = {\n  name: 'italic',\n  selector: 'em, i',\n  vdom: children => <em>{children}</em>,\n};\n\n\nexport const link = {\n  name: 'link',\n  selector: 'a[href]',\n  dom: node => node.href,\n  vdom: (children, attr) => <a href={attr.link} target=\"_blank\">{children}</a>,\n};\n","import { h } from './vdom';\n\n\nexport const image = {\n  name: 'image',\n  selector: 'img',\n  dom: node => node.src,\n  vdom: value => <img src={value}/>,\n};\n\n// To represent a collaborator's cursor, for use in decorators\nexport const cursor = {\n  name: 'cursor',\n  selector: 'span.cursor',\n  dom: node => ({ name: node.dataset.name, color: node.style.backgroundColor }),\n  vdom: value => {\n    return <span class=\"cursor\" data-name={value.name} style={ `background-color: ${value.color}` }></span>\n  },\n};\n","import { paragraph, header, list, blockquote } from './blocks';\nimport { bold, italics, link } from './markups';\nimport { image } from './embeds';\n\n\nexport default {\n  blocks: [ paragraph, header, list, blockquote ],\n  markups: [ bold, italics, link ],\n  embeds: [ image ],\n};\n","import { h } from './view/vdom';\n\nexport default class Paper {\n  constructor(types) {\n    this.blocks = new Types();\n    this.markups = new Types();\n    this.embeds = new Types();\n    this.container = types.container || container;\n    if (types && types.blocks) types.blocks.forEach(block => this.blocks.add(block));\n    if (types && types.markups) types.markups.forEach(markup => this.markups.add(markup));\n    if (types && types.embeds) types.embeds.forEach(embed => this.embeds.add(embed));\n  }\n}\n\n\nexport function container(children, view) {\n  return <div class=\"typewriter-editor\" contentEditable={view.enabled}>\n    {children && children.length ? children : this.blocks.getDefault().vdom()}\n  </div>;\n}\n\n\nclass Types {\n  constructor() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  add(definition, index) {\n    if (!definition.name || !definition.selector || !definition.vdom) {\n      throw new Error('DOMType definitions must include a name, selector, and vdom function');\n    }\n    if (this.types[definition.name]) this.remove(definition.name);\n    this.selector += (this.selector ? ', ' : '') + definition.selector;\n    this.types[definition.name] = definition;\n    if (typeof index !== 'number') {\n      this.priorities[name] = this.array.length;\n      this.array.push(definition);\n    } else {\n      this.array.splice(i, 0, definition);\n      this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    }\n  }\n\n  remove(name) {\n    if (!this.types[name]) return;\n    delete this.types[name];\n    this.array = this.array.filter(domType => domType.name !== name);\n    this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    this.selector = this.array.map(type => type.selector).join(', ');\n  }\n\n  clear() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  get(name) {\n    return this.types[name];\n  }\n\n  priority(name) {\n    return this.priorities[name];\n  }\n\n  getDefault() {\n    return this.array[0];\n  }\n\n  matches(node) {\n    if (node instanceof Node) {\n      return this.selector ? node.matches(this.selector) : false;\n    } else {\n      throw new Error('Cannot match against ' + node);\n    }\n  }\n\n  find(nodeOrAttr) {\n    if (nodeOrAttr instanceof Node) {\n      let i = this.array.length;\n      while (i--) {\n        let domType = this.array[i];\n        if (nodeOrAttr.matches(domType.selector)) return domType;\n      }\n    } else if (nodeOrAttr && typeof nodeOrAttr === 'object') {\n      let domType;\n      Object.keys(nodeOrAttr).some(name => domType = this.get(name));\n      return domType;\n    }\n  }\n}\n","const modifierKeys = {\n  Control: true,\n  Meta: true,\n  Shift: true,\n  Alt: true\n};\n\n\n/**\n * Returns the textual representation of a shortcut given a keyboard event. Examples of shortcuts:\n * Cmd+L\n * Cmd+Shift+M\n * Ctrl+O\n * Backspace\n * T\n * Right\n * Shift+Down\n * Shift+F1\n * Space\n */\nexport function shortcutFromEvent(event) {\n  const shortcutArray = [];\n  const key = event.key;\n  if (!key) return '';\n  if (key === ' ') key = 'Space';\n\n  if (event.metaKey) shortcutArray.push('Cmd');\n  if (event.ctrlKey) shortcutArray.push('Ctrl');\n  if (event.altKey) shortcutArray.push('Alt');\n  if (event.shiftKey) shortcutArray.push('Shift');\n\n  if (!modifierKeys[key]) {\n    // a and A, b and B, should be the same shortcut\n    if (key.length === 1) key = key.toUpperCase();\n    shortcutArray.push(key);\n  }\n\n  return shortcutArray.join('+');\n}\n","import EventDispatcher from './event-dispatcher';\nimport Editor from './editor';\nimport { renderChildren } from './view/vdom';\nimport defaultPaper from './view/defaultPaper';\nimport { getSelection, setSelection, getBrowserRange } from './view/selection';\nimport { deltaToVdom, deltaFromDom, deltaToHTML, deltaFromHTML } from './view/dom';\nimport Paper from './paper';\nimport { shortcutFromEvent } from './shortcut-string';\nimport { shallowEqual } from './equal';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst isMac = navigator.userAgent.indexOf('Macintosh') !== -1;\nconst modExpr = isMac ? /Cmd/ : /Ctrl/;\n\n/**\n * Triggers before each render inside an editor transaction. Use this event to alter the contents of the editor with\n * decorators which will only be visible in the view and will not save to the editor. To add decorators, simply use the\n * editor APIs to format text, insert embeds, etc.\n *\n * @event View#decorate\n */\n\n/**\n * Triggers right before the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#rendering\n */\n\n/**\n * Triggers when the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#render\n */\n\n/**\n * Triggers on a keydown event, calling listeners with the keydown event and a shortcut string. These shortcut strings\n * will contain all the modifiers being pressed along with the key. Examples are:\n * Ctrl+B, Ctrl+Shift+Tab, Alt+A, Enter, Shift+Enter, Cmd+Enter, Cmd+Backspace, Space, Tab, Ctrl+Shift+Alt+F11, Ctrl++\n *\n * In addition to the normal modifiers, Cmd, Ctrl, Alt, and Shift, a special modifier called Mod can be used to match\n * Cmd on Mac and Ctrl on other OSes. This allows Mod+B to be used for bold and work correctly on all systems.\n *\n * You can listen for all shortcuts using the \"shortcut\" event, or you can listen for a specific shortcut using\n * \"shortcut:{shortcut}\".\n *\n * @event View#shortcut\n * @event View#shortcut:{shortcut} E.g. \"shortcut:Mod+Bold\"\n */\n\n/**\n * The Typewriter View displays and Editor's contents and selection. The contents are displayed as HTML using a tiny\n * virtual dom implementation and Paper to describe the HTML. The selection is displayed with the native browser\n * selection.\n *\n * View also sends changes to the editor using contenteditable and a mutation observer to capture text entry, keyboard\n * shortcuts to capture other types of edits, and the native selectionchange event to update selection.\n */\nexport default class View extends EventDispatcher {\n\n  /**\n   * Create a new View to display an Editor's contents.\n   *\n   * @param {Editor} editor  A Typewriter editor this View will display the contents for\n   * @param {Object} options Options include:\n   *   @param {HTMLElement} root   The root HTML element of this view. If not provided, you must append view.root to the\n   *                               DOM yourself\n   *   @param {Object} paper       The blocks, markups, embeds, and/or container to be used in this editor\n   *   @param {Object} modules     Modules which can be used with this view\n   */\n  constructor(editor, options = {}) {\n    super();\n    if (!editor) throw new Error('Editor view requires an editor');\n    this.editor = editor;\n    this.root = options.root || document.createElement('div');\n    if (!options.root) this.root.className = 'typewriter-editor';\n    this.paper = new Paper({ ...defaultPaper, ...options.paper });\n    this.enable();\n    this.isMac = isMac;\n    this._settingEditorSelection = false;\n    this._settingBrowserSelection = false;\n    this.init();\n    this.modules = {};\n    if (options.modules) Object.keys(options.modules).forEach(key => this.modules[key] = options.modules[key](this));\n    this.render();\n  }\n\n  /**\n   * Returns whether or not the view has browser focus.\n   *\n   * @returns {Boolean} Whether the view has focus\n   */\n  hasFocus() {\n    return this.root.contains(this.root.ownerDocument.activeElement);\n  }\n\n  /**\n   * Focuses the view using the last known selection.\n   */\n  focus() {\n    if (this.lastSelection) this.editor.setSelection(this.lastSelection);\n    else this.root.focus();\n  }\n\n  /**\n   * Removes focus from the view.\n   */\n  blur() {\n    this.root.blur();\n  }\n\n  /**\n   * Disables view text entry and key shortcuts.\n   */\n  disable() {\n    this.enable(false);\n  }\n\n  /**\n   * Enables (or disables) view text entry and key shortcuts.\n   *\n   * @param {Boolean} enabled Whether to make it enabled or disabled, default being true\n   */\n  enable(enabled = true) {\n    this.enabled = enabled;\n    this.root.contentEditable = enabled;\n  }\n\n  /**\n   * Get the position and size of a range as it is displayed in the DOM relative to the top left of visible document.\n   * You can use `getBounds(editor.selection)` to find the coordinates of the current selection and display a popup at\n   * that location.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRect}   A native DOMRect object with the bounds of the range\n   */\n  getBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getBoundingClientRect();\n  }\n\n  /**\n   * Get all positions and sizes of a range as it is displayed in the DOM relative to the top left of visible document.\n   * This is different from `getBounds` because instead of a single bounding box you may get multiple rects such as when\n   * the selection is split across lines. You can use `getAllBounds` to draw a highlight behind the text within this\n   * range.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRectList}   A native DOMRect object with the bounds of the range\n   */\n  getAllBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getClientRects();\n  }\n\n  /**\n   * Get the HTML text of the View (minus any decorators). You could use this to store the HTML contents rather than\n   * storing the editor contents. If you don't care about collaborative editing this may be easier than storing Deltas.\n   *\n   * @returns {String} A string of HTML\n   */\n  getHTML() {\n    return deltaToHTML(this, this.editor.contents);\n  }\n\n  /**\n   * Set a string of HTML to be the contents of the editor. It will be parsed using Paper so incorrectly formatted HTML\n   * cannot be set in Typewriter.\n   *\n   * @param {String} html A string of HTML to set in the editor\n   * @param {*} source    The source of the change being made, api, user, or silent\n   */\n  setHTML(html, source) {\n    this.editor.setContents(deltaFromHTML(this, html), source);\n  }\n\n  /**\n   * Re-render the current editor state to the DOM.\n   */\n  render(changeEvent) {\n    let contents = this.editor.contents;\n    this.decorators = this.editor.getChange(() => this.fire('decorate', this.editor, changeEvent));\n    if (this.decorators.ops.length) {\n      contents = contents.compose(this.decorators);\n      this.reverseDecorators = contents.diff(this.editor.contents);\n    } else {\n      this.reverseDecorators = this.decorators;\n    }\n    const vdom = deltaToVdom(this, contents);\n    if (!this.enabled) vdom.attributes.contenteditable = undefined;\n    this.fire('rendering', changeEvent);\n    renderChildren(vdom, this.root);\n    if (this.hasFocus()) this.updateBrowserSelection();\n    this.fire('render', changeEvent);\n  }\n\n  /**\n   * Update the browser's selection to match the editor's selection.\n   */\n  updateBrowserSelection() {\n    if (this._settingEditorSelection) return;\n    this._settingBrowserSelection = true;\n    this.setSelection(this.editor.selection);\n    setTimeout(() => this._settingBrowserSelection = false, 20); // sad hack :(\n  }\n\n  /**\n   * Update the editor's selection to match the browser's selection.\n   *\n   * @param {String} source The source of the selection change, api, user, or silent\n   */\n  updateEditorSelection(source = SOURCE_API) {\n    if (this._settingBrowserSelection) return this._settingBrowserSelection = false;\n    const range = this.getSelection();\n\n    // Store the last non-null selection for restoration on focus()\n    if (range) this.lastSelection = range;\n\n    this._settingEditorSelection = true;\n    this.editor.setSelection(range, source);\n    this._settingEditorSelection = false;\n\n    // If the selection was adjusted when set then update the browser's selection\n    if (!shallowEqual(range, this.editor.selection)) this.updateBrowserSelection();\n  }\n\n  /**\n   * Get the mapped editor range from the current browser selection.\n   *\n   * @returns {Array} A range (or null) that represents the current browser selection\n   */\n  getSelection(nativeRange) {\n    let range = getSelection(this, nativeRange);\n    if (range && this.reverseDecorators.ops.length) {\n      range = range.map(i => this.reverseDecorators.transform(i));\n    }\n    return range;\n  }\n\n  /**\n   * Set's the browser selection to the given range.\n   *\n   * @param {Array} range The range to set selection to\n   */\n  setSelection(range) {\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    setSelection(this, range);\n  }\n\n  /**\n   * Initializes the view, setting up listeners in the DOM and on the editor.\n   */\n  init() {\n    this.root.ownerDocument.execCommand('defaultParagraphSeparator', false, this.paper.blocks.getDefault().selector);\n\n    const onKeyDown = event => {\n      let shortcut = shortcutFromEvent(event);\n      this.fire(`shortcut:${shortcut}`, event, shortcut);\n      this.fire(`shortcut`, event, shortcut);\n      if (modExpr.test(shortcut)) {\n        shortcut = shortcut.replace(modExpr, 'Mod');\n        this.fire(`shortcut:${shortcut}`, event, shortcut);\n        this.fire(`shortcut`, event, shortcut);\n      }\n    };\n\n    const onSelectionChange = () => {\n      this.updateEditorSelection(SOURCE_USER);\n    };\n\n    const onTextChanging = ({ contents }) => {\n      // Prevent incorrect formats\n      return !contents.ops.some(op => {\n        if (typeof op.insert === 'object') {\n          return !this.paper.embeds.find(op.insert);\n        } else if (op.attributes) {\n          // If attributes is empty except for classes/attributes than it is the default block\n          if (!Object.keys(op.attributes).filter(key => key !== 'classes' && key !== 'attributes').length) return;\n          return !(this.paper.blocks.find(op.attributes) || this.paper.markups.find(op.attributes));\n        }\n      });\n    };\n\n    const onEditorChange = event => {\n      if (event.change) this.render(event);\n      this.updateBrowserSelection();\n    };\n\n    // Use mutation tracking during development to catch errors\n    // TODO delete this mutation observer when we're confident in core (or put it behind a development flag)\n    let checking = 0;\n    const devObserver = new MutationObserver(list => {\n      if (checking) clearTimeout(checking);\n      checking = setTimeout(() => {\n        checking = 0;\n        const diff = this.editor.contents.compose(this.decorators).diff(deltaFromDom(this));\n        if (diff.length()) {\n          console.error('Delta out of sync with DOM:', diff, this.editor.contents, deltaFromDom(this), this.decorators);\n        }\n      }, 20);\n    });\n    devObserver.observe(this.root, { characterData: true, characterDataOldValue: true, childList: true, attributes: true, subtree: true });\n\n\n    this.root.addEventListener('keydown', onKeyDown);\n    this.root.ownerDocument.addEventListener('selectionchange', onSelectionChange);\n    this.editor.on('text-changing', onTextChanging);\n    this.editor.on('editor-change', onEditorChange);\n    this.render();\n\n    this.uninit = () => {\n      devObserver.disconnect();\n      this.root.removeEventListener('keydown', onKeyDown);\n      this.root.ownerDocument.removeEventListener('selectionchange', onSelectionChange);\n      this.editor.off('text-changing', onTextChanging);\n      this.editor.off('editor-change', onEditorChange);\n      delete this.uninit;\n    }\n  }\n\n  /**\n   * Cleans up the listeners on the DOM and editor after they have been added.\n   */\n  uninit() {\n    // This is overwritten inside `init`\n  }\n\n  /**\n   * Clean up and allow modules to clean up before the editor is removed from the DOM.\n   */\n  destroy() {\n    this.uninit();\n    Object.keys(modules).forEach(key => {\n      const api = this.module[key];\n      if (api && typeof api.destroy === 'function') api.destroy();\n    });\n  }\n}\n","import { getNodeIndex } from '../view/selection';\nimport { deltaFromDom } from '../view/dom';\nimport diff from '../diff';\n\nconst SOURCE_USER = 'user';\nconst lastWord = /\\w+[^\\w]*$/;\nconst firstWord = /^[^\\w]*\\w+/;\nconst lastLine = /[^\\n]*$/;\nconst firstLine = /^[^\\n]*/;\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function input() {\n  return view => {\n    const editor = view.editor;\n    const mutationOptions = {\n      characterData: true,\n      characterDataOldValue: true,\n      subtree: true,\n      childList: true,\n      attributes: true\n    };\n\n    // Detects changes from spell-check and the user typing\n    function onMutate(list) {\n      const seen = new Set();\n      list = list.filter(m => {\n        if (seen.has(m.target)) return false;\n        seen.add(m.target);\n        return true;\n      });\n\n      const selection = view.getSelection();\n      const mutation = list[0];\n      const isTextChange = list.length === 1 && mutation.type === 'characterData' ||\n        (mutation.type === 'childList' && mutation.addedNodes.length === 1 &&\n         mutation.addedNodes[0].nodeType === Node.TEXT_NODE);\n\n      // Only one text node has been altered. Optimize for view most common case.\n      if (isTextChange) {\n        const change = editor.delta();\n        const node = mutation.type === 'characterData' ? mutation.target : mutation.addedNodes[0];\n        const index = view.reverseDecorators.transform(getNodeIndex(view, node));\n        change.retain(index);\n\n        if (mutation.type === 'characterData') {\n          const diffs = diff(mutation.oldValue.replace(/\\xA0/g, ' '), mutation.target.nodeValue.replace(/\\xA0/g, ' '));\n          diffs.forEach(([ action, string ]) => {\n            if (action === diff.EQUAL) change.retain(string.length);\n            else if (action === diff.DELETE) change.delete(string.length);\n            else if (action === diff.INSERT) {\n              change.insert(string, editor.activeFormats);\n            }\n          });\n          change.chop();\n        } else {\n          change.insert(node.nodeValue.replace(/\\xA0/g, ' '), editor.activeFormats);\n        }\n\n        if (change.ops.length) {\n          // console.log('changing a little', change);\n          editor.updateContents(change, SOURCE_USER, selection);\n        }\n      } else if (list.length === 1 && mutation.type === 'childList' &&\n        mutation.addedNodes.length === 1 && mutation.addedNodes[0].nodeType === Node.TEXT_NODE)\n      {\n\n      } else {\n        let contents = deltaFromDom(view, view.root, { ignoreAttributes: true });\n        contents = contents.compose(view.reverseDecorators);\n        const change = editor.contents.diff(contents);\n        // console.log('changing a lot (possibly)', change);\n        editor.updateContents(change, SOURCE_USER, selection);\n      }\n    }\n\n\n    function onEnter(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n\n      const line = editor.contents.getLine(from);\n      let attributes = line.attributes;\n      const block = view.paper.blocks.find(attributes);\n      const isDefault = !block;\n      const length = line.end - line.start - 1;\n      const atEnd = to === line.end - 1;\n      if (atEnd && !isDefault && block.defaultFollows) {\n        attributes = {};\n      }\n      if (!length && !isDefault && !block.defaultFollows && from === to) {\n        editor.formatLine(from, to, {}, SOURCE_USER);\n      } else {\n        let selection = from + 1;\n        if (from === to && atEnd) {\n          from++;\n          to++;\n        }\n        editor.insertText(from, to, '\\n', attributes, SOURCE_USER, selection);\n      }\n    }\n\n\n    function onShiftEnter(event) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n      editor.insertText(from, to, '\\r', null, SOURCE_USER);\n    }\n\n\n    function onBackspace(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from + to === 0) {\n        const line = editor.contents.getLine(from);\n        const block = view.paper.blocks.find(line.attributes);\n        if (block) editor.formatLine(0, {}, SOURCE_USER);\n      } else {\n        // The \"from\" block needs to stay the same. The \"to\" block gets merged into it\n        if (from === to) {\n          if (shortcut === 'Alt+Backspace' && view.isMac) {\n            const match = editor.getText().slice(0, from).match(lastWord);\n            if (match) from -= match[0].length;\n          } else if (shortcut === 'Mod+Backspace' && view.isMac) {\n            const match = editor.getText().slice(0, from).match(lastLine);\n            if (match) from -= match[0].length;\n          } else {\n            const line = editor.contents.getLine(from);\n            if (from === line.start) {\n              const block = view.paper.blocks.find(line.attributes);\n              if (block && !block.defaultFollows) {\n                const prevLine = editor.contents.getLine(line.start - 1);\n                const prevBlock = prevLine && view.paper.blocks.find(prevLine.attributes);\n                if (block !== prevBlock) {\n                  editor.formatLine(from, {}, SOURCE_USER);\n                  return;\n                }\n              }\n            }\n\n            from--;\n          }\n        }\n        editor.deleteText(from, to, SOURCE_USER);\n      }\n    }\n\n    function onDelete(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from === to && from === editor.length) return;\n\n      if (from === to) {\n        if (shortcut === 'Alt+Delete' && view.isMac) {\n          const match = editor.getText().slice(from).match(firstWord);\n          if (match) to += match[0].length;\n        } else {\n          to++;\n        }\n      }\n      editor.deleteText(from, to, SOURCE_USER);\n    }\n\n    function onTab(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      const direction = shortcut === 'Tab' || shortcut === 'Mod+]' ? 1 : -1;\n      const [ from, to ] = editor.getSelectedRange();\n      const lines = editor.contents.getLines(from, to);\n\n      editor.transaction(() => {\n        lines.forEach((line, i) => {\n          if (line.attributes.list) {\n            let prevLine = lines[i -1];\n            if (!prevLine && line.index > 0) prevLine = editor.contents.getLine(line.start - 1);\n            const prevIndent = prevLine && prevLine.attributes.list ? prevLine.attributes.indent || 0 : -1;\n\n            let indent = line.attributes.indent || 0;\n            indent += direction;\n            if (indent > prevIndent + 1) return console.log('will not indent too much');\n            if (indent < 0) {\n              editor.formatLine(line.start, {});\n            } else {\n              const attributes = { ...line.attributes, indent };\n              editor.formatLine(line.start, attributes);\n            }\n          }\n        });\n      }, SOURCE_USER);\n    }\n\n    const observer = new MutationObserver(onMutate);\n    observer.observe(view.root, mutationOptions);\n\n    // Don't observe the changes that occur when the view updates, we only want to respond to changes that happen\n    // outside of our API to read them back in\n    function onRendering() {\n      observer.disconnect();\n    }\n\n    // Once the view update is complete, continue observing for changes\n    function onRender() {\n      observer.observe(view.root, mutationOptions);\n    }\n\n    view.on('rendering', onRendering);\n    view.on('render', onRender);\n    view.on('shortcut:Enter', onEnter);\n    view.on('shortcut:Shift+Enter', onShiftEnter);\n    view.on('shortcut:Backspace', onBackspace);\n    view.on('shortcut:Alt+Backspace', onBackspace);\n    view.on('shortcut:Mod+Backspace', onBackspace);\n    view.on('shortcut:Delete', onDelete);\n    view.on('shortcut:Alt+Delete', onDelete);\n    view.on('shortcut:Tab', onTab);\n    view.on('shortcut:Shift+Tab', onTab);\n\n    return {\n      destroy() {\n        observer.disconnect();\n        view.off('rendering', onRendering);\n        view.off('render', onRender);\n        view.off('shortcut:Enter', onEnter);\n        view.off('shortcut:Shift+Enter', onShiftEnter);\n        view.off('shortcut:Backspace', onBackspace);\n        view.off('shortcut:Alt+Backspace', onBackspace);\n        view.off('shortcut:Mod+Backspace', onBackspace);\n        view.off('shortcut:Delete', onDelete);\n        view.off('shortcut:Alt+Delete', onDelete);\n        view.off('shortcut:Tab', onTab);\n        view.off('shortcut:Shift+Tab', onTab);\n      }\n    }\n  }\n}\n","const SOURCE_USER = 'user';\n\n\nexport const keymap = {\n  'Mod+B': editor => editor.toggleTextFormat(editor.selection, { bold: true }, SOURCE_USER),\n  'Mod+I': editor => editor.toggleTextFormat(editor.selection, { italic: true }, SOURCE_USER),\n  'Mod+1': editor => editor.toggleLineFormat(editor.selection, { header: 1 }, SOURCE_USER),\n  'Mod+2': editor => editor.toggleLineFormat(editor.selection, { header: 2 }, SOURCE_USER),\n  'Mod+3': editor => editor.toggleLineFormat(editor.selection, { header: 3 }, SOURCE_USER),\n  'Mod+4': editor => editor.toggleLineFormat(editor.selection, { header: 4 }, SOURCE_USER),\n  'Mod+5': editor => editor.toggleLineFormat(editor.selection, { header: 5 }, SOURCE_USER),\n  'Mod+6': editor => editor.toggleLineFormat(editor.selection, { header: 6 }, SOURCE_USER),\n  'Mod+0': editor => editor.formatLine(editor.selection, { }, SOURCE_USER),\n};\n\nexport const macKeymap = { ...keymap };\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function keyShortcuts(customShortcuts = {}) {\n  return view => {\n    const shortcuts = { ...(view.isMac ? macKeymap : keymap), ...customShortcuts };\n    const editor = view.editor;\n\n    function onShortcut(event, shortcut) {\n      if (event.defaultPrevented) return;\n      if (shortcut in shortcuts) {\n        event.preventDefault();\n        shortcuts[shortcut](editor);\n      }\n    }\n\n    view.on('shortcut', onShortcut);\n\n    return {\n      destroy() {\n        view.off('shortcut', onShortcut);\n      }\n    }\n  };\n}\n","const SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst defaultOptions = {\n  delay: 0,\n  maxStack: 500,\n};\n\n/**\n * History is a view module for storing user changes.\n *\n * Stores history for all user-generated changes. Like-changes will be combined until a selection or a delay timeout\n * cuts off the combining. E.g. if a user types \"Hello\" the 5 changes will be combined into one history entry. If\n * the user moves the cursor somewhere and then back to the end and types \" World\" the next 6 changes are combined\n * separately from the first 5 because selection changes add a cutoff history entries.\n *\n * The default options can be overridden by passing alternatives to history. To add a timeout to force a cutoff after\n * so many milliseconds set a delay like this:\n * ```js\n * view = new View(editor, {\n *   modules: {\n *     history: history({ delay: 4000 })\n *   }\n * })\n * ```\n */\nexport default function history(options = {}) {\n\n  return view => {\n    const editor = view.editor;\n    options = { ...defaultOptions, ...options };\n\n    const stack = options.stack || {\n      undo: [],\n      redo: [],\n    };\n    let lastRecorded = 0;\n    let lastAction;\n    let ignoreChange = false;\n\n    function undo(event) {\n      action(event, 'undo', 'redo');\n    }\n\n    function redo(event) {\n      action(event, 'redo', 'undo');\n    }\n\n    function cutoff() {\n      lastRecorded = 0;\n    }\n\n    function clear() {\n      stack.undo.length = 0;\n      stack.redo.length = 0;\n    }\n\n    function action(event, source, dest) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      if (stack[source].length === 0) return;\n      let entry = stack[source].pop();\n      stack[dest].push(entry);\n      cutoff();\n      ignoreChange = true;\n      if (typeof entry[source] === 'function') {\n        entry[source]();\n      } else {\n        editor.updateContents(entry[source], SOURCE_USER, entry[source + 'Selection']);\n      }\n      ignoreChange = false;\n    }\n\n    function record(change, contents, oldContents, selection, oldSelection) {\n      const timestamp = Date.now();\n      const action = getAction(change);\n      stack.redo.length = 0;\n\n      let undoChange = contents.diff(oldContents);\n      // Break combining if actions are different (e.g. a delete then an insert should break it)\n      if (!action || lastAction !== action) cutoff();\n      lastAction = action;\n\n      if (lastRecorded && (!options.delay || lastRecorded + options.delay > timestamp) && stack.undo.length > 0) {\n        // Combine with the last change\n        let entry = stack.undo.pop();\n        oldSelection = entry.undoSelection;\n        undoChange = undoChange.compose(entry.undo);\n        change = entry.redo.compose(change);\n      } else {\n        lastRecorded = timestamp;\n      }\n\n      stack.undo.push({\n        redo: change,\n        undo: undoChange,\n        redoSelection: selection,\n        undoSelection: oldSelection,\n      });\n\n      if (stack.undo.length > options.maxStack) {\n        stack.undo.shift();\n      }\n    }\n\n\n    function transform(change) {\n      stack.undo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n      stack.redo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n    }\n\n\n    function onTextChange({ change, contents, oldContents, selection, oldSelection, source }) {\n      if (ignoreChange) return;\n      if (source === SOURCE_USER) {\n        record(change, contents, oldContents, selection, oldSelection);\n      } else {\n        transform(change);\n      }\n    }\n\n    function onSelectionChange({ change }) {\n      if (change) return;\n      // Break the history merging when selection changes without a text change\n      cutoff();\n    }\n\n\n    editor.on('text-change', onTextChange);\n    editor.on('selection-change', onSelectionChange);\n    if (view.isMac) {\n      view.on('shortcut:Cmd+Z', undo);\n      view.on('shortcut:Cmd+Shift+Z', redo);\n    } else {\n      view.on('shortcut:Ctrl+Z', undo);\n      view.on('shortcut:Cmd+Y', redo);\n    }\n\n    return {\n      undo,\n      redo,\n      cutoff,\n      options,\n      destroy() {\n        editor.off('text-change', onTextChange);\n        editor.off('selection-change', onSelectionChange);\n        if (view.isMac) {\n          view.off('shortcut:Cmd+Z', undo);\n          view.off('shortcut:Cmd+Shift+Z', redo);\n        } else {\n          view.off('shortcut:Ctrl+Z', undo);\n          view.off('shortcut:Cmd+Y', redo);\n        }\n      }\n    }\n  }\n}\n\nfunction getAction(change) {\n  if (change.ops.length === 1 || change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes) {\n    const changeOp = change.ops[change.ops.length - 1];\n    if (changeOp.delete) return 'delete';\n    if (changeOp.insert === '\\n') return 'newline';\n    if (changeOp.insert) return 'insert';\n  }\n  return '';\n}\n","import { h } from '../view/vdom';\n\nexport default function placeholder(placeholder) {\n  return view => {\n\n    view.paper.markups.add({\n      name: 'placeholder',\n      selector: 'span.placholder',\n      vdom: children => <span class=\"placeholder\" style={{pointerEvents: 'none'}}>{children}</span>,\n    });\n\n    function onDecorate(editor) {\n      if (editor.length === 1) {\n        editor.insertText(placeholder, { placeholder: true });\n      }\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n","const SOURCE_USER = 'user';\nconst bullet = /^[-*] $/;\nconst ordered = /^(-?\\d+)\\. $/;\nconst header = /^#{1,6} $/;\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into a formatted block with the attributes returned by the\n * function. The function's argument will be the captured text from the regular expression.\n */\nexport const blockReplacements = [\n  [ /^(#{1,6}) $/, capture => ({ header: capture.length }) ],\n  [ /^[-*] $/, () => ({ list: 'bullet' }) ],\n  [ /^1\\. $/, () => ({ list: 'ordered' }) ],\n  [ /^> $/, () => ({ blockquote: true }) ],\n];\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into another string of text which is returned by the function.\n * The function's argument will be the captured text from the regular expression.\n */\nexport const textReplacements = [\n  [ /--$/, () => '—' ],\n  [ /\\.\\.\\.$/, () => '…' ],\n];\n\n/**\n * Allow text representations to format a block\n */\nexport function blockReplace(index, prefix) {\n  return blockReplacements.some(([ regexp, getAttributes ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      const attributes = getAttributes(match[1]);\n      const change = editor.getChange(() => {\n        editor.formatLine(index, attributes);\n        editor.deleteText(index - prefix.length, index);\n      });\n      editor.updateContents(change, SOURCE_USER, index - prefix.length);\n      return true;\n    }\n  });\n}\n\nexport function textReplace(index, prefix) {\n  return textReplacements.some(([ regexp, replaceWith ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      editor.insertText(index - match[0].length, index, replaceWith(match[1]), null, SOURCE_USER);\n      return true;\n    }\n  });\n}\n\nexport const defaultHandlers = [ blockReplace, textReplace ];\n\n\nexport default function(handlers = defaultHandlers) {\n\n  return view => {\n    const editor = view.editor;\n    let ignore = false;\n\n    function onTextChange({ change, source }) {\n      if (ignore || source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n      const index = editor.selection[1];\n      const text = editor.getExactText();\n      const lineStart = text.lastIndexOf('\\n', index - 1) + 1;\n      const prefix = text.slice(lineStart, index);\n\n      ignore = true;\n      handlers.some(handler => handler(index, prefix));\n      ignore = false;\n    }\n\n    editor.on('text-change', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-change', onTextChange);\n      }\n    }\n  };\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","\n/**\n * Replaces regular quotes with smart quotes as they are typed. Does not affect pasted content.\n * Uses the text-changing event to prevent the original change and replace it with the new one. This makes the smart-\n * quotes act more seemlessly and includes them as part of regular text undo/redo instead of breaking it like the smart-\n * entry conversions do.\n */\nexport default function smartQuotes() {\n  return view => {\n    const editor = view.editor;\n\n    function onTextChange({ change, source, selection }) {\n      if (source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n\n      const index = editor.selection[1];\n      const lastOp = change.ops[change.ops.length - 1];\n      const lastChars = editor.getText(index - 1, index) + lastOp.insert.slice(-1);\n\n      const replaced = lastChars.replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(\")$/, '“')\n              .replace(/\"$/, '”')\n              .replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(')$/, '‘')\n              .replace(/'$/, '’');\n\n      if (replaced !== lastChars) {\n        const quote = replaced.slice(-1);\n        lastOp.insert = lastOp.insert.slice(0, -1) + quote;\n        editor.updateContents(change, source, selection);\n        return false;\n      }\n    }\n\n    editor.on('text-changing', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-changing', onTextChange);\n      }\n    }\n  }\n}\n\n\n/**\n * Adds smartquotes to a document as a decorator. This does not affect the source, allowing you to store regular quotes\n * in your source data but display smart quotes to the user. Use this as an alternative to the module above, not in\n * addition to it.\n */\nexport function smartQuotesDecorator() {\n  return view => {\n    const quotes = [\n      [ /(^|\\s)\"/g, /(^|\\s)\"/, '$1“' ],\n      [ /\"/g, /\"/, '”'],\n      [ /\\b'/g, /'/, '’'],\n      [ /'/g, /'/, '‘'],\n    ];\n\n    function onDecorate(editor) {\n      let { text } = editor;\n      quotes.forEach(([ expr, replacer, replaceWith ]) => {\n        let match;\n        while ((match = expr.exec(text))) {\n          const replacement = match[0].replace(replacer, replaceWith);\n          text = text.slice(0, match.index) + replacement + text.slice(expr.lastIndex);\n          editor.insertText(match.index, expr.lastIndex, replacement);\n        }\n      });\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","function noop() {}\n\nfunction assign(tar, src) {\n\tfor (var k in src) tar[k] = src[k];\n\treturn tar;\n}\n\nfunction assignTrue(tar, src) {\n\tfor (var k in src) tar[k] = 1;\n\treturn tar;\n}\n\nfunction isPromise(value) {\n\treturn value && typeof value.then === 'function';\n}\n\nfunction callAfter(fn, i) {\n\tif (i === 0) fn();\n\treturn () => {\n\t\tif (!--i) fn();\n\t};\n}\n\nfunction addLoc(element, file, line, column, char) {\n\telement.__svelte_meta = {\n\t\tloc: { file, line, column, char }\n\t};\n}\n\nfunction exclude(src, prop) {\n\tconst tar = {};\n\tfor (const k in src) k === prop || (tar[k] = src[k]);\n\treturn tar;\n}\n\nfunction run(fn) {\n\tfn();\n}\n\nfunction append(target, node) {\n\ttarget.appendChild(node);\n}\n\nfunction insert(target, node, anchor) {\n\ttarget.insertBefore(node, anchor);\n}\n\nfunction detachNode(node) {\n\tnode.parentNode.removeChild(node);\n}\n\nfunction detachBetween(before, after) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction detachBefore(after) {\n\twhile (after.previousSibling) {\n\t\tafter.parentNode.removeChild(after.previousSibling);\n\t}\n}\n\nfunction detachAfter(before) {\n\twhile (before.nextSibling) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction reinsertBetween(before, after, target) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\ttarget.appendChild(before.parentNode.removeChild(before.nextSibling));\n\t}\n}\n\nfunction reinsertChildren(parent, target) {\n\twhile (parent.firstChild) target.appendChild(parent.firstChild);\n}\n\nfunction reinsertAfter(before, target) {\n\twhile (before.nextSibling) target.appendChild(before.nextSibling);\n}\n\nfunction reinsertBefore(after, target) {\n\tvar parent = after.parentNode;\n\twhile (parent.firstChild !== after) target.appendChild(parent.firstChild);\n}\n\nfunction destroyEach(iterations, detach) {\n\tfor (var i = 0; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].d(detach);\n\t}\n}\n\nfunction createFragment() {\n\treturn document.createDocumentFragment();\n}\n\nfunction createElement(name) {\n\treturn document.createElement(name);\n}\n\nfunction createSvgElement(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nfunction createText(data) {\n\treturn document.createTextNode(data);\n}\n\nfunction createComment() {\n\treturn document.createComment('');\n}\n\nfunction addListener(node, event, handler) {\n\tnode.addEventListener(event, handler, false);\n}\n\nfunction removeListener(node, event, handler) {\n\tnode.removeEventListener(event, handler, false);\n}\n\nfunction setAttribute(node, attribute, value) {\n\tnode.setAttribute(attribute, value);\n}\n\nfunction setAttributes(node, attributes) {\n\tfor (var key in attributes) {\n\t\tif (key === 'style') {\n\t\t\tnode.style.cssText = attributes[key];\n\t\t} else if (key in node) {\n\t\t\tnode[key] = attributes[key];\n\t\t} else {\n\t\t\tif (attributes[key] === undefined) removeAttribute(node, key);\n\t\t\telse setAttribute(node, key, attributes[key]);\n\t\t}\n\t}\n}\n\nfunction setCustomElementData(node, prop, value) {\n\tif (prop in node) {\n\t\tnode[prop] = value;\n\t} else if (value) {\n\t\tsetAttribute(node, prop, value);\n\t} else {\n\t\tremoveAttribute(node, prop);\n\t}\n}\n\nfunction removeAttribute(node, attribute) {\n\tnode.removeAttribute(attribute);\n}\n\nfunction setXlinkAttribute(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\nfunction getBindingGroupValue(group) {\n\tvar value = [];\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.push(group[i].__value);\n\t}\n\treturn value;\n}\n\nfunction toNumber(value) {\n\treturn value === '' ? undefined : +value;\n}\n\nfunction timeRangesToArray(ranges) {\n\tvar array = [];\n\tfor (var i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\nfunction children (element) {\n\treturn Array.from(element.childNodes);\n}\n\nfunction claimElement (nodes, name, attributes, svg) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeName === name) {\n\t\t\tfor (var j = 0; j < node.attributes.length; j += 1) {\n\t\t\t\tvar attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) node.removeAttribute(attribute.name);\n\t\t\t}\n\t\t\treturn nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n\t\t}\n\t}\n\n\treturn svg ? createSvgElement(name) : createElement(name);\n}\n\nfunction claimText (nodes, data) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeType === 3) {\n\t\t\tnode.data = data;\n\t\t\treturn nodes.splice(i, 1)[0];\n\t\t}\n\t}\n\n\treturn createText(data);\n}\n\nfunction setData(text, data) {\n\ttext.data = '' + data;\n}\n\nfunction setInputType(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {}\n}\n\nfunction setStyle(node, key, value) {\n\tnode.style.setProperty(key, value);\n}\n\nfunction selectOption(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\n\t\tif (option.__value === value) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nfunction selectOptions(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\t\toption.selected = ~value.indexOf(option.__value);\n\t}\n}\n\nfunction selectValue(select) {\n\tvar selectedOption = select.querySelector(':checked') || select.options[0];\n\treturn selectedOption && selectedOption.__value;\n}\n\nfunction selectMultipleValue(select) {\n\treturn [].map.call(select.querySelectorAll(':checked'), function(option) {\n\t\treturn option.__value;\n\t});\n}\n\nfunction addResizeListener(element, fn) {\n\tif (getComputedStyle(element).position === 'static') {\n\t\telement.style.position = 'relative';\n\t}\n\n\tconst object = document.createElement('object');\n\tobject.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;');\n\tobject.type = 'text/html';\n\n\tlet win;\n\n\tobject.onload = () => {\n\t\twin = object.contentDocument.defaultView;\n\t\twin.addEventListener('resize', fn);\n\t};\n\n\tif (/Trident/.test(navigator.userAgent)) {\n\t\telement.appendChild(object);\n\t\tobject.data = 'about:blank';\n\t} else {\n\t\tobject.data = 'about:blank';\n\t\telement.appendChild(object);\n\t}\n\n\treturn {\n\t\tcancel: () => {\n\t\t\twin && win.removeEventListener && win.removeEventListener('resize', fn);\n\t\t\telement.removeChild(object);\n\t\t}\n\t};\n}\n\nfunction toggleClass(element, name, toggle) {\n\telement.classList.toggle(name, !!toggle);\n}\n\nfunction linear(t) {\n\treturn t;\n}\n\nfunction generateRule({ a, b, delta, duration }, ease, fn) {\n\tconst step = 16.666 / duration;\n\tlet keyframes = '{\\n';\n\n\tfor (let p = 0; p <= 1; p += step) {\n\t\tconst t = a + delta * ease(p);\n\t\tkeyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n\t}\n\n\treturn keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n}\n\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n\tlet hash = 5381;\n\tlet i = str.length;\n\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn hash >>> 0;\n}\n\nfunction wrapTransition(component, node, fn, params, intro) {\n\tlet obj = fn.call(component, node, params);\n\tlet duration;\n\tlet ease;\n\tlet cssText;\n\n\tlet initialised = false;\n\n\treturn {\n\t\tt: intro ? 0 : 1,\n\t\trunning: false,\n\t\tprogram: null,\n\t\tpending: null,\n\n\t\trun(b, callback) {\n\t\t\tif (typeof obj === 'function') {\n\t\t\t\ttransitionManager.wait().then(() => {\n\t\t\t\t\tobj = obj();\n\t\t\t\t\tthis._run(b, callback);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._run(b, callback);\n\t\t\t}\n\t\t},\n\n\t\t_run(b, callback) {\n\t\t\tduration = obj.duration || 300;\n\t\t\tease = obj.easing || linear;\n\n\t\t\tconst program = {\n\t\t\t\tstart: window.performance.now() + (obj.delay || 0),\n\t\t\t\tb,\n\t\t\t\tcallback: callback || noop\n\t\t\t};\n\n\t\t\tif (intro && !initialised) {\n\t\t\t\tif (obj.css && obj.delay) {\n\t\t\t\t\tcssText = node.style.cssText;\n\t\t\t\t\tnode.style.cssText += obj.css(0, 1);\n\t\t\t\t}\n\n\t\t\t\tif (obj.tick) obj.tick(0, 1);\n\t\t\t\tinitialised = true;\n\t\t\t}\n\n\t\t\tif (!b) {\n\t\t\t\tprogram.group = outros.current;\n\t\t\t\toutros.current.remaining += 1;\n\t\t\t}\n\n\t\t\tif (obj.delay) {\n\t\t\t\tthis.pending = program;\n\t\t\t} else {\n\t\t\t\tthis.start(program);\n\t\t\t}\n\n\t\t\tif (!this.running) {\n\t\t\t\tthis.running = true;\n\t\t\t\ttransitionManager.add(this);\n\t\t\t}\n\t\t},\n\n\t\tstart(program) {\n\t\t\tcomponent.fire(`${program.b ? 'intro' : 'outro'}.start`, { node });\n\n\t\t\tprogram.a = this.t;\n\t\t\tprogram.delta = program.b - program.a;\n\t\t\tprogram.duration = duration * Math.abs(program.b - program.a);\n\t\t\tprogram.end = program.start + program.duration;\n\n\t\t\tif (obj.css) {\n\t\t\t\tif (obj.delay) node.style.cssText = cssText;\n\n\t\t\t\tconst rule = generateRule(program, ease, obj.css);\n\t\t\t\ttransitionManager.addRule(rule, program.name = '__svelte_' + hash(rule));\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(anim => anim && (program.delta < 0 || !/__svelte/.test(anim)))\n\t\t\t\t\t.concat(`${program.name} ${program.duration}ms linear 1 forwards`)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tthis.program = program;\n\t\t\tthis.pending = null;\n\t\t},\n\n\t\tupdate(now) {\n\t\t\tconst program = this.program;\n\t\t\tif (!program) return;\n\n\t\t\tconst p = now - program.start;\n\t\t\tthis.t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (obj.tick) obj.tick(this.t, 1 - this.t);\n\t\t},\n\n\t\tdone() {\n\t\t\tconst program = this.program;\n\t\t\tthis.t = program.b;\n\n\t\t\tif (obj.tick) obj.tick(this.t, 1 - this.t);\n\n\t\t\tcomponent.fire(`${program.b ? 'intro' : 'outro'}.end`, { node });\n\n\t\t\tif (!program.b && !program.invalidated) {\n\t\t\t\tprogram.group.callbacks.push(() => {\n\t\t\t\t\tprogram.callback();\n\t\t\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\t\t});\n\n\t\t\t\tif (--program.group.remaining === 0) {\n\t\t\t\t\tprogram.group.callbacks.forEach(run);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\t}\n\n\t\t\tthis.running = !!this.pending;\n\t\t},\n\n\t\tabort(reset) {\n\t\t\tif (this.program) {\n\t\t\t\tif (reset && obj.tick) obj.tick(1, 0);\n\t\t\t\tif (obj.css) transitionManager.deleteRule(node, this.program.name);\n\t\t\t\tthis.program = this.pending = null;\n\t\t\t\tthis.running = false;\n\t\t\t}\n\t\t},\n\n\t\tinvalidate() {\n\t\t\tif (this.program) {\n\t\t\t\tthis.program.invalidated = true;\n\t\t\t}\n\t\t}\n\t};\n}\n\nlet outros = {};\n\nfunction groupOutros() {\n\toutros.current = {\n\t\tremaining: 0,\n\t\tcallbacks: []\n\t};\n}\n\nvar transitionManager = {\n\trunning: false,\n\ttransitions: [],\n\tbound: null,\n\tstylesheet: null,\n\tactiveRules: {},\n\tpromise: null,\n\n\tadd(transition) {\n\t\tthis.transitions.push(transition);\n\n\t\tif (!this.running) {\n\t\t\tthis.running = true;\n\t\t\trequestAnimationFrame(this.bound || (this.bound = this.next.bind(this)));\n\t\t}\n\t},\n\n\taddRule(rule, name) {\n\t\tif (!this.stylesheet) {\n\t\t\tconst style = createElement('style');\n\t\t\tdocument.head.appendChild(style);\n\t\t\ttransitionManager.stylesheet = style.sheet;\n\t\t}\n\n\t\tif (!this.activeRules[name]) {\n\t\t\tthis.activeRules[name] = true;\n\t\t\tthis.stylesheet.insertRule(`@keyframes ${name} ${rule}`, this.stylesheet.cssRules.length);\n\t\t}\n\t},\n\n\tnext() {\n\t\tthis.running = false;\n\n\t\tconst now = window.performance.now();\n\t\tlet i = this.transitions.length;\n\n\t\twhile (i--) {\n\t\t\tconst transition = this.transitions[i];\n\n\t\t\tif (transition.program && now >= transition.program.end) {\n\t\t\t\ttransition.done();\n\t\t\t}\n\n\t\t\tif (transition.pending && now >= transition.pending.start) {\n\t\t\t\ttransition.start(transition.pending);\n\t\t\t}\n\n\t\t\tif (transition.running) {\n\t\t\t\ttransition.update(now);\n\t\t\t\tthis.running = true;\n\t\t\t} else if (!transition.pending) {\n\t\t\t\tthis.transitions.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (this.running) {\n\t\t\trequestAnimationFrame(this.bound);\n\t\t} else if (this.stylesheet) {\n\t\t\tlet i = this.stylesheet.cssRules.length;\n\t\t\twhile (i--) this.stylesheet.deleteRule(i);\n\t\t\tthis.activeRules = {};\n\t\t}\n\t},\n\n\tdeleteRule(node, name) {\n\t\tnode.style.animation = node.style.animation\n\t\t\t.split(', ')\n\t\t\t.filter(anim => anim && anim.indexOf(name) === -1)\n\t\t\t.join(', ');\n\t},\n\n\twait() {\n\t\tif (!transitionManager.promise) {\n\t\t\ttransitionManager.promise = Promise.resolve();\n\t\t\ttransitionManager.promise.then(() => {\n\t\t\t\ttransitionManager.promise = null;\n\t\t\t});\n\t\t}\n\n\t\treturn transitionManager.promise;\n\t}\n};\n\nfunction wrapAnimation(node, from, fn, params) {\n\tif (!from) return;\n\n\tconst to = node.getBoundingClientRect();\n\tif (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom) return;\n\n\tconst info = fn(node, { from, to }, params);\n\n\tconst duration = 'duration' in info ? info.duration : 300;\n\tconst delay = 'delay' in info ? info.delay : 0;\n\tconst ease = info.easing || linear;\n\tconst start = window.performance.now() + delay;\n\tconst end = start + duration;\n\n\tconst program = {\n\t\ta: 0,\n\t\tt: 0,\n\t\tb: 1,\n\t\tdelta: 1,\n\t\tduration,\n\t\tstart,\n\t\tend\n\t};\n\n\tconst cssText = node.style.cssText;\n\n\tconst animation = {\n\t\tpending: delay ? program : null,\n\t\tprogram: delay ? null : program,\n\t\trunning: true,\n\n\t\tstart() {\n\t\t\tif (info.css) {\n\t\t\t\tif (delay) node.style.cssText = cssText;\n\n\t\t\t\tconst rule = generateRule(program, ease, info.css);\n\t\t\t\tprogram.name = `__svelte_${hash(rule)}`;\n\n\t\t\t\ttransitionManager.addRule(rule, program.name);\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(anim => anim && (program.delta < 0 || !/__svelte/.test(anim)))\n\t\t\t\t\t.concat(`${program.name} ${program.duration}ms linear 1 forwards`)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tanimation.program = program;\n\t\t\tanimation.pending = null;\n\t\t},\n\n\t\tupdate: now => {\n\t\t\tconst p = now - program.start;\n\t\t\tconst t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (info.tick) info.tick(t, 1 - t);\n\t\t},\n\n\t\tdone() {\n\t\t\tif (info.tick) info.tick(1, 0);\n\t\t\tanimation.stop();\n\t\t},\n\n\t\tstop() {\n\t\t\tif (info.css) transitionManager.deleteRule(node, program.name);\n\t\t\tanimation.running = false;\n\t\t}\n\t};\n\n\ttransitionManager.add(animation);\n\n\tif (info.tick) info.tick(0, 1);\n\n\tif (delay) {\n\t\tif (info.css) node.style.cssText += info.css(0, 1);\n\t} else {\n\t\tanimation.start();\n\t}\n\n\treturn animation;\n}\n\nfunction fixPosition(node) {\n\tconst style = getComputedStyle(node);\n\n\tif (style.position !== 'absolute' && style.position !== 'fixed') {\n\t\tconst { width, height } = style;\n\t\tconst a = node.getBoundingClientRect();\n\t\tnode.style.position = 'absolute';\n\t\tnode.style.width = width;\n\t\tnode.style.height = height;\n\t\tconst b = node.getBoundingClientRect();\n\n\t\tif (a.left !== b.left || a.top !== b.top) {\n\t\t\tconst style = getComputedStyle(node);\n\t\t\tconst transform = style.transform === 'none' ? '' : style.transform;\n\n\t\t\tnode.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n\t\t}\n\t}\n}\n\nfunction handlePromise(promise, info) {\n\tvar token = info.token = {};\n\n\tfunction update(type, index, key, value) {\n\t\tif (info.token !== token) return;\n\n\t\tinfo.resolved = key && { [key]: value };\n\n\t\tconst child_ctx = assign(assign({}, info.ctx), info.resolved);\n\t\tconst block = type && (info.current = type)(info.component, child_ctx);\n\n\t\tif (info.block) {\n\t\t\tif (info.blocks) {\n\t\t\t\tinfo.blocks.forEach((block, i) => {\n\t\t\t\t\tif (i !== index && block) {\n\t\t\t\t\t\tgroupOutros();\n\t\t\t\t\t\tblock.o(() => {\n\t\t\t\t\t\t\tblock.d(1);\n\t\t\t\t\t\t\tinfo.blocks[i] = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tinfo.block.d(1);\n\t\t\t}\n\n\t\t\tblock.c();\n\t\t\tblock[block.i ? 'i' : 'm'](info.mount(), info.anchor);\n\n\t\t\tinfo.component.root.set({}); // flush any handlers that were created\n\t\t}\n\n\t\tinfo.block = block;\n\t\tif (info.blocks) info.blocks[index] = block;\n\t}\n\n\tif (isPromise(promise)) {\n\t\tpromise.then(value => {\n\t\t\tupdate(info.then, 1, info.value, value);\n\t\t}, error => {\n\t\t\tupdate(info.catch, 2, info.error, error);\n\t\t});\n\n\t\t// if we previously had a then/catch block, destroy it\n\t\tif (info.current !== info.pending) {\n\t\t\tupdate(info.pending, 0);\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (info.current !== info.then) {\n\t\t\tupdate(info.then, 1, info.value, promise);\n\t\t\treturn true;\n\t\t}\n\n\t\tinfo.resolved = { [info.value]: promise };\n\t}\n}\n\nfunction destroyBlock(block, lookup) {\n\tblock.d(1);\n\tlookup[block.key] = null;\n}\n\nfunction outroAndDestroyBlock(block, lookup) {\n\tblock.o(function() {\n\t\tdestroyBlock(block, lookup);\n\t});\n}\n\nfunction fixAndOutroAndDestroyBlock(block, lookup) {\n\tblock.f();\n\toutroAndDestroyBlock(block, lookup);\n}\n\nfunction updateKeyedEach(old_blocks, component, changed, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, intro_method, next, get_context) {\n\tvar o = old_blocks.length;\n\tvar n = list.length;\n\n\tvar i = o;\n\tvar old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\n\tvar new_blocks = [];\n\tvar new_lookup = {};\n\tvar deltas = {};\n\n\tvar i = n;\n\twhile (i--) {\n\t\tvar child_ctx = get_context(ctx, list, i);\n\t\tvar key = get_key(child_ctx);\n\t\tvar block = lookup[key];\n\n\t\tif (!block) {\n\t\t\tblock = create_each_block(component, key, child_ctx);\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\tblock.p(changed, child_ctx);\n\t\t}\n\n\t\tnew_blocks[i] = new_lookup[key] = block;\n\n\t\tif (key in old_indexes) deltas[key] = Math.abs(i - old_indexes[key]);\n\t}\n\n\tvar will_move = {};\n\tvar did_move = {};\n\n\tfunction insert(block) {\n\t\tblock[intro_method](node, next);\n\t\tlookup[block.key] = block;\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\n\twhile (o && n) {\n\t\tvar new_block = new_blocks[n - 1];\n\t\tvar old_block = old_blocks[o - 1];\n\t\tvar new_key = new_block.key;\n\t\tvar old_key = old_block.key;\n\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t}\n\n\t\telse if (!new_lookup[old_key]) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t}\n\n\t\telse if (!lookup[new_key] || will_move[new_key]) {\n\t\t\tinsert(new_block);\n\t\t}\n\n\t\telse if (did_move[old_key]) {\n\t\t\to--;\n\n\t\t} else if (deltas[new_key] > deltas[old_key]) {\n\t\t\tdid_move[new_key] = true;\n\t\t\tinsert(new_block);\n\n\t\t} else {\n\t\t\twill_move[old_key] = true;\n\t\t\to--;\n\t\t}\n\t}\n\n\twhile (o--) {\n\t\tvar old_block = old_blocks[o];\n\t\tif (!new_lookup[old_block.key]) destroy(old_block, lookup);\n\t}\n\n\twhile (n) insert(new_blocks[n - 1]);\n\n\treturn new_blocks;\n}\n\nfunction measure(blocks) {\n\tconst rects = {};\n\tlet i = blocks.length;\n\twhile (i--) rects[blocks[i].key] = blocks[i].node.getBoundingClientRect();\n\treturn rects;\n}\n\nfunction animate(blocks, rects, fn, params) {\n\tlet i = blocks.length;\n\twhile (i--) {\n\t\tconst block = blocks[i];\n\t\tconst from = rects[block.key];\n\n\t\tif (!from) continue;\n\t\tconst to = block.node.getBoundingClientRect();\n\n\t\tif (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom) continue;\n\n\n\t}\n}\n\nfunction getSpreadUpdate(levels, updates) {\n\tvar update = {};\n\n\tvar to_null_out = {};\n\tvar accounted_for = {};\n\n\tvar i = levels.length;\n\twhile (i--) {\n\t\tvar o = levels[i];\n\t\tvar n = updates[i];\n\n\t\tif (n) {\n\t\t\tfor (var key in o) {\n\t\t\t\tif (!(key in n)) to_null_out[key] = 1;\n\t\t\t}\n\n\t\t\tfor (var key in n) {\n\t\t\t\tif (!accounted_for[key]) {\n\t\t\t\t\tupdate[key] = n[key];\n\t\t\t\t\taccounted_for[key] = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlevels[i] = n;\n\t\t} else {\n\t\t\tfor (var key in o) {\n\t\t\t\taccounted_for[key] = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (var key in to_null_out) {\n\t\tif (!(key in update)) update[key] = undefined;\n\t}\n\n\treturn update;\n}\n\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nconst invalidAttributeNameCharacter = /[\\s'\">\\/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n\nfunction spread(args) {\n\tconst attributes = Object.assign({}, ...args);\n\tlet str = '';\n\n\tObject.keys(attributes).forEach(name => {\n\t\tif (invalidAttributeNameCharacter.test(name)) return;\n\n\t\tconst value = attributes[name];\n\t\tif (value === undefined) return;\n\t\tif (value === true) str += \" \" + name;\n\n\t\tconst escaped = String(value)\n\t\t\t.replace(/\"/g, '&#34;')\n\t\t\t.replace(/'/g, '&#39;');\n\n\t\tstr += \" \" + name + \"=\" + JSON.stringify(escaped);\n\t});\n\n\treturn str;\n}\n\nconst escaped = {\n\t'\"': '&quot;',\n\t\"'\": '&#39;',\n\t'&': '&amp;',\n\t'<': '&lt;',\n\t'>': '&gt;'\n};\n\nfunction escape(html) {\n\treturn String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\n\nfunction each(items, assign, fn) {\n\tlet str = '';\n\tfor (let i = 0; i < items.length; i += 1) {\n\t\tstr += fn(assign(items[i], i));\n\t}\n\treturn str;\n}\n\nconst missingComponent = {\n\t_render: () => ''\n};\n\nfunction validateSsrComponent(component, name) {\n\tif (!component || !component._render) {\n\t\tif (name === 'svelte:component') name += 'this={...}';\n\t\tthrow new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n\t}\n\n\treturn component;\n}\n\nfunction debug(file, line, column, values) {\n\tconsole.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`);\n\tconsole.log(values);\n\treturn '';\n}\n\nfunction blankObject() {\n\treturn Object.create(null);\n}\n\nfunction destroy(detach) {\n\tthis.destroy = noop;\n\tthis.fire('destroy');\n\tthis.set = noop;\n\n\tthis._fragment.d(detach !== false);\n\tthis._fragment = null;\n\tthis._state = {};\n}\n\nfunction destroyDev(detach) {\n\tdestroy.call(this, detach);\n\tthis.destroy = function() {\n\t\tconsole.warn('Component was already destroyed');\n\t};\n}\n\nfunction _differs(a, b) {\n\treturn a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\n\nfunction _differsImmutable(a, b) {\n\treturn a != a ? b == b : a !== b;\n}\n\nfunction fire(eventName, data) {\n\tvar handlers =\n\t\teventName in this._handlers && this._handlers[eventName].slice();\n\tif (!handlers) return;\n\n\tfor (var i = 0; i < handlers.length; i += 1) {\n\t\tvar handler = handlers[i];\n\n\t\tif (!handler.__calling) {\n\t\t\ttry {\n\t\t\t\thandler.__calling = true;\n\t\t\t\thandler.call(this, data);\n\t\t\t} finally {\n\t\t\t\thandler.__calling = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction flush(component) {\n\tcomponent._lock = true;\n\tcallAll(component._beforecreate);\n\tcallAll(component._oncreate);\n\tcallAll(component._aftercreate);\n\tcomponent._lock = false;\n}\n\nfunction get() {\n\treturn this._state;\n}\n\nfunction init(component, options) {\n\tcomponent._handlers = blankObject();\n\tcomponent._slots = blankObject();\n\tcomponent._bind = options._bind;\n\n\tcomponent.options = options;\n\tcomponent.root = options.root || component;\n\tcomponent.store = options.store || component.root.store;\n\n\tif (!options.root) {\n\t\tcomponent._beforecreate = [];\n\t\tcomponent._oncreate = [];\n\t\tcomponent._aftercreate = [];\n\t}\n}\n\nfunction on(eventName, handler) {\n\tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n\thandlers.push(handler);\n\n\treturn {\n\t\tcancel: function() {\n\t\t\tvar index = handlers.indexOf(handler);\n\t\t\tif (~index) handlers.splice(index, 1);\n\t\t}\n\t};\n}\n\nfunction set(newState) {\n\tthis._set(assign({}, newState));\n\tif (this.root._lock) return;\n\tflush(this.root);\n}\n\nfunction _set(newState) {\n\tvar oldState = this._state,\n\t\tchanged = {},\n\t\tdirty = false;\n\n\tfor (var key in newState) {\n\t\tif (this._differs(newState[key], oldState[key])) changed[key] = dirty = true;\n\t}\n\tif (!dirty) return;\n\n\tthis._state = assign(assign({}, oldState), newState);\n\tthis._recompute(changed, this._state);\n\tif (this._bind) this._bind(changed, this._state);\n\n\tif (this._fragment) {\n\t\tthis.fire(\"state\", { changed: changed, current: this._state, previous: oldState });\n\t\tthis._fragment.p(changed, this._state);\n\t\tthis.fire(\"update\", { changed: changed, current: this._state, previous: oldState });\n\t}\n}\n\nfunction setDev(newState) {\n\tif (typeof newState !== 'object') {\n\t\tthrow new Error(\n\t\t\tthis._debugName + '.set was called without an object of data key-values to update.'\n\t\t);\n\t}\n\n\tthis._checkReadOnly(newState);\n\tset.call(this, newState);\n}\n\nfunction callAll(fns) {\n\twhile (fns && fns.length) fns.shift()();\n}\n\nfunction _mount(target, anchor) {\n\tthis._fragment[this._fragment.i ? 'i' : 'm'](target, anchor || null);\n}\n\nvar PENDING = {};\nvar SUCCESS = {};\nvar FAILURE = {};\n\nfunction removeFromStore() {\n\tthis.store._remove(this);\n}\n\nvar proto = {\n\tdestroy,\n\tget,\n\tfire,\n\ton,\n\tset,\n\t_recompute: noop,\n\t_set,\n\t_mount,\n\t_differs\n};\n\nvar protoDev = {\n\tdestroy: destroyDev,\n\tget,\n\tfire,\n\ton,\n\tset: setDev,\n\t_recompute: noop,\n\t_set,\n\t_mount,\n\t_differs\n};\n\nexport { blankObject, destroy, destroyDev, _differs, _differsImmutable, fire, flush, get, init, on, set, _set, setDev, callAll, _mount, PENDING, SUCCESS, FAILURE, removeFromStore, proto, protoDev, wrapAnimation, fixPosition, handlePromise, append, insert, detachNode, detachBetween, detachBefore, detachAfter, reinsertBetween, reinsertChildren, reinsertAfter, reinsertBefore, destroyEach, createFragment, createElement, createSvgElement, createText, createComment, addListener, removeListener, setAttribute, setAttributes, setCustomElementData, removeAttribute, setXlinkAttribute, getBindingGroupValue, toNumber, timeRangesToArray, children, claimElement, claimText, setData, setInputType, setStyle, selectOption, selectOptions, selectValue, selectMultipleValue, addResizeListener, toggleClass, destroyBlock, outroAndDestroyBlock, fixAndOutroAndDestroyBlock, updateKeyedEach, measure, animate, getSpreadUpdate, invalidAttributeNameCharacter, spread, escaped, escape, each, missingComponent, validateSsrComponent, debug, linear, generateRule, hash, wrapTransition, outros, groupOutros, transitionManager, noop, assign, assignTrue, isPromise, callAfter, addLoc, exclude, run };\n","<div\n  ref:menu\n  style=\"top: {pos.top}px; left: {pos.left}px\"\n  class=\"menu{active ? ' active' : ''}{inputMode ? ' input-mode' : ''}\">\n  <div class=\"items\">\n    {#each items as item}\n      {#if item}\n        <button class=\"editor-menu-{item.name}{item.active ? ' active' : ''}\" on:click=\"onClick(item)\" disabled={item.disabled}>\n          <i class=\"typewriter-icon typewriter-{item.icon || item.name}\"></i>\n        </button>\n      {:else}\n        <div class=\"typewriter-separator\"></div>\n      {/if}\n    {/each}\n  </div>\n  <div class=\"link-input\">\n    <input ref:input bind:value=\"href\" on:keydown=\"onKeyDown(event)\" on:blur=\"exitInput()\" placeholder=\"https://example.com/\">\n    <i on:click=\"exitInput()\" class=\"close\">×</i>\n  </div>\n</div>\n\n<script>\n  const SOURCE_USER = 'user';\n\n  export default {\n    data() {\n      return {\n        view: null,\n        active: false,\n        inputMode: false,\n        pos: { left: 0, top: 0 },\n        href: '',\n      };\n    },\n\n    oncreate() {\n      this.reposition();\n      this.on('state', ({ changed, current }) => {\n        if (!changed.view && !changed.range) return;\n        this.reposition();\n      });\n    },\n\n    computed: {\n      items: ({ view, range }) => {\n        if (!view) return [];\n\n        const editor = view.editor;\n        const { blocks, markups } = view.paper;\n        const { header, blockquote } = blocks.types;\n        const { bold, italic, link } = markups.types;\n        const format = editor.getFormat(range);\n        const items = [];\n\n        if (bold) {\n          items.push({\n            name: 'bold',\n            active: format.bold,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (italic) {\n          items.push({\n            name: 'italic',\n            active: format.italic,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (link) {\n          items.push({\n            name: 'link',\n            active: format.link,\n            action: 'onLinkClick'\n          });\n        }\n\n        if (items.length && (header || blockquote)) {\n          items.push(null);\n        }\n\n        if (header) {\n          items.push({\n            name: 'header',\n            icon: 'heading1',\n            active: format.header === 2,\n            action: 'onBlockClick',\n            value: 2\n          }, {\n            name: 'header',\n            icon: 'heading2',\n            active: format.header === 3,\n            action: 'onBlockClick',\n            value: 3\n          });\n        }\n\n        if (blockquote) {\n          items.push({\n            name: 'blockquote',\n            active: format.blockquote,\n            action: 'onBlockClick'\n          });\n        }\n\n        return items;\n      }\n    },\n\n    methods: {\n      reposition() {\n        const { view, range } = this.get();\n        let pos;\n        if (!view || !range) {\n          pos = { top: -100000, left: -100000 };\n        } else {\n          const menu = this.refs.menu;\n          const container = menu.offsetParent.getBoundingClientRect();\n          const target = view.getBounds(range);\n          pos = {\n            top: target.top - container.top - menu.offsetHeight,\n            left: target.left - container.left + target.width / 2 - menu.offsetWidth / 2,\n          };\n        }\n        this.set({ pos });\n      },\n\n      inputLink() {\n        this.set({ inputMode: true, href: '' });\n        this.refs.input.focus();\n      },\n\n      exitInput() {\n        let { view } = this.get();\n        this.set({ inputMode: false, href: '' });\n        view.focus();\n      },\n\n      createLink() {\n        let { href, view, range } = this.get();\n        href = href.trim();\n        if (href) {\n          view.editor.formatText(range, { link: href }, SOURCE_USER);\n        }\n        view.focus();\n        this.exitInput();\n      },\n\n      onMarkupClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleTextFormat(range, { [item.name]: true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onBlockClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleLineFormat(range, { [item.name]: item.value || true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onLinkClick() {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onHeaderClick(item) {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onClick(item) {\n        if (typeof this[item.action] === 'function') {\n          this[item.action](item);\n        }\n      },\n\n      onKeyDown(event) {\n        if (event.keyCode === 27) {\n          event.preventDefault();\n          this.exitInput();\n        } else if (event.keyCode === 13) {\n          event.preventDefault();\n          this.createLink();\n        }\n      }\n    }\n  }\n</script>\n\n<style>\n  @import url(https://fonts.googleapis.com/icon?family=Material+Icons);\n  .menu {\n    position: absolute;\n    background-image: linear-gradient(to bottom, rgba(49, 49, 47, .99), #262625);\n    border-radius: .25rem;\n    opacity: 0;\n    z-index: 10000;\n    margin-top: -7px;\n    white-space: nowrap;\n  }\n  .menu.active {\n    opacity: 1;\n    animation: pop-upwards 180ms forwards linear;\n    transition: top 75ms ease-out, left 75ms ease-out;\n  }\n  .menu::after {\n    content: '';\n    position: absolute;\n    bottom: -13px;\n    left: 50%;\n    margin-left: -7px;\n    border: 7px solid transparent;\n    border-top-color: #262625;\n  }\n  button {\n    height: 42px;\n    line-height: 42px;\n    vertical-align: middle;\n    border: none;\n    padding: 0 8px;\n    color: #fff;\n    background: none;\n    outline: none;\n    cursor: pointer;\n  }\n  button:first-child {\n    padding-left: 14px;\n  }\n  button:last-child {\n    padding-right: 14px;\n  }\n  button.active {\n    color: #74b6ff;\n  }\n  button[disabled] {\n    opacity: .5;\n    cursor: default;\n  }\n  .typewriter-icon {\n    display: inline-block;\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: inherit;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n  .typewriter-icon.typewriter-bold::before {\n    content: '\\E238';\n  }\n  .typewriter-icon.typewriter-italic::before {\n    content: '\\E23F';\n  }\n  .typewriter-icon.typewriter-link::before {\n    content: '\\E250';\n  }\n  .typewriter-icon.typewriter-heading1::before {\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-heading2::before {\n    font-size: .75em;\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-blockquote::before {\n    content: '\\E244';\n  }\n  .typewriter-separator {\n    display: inline-block;\n    vertical-align: middle;\n    width: 1px;\n    margin: 0 6px;\n    height: 24px;\n    background: rgba(0, 0, 0, .2);\n    box-shadow: 1px 0 rgba(255, 255, 255, .2);\n  }\n  @keyframes pop-upwards {\n    0% {\n      transform: matrix(.97, 0, 0, 1, 0, 12);\n      opacity: 0\n    }\n    20% {\n      transform: matrix(.99, 0, 0, 1, 0, 2);\n      opacity: .7\n    }\n    40% {\n      transform: matrix(1, 0, 0, 1, 0, -1);\n      opacity: 1\n    }\n    70% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n    100% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n  }\n\n  .link-input {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 100%;\n  }\n  .link-input input {\n    width: 100%;\n    height: 100%;\n    background: none;\n    border: none;\n    color: #f7f7f9;\n    padding: 10px 24px 10px 12px;\n    font-size: .875rem;\n    outline: none;\n    box-sizing: border-box;\n  }\n  .link-input .close {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    color: #f7f7f9;\n    opacity: .5;\n  }\n  .link-input .close:hover {\n    color: #f7f7f9;\n    opacity: 1;\n  }\n  .menu:not(.input-mode) .link-input {\n    display: none;\n  }\n  .menu.input-mode .items {\n    opacity: 0;\n  }\n</style>\n","import HoverMenu from '../ui/HoverMenu.html';\n\nexport default function hoverMenu() {\n\n  return view => {\n    const editor = view.editor;\n    let menu;\n\n\n    function show(range = editor.selection) {\n      if (!menu) {\n        menu = new HoverMenu({\n          target: view.root.parentNode,\n          data: { view, range },\n        });\n        if (menu.get().items.length) {\n          requestAnimationFrame(() => menu.set({ active: true }));\n        }\n      } else {\n        menu.set({ range });\n      }\n    }\n\n    function hide() {\n      if (menu) menu.destroy();\n      menu = null;\n    }\n\n    function onEditorChange({ selection }) {\n      const validSelection = selection && selection[0] !== selection[1];\n      const inputMode = menu && menu.get().inputMode;\n      if (!validSelection || !view.enabled) {\n        if (!inputMode) hide();\n        return;\n      }\n      let [ from, to ] = selection;\n\n      // Don't show when selection goes across lines\n      if (from > to) [ from, to ] = [ to, from ];\n      if (editor.contents.getLines(from, to).length > 1) return;\n\n      show();\n    }\n\n\n    editor.on('editor-change', onEditorChange);\n\n    return {\n      show,\n      hide,\n      destroy() {\n        editor.off('editor-change', onEditorChange);\n        hide();\n      }\n    }\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport Editor from './editor';\nimport View from './view';\nimport Paper from './paper';\nimport { h } from './view/vdom';\n\nimport input from './modules/input';\nimport keyShortcuts from './modules/key-shortcuts';\nimport history from './modules/history';\nimport placeholder from './modules/placeholder';\nimport smartEntry from './modules/smart-entry';\nimport smartQuotes, { smartQuotesDecorator } from './modules/smart-quotes';\nimport hoverMenu from './modules/hover-menu';\n\nconst defaultViewModules = {\n  input: input(),\n  keyShortcuts: keyShortcuts(),\n  history: history(),\n};\n\nexport {\n  EventDispatcher,\n  Delta,\n  Editor,\n  View,\n  Paper,\n  h,\n  input,\n  keyShortcuts,\n  history,\n  placeholder,\n  smartEntry,\n  smartQuotes,\n  smartQuotesDecorator,\n  hoverMenu,\n  defaultViewModules,\n};\n"],"names":["dispatcherEvents","WeakMap","EventDispatcher","type","listener","add","events","getEventListeners","delete","once","args","off","apply","on","uncanceled","forEach","obj","autocreate","get","set","Object","create","Set","DIFF_DELETE","DIFF_INSERT","DIFF_EQUAL","diff","text1","text2","cursor_pos","length","commonlength","diff_commonPrefix","commonprefix","substring","diff_commonSuffix","commonsuffix","diffs","diff_compute_","unshift","push","fix_cursor","fix_emoji","longtext","shorttext","i","indexOf","hm","diff_halfMatch_","text1_a","text1_b","text2_a","text2_b","mid_common","diffs_a","diffs_b","concat","diff_bisect_","text1_length","text2_length","max_d","Math","ceil","v_offset","v_length","v1","Array","v2","x","delta","front","k1start","k1end","k2start","k2end","d","k1","k1_offset","x1","y1","charAt","k2_offset","x2","diff_bisectSplit_","k2","y2","y","text1a","text2a","text1b","text2b","diffsb","pointermin","pointermax","min","pointermid","pointerstart","floor","pointerend","diff_halfMatchI_","seed","j","best_common","best_longtext_a","best_longtext_b","best_shorttext_a","best_shorttext_b","prefixLength","suffixLength","hm1","hm2","diff_cleanupMerge","pointer","count_delete","count_insert","text_delete","text_insert","splice","pop","changes","INSERT","DELETE","EQUAL","cursor_normalize_diff","current_pos","next_pos","slice","split_pos","d_left","d_right","Error","norm","ndiffs","cursor_pointer","d_next","merge_tuples","suffix","compact","starts_with_pair_end","str","charCodeAt","ends_with_pair_start","fixed_diffs","start","left_d","right_d","shallowEqual","objA","objB","valueEqual","strictEqual","deepEqual","valueA","valueB","propEqual","Date","getTime","objectEqual","prototype","keysA","keys","keysB","every","key","NULL_CHARACTER","String","fromCharCode","Delta","ops","text","attributes","newOp","insert","_push","retain","index","lastOp","Iterator","predicate","filter","map","passed","failed","op","target","initial","reduce","entry","getOpLength","end","Infinity","iter","iterator","hasNext","nextOp","next","other","thisIter","otherIter","peekType","peekLength","thisOp","otherOp","composeAttributes","chop","strings","prep","join","diffResult","component","opLength","diffAttributes","newline","lineStart","currentIndex","peek","nextLength","newlineIndex","line","from","to","lines","eachLine","at","getLines","some","getOps","priority","transformPosition","transformAttributes","offset","nextType","source","keepNull","undefined","retOp","substr","SOURCE_API","SOURCE_USER","SOURCE_SILENT","empty","Editor","options","contents","selection","activeFormats","modules","_normalizeRange","getContents","oldSelection","_normalizeSelection","getTextFormat","event","fire","change","oldContents","normalizeContents","compose","transform","getSelectedRange","changeEvent","selectionChanged","newContents","updateContents","setContents","formats","getLineFormat","lineFormat","textFormat","split","cleanDelete","embed","value","combineFormats","seleciton","test","name","decorations","classes","getText","format","existing","formatLine","isSame","formatText","producer","singleChange","getChange","range","max","rest","isArray","editor","getLine","lineChange","freeze","combined","merged","h","children","arguments","node","renderChildren","element","clone","eventListener","currentTarget","updateAttribute","isSvg","oldValue","addEventListener","removeEventListener","setAttribute","removeAttribute","createElement","document","createTextNode","createElementNS","appendChild","getElementAttributes","updateElement","oldAttributes","removeElement","parent","removeChild","patchChildren","childNodes","patch","nodeName","toLowerCase","newElement","insertBefore","nodeValue","matchHtmlRegExp","escapeHtml","string","match","exec","escape","html","lastIndex","getSelection","view","root","ownerDocument","defaultView","startContainer","anchorOffset","startOffset","endContainer","focusOffset","endOffset","collapsed","contains","anchorNode","anchorIndex","getNodeAndOffsetIndex","focusIndex","isCollapsed","focusNode","setSelection","hasFocus","activeElement","blur","setBaseAndExtent","getNodesForRange","focus","getBrowserRange","browserRange","createRange","setStart","setEnd","getNodeAndOffset","blocks","embeds","paper","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","nodeType","Node","TEXT_NODE","offsetParent","FILTER_ACCEPT","FILTER_REJECT","count","firstBlockSeen","currentNode","nextNode","size","matches","firstChild","isBRNode","nextSibling","parentNode","call","ELEMENT_NODE","getNodeIndex","previousNode","lastChild","markups","nodeMarkup","br","voidElements","base","col","hr","img","input","meta","param","track","wbr","deltaToVdom","container","blockData","inlineChildren","child","replace","find","vdom","sort","a","b","markup","mergeChildren","block","getDefault","blockChildren","collect","data","attr","optimize","decorateBlock","classArray","class","undecorateBlock","ignoreClasses","ignoreAttributes","selector","_","attrLength","classList","item","attribute","deltaFromDom","opts","notInDom","currentBlock","isBr","dom","deltaToHTML","childrenToHTML","deltaFromHTML","template","innerHTML","content","oldChildren","prev","nodeToHTML","closingTag","paragraph","header","parseInt","H","list","indent","lists","topLevelChildren","levels","List","childrenArray","blockquote","quotes","bold","italics","link","href","image","src","Paper","types","Types","enabled","array","priorities","definition","remove","domType","nodeOrAttr","modifierKeys","shortcutFromEvent","shortcutArray","metaKey","ctrlKey","altKey","shiftKey","toUpperCase","isMac","navigator","userAgent","modExpr","View","className","defaultPaper","enable","_settingEditorSelection","_settingBrowserSelection","init","render","lastSelection","contentEditable","decorators","getBoundingClientRect","getClientRects","reverseDecorators","contenteditable","updateBrowserSelection","nativeRange","execCommand","onKeyDown","shortcut","onSelectionChange","updateEditorSelection","onTextChanging","onEditorChange","checking","devObserver","MutationObserver","clearTimeout","setTimeout","error","observe","characterData","characterDataOldValue","childList","subtree","uninit","disconnect","api","module","destroy","lastWord","firstWord","lastLine","mutationOptions","onMutate","seen","m","has","mutation","isTextChange","addedNodes","action","onEnter","defaultPrevented","preventDefault","isDefault","atEnd","defaultFollows","insertText","onShiftEnter","onBackspace","prevLine","prevBlock","deleteText","onDelete","onTab","direction","transaction","prevIndent","console","log","observer","onRendering","onRender","keymap","toggleTextFormat","italic","toggleLineFormat","macKeymap","keyShortcuts","customShortcuts","shortcuts","onShortcut","defaultOptions","history","stack","lastRecorded","lastAction","ignoreChange","undo","redo","cutoff","dest","record","timestamp","now","getAction","undoChange","delay","undoSelection","maxStack","shift","onTextChange","changeOp","placeholder","pointerEvents","onDecorate","blockReplacements","capture","textReplacements","blockReplace","prefix","regexp","getAttributes","textReplace","replaceWith","defaultHandlers","handlers","ignore","isTextEntry","getExactText","lastIndexOf","handler","smartQuotes","lastChars","replaced","quote","smartQuotesDecorator","expr","replacer","replacement","getFormat","items","left","top","pos","menu","refs","getBounds","offsetHeight","width","offsetWidth","inputMode","trim","exitInput","inputLink","keyCode","createLink","reposition","changed","current","active","icon","disabled","onClick","hoverMenu","show","HoverMenu","hide","validSelection","defaultViewModules"],"mappings":"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"}