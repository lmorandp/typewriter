{"version":3,"file":"typewriter.js","sources":["../src/event-dispatcher.js","../node_modules/fast-diff/diff.js","../node_modules/fast-equals/es/utils.js","../node_modules/fast-equals/es/comparator.js","../node_modules/fast-equals/es/index.js","../src/delta.js","../src/editor.js","../src/view/vdom.js","../node_modules/escape-html/index.js","../src/view/selection.js","../src/view/dom.js","../src/view/blocks.js","../src/view/markups.js","../src/view/embeds.js","../src/view/defaultPaper.js","../src/paper.js","../node_modules/keyboardevent-key-polyfill/index.js","../node_modules/shortcut-string/index.js","../src/view.js","../src/modules/input.js","../src/modules/key-shortcuts.js","../src/modules/history.js","../src/modules/placeholder.js","../src/modules/smart-entry.js","../src/modules/smart-quotes.js","../node_modules/svelte/shared.js","../src/ui/HoverMenu.html","../src/modules/hover-menu.js","../src/index.js"],"sourcesContent":["const dispatcherEvents = new WeakMap();\n\n\nexport default class EventDispatcher {\n\n  on(type, listener) {\n    getEventListeners(this, type, true).add(listener);\n  }\n\n  off(type, listener) {\n    const events = getEventListeners(this, type);\n    events && events.delete(listener);\n  }\n\n  once(type, listener) {\n    function once(...args) {\n      this.off(type, once);\n      listener.apply(this, args);\n    }\n    this.on(type, once);\n  }\n\n  fire(type, ...args) {\n    let uncanceled = true;\n    const events = getEventListeners(this, type);\n    if (events) events.forEach(listener => {\n      uncanceled && listener.apply(this, args) !== false || (uncanceled = false);\n    });\n    return uncanceled;\n  }\n}\n\n\nfunction getEventListeners(obj, type, autocreate) {\n  let events = dispatcherEvents.get(obj);\n  if (!events && autocreate) dispatcherEvents.set(obj, events = Object.create(null));\n  return events && events[type] || autocreate && (events[type] = new Set());\n}\n","/**\n * This library modifies the diff-patch-match library by Neil Fraser\n * by removing the patch and match functionality and certain advanced\n * options in the diff function. The original license is as follows:\n *\n * ===\n *\n * Diff Match and Patch\n *\n * Copyright 2006 Google Inc.\n * http://code.google.com/p/google-diff-match-patch/\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The data structure representing a diff is an array of tuples:\n * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n */\nvar DIFF_DELETE = -1;\nvar DIFF_INSERT = 1;\nvar DIFF_EQUAL = 0;\n\n\n/**\n * Find the differences between two texts.  Simplifies the problem by stripping\n * any common prefix or suffix off the texts before diffing.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {Int} cursor_pos Expected edit position in text1 (optional)\n * @return {Array} Array of diff tuples.\n */\nfunction diff_main(text1, text2, cursor_pos) {\n  // Check for equality (speedup).\n  if (text1 == text2) {\n    if (text1) {\n      return [[DIFF_EQUAL, text1]];\n    }\n    return [];\n  }\n\n  // Check cursor_pos within bounds\n  if (cursor_pos < 0 || text1.length < cursor_pos) {\n    cursor_pos = null;\n  }\n\n  // Trim off common prefix (speedup).\n  var commonlength = diff_commonPrefix(text1, text2);\n  var commonprefix = text1.substring(0, commonlength);\n  text1 = text1.substring(commonlength);\n  text2 = text2.substring(commonlength);\n\n  // Trim off common suffix (speedup).\n  commonlength = diff_commonSuffix(text1, text2);\n  var commonsuffix = text1.substring(text1.length - commonlength);\n  text1 = text1.substring(0, text1.length - commonlength);\n  text2 = text2.substring(0, text2.length - commonlength);\n\n  // Compute the diff on the middle block.\n  var diffs = diff_compute_(text1, text2);\n\n  // Restore the prefix and suffix.\n  if (commonprefix) {\n    diffs.unshift([DIFF_EQUAL, commonprefix]);\n  }\n  if (commonsuffix) {\n    diffs.push([DIFF_EQUAL, commonsuffix]);\n  }\n  diff_cleanupMerge(diffs);\n  if (cursor_pos != null) {\n    diffs = fix_cursor(diffs, cursor_pos);\n  }\n  diffs = fix_emoji(diffs);\n  return diffs;\n};\n\n\n/**\n * Find the differences between two texts.  Assumes that the texts do not\n * have any common prefix or suffix.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_compute_(text1, text2) {\n  var diffs;\n\n  if (!text1) {\n    // Just add some text (speedup).\n    return [[DIFF_INSERT, text2]];\n  }\n\n  if (!text2) {\n    // Just delete some text (speedup).\n    return [[DIFF_DELETE, text1]];\n  }\n\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  var i = longtext.indexOf(shorttext);\n  if (i != -1) {\n    // Shorter text is inside the longer text (speedup).\n    diffs = [[DIFF_INSERT, longtext.substring(0, i)],\n             [DIFF_EQUAL, shorttext],\n             [DIFF_INSERT, longtext.substring(i + shorttext.length)]];\n    // Swap insertions for deletions if diff is reversed.\n    if (text1.length > text2.length) {\n      diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n    }\n    return diffs;\n  }\n\n  if (shorttext.length == 1) {\n    // Single character string.\n    // After the previous speedup, the character can't be an equality.\n    return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n  }\n\n  // Check to see if the problem can be split in two.\n  var hm = diff_halfMatch_(text1, text2);\n  if (hm) {\n    // A half-match was found, sort out the return data.\n    var text1_a = hm[0];\n    var text1_b = hm[1];\n    var text2_a = hm[2];\n    var text2_b = hm[3];\n    var mid_common = hm[4];\n    // Send both pairs off for separate processing.\n    var diffs_a = diff_main(text1_a, text2_a);\n    var diffs_b = diff_main(text1_b, text2_b);\n    // Merge the results.\n    return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n  }\n\n  return diff_bisect_(text1, text2);\n};\n\n\n/**\n * Find the 'middle snake' of a diff, split the problem in two\n * and return the recursively constructed diff.\n * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n * @private\n */\nfunction diff_bisect_(text1, text2) {\n  // Cache the text lengths to prevent multiple calls.\n  var text1_length = text1.length;\n  var text2_length = text2.length;\n  var max_d = Math.ceil((text1_length + text2_length) / 2);\n  var v_offset = max_d;\n  var v_length = 2 * max_d;\n  var v1 = new Array(v_length);\n  var v2 = new Array(v_length);\n  // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n  // integers and undefined.\n  for (var x = 0; x < v_length; x++) {\n    v1[x] = -1;\n    v2[x] = -1;\n  }\n  v1[v_offset + 1] = 0;\n  v2[v_offset + 1] = 0;\n  var delta = text1_length - text2_length;\n  // If the total number of characters is odd, then the front path will collide\n  // with the reverse path.\n  var front = (delta % 2 != 0);\n  // Offsets for start and end of k loop.\n  // Prevents mapping of space beyond the grid.\n  var k1start = 0;\n  var k1end = 0;\n  var k2start = 0;\n  var k2end = 0;\n  for (var d = 0; d < max_d; d++) {\n    // Walk the front path one step.\n    for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n      var k1_offset = v_offset + k1;\n      var x1;\n      if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n        x1 = v1[k1_offset + 1];\n      } else {\n        x1 = v1[k1_offset - 1] + 1;\n      }\n      var y1 = x1 - k1;\n      while (x1 < text1_length && y1 < text2_length &&\n             text1.charAt(x1) == text2.charAt(y1)) {\n        x1++;\n        y1++;\n      }\n      v1[k1_offset] = x1;\n      if (x1 > text1_length) {\n        // Ran off the right of the graph.\n        k1end += 2;\n      } else if (y1 > text2_length) {\n        // Ran off the bottom of the graph.\n        k1start += 2;\n      } else if (front) {\n        var k2_offset = v_offset + delta - k1;\n        if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {\n          // Mirror x2 onto top-left coordinate system.\n          var x2 = text1_length - v2[k2_offset];\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n\n    // Walk the reverse path one step.\n    for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n      var k2_offset = v_offset + k2;\n      var x2;\n      if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n        x2 = v2[k2_offset + 1];\n      } else {\n        x2 = v2[k2_offset - 1] + 1;\n      }\n      var y2 = x2 - k2;\n      while (x2 < text1_length && y2 < text2_length &&\n             text1.charAt(text1_length - x2 - 1) ==\n             text2.charAt(text2_length - y2 - 1)) {\n        x2++;\n        y2++;\n      }\n      v2[k2_offset] = x2;\n      if (x2 > text1_length) {\n        // Ran off the left of the graph.\n        k2end += 2;\n      } else if (y2 > text2_length) {\n        // Ran off the top of the graph.\n        k2start += 2;\n      } else if (!front) {\n        var k1_offset = v_offset + delta - k2;\n        if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n          var x1 = v1[k1_offset];\n          var y1 = v_offset + x1 - k1_offset;\n          // Mirror x2 onto top-left coordinate system.\n          x2 = text1_length - x2;\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n  }\n  // Diff took too long and hit the deadline or\n  // number of diffs equals number of characters, no commonality at all.\n  return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n};\n\n\n/**\n * Given the location of the 'middle snake', split the diff in two parts\n * and recurse.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {number} x Index of split point in text1.\n * @param {number} y Index of split point in text2.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_bisectSplit_(text1, text2, x, y) {\n  var text1a = text1.substring(0, x);\n  var text2a = text2.substring(0, y);\n  var text1b = text1.substring(x);\n  var text2b = text2.substring(y);\n\n  // Compute both diffs serially.\n  var diffs = diff_main(text1a, text2a);\n  var diffsb = diff_main(text1b, text2b);\n\n  return diffs.concat(diffsb);\n};\n\n\n/**\n * Determine the common prefix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the start of each\n *     string.\n */\nfunction diff_commonPrefix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerstart = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(pointerstart, pointermid) ==\n        text2.substring(pointerstart, pointermid)) {\n      pointermin = pointermid;\n      pointerstart = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Determine the common suffix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the end of each string.\n */\nfunction diff_commonSuffix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 ||\n      text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerend = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n        text2.substring(text2.length - pointermid, text2.length - pointerend)) {\n      pointermin = pointermid;\n      pointerend = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Do the two texts share a substring which is at least half the length of the\n * longer text?\n * This speedup can produce non-minimal diffs.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {Array.<string>} Five element Array, containing the prefix of\n *     text1, the suffix of text1, the prefix of text2, the suffix of\n *     text2 and the common middle.  Or null if there was no match.\n */\nfunction diff_halfMatch_(text1, text2) {\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n    return null;  // Pointless.\n  }\n\n  /**\n   * Does a substring of shorttext exist within longtext such that the substring\n   * is at least half the length of longtext?\n   * Closure, but does not reference any external variables.\n   * @param {string} longtext Longer string.\n   * @param {string} shorttext Shorter string.\n   * @param {number} i Start index of quarter length substring within longtext.\n   * @return {Array.<string>} Five element Array, containing the prefix of\n   *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n   *     of shorttext and the common middle.  Or null if there was no match.\n   * @private\n   */\n  function diff_halfMatchI_(longtext, shorttext, i) {\n    // Start with a 1/4 length substring at position i as a seed.\n    var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n    var j = -1;\n    var best_common = '';\n    var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;\n    while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n      var prefixLength = diff_commonPrefix(longtext.substring(i),\n                                           shorttext.substring(j));\n      var suffixLength = diff_commonSuffix(longtext.substring(0, i),\n                                           shorttext.substring(0, j));\n      if (best_common.length < suffixLength + prefixLength) {\n        best_common = shorttext.substring(j - suffixLength, j) +\n            shorttext.substring(j, j + prefixLength);\n        best_longtext_a = longtext.substring(0, i - suffixLength);\n        best_longtext_b = longtext.substring(i + prefixLength);\n        best_shorttext_a = shorttext.substring(0, j - suffixLength);\n        best_shorttext_b = shorttext.substring(j + prefixLength);\n      }\n    }\n    if (best_common.length * 2 >= longtext.length) {\n      return [best_longtext_a, best_longtext_b,\n              best_shorttext_a, best_shorttext_b, best_common];\n    } else {\n      return null;\n    }\n  }\n\n  // First check if the second quarter is the seed for a half-match.\n  var hm1 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 4));\n  // Check again based on the third quarter.\n  var hm2 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 2));\n  var hm;\n  if (!hm1 && !hm2) {\n    return null;\n  } else if (!hm2) {\n    hm = hm1;\n  } else if (!hm1) {\n    hm = hm2;\n  } else {\n    // Both matched.  Select the longest.\n    hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n  }\n\n  // A half-match was found, sort out the return data.\n  var text1_a, text1_b, text2_a, text2_b;\n  if (text1.length > text2.length) {\n    text1_a = hm[0];\n    text1_b = hm[1];\n    text2_a = hm[2];\n    text2_b = hm[3];\n  } else {\n    text2_a = hm[0];\n    text2_b = hm[1];\n    text1_a = hm[2];\n    text1_b = hm[3];\n  }\n  var mid_common = hm[4];\n  return [text1_a, text1_b, text2_a, text2_b, mid_common];\n};\n\n\n/**\n * Reorder and merge like edit sections.  Merge equalities.\n * Any edit section can move as long as it doesn't cross an equality.\n * @param {Array} diffs Array of diff tuples.\n */\nfunction diff_cleanupMerge(diffs) {\n  diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.\n  var pointer = 0;\n  var count_delete = 0;\n  var count_insert = 0;\n  var text_delete = '';\n  var text_insert = '';\n  var commonlength;\n  while (pointer < diffs.length) {\n    switch (diffs[pointer][0]) {\n      case DIFF_INSERT:\n        count_insert++;\n        text_insert += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_DELETE:\n        count_delete++;\n        text_delete += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_EQUAL:\n        // Upon reaching an equality, check for prior redundancies.\n        if (count_delete + count_insert > 1) {\n          if (count_delete !== 0 && count_insert !== 0) {\n            // Factor out any common prefixies.\n            commonlength = diff_commonPrefix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              if ((pointer - count_delete - count_insert) > 0 &&\n                  diffs[pointer - count_delete - count_insert - 1][0] ==\n                  DIFF_EQUAL) {\n                diffs[pointer - count_delete - count_insert - 1][1] +=\n                    text_insert.substring(0, commonlength);\n              } else {\n                diffs.splice(0, 0, [DIFF_EQUAL,\n                                    text_insert.substring(0, commonlength)]);\n                pointer++;\n              }\n              text_insert = text_insert.substring(commonlength);\n              text_delete = text_delete.substring(commonlength);\n            }\n            // Factor out any common suffixies.\n            commonlength = diff_commonSuffix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              diffs[pointer][1] = text_insert.substring(text_insert.length -\n                  commonlength) + diffs[pointer][1];\n              text_insert = text_insert.substring(0, text_insert.length -\n                  commonlength);\n              text_delete = text_delete.substring(0, text_delete.length -\n                  commonlength);\n            }\n          }\n          // Delete the offending records and add the merged ones.\n          if (count_delete === 0) {\n            diffs.splice(pointer - count_insert,\n                count_delete + count_insert, [DIFF_INSERT, text_insert]);\n          } else if (count_insert === 0) {\n            diffs.splice(pointer - count_delete,\n                count_delete + count_insert, [DIFF_DELETE, text_delete]);\n          } else {\n            diffs.splice(pointer - count_delete - count_insert,\n                count_delete + count_insert, [DIFF_DELETE, text_delete],\n                [DIFF_INSERT, text_insert]);\n          }\n          pointer = pointer - count_delete - count_insert +\n                    (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;\n        } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n          // Merge this equality with the previous one.\n          diffs[pointer - 1][1] += diffs[pointer][1];\n          diffs.splice(pointer, 1);\n        } else {\n          pointer++;\n        }\n        count_insert = 0;\n        count_delete = 0;\n        text_delete = '';\n        text_insert = '';\n        break;\n    }\n  }\n  if (diffs[diffs.length - 1][1] === '') {\n    diffs.pop();  // Remove the dummy entry at the end.\n  }\n\n  // Second pass: look for single edits surrounded on both sides by equalities\n  // which can be shifted sideways to eliminate an equality.\n  // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n  var changes = false;\n  pointer = 1;\n  // Intentionally ignore the first and last element (don't need checking).\n  while (pointer < diffs.length - 1) {\n    if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL) {\n      // This is a single edit surrounded by equalities.\n      if (diffs[pointer][1].substring(diffs[pointer][1].length -\n          diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {\n        // Shift the edit over the previous equality.\n        diffs[pointer][1] = diffs[pointer - 1][1] +\n            diffs[pointer][1].substring(0, diffs[pointer][1].length -\n                                        diffs[pointer - 1][1].length);\n        diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n        diffs.splice(pointer - 1, 1);\n        changes = true;\n      } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n          diffs[pointer + 1][1]) {\n        // Shift the edit over the next equality.\n        diffs[pointer - 1][1] += diffs[pointer + 1][1];\n        diffs[pointer][1] =\n            diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n            diffs[pointer + 1][1];\n        diffs.splice(pointer + 1, 1);\n        changes = true;\n      }\n    }\n    pointer++;\n  }\n  // If shifts were made, the diff needs reordering and another shift sweep.\n  if (changes) {\n    diff_cleanupMerge(diffs);\n  }\n};\n\n\nvar diff = diff_main;\ndiff.INSERT = DIFF_INSERT;\ndiff.DELETE = DIFF_DELETE;\ndiff.EQUAL = DIFF_EQUAL;\n\nmodule.exports = diff;\n\n/*\n * Modify a diff such that the cursor position points to the start of a change:\n * E.g.\n *   cursor_normalize_diff([[DIFF_EQUAL, 'abc']], 1)\n *     => [1, [[DIFF_EQUAL, 'a'], [DIFF_EQUAL, 'bc']]]\n *   cursor_normalize_diff([[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xyz']], 2)\n *     => [2, [[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xy'], [DIFF_DELETE, 'z']]]\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} A tuple [cursor location in the modified diff, modified diff]\n */\nfunction cursor_normalize_diff (diffs, cursor_pos) {\n  if (cursor_pos === 0) {\n    return [DIFF_EQUAL, diffs];\n  }\n  for (var current_pos = 0, i = 0; i < diffs.length; i++) {\n    var d = diffs[i];\n    if (d[0] === DIFF_DELETE || d[0] === DIFF_EQUAL) {\n      var next_pos = current_pos + d[1].length;\n      if (cursor_pos === next_pos) {\n        return [i + 1, diffs];\n      } else if (cursor_pos < next_pos) {\n        // copy to prevent side effects\n        diffs = diffs.slice();\n        // split d into two diff changes\n        var split_pos = cursor_pos - current_pos;\n        var d_left = [d[0], d[1].slice(0, split_pos)];\n        var d_right = [d[0], d[1].slice(split_pos)];\n        diffs.splice(i, 1, d_left, d_right);\n        return [i + 1, diffs];\n      } else {\n        current_pos = next_pos;\n      }\n    }\n  }\n  throw new Error('cursor_pos is out of bounds!')\n}\n\n/*\n * Modify a diff such that the edit position is \"shifted\" to the proposed edit location (cursor_position).\n *\n * Case 1)\n *   Check if a naive shift is possible:\n *     [0, X], [ 1, Y] -> [ 1, Y], [0, X]    (if X + Y === Y + X)\n *     [0, X], [-1, Y] -> [-1, Y], [0, X]    (if X + Y === Y + X) - holds same result\n * Case 2)\n *   Check if the following shifts are possible:\n *     [0, 'pre'], [ 1, 'prefix'] -> [ 1, 'pre'], [0, 'pre'], [ 1, 'fix']\n *     [0, 'pre'], [-1, 'prefix'] -> [-1, 'pre'], [0, 'pre'], [-1, 'fix']\n *         ^            ^\n *         d          d_next\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} Array of diff tuples\n */\nfunction fix_cursor (diffs, cursor_pos) {\n  var norm = cursor_normalize_diff(diffs, cursor_pos);\n  var ndiffs = norm[1];\n  var cursor_pointer = norm[0];\n  var d = ndiffs[cursor_pointer];\n  var d_next = ndiffs[cursor_pointer + 1];\n\n  if (d == null) {\n    // Text was deleted from end of original string,\n    // cursor is now out of bounds in new string\n    return diffs;\n  } else if (d[0] !== DIFF_EQUAL) {\n    // A modification happened at the cursor location.\n    // This is the expected outcome, so we can return the original diff.\n    return diffs;\n  } else {\n    if (d_next != null && d[1] + d_next[1] === d_next[1] + d[1]) {\n      // Case 1)\n      // It is possible to perform a naive shift\n      ndiffs.splice(cursor_pointer, 2, d_next, d)\n      return merge_tuples(ndiffs, cursor_pointer, 2)\n    } else if (d_next != null && d_next[1].indexOf(d[1]) === 0) {\n      // Case 2)\n      // d[1] is a prefix of d_next[1]\n      // We can assume that d_next[0] !== 0, since d[0] === 0\n      // Shift edit locations..\n      ndiffs.splice(cursor_pointer, 2, [d_next[0], d[1]], [0, d[1]]);\n      var suffix = d_next[1].slice(d[1].length);\n      if (suffix.length > 0) {\n        ndiffs.splice(cursor_pointer + 2, 0, [d_next[0], suffix]);\n      }\n      return merge_tuples(ndiffs, cursor_pointer, 3)\n    } else {\n      // Not possible to perform any modification\n      return diffs;\n    }\n  }\n}\n\n/*\n * Check diff did not split surrogate pairs.\n * Ex. [0, '\\uD83D'], [-1, '\\uDC36'], [1, '\\uDC2F'] -> [-1, '\\uD83D\\uDC36'], [1, '\\uD83D\\uDC2F']\n *     '\\uD83D\\uDC36' === '🐶', '\\uD83D\\uDC2F' === '🐯'\n *\n * @param {Array} diffs Array of diff tuples\n * @return {Array} Array of diff tuples\n */\nfunction fix_emoji (diffs) {\n  var compact = false;\n  var starts_with_pair_end = function(str) {\n    return str.charCodeAt(0) >= 0xDC00 && str.charCodeAt(0) <= 0xDFFF;\n  }\n  var ends_with_pair_start = function(str) {\n    return str.charCodeAt(str.length-1) >= 0xD800 && str.charCodeAt(str.length-1) <= 0xDBFF;\n  }\n  for (var i = 2; i < diffs.length; i += 1) {\n    if (diffs[i-2][0] === DIFF_EQUAL && ends_with_pair_start(diffs[i-2][1]) &&\n        diffs[i-1][0] === DIFF_DELETE && starts_with_pair_end(diffs[i-1][1]) &&\n        diffs[i][0] === DIFF_INSERT && starts_with_pair_end(diffs[i][1])) {\n      compact = true;\n\n      diffs[i-1][1] = diffs[i-2][1].slice(-1) + diffs[i-1][1];\n      diffs[i][1] = diffs[i-2][1].slice(-1) + diffs[i][1];\n\n      diffs[i-2][1] = diffs[i-2][1].slice(0, -1);\n    }\n  }\n  if (!compact) {\n    return diffs;\n  }\n  var fixed_diffs = [];\n  for (var i = 0; i < diffs.length; i += 1) {\n    if (diffs[i][1].length > 0) {\n      fixed_diffs.push(diffs[i]);\n    }\n  }\n  return fixed_diffs;\n}\n\n/*\n * Try to merge tuples with their neigbors in a given range.\n * E.g. [0, 'a'], [0, 'b'] -> [0, 'ab']\n *\n * @param {Array} diffs Array of diff tuples.\n * @param {Int} start Position of the first element to merge (diffs[start] is also merged with diffs[start - 1]).\n * @param {Int} length Number of consecutive elements to check.\n * @return {Array} Array of merged diff tuples.\n */\nfunction merge_tuples (diffs, start, length) {\n  // Check from (start-1) to (start+length).\n  for (var i = start + length - 1; i >= 0 && i >= start - 1; i--) {\n    if (i + 1 < diffs.length) {\n      var left_d = diffs[i];\n      var right_d = diffs[i+1];\n      if (left_d[0] === right_d[1]) {\n        diffs.splice(i, 2, [left_d[0], left_d[1] + right_d[1]]);\n      }\n    }\n  }\n  return diffs;\n}\n","export var createIsSameValueZero = function createIsSameValueZero() {\n  return (\n    /**\n     * @function isSameValueZero\n     *\n     * @description\n     * are the objects passed strictly equal or both NaN\n     *\n     * @param {*} objectA the object to compare against\n     * @param {*} objectB the object to test\n     * @returns {boolean} are the objects equal by the SameValueZero principle\n     */\n    function (objectA, objectB) {\n      return objectA === objectB || objectA !== objectA && objectB !== objectB;\n    }\n  );\n};\n\n/**\n * @function isReactElement\n *\n * @description\n * is the object passed a react element\n *\n * @param {any} object the object to test\n * @returns {boolean} is the object a react element\n */\nexport var isReactElement = function isReactElement(object) {\n  return !!(object.$$typeof && object._store);\n};\n\n/**\n * @function toPairs\n *\n * @param {Map|Set} iterable the iterable to convert to [key, value] pairs (entries)\n * @returns {{keys: Array<*>, values: Array<*>}} the [key, value] pairs\n */\nexport var toPairs = function toPairs(iterable) {\n  var pairs = { keys: new Array(iterable.size), values: new Array(iterable.size) };\n\n  var index = 0;\n\n  iterable.forEach(function (value, key) {\n    pairs.keys[index] = key;\n    pairs.values[index++] = value;\n  });\n\n  return pairs;\n};\n\n/**\n * @function areIterablesEqual\n *\n * @description\n * determine if the iterables are equivalent in value\n *\n * @param {Map|Set} objectA the object to test\n * @param {Map|Set} objectB the object to test against\n * @param {function} comparator the comparator to determine deep equality\n * @param {boolean} shouldCompareKeys should the keys be tested in the equality comparison\n * @returns {boolean} are the objects equal in value\n */\nexport var areIterablesEqual = function areIterablesEqual(objectA, objectB, comparator, shouldCompareKeys) {\n  if (objectA.size !== objectB.size) {\n    return false;\n  }\n\n  var pairsA = toPairs(objectA);\n  var pairsB = toPairs(objectB);\n\n  return shouldCompareKeys ? comparator(pairsA.keys, pairsB.keys) && comparator(pairsA.values, pairsB.values) : comparator(pairsA.values, pairsB.values);\n};","// utils\nimport { areIterablesEqual, createIsSameValueZero, isReactElement } from './utils';\n\nvar HAS_MAP_SUPPORT = typeof Map === 'function';\nvar HAS_SET_SUPPORT = typeof Set === 'function';\n\nvar isSameValueZero = createIsSameValueZero();\n\nvar createComparator = function createComparator(createIsEqual) {\n  var isEqual = typeof createIsEqual === 'function' ? createIsEqual(comparator) : comparator; // eslint-disable-line\n\n  /**\n   * @function comparator\n   *\n   * @description\n   * compare the value of the two objects and return true if they are equivalent in values\n   *\n   * @param {*} objectA the object to test against\n   * @param {*} objectB the object to test\n   * @returns {boolean} are objectA and objectB equivalent in value\n   */\n  function comparator(objectA, objectB) {\n    if (isSameValueZero(objectA, objectB)) {\n      return true;\n    }\n\n    var typeOfA = typeof objectA;\n\n    if (typeOfA !== typeof objectB) {\n      return false;\n    }\n\n    if (typeOfA === 'object' && objectA && objectB) {\n      var arrayA = Array.isArray(objectA);\n      var arrayB = Array.isArray(objectB);\n\n      var index = void 0;\n\n      if (arrayA || arrayB) {\n        if (arrayA !== arrayB || objectA.length !== objectB.length) {\n          return false;\n        }\n\n        for (index = 0; index < objectA.length; index++) {\n          if (!isEqual(objectA[index], objectB[index])) {\n            return false;\n          }\n        }\n\n        return true;\n      }\n\n      var dateA = objectA instanceof Date;\n      var dateB = objectB instanceof Date;\n\n      if (dateA || dateB) {\n        return dateA === dateB && isSameValueZero(objectA.getTime(), objectB.getTime());\n      }\n\n      var regexpA = objectA instanceof RegExp;\n      var regexpB = objectB instanceof RegExp;\n\n      if (regexpA || regexpB) {\n        return regexpA === regexpB && objectA.source === objectB.source && objectA.global === objectB.global && objectA.ignoreCase === objectB.ignoreCase && objectA.multiline === objectB.multiline;\n      }\n\n      if (HAS_MAP_SUPPORT) {\n        var mapA = objectA instanceof Map;\n        var mapB = objectB instanceof Map;\n\n        if (mapA || mapB) {\n          return mapA === mapB && areIterablesEqual(objectA, objectB, comparator, true);\n        }\n      }\n\n      if (HAS_SET_SUPPORT) {\n        var setA = objectA instanceof Set;\n        var setB = objectB instanceof Set;\n\n        if (setA || setB) {\n          return setA === setB && areIterablesEqual(objectA, objectB, comparator, false);\n        }\n      }\n\n      var keysA = Object.keys(objectA);\n\n      if (keysA.length !== Object.keys(objectB).length) {\n        return false;\n      }\n\n      var key = void 0;\n\n      for (index = 0; index < keysA.length; index++) {\n        key = keysA[index];\n\n        if (!Object.prototype.hasOwnProperty.call(objectB, key)) {\n          return false;\n        }\n\n        // if a react element, ignore the \"_owner\" key because its not necessary for equality comparisons\n        if (key === '_owner' && isReactElement(objectA) && isReactElement(objectB)) {\n          continue;\n        }\n\n        if (!isEqual(objectA[key], objectB[key])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  return comparator;\n};\n\nexport default createComparator;","// comparator\nimport createCustomEqual from './comparator';\n\n// utils\nimport { createIsSameValueZero } from './utils';\n\nexport { createCustomEqual };\n\nexport var deepEqual = createCustomEqual();\nexport var sameValueZeroEqual = createIsSameValueZero();\nexport var shallowEqual = createCustomEqual(createIsSameValueZero);\n\nexport default {\n  createCustom: createCustomEqual,\n  deep: deepEqual,\n  sameValueZero: sameValueZeroEqual,\n  shallow: shallowEqual\n};","import diff from 'fast-diff';\nimport { deepEqual } from 'fast-equals';\n\nconst NULL_CHARACTER = String.fromCharCode(0);  // Placeholder char for embed in diff()\n\nexport default class Delta {\n\n  constructor(ops = []) {\n    this.ops = ops;\n  }\n\n  /**\n   * Appends an insert operation. Returns this for chainability.\n   *\n   * @param {String|Object} text Represents text or embed to insert\n   * @param {Object} attributes Optional attributes to apply\n   */\n  insert(text, attributes) {\n    var newOp = {};\n    if (text.length === 0) return this;\n    newOp.insert = text;\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Appends a delete operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to delete\n   */\n  delete(length) {\n    if (length <= 0) return this;\n    return this._push({ delete: length });\n  }\n\n  /**\n   * Appends a retain operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to retain\n   * @param {Object} attributes Optional attributes to apply\n   * @returns {Delta} This delta\n   */\n  retain(length, attributes) {\n    if (length <= 0) return this;\n    var newOp = { retain: length };\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Freezes delta from future modifications. Returns this for chainability.\n   *\n   * @returns {Delta} This delta\n   */\n  freeze() {\n    this._push = () => this;\n    return this;\n  }\n\n  /**\n   * Adds a new operation. Returns this for chainability.\n   *\n   * @param {Object} newOp A new operation\n   * @returns {Delta} This delta\n   */\n  _push(newOp) {\n    var index = this.ops.length;\n    var lastOp = this.ops[index - 1];\n    if (typeof lastOp === 'object') {\n      if (typeof newOp.delete === 'number' && typeof lastOp.delete === 'number') {\n        this.ops[index - 1] = { delete: lastOp.delete + newOp.delete };\n        return this;\n      }\n      // Since it does not matter if we insert before or after deleting at the same index,\n      // always prefer to insert first\n      if (typeof lastOp.delete === 'number' && newOp.insert != null) {\n        index -= 1;\n        lastOp = this.ops[index - 1];\n        if (typeof lastOp !== 'object') {\n          this.ops.unshift(newOp);\n          return this;\n        }\n      }\n      if (deepEqual(newOp.attributes, lastOp.attributes)) {\n        if (typeof newOp.insert === 'string' && typeof lastOp.insert === 'string') {\n          this.ops[index - 1] = { insert: lastOp.insert + newOp.insert };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        } else if (typeof newOp.retain === 'number' && typeof lastOp.retain === 'number') {\n          this.ops[index - 1] = { retain: lastOp.retain + newOp.retain };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        }\n      }\n    }\n    if (index === this.ops.length) {\n      this.ops.push(newOp);\n    } else {\n      this.ops.splice(index, 0, newOp);\n    }\n    return this;\n  }\n\n  /**\n   * Chops off trailing retain instructions to make the delta concise.\n   *\n   * @returns {Delta} This delta\n   */\n  chop() {\n    var lastOp = this.ops[this.ops.length - 1];\n    if (lastOp && lastOp.retain && !lastOp.attributes) {\n      this.ops.pop();\n    }\n    return this;\n  }\n\n  /**\n   * Returns an iterator to iterate over the operations of this delta.\n   *\n   * @returns {Iterator} An operation iterator with methods hasNext, next, peek, peekLength, & peekType\n   */\n  iterator() {\n    return new Iterator(this.ops);\n  }\n\n  /**\n   * Returns an array of operations that passes a given function.\n   *\n   * @param {Function} predicate Function to test each operation against. Return true to keep the operation, false\n   *                             otherwise\n   * @returns {Array} Filtered resulting array\n   */\n  filter(predicate) {\n    return this.ops.filter(predicate);\n  }\n\n  /**\n   * Iterates through operations, calling the provided function for each operation.\n   *\n   * @param {Function} predicate Function to call during iteration, passing in the current operation\n   */\n  forEach(predicate) {\n    this.ops.forEach(predicate);\n  }\n\n  /**\n   * Returns a new array with the results of calling provided function on each operation.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning an element of the new\n   *                             array to be returned\n   * @returns {Array} A new array with each element being the result of the given function\n   */\n  map(predicate) {\n    return this.ops.map(predicate);\n  }\n\n  /**\n   * Create an array of two arrays, the first with operations that pass the given function, the other that failed.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning whether that operation\n   *                             passed\n   * @returns {Array} A new array of two Arrays, the first with passed operations, the other with failed operations\n   */\n  partition(predicate) {\n    var passed = [], failed = [];\n    this.forEach(op => {\n      var target = predicate(op) ? passed : failed;\n      target.push(op);\n    });\n    return [passed, failed];\n  }\n\n  /**\n   * Applies given function against an accumulator and each operation to reduce to a single value.\n   *\n   * @param {Function} predicate Function to call per iteration, returning an accumulated value\n   * @param {*} initial Initial value to pass to first call to predicate\n   * @returns {*} The accumulated value\n   */\n  reduce(predicate, initial) {\n    return this.ops.reduce(predicate, initial);\n  }\n\n  changeLength() {\n    return this.reduce((length, entry) => {\n      if (entry.insert) {\n        return length + getOpLength(entry);\n      } else if (entry.delete) {\n        return length - entry.delete;\n      }\n      return length;\n    }, 0);\n  }\n\n  /**\n   * Returns length of a Delta, which is the sum of the lengths of its operations.\n   *\n   * @returns {Number} The length of this delta\n   */\n  length() {\n    return this.reduce((length, entry) => {\n      return length + getOpLength(entry);\n    }, 0);\n  }\n\n  /**\n   * Returns copy of delta with subset of operations.\n   *\n   * @param {Number} start Start index of subset, defaults to 0\n   * @param {Number} end End index of subset, defaults to rest of operations\n   * @returns {Array} An array slice of the operations\n   */\n  slice(start = 0, end) {\n    if (typeof end !== 'number') end = Infinity;\n    var ops = [];\n    var iter = this.iterator();\n    var index = 0;\n    while (index < end && iter.hasNext()) {\n      var nextOp;\n      if (index < start) {\n        nextOp = iter.next(start - index);\n      } else {\n        nextOp = iter.next(end - index);\n        ops.push(nextOp);\n      }\n      index += getOpLength(nextOp);\n    }\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns a Delta that is equivalent to applying the operations of own Delta, followed by another Delta.\n   *\n   * @param {Delta} other Delta to compose\n   */\n  compose(other) {\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else if (thisIter.peekType() === 'delete') {\n        delta._push(thisIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (typeof otherOp.retain === 'number') {\n          var newOp = {};\n          if (typeof thisOp.retain === 'number') {\n            newOp.retain = length;\n          } else {\n            newOp.insert = thisOp.insert;\n          }\n          // Preserve null when composing with a retain, otherwise remove it for inserts\n          var attributes = composeAttributes(thisOp.attributes, otherOp.attributes, typeof thisOp.retain === 'number');\n          if (attributes) newOp.attributes = attributes;\n          delta._push(newOp);\n        // Other op should be delete, we could be an insert or retain\n        // Insert + delete cancels out\n        } else if (typeof otherOp.delete === 'number' && typeof thisOp.retain === 'number') {\n          delta._push(otherOp);\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Returns a new Delta representing the concatenation of this and another document Delta's operations.\n   *\n   * @param {Delta} other Document Delta to concatenate\n   * @returns {Delta} Concatenated document Delta\n   */\n  concat(other) {\n    var delta = new Delta(this.ops.slice());\n    if (other.ops.length > 0) {\n      delta._push(other.ops[0]);\n      delta.ops = delta.ops.concat(other.ops.slice(1));\n    }\n    return delta;\n  }\n\n  /**\n   * Returns a Delta representing the difference between two documents. Optionally, accepts a suggested index where\n   * change took place, often representing a cursor position before change.\n   *\n   * @param {Delta} other Document Delta to diff against\n   * @param {Number} index Suggested index where change took place\n   * @returns {Delta} Difference between the two documents\n   */\n  diff(other, index) {\n    if (this.ops === other.ops) {\n      return new Delta();\n    }\n    var strings = [this, other].map((delta) => {\n      return delta.map((op) => {\n        if (op.insert != null) {\n          return typeof op.insert === 'string' ? op.insert : NULL_CHARACTER;\n        }\n        var prep = (delta === other) ? 'on' : 'with';\n        throw new Error('diff() called ' + prep + ' non-document');\n      }).join('');\n    });\n    var delta = new Delta();\n    var diffResult = diff(strings[0], strings[1], index);\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    diffResult.forEach((component) => {\n      var length = component[1].length;\n      while (length > 0) {\n        var opLength = 0;\n        switch (component[0]) {\n          case diff.INSERT:\n            opLength = Math.min(otherIter.peekLength(), length);\n            delta._push(otherIter.next(opLength));\n            break;\n          case diff.DELETE:\n            opLength = Math.min(length, thisIter.peekLength());\n            thisIter.next(opLength);\n            delta.delete(opLength);\n            break;\n          case diff.EQUAL:\n            opLength = Math.min(thisIter.peekLength(), otherIter.peekLength(), length);\n            var thisOp = thisIter.next(opLength);\n            var otherOp = otherIter.next(opLength);\n            if (deepEqual(thisOp.insert, otherOp.insert)) {\n              delta.retain(opLength, diffAttributes(thisOp.attributes, otherOp.attributes));\n            } else {\n              delta._push(otherOp).delete(opLength);\n            }\n            break;\n        }\n        length -= opLength;\n      }\n    });\n    return delta.chop();\n  }\n\n  /**\n   * Iterates through document Delta, calling a given function with a Delta and attributes object, representing the line\n   * segment.\n   *\n   * @param {Function} predicate Function to call on each line group\n   * @param {String} newline Newline character, defaults to \\n\n   */\n  eachLine(predicate, newline = '\\n') {\n    var iter = this.iterator();\n    var ops = new Delta();\n    var index = 0;\n    var lineStart = 0;\n    var currentIndex = 0;\n\n    while (iter.hasNext()) {\n      if (iter.peekType() !== 'insert') return;\n\n      var op = iter.peek();\n      var nextLength = iter.peekLength();\n      var start = getOpLength(op) - nextLength;\n      var newlineIndex = typeof op.insert === 'string' ? op.insert.indexOf(newline, start) - start : -1;\n\n      if (newlineIndex < 0) {\n        currentIndex += nextLength;\n        ops._push(iter.next());\n      } else if (newlineIndex > 0) {\n        currentIndex += newlineIndex;\n        ops._push(iter.next(newlineIndex));\n      } else {\n        currentIndex += 1;\n        var attributes = iter.next(1).attributes || {};\n        var line = { ops, attributes, start: lineStart, end: currentIndex, index: index };\n        if (predicate(line, index) === false) {\n          return;\n        }\n        index += 1;\n        lineStart = currentIndex;\n        ops = new Delta();\n      }\n    }\n    if (ops.length() > 0) {\n      var line = { ops, attributes: {}, start: lineStart, end: currentIndex, index };\n      predicate(line, index);\n    }\n  }\n\n  // Extends Delta, get the lines from `from` to `to`.\n  getLines(from = 0, to = Infinity, newline) {\n    const lines = [];\n    this.eachLine(line => {\n      if (line.start > to || (line.start === to && from !== to)) return false;\n      if (line.end > from) {\n        lines.push(line);\n      }\n    }, newline);\n    return lines;\n  }\n\n  // Extends Delta, get the line at `at`.\n  getLine(at, newline) {\n    return this.getLines(at, at, newline)[0];\n  }\n\n  // Extends Delta, get the ops from `from` to `to`.\n  getOps(from, to) {\n    let start = 0;\n    const ops = [];\n    this.ops.some(op => {\n      if (start >= to) return true;\n      const end = start + getOpLength(op);\n      if (end > from || (from === to && end === to)) {\n        ops.push({ op, start, end });\n      }\n      start = end;\n    });\n    return ops;\n  }\n\n  // Extends Delta, get the op at `at`.\n  getOp(at) {\n    return this.getOps(at, at)[0];\n  }\n\n  /**\n   * Transform given Delta against own operations. Used as an alias for transformPosition when called with a number.\n   *\n   * @param {Delta} other Delta to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Delta} Transformed Delta\n   */\n  transform(other, priority = false) {\n    if (typeof other === 'number') {\n      return this.transformPosition(other, priority);\n    }\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (thisIter.peekType() === 'insert' && (priority || otherIter.peekType() !== 'insert')) {\n        delta.retain(getOpLength(thisIter.next()));\n      } else if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (thisOp.delete) {\n          // Our delete either makes their delete redundant or removes their retain\n          continue;\n        } else if (otherOp.delete) {\n          delta._push(otherOp);\n        } else {\n          // We retain either their retain or insert\n          delta.retain(length, transformAttributes(thisOp.attributes, otherOp.attributes, priority));\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Transform an index against the delta. Useful for representing cursor/selection positions.\n   *\n   * @param {Number} index Index to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Number} Transformed index\n   */\n  transformPosition(index, priority = false) {\n    var thisIter = this.iterator();\n    var offset = 0;\n    while (thisIter.hasNext() && offset <= index) {\n      var length = thisIter.peekLength();\n      var nextType = thisIter.peekType();\n      thisIter.next();\n      if (nextType === 'delete') {\n        index -= Math.min(length, index - offset);\n        continue;\n      } else if (nextType === 'insert' && (offset < index || !priority)) {\n        index += length;\n      }\n      offset += length;\n    }\n    return index;\n  }\n\n}\n\n\n/**\n * Create an attributes object that is equivalent to applying the attributes of the target followed by the source.\n *\n * @param {Object} target Target attributes object which will have the source applied to\n * @param {Object} source Source attributes object being applied to the target\n * @param {Boolean} keepNull Whether to keep null values from source\n * @returns {Object} A new attributes object (or undefined if empty) with both\n */\nexport function composeAttributes(target = {}, source = {}, keepNull) {\n  var attributes = { ...target, ...source };\n\n  if (!keepNull) Object.keys(attributes).forEach(key => {\n    if (attributes[key] == null) delete attributes[key];\n  });\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Finds the difference between two attributes objects. Returns the source attributes that are different from the\n * target attributes.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @returns {Object} The difference between the two attribute objects or undefined if there is none\n */\nexport function diffAttributes(target = {}, source = {}) {\n  var attributes = Object.keys(target).concat(Object.keys(source)).reduce((attributes, key) => {\n    if (!deepEqual(target[key], source[key])) {\n      attributes[key] = source[key] === undefined ? null : source[key];\n    }\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Transforms the attributes of source over target (or the other way around if priority is set). Will return an\n * attributes object which has all the values from source if priority if false or will have the values from source that\n * are set on target.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @param {Boolean} priority If target has priority over source\n */\nexport function transformAttributes(target, source, priority) {\n  if (typeof target !== 'object') return source;\n  if (typeof source !== 'object') return undefined;\n  if (!priority) return source;  // b simply overwrites us without priority\n\n  var attributes = Object.keys(source).reduce((attributes, key) => {\n    if (target[key] === undefined) attributes[key] = source[key];  // null is a valid value\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Determines the length of a Delta operation.\n *\n * @param {Object} op An operation entry from a Delta object\n * @returns {Number} The length of the op\n */\nexport function getOpLength(op) {\n  if (typeof op.delete === 'number') {\n    return op.delete;\n  } else if (typeof op.retain === 'number') {\n    return op.retain;\n  } else {\n    return typeof op.insert === 'string' ? op.insert.length : 1;\n  }\n}\n\n/**\n * An iterator to handle iterating over a list of Delta operations efficiently.\n */\nexport class Iterator {\n\n  constructor(ops) {\n    this.ops = ops;\n    this.index = 0;\n    this.offset = 0;\n  }\n\n  /**\n   * Determine if there will be another operation returned by `next`.\n   *\n   * @returns {Boolean} Whether there are more operations to iterate over\n   */\n  hasNext() {\n    return this.peekLength() < Infinity;\n  }\n\n  /**\n   * Get the next operation, optionally limited/sliced by length. If an operation is sliced by length, the next call to\n   * `next` will return more of that operation until it is returned in full.\n   *\n   * @param {Number} length Optionally limit the returned operation by length, slicing it down as needed\n   */\n  next(length = Infinity) {\n    var nextOp = this.ops[this.index];\n    if (!nextOp) return { retain: Infinity };\n\n    var offset = this.offset;\n    var opLength = getOpLength(nextOp);\n\n    // Update index and offset\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n\n    if (typeof nextOp.delete === 'number') {\n      return { delete: length };\n    } else {\n      var retOp = {};\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n      return retOp;\n    }\n  }\n\n  /**\n   * Return the next entry.\n   *\n   * @returns {Object} The next entry in the ops array.\n   */\n  peek() {\n    return this.ops[this.index];\n  }\n\n  /**\n   * Check the length of the next entry.\n   *\n   * @returns {Number} The length of the next entry or Infinity if there is no next entry\n   */\n  peekLength() {\n    if (this.ops[this.index]) {\n      // Should never return 0 if our index is being managed correctly\n      return getOpLength(this.ops[this.index]) - this.offset;\n    } else {\n      return Infinity;\n    }\n  }\n\n  /**\n   * Check the type of the next entry, delete, retain, or insert.\n   *\n   * @returns {String} The type of the next entry\n   */\n  peekType() {\n    if (this.ops[this.index]) {\n      if (typeof this.ops[this.index].delete === 'number') {\n        return 'delete';\n      } else if (typeof this.ops[this.index].retain === 'number') {\n        return 'retain';\n      } else {\n        return 'insert';\n      }\n    }\n    return 'retain';\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport { shallowEqual, deepEqual } from 'fast-equals';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst empty = {};\n\n/**\n * Event for text changes, called before the change has occurred. If a listener returns false the change will be\n * canceled and not committed.\n *\n * @event Editor#text-changing\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for text changes, called after the change has occurred.\n *\n * @event Editor#text-change\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for selection changes. If part of a text change the `change`, `content`, and `oldContent` properties will be\n * set. Otherwise they will not be set.\n *\n * @event Editor#selection-change\n * @type  {Object}\n * @property {Delta} change       [ Optional ] The change which is being applied to the content\n * @property {Delta} content      [ Optional ] The new content after the change\n * @property {Delta} oldContent   [ Optional ] The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * A Typewriter Editor handles the logic for selection and editing of contents. It has no dependency on browser APIs\n * and can be used in Node.js as easily as the browser. It has no logic to limit formatting (i.e. it does not disallow\n * using bold, headers, links, or FOOBAR), that will need to be limited outside of the editor itself.\n *\n * @fires Editor#text-changing\n * @fires Editor#text-change\n * @fires Editor#selection-change\n *\n * @readonly @property {Delta}  contents      The data model for the text editor\n * @readonly @property {Number} length        The length of the contents\n * @readonly @property {String} text          The text of the contents\n * @readonly @property {Array}  selection     The current editor selection, a tuple of `[ from, to ]` or `null`\n * @readonly @property {Object} activeFormats The currently active formats (formats that will apply on the next insert)\n */\nexport default class Editor extends EventDispatcher {\n\n  /**\n   * Create a new Typewriter editor.\n   *\n   * @param {Object} options Options for this editor include initial `contents` and `modules`:\n   * @param {Delta}  options.contents The initial contents of this editor\n   * @param {Array}  options.modules  An array of functions which will be executed with the editor being passed as an\n   *                                  argument.\n   */\n  constructor(options = {}) {\n    super();\n    this.contents = null;\n    this.length = 0;\n    this.selection = null;\n    this.activeFormats = empty;\n    setContents(this, options.contents || this.delta().insert('\\n'));\n    this.modules = {};\n    if (options.modules) Object.keys(options.modules).forEach(key => this.modules[key] = options.modules[key](this));\n  }\n\n  /**\n   * Convenience method for creating a new delta (allows other modules to not need to require Delta). Used for creating\n   * change deltas for updating the contents.\n   *\n   * @param {Array} ops [Optional] The initial ops for the delta\n   * @returns {Delta}   A new Delta object\n   */\n  delta(ops) {\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns the contents or a slice of them.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {Delta}     The contents of this editor\n   */\n  getContents(from = 0, to = this.length) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.contents.slice(from, to);\n  }\n\n  /**\n   * Returns the text for the editor or a slice of it.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor\n   */\n  getText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .filter(op => typeof op.insert === 'string')\n      .map(op => op.insert)\n      .join('');\n  }\n\n  /**\n   * Returns the text for the editor with spaces in place of embeds. This can be used to determine the index of given\n   * words or lines of text within the contents.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor with embed spaces\n   */\n  getExactText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .map(op => typeof op.insert === 'string' ? op.insert : ' ')\n      .join('');\n  }\n\n  /**\n   * Set the selection to a new location (or null for no selection). Will return false if the new selection is the same\n   * as the old selection. Dispatches \"selection-change\" once the selection is changed. This \"selection-change\" event\n   * won't have { contents, oldContnts, change } in it since the selection is changing without any content updates.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Boolean}        Whether the selection changed or not\n   */\n  setSelection(from, to, source = SOURCE_USER) {\n    const oldSelection = this.selection;\n    let selection;\n\n    if (from === null) {\n      selection = null;\n      if (typeof to === 'string') source = to;\n    } else {\n      [from, to, source ] = this._normalizeSelection(from, to, source);\n      selection = [ from, to ].map(i => Math.min(i, this.length - 1));\n    }\n\n    if (shallowEqual(oldSelection, selection)) return false;\n\n    // Reset the active formats when selection changes (do this before setting selection)\n    this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n    this.selection = selection;\n    const event = { selection, oldSelection, source };\n\n    if (source !== SOURCE_SILENT) this.fire('selection-change', event);\n    this.fire('editor-change', event);\n    return true;\n  }\n\n  /**\n   * The method that all other methods use to update the contents (even setContents & setText). This method will\n   * dispatch the event \"text-changing\". If a listener returns `false` then the change will be canceled and null will\n   * be returned. Otherwise, the change will be successful and if the `source` is not \"silent\" a \"text-change\" event\n   * will be fired with an event object containing `{ contents, oldContents, selection, oldSelection, source }`. If the\n   * selection has changed as part of this update a \"selection-change\" event will also be fired with the same event\n   * object.\n   *\n   * @param {Delta} change    A delta change to the document\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  updateContents(change, source = SOURCE_API, selection) {\n    if (!change.chop().ops.length) return null;\n\n    const oldContents = this.contents;\n    const contents = normalizeContents(oldContents.compose(change));\n    const length = contents.length();\n    const oldSelection = this.selection;\n    if (!selection) selection = oldSelection ? oldSelection.map(i => change.transform(i)) : oldSelection;\n    selection = selection && this.getSelectedRange(selection, length - 1);\n\n    const changeEvent = { contents, oldContents, change, selection, oldSelection, source };\n    const selectionChanged = !shallowEqual(oldSelection, selection);\n\n    if (!this.fire('text-changing', changeEvent)) return null;\n\n    setContents(this, contents);\n\n    if (selection) {\n      // Reset the active formats when selection changes (do this before setting selection)\n      this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n      this.selection = selection;\n    }\n\n    if (source !== SOURCE_SILENT) {\n      this.fire('text-change', changeEvent);\n      if (selectionChanged) this.fire('selection-change', changeEvent);\n    }\n    this.fire('editor-change', changeEvent);\n    return change;\n  }\n\n  /**\n   * Sets the entire contents of the editor. This will calculate the difference between the old content and the new and\n   * only apply the difference, if any.\n   *\n   * @param {Delta} newContents The contents of the editor, as a delta object\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  setContents(newContents, source, selection) {\n    const change = this.contents.diff(normalizeContents(newContents));\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Sets the text content of the editor, removing existing contents and formatting.\n   *\n   * @param {String} text     Set the contents of this editor as text\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  setText(text, source, selection) {\n    return this.setContents(this.delta().insert(text + '\\n'), source, selection);\n  }\n\n  /**\n   * Inserts text into the content of the editor, removing text between from and to if provided. If `text` is a newline\n   * (\"\\n\") then the formats will apply to the line, otherwise they will apply to the text only (even if there are\n   * newlines in the text).\n   *\n   * @param {Number} from      Insert the text at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} text      The text to insert into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertText(from, to, text, formats, source, selection) {\n    [ from, to, text, formats, source, selection ] =\n      this._normalizeRange(from, to, text, formats, source, selection);\n\n    // If we are not inserting a newline, make sure from and to are within the selectable range\n    if (text !== '\\n') [ from, to ] = this.getSelectedRange([ from, to ]);\n\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (selection == null && this.selection !== null) selection = from + text.length;\n    let change = this.delta().retain(from).delete(to - from);\n\n    if (text === '\\n') {\n      change.insert('\\n', formats || this.getLineFormat(from));\n    } else {\n      const lineFormat = text.indexOf('\\n') === -1 ? null : this.getLineFormat(from);\n      const textFormat = formats || this.getTextFormat(from);\n      text.split('\\n').forEach((line, i) => {\n        if (i) change.insert('\\n', lineFormat);\n        line.length && change.insert(line, textFormat);\n      });\n    }\n\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Inserts an embed into the content of the editor, removing text between from and to if provided.\n   *\n   * @param {Number} from      Insert the embed at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} embed     Insert the text into the editor's contents\n   * @param {mixed}  value     Insert the text into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertEmbed(from, to, embed, value, formats, source, selection) {\n    [ from, to, embed, value, source, selection ] =\n      this._normalizeRange(from, to, embed, value, source, selection);\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (from >= this.length) from = this.length - 1;\n    if (to >= this.length) to = this.length - 1;\n    if (selection == null && this.selection !== null) selection = from + 1;\n    const textFormat = formats || this.getTextFormat(from);\n    let change = this.delta().retain(from).delete(to - from).insert({ [embed]: value }, textFormat);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Deletes text from `from` to `to`.\n   *\n   * @param {Number} from      Insert the text as this index, can also be a range Array tuple, default 0\n   * @param {Number} to        Will delete the text between `from` and `to`\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  deleteText(from, to, source, selection) {\n    [ from, to, source, selection ] = this._normalizeRange(from, to, source, selection);\n    if (from === to) return null;\n    if (selection == null && this.selection !== null) selection = from;\n    let change = this.delta().retain(from).delete(to - from);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Get the line formats for the line that `from` is in to the line that `to` is in. Returns only the common formats\n   * between all the lines. If `from` equals `to` (or `to` is not provided) the formats will be all of those for the\n   * line `from` is on. If two lines are touched and they have different formats, an empty object will be returned.\n   *\n   * @param {Number} from Getting line formats starting at `from`\n   * @param {Number} to   Getting line formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines which intersect from and to\n   */\n  getLineFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!line.attributes) formats = {};\n      else if (!formats) formats = { ...line.attributes };\n      else formats = combineFormats(formats, line.attributes);\n    });\n\n    return formats;\n  }\n\n  /**\n   * Get the text formats for all the text from `from` to `to`. Returns only the common formats between the two indexes.\n   * Will also return the `activeFormats`. Active formats are those which are toggled on when the selection is collapsed\n   * (from and to are equal) indicating inserted text should use (or not use) those formats.\n   *\n   * @param {Number} from Getting text formats starting at `from`\n   * @param {Number} to   Getting text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the text\n   */\n  getTextFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    // optimize for current selection\n    const seleciton = this.selection;\n    if (from === to && shallowEqual(this.selection, [ from, to ])) {\n      return this.activeFormats;\n    }\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      if (/^\\n+$/.test(op.insert)) return;\n      if (!op.attributes) formats = {};\n      else if (!formats) formats = { ...op.attributes };\n      else formats = combineFormats(formats, op.attributes);\n    });\n\n    if (!formats) formats = {};\n\n    return formats;\n  }\n\n  /**\n   * Get the text and line formats for all the lines and text from `from` to `to`.\n   *\n   * @param {Number} from Getting line and text formats starting at `from`\n   * @param {Number} to   Getting line and text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines and text which intersect from and to\n   */\n  getFormat(from, to) {\n    return { ...this.getTextFormat(from, to), ...this.getLineFormat(from, to) };\n  }\n\n  /**\n   * Formats the lines intersected by `from` and `to` with the given line formats. To remove an existing format pass in\n   * `null` or `false` to turn it off (e.g. `{ blockquote: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatLine(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    const change = this.delta();\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      // Clear out old formats on the line\n      Object.keys(line.attributes).forEach(name => !formats[name] && (formats[name] = null));\n      change.retain(1, formats);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Adds additional attributes or classes to the lines intersected by `from` and `to`. Markups are easy to nest to add\n   * additional attributes/classes, but you cannot do that with lines/blocks.\n   * Setting a class to false will remove a previous decoration, but it will not remove a class which is part of the\n   * block definition. This method is a cross-over with HTML view and should be used sparingly.\n   *\n   * Example:\n   * ```js\n   * editor.decorateLine(0, {\n   *   attributes: { 'data-placeholder': 'Enter Text' },\n   *   classes: { active: true, empty: true }\n   * });\n   * // <p data-placeholder=\"Enter Text\" class=\"active empty\">\n   * ```\n   *\n   * @param {Number} from        The starting index\n   * @param {Number} to          The ending index\n   * @param {String} decorations The attributes/classes for the line.\n   * @param {String} source      The source of the change, user, api, or silent\n   * @returns {Delta}            Returns the change when successful, or null if not\n   */\n  decorateLine(from, to, decorations, source) {\n    [ from, to, decorations, source ] = this._normalizeRange(from, to, decorations, source);\n    const change = this.delta();\n\n    if (decorations.attributes) {\n      Object.keys(decorations.attributes).forEach(name => {\n        if (decorations.attributes[name] === '') decorations.attributes[name] = true;\n      });\n    }\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      let { attributes, classes } = decorations;\n\n      // Merge with any existing formats on the line\n      if (attributes) {\n        if (line.attributes.attributes) {\n          decorations = { ...decorations, attributes: { ...line.attributes.attributes, ...attributes }};\n        }\n\n        Object.keys(attributes).forEach(name => {\n          const value = attributes[name];\n          if (value == null || value === false) delete decorations.attributes[name];\n        });\n\n        if (!Object.keys(decorations.attributes).length) {\n          decorations = { ...decorations, attributes: null };\n        }\n      }\n      if (classes) {\n        if (line.attributes.classes) {\n          decorations = { ...decorations, classes: { ...line.attributes.classes, ...classes }};\n        }\n\n        Object.keys(classes).forEach(name => {\n          if (!classes[name]) delete decorations.classes[name];\n        });\n\n        if (!Object.keys(decorations.classes).length) {\n          decorations = { ...decorations, classes: null };\n        }\n      }\n\n      change.retain(1, decorations);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Formats the text from `from` to `to` with the given text formats. To remove an existing format pass in `null` or\n   * `false` to turn it off (e.g. `{ bold: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatText(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    if (from === to) {\n      if (this.activeFormats === empty) this.activeFormats = {};\n      Object.keys(formats).forEach(key => {\n        const value = formats[key];\n        if (value == null || value === false) delete this.activeFormats[key];\n        else this.activeFormats[key] = value;\n      });\n      return;\n    }\n    Object.keys(formats).forEach(name => formats[name] === false && (formats[name] = null));\n    const change = this.delta().retain(from);\n    this.getText(from, to).split('\\n').forEach(line => {\n      line.length && change.retain(line.length, formats).retain(1);\n    });\n    change.chop();\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Toggles the line formats from `from` to `to` with the given line formats. If the line has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleLineFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getLineFormat(from, to);\n    if (deepEqual(existing, format)) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatLine(from, to, format, source);\n  }\n\n  /**\n   * Toggles the text formats from `from` to `to` with the given text formats. If the text has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleTextFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getTextFormat(from, to);\n    const isSame = Object.keys(format).every(key => format[key] === existing[key]);\n    if (isSame) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatText(from, to, format, source);\n  }\n\n  /**\n   * Removes all formatting, text and line formats, for the text and lines from `from` to `to`.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  removeFormat(from, to, source) {\n    [ from, to, source ] = this._normalizeRange(from, to, source);\n    const formats = {};\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      op.attributes && Object.keys(op.attributes).forEach(key => formats[key] = null);\n    });\n\n    let change = this.delta().retain(from).retain(to - from, formats);\n\n    // If the last block was not captured be sure to clear that too\n    this.contents.getLines(from, to).forEach(line => {\n      const formats = {};\n      Object.keys(line.attributes).forEach(key => formats[key] = null);\n      change = change.compose(this.delta().retain(line.end - 1).retain(1, formats));\n    });\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Create a change delta calling one or more methods on the editor. The changes will not be applied as normal but will\n   * be collated into a single change delta and returned from this methnod. Example:\n   * ```js\n   * var change = editor.getChange(function() {\n   *   editor.deleteText(0, 5);\n   *   editor.insertText('\\n', { blockquote: true });\n   *   editor.formatText(10, 20, { bold: true });\n   * });\n   *\n   * editor.updateContents(change, 'user');\n   * ```\n   *\n   * @param {Function} producer A function in which to call methods on the editor to produce a change\n   * @returns {Delta}           The sum of all the changes made within the producer\n   */\n  getChange(producer) {\n    let change = this.delta();\n    this.updateContents = singleChange => {\n      if (singleChange.ops.length) {\n        change = change.compose(singleChange);\n        return singleChange;\n      } else {\n        return null;\n      }\n    };\n    producer(this);\n    delete this.updateContents;\n    return change;\n  }\n\n  /**\n   * Make several changes to the editor apply all at one in one commit. Changes made with the transaction will be\n   * applied all together and the \"text-changing\", \"text-change\", and \"selection-change\" events will be dispatched only\n   * once. Use this to combine multiple changes into one.\n   *\n   * @param {Function} producer A function which should make changes with the editor\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  transaction(producer, source, selection) {\n    const change = this.getChange(producer);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Returns the selected range (or the provided range) in index order (lowest number first) and within the bounds of\n   * the content, between 0 and content.length() - 1 (the selection cannot be past the trailing newline).\n   *\n   * @param {Array} range Optional range, defaults to current selection\n   * @param {Number} max  The maxium number the range can be\n   */\n  getSelectedRange(range = this.selection, max = this.length - 1) {\n    if (range == null) return range;\n    if (typeof range === 'number') range = [ range, range ];\n    if (range[0] > range[1]) [range[0], range[1]] = [range[1], range[0]];\n    return range.map(index => Math.max(0, Math.min(max, index)));\n  }\n\n  /**\n   * Normalizes range values to a proper range if it is not already. A range is a `from` and a `to` index, e.g. 0, 4.\n   * This will ensure the lower index is first. Example usage:\n   * editor._normalizeRange(5); // [5, 5]\n   * editor._normalizeRange(-4, 100); // for a doc with length 10, [0, 10]\n   * editor._normalizeRange(25, 18); // [18, 25]\n   * editor._normalizeRange([12, 13]); // [12, 13]\n   * editor._normalizeRange(5, { bold: true }); // [5, 5, { bold: true }]\n   */\n  _normalizeRange(from, to, ...rest) {\n    [ from, to, ...rest ] = this._normalizeSelection(from, to, ...rest);\n    if (from > to) [from, to] = [to, from];\n    return [from, to].concat(rest);\n  }\n\n  _normalizeSelection(from, to, ...rest) {\n    if (Array.isArray(from)) {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      [from, to] = from;\n      if (to === undefined) to = from;\n    } else if (typeof from !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      if (from !== undefined || rest.length) rest.unshift(from);\n      from = to = 0;\n    } else if (typeof to !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      to = from;\n    }\n    from = Math.max(0, Math.min(this.length, ~~from));\n    to = Math.max(0, Math.min(this.length, ~~to));\n    return [from, to].concat(rest);\n  }\n}\n\n// Ensures the format for the current line in a delete remains the same when multiple lines are deleted. This is needed\n// because the last line holds the formatting after a delete, but the first line is expected to be the retained format\nfunction cleanDelete(editor, from, to, change) {\n  if (from !== to) {\n    const line = editor.contents.getLine(from);\n    if (!line.ops.length() && to === from + 1) return change;\n    const lineFormat = editor.getLineFormat(from);\n    if (!deepEqual(lineFormat, editor.getLineFormat(to))) {\n      const lineChange = editor.getChange(() => editor.formatLine(to, lineFormat))\n      change = change.compose(change.transform(lineChange));\n    }\n  }\n  return change;\n}\n\n// Ensures contents end with a newline\nfunction normalizeContents(contents) {\n  // Contents only have inserts. Deletes and retains belong to changes only.\n  contents.ops = contents.ops.filter(op => op.insert);\n  const lastOp = contents.ops[contents.ops.length - 1];\n  if (!lastOp || typeof lastOp.insert !== 'string' || lastOp.insert.slice(-1) !== '\\n') contents.insert('\\n');\n  return contents;\n}\n\n// Delta no operation method\nfunction deltaNoop() {\n  return this;\n}\n\n// Sets the contents onto the editor after ensuring they end in a newline, freezes the contents from change, and\n// updates the length and text of the editor to the latest\nfunction setContents(editor, contents) {\n  contents = normalizeContents(contents);\n  contents.freeze();\n  editor.contents = contents;\n  editor.length = contents.length();\n}\n\n// Combine formats removing ones that don't exist in both and creating an array for those with multiple values\nfunction combineFormats(formats, combined) {\n  return Object.keys(combined).reduce(function(merged, name) {\n    if (formats[name] == null) return merged;\n    if (combined[name] === formats[name]) {\n      merged[name] = combined[name];\n    } else if (Array.isArray(combined[name])) {\n      if (combined[name].indexOf(formats[name]) < 0) {\n        merged[name] = combined[name].concat([formats[name]]);\n      }\n    } else {\n      merged[name] = [combined[name], formats[name]];\n    }\n    return merged;\n  }, {});\n}\n","// Based off of https://github.com/jorgebucaran/ultradom/ MIT licensed\n\nexport function h(name, attributes) {\n  var rest = [];\n  var children = [];\n  var length = arguments.length;\n\n  while (length-- > 2) rest.push(arguments[length]);\n\n  while (rest.length) {\n    var node = rest.pop();\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length]);\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node);\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        name,\n        attributes: attributes || {},\n        children: children\n      };\n}\n\nexport function render(node, element) {\n  element = element ?\n    patch(element.parentNode, element, node) :\n    patch(null, null, node);\n  return element;\n}\n\nexport function renderChildren(node, element) {\n  patchChildren(element, node.children);\n}\n\n\nfunction clone(target, source) {\n  var obj = {};\n\n  for (var i in target) obj[i] = target[i];\n  for (var i in source) obj[i] = source[i];\n\n  return obj;\n}\n\nfunction eventListener(event) {\n  return event.currentTarget.events[event.type](event);\n}\n\nfunction updateAttribute(element, name, value, isSvg) {\n  if (name[0] === \"o\" && name[1] === \"n\") {\n    if (!element.events) {\n      element.events = {};\n    }\n    name = name.slice(2);\n    const oldValue = element.events[name];\n    element.events[name] = value;\n    if (value) {\n      if (!oldValue) {\n        element.addEventListener(name, eventListener);\n      }\n    } else {\n      element.removeEventListener(name, eventListener);\n    }\n  } else if (name in element && name !== \"list\" && !isSvg) {\n    element[name] = value == null ? \"\" : value;\n  } else if (value != null && value !== false) {\n    element.setAttribute(name, value === true ? '' : value);\n  }\n\n  if (value == null || value === false) {\n    element.removeAttribute(name);\n  }\n}\n\nfunction createElement(node, isSvg) {\n  var element =\n    typeof node === \"string\" || typeof node === \"number\"\n      ? document.createTextNode(node)\n      : (isSvg = isSvg || node.name === \"svg\")\n        ? document.createElementNS(\n            \"http://www.w3.org/2000/svg\",\n            node.name\n          )\n        : document.createElement(node.name);\n\n  var attributes = node.attributes;\n  if (attributes) {\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSvg));\n    }\n\n    for (var name in attributes) {\n      updateAttribute(element, name, attributes[name], isSvg);\n    }\n  }\n\n  return element;\n}\n\nfunction getElementAttributes(element, isSvg) {\n  var attributes = {};\n  for (var i = 0; i < element.attributes.length; i++) {\n    var { name, value } = element.attributes[i];\n    if (name in element && name !== \"list\" && !isSvg) {\n      attributes[name] = element[name];\n    } else {\n      attributes[name] = value === '' ? true : value;\n    }\n  }\n  return attributes;\n}\n\nfunction updateElement(element, attributes, isSvg) {\n  var oldAttributes = getElementAttributes(element);\n  for (var name in clone(oldAttributes, attributes)) {\n    if (\n      attributes[name] !==\n      (name === \"value\" || name === \"checked\"\n        ? element[name]\n        : oldAttributes[name])\n    ) {\n      updateAttribute(\n        element,\n        name,\n        attributes[name],\n        isSvg\n      )\n    }\n  }\n}\n\nfunction removeElement(parent, element) {\n  parent.removeChild(element);\n}\n\nfunction patchChildren(element, children, isSvg) {\n  var i = 0;\n\n  while (i < children.length) {\n    patch(element, element.childNodes[i], children[i], isSvg);\n    i++;\n  }\n\n  while (i < element.childNodes.length) {\n    removeElement(element, element.childNodes[i]);\n  }\n}\n\nfunction patch(parent, element, node, isSvg) {\n  var name = element && element.nodeName !== '#text' ? element.nodeName.toLowerCase() : undefined;\n  if (element == null || name !== node.name) {\n    var newElement = createElement(node, isSvg);\n\n    if (parent) {\n      parent.insertBefore(newElement, element);\n      if (element != null) {\n        removeElement(parent, element);\n      }\n    }\n\n    element = newElement;\n  } else if (name == null) {\n    if (element.nodeValue !== node) element.nodeValue = node;\n  } else {\n    updateElement(\n      element,\n      node.attributes,\n      (isSvg = isSvg || node.name === \"svg\")\n    );\n\n    patchChildren(element, node.children, isSvg);\n  }\n  return element;\n}\n","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module variables.\n * @private\n */\n\nvar matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = escapeHtml;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nfunction escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}\n","const indexOf = [].indexOf;\n\n// Get the range (a tuple of indexes) for this view from the browser selection\nexport function getSelection(view, range) {\n  const root = view.root;\n  const selection = !range ? root.ownerDocument.defaultView.getSelection() : {\n    anchorNode: range.startContainer, anchorOffset: range.startOffset,\n    focusNode: range.endContainer, focusOffset: range.endOffset,\n    isCollapsed: range.collapsed,\n  };\n\n  if (!root.contains(selection.anchorNode)) {\n    return null;\n  } else {\n    const anchorIndex = getNodeAndOffsetIndex(view, selection.anchorNode, selection.anchorOffset);\n    let focusIndex = selection.isCollapsed ?\n      anchorIndex :\n      getNodeAndOffsetIndex(view, selection.focusNode, selection.focusOffset);\n\n    return [ anchorIndex, focusIndex ];\n  }\n}\n\n// Set the browser selection to the range (a tuple of indexes) of this view\nexport function setSelection(view, range) {\n  const root = view.root;\n  const selection = root.ownerDocument.defaultView.getSelection();\n  const hasFocus = root.contains(root.ownerDocument.activeElement);\n\n  if (range == null) {\n    if (hasFocus) {\n      root.blur();\n      selection.setBaseAndExtent(null, 0, null, 0);\n    }\n  } else {\n    const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n    selection.setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset);\n    if (!hasFocus) root.focus();\n  }\n}\n\n// Get a browser range object for the given editor range tuple\nexport function getBrowserRange(view, range) {\n  if (range[0] > range[1]) range = [ range[1], range[0] ];\n  const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n  const browserRange = document.createRange();\n  browserRange.setStart(anchorNode, anchorOffset);\n  browserRange.setEnd(focusNode, focusOffset);\n  return browserRange;\n}\n\n\n// Get the browser nodes and offsets for the range (a tuple of indexes) of this view\nexport function getNodesForRange(view, range) {\n  if (range == null) {\n    return [ null, 0, null, 0 ];\n  } else {\n    const [ anchorNode, anchorOffset ] = getNodeAndOffset(view, range[0]);\n    const [ focusNode, focusOffset ] = range[0] === range[1] ?\n          [ anchorNode, anchorOffset ] : getNodeAndOffset(view, range[1]);\n\n    return [ anchorNode, anchorOffset, focusNode, focusOffset ];\n  }\n}\n\nexport function getNodeAndOffset(view, index) {\n  const root = view.root;\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  let count = 0, node, firstBlockSeen = false;\n  walker.currentNode = root;\n  while ((node = walker.nextNode())) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      const size = node.nodeValue.length\n      if (index <= count + size) return [ node, index - count ];\n      count += size;\n    } else if (embeds.matches(node)) {\n      count += 1;\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) count += 1;\n      else firstBlockSeen = true;\n\n      // If the selection lands at the beginning of a block, and the first node isn't a text node, place the selection\n      if (count === index && (!node.firstChild || node.firstChild.nodeType !== Node.TEXT_NODE)) {\n        return [ node, 0 ];\n      }\n    } else if (isBRNode(view, node)) {\n      count += 1;\n      // If the selection lands after this br, and the next node isn't a text node, place the selection\n      if (count === index && (!node.nextSibling || node.nextSibling.nodeType !== Node.TEXT_NODE)) {\n        return [ node.parentNode, indexOf.call(node.parentNode.childNodes, node) + 1 ];\n      }\n    }\n  }\n  return [ null, 0 ];\n}\n\nexport function getNodeAndOffsetIndex(view, node, offset) {\n  if (node.nodeType === Node.ELEMENT_NODE && offset > 0) {\n    node = node.childNodes[offset - 1];\n    offset = 0;\n  }\n  return getNodeIndex(view, node) + offset;\n}\n\n// Get the index the node starts at in the content\nexport function getNodeIndex(view, node) {\n  const root = view.root;\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  walker.currentNode = node;\n  let index = node.nodeType === Node.ELEMENT_NODE ? 0 : -1;\n  while ((node = walker.previousNode())) {\n    if (node.nodeType === Node.TEXT_NODE) index += node.nodeValue.length;\n    else if (isBRNode(view, node)) index++;\n    else if (embeds.matches(node)) index++;\n    else if (node !== root && blocks.matches(node)) index++;\n  }\n  return index;\n}\n\n// Determines if a node is actually a BR in our content or if is just the placeholder BR which appears in an empty block\nexport function isBRNode(view, node) {\n  return node.nodeName === 'BR' && node.parentNode.lastChild !== node &&\n    ( // Check if the next node is an inline node (e.g. not another block such as a list)\n      node.nextSibling.nodeType === Node.TEXT_NODE ||\n      node.nextSibling.nodeName === 'BR' ||\n      view.paper.markups.matches(node.nextSibling) ||\n      view.paper.embeds.matches(node.nextSibling)\n    );\n}\n","import Delta from '../delta';\nimport { deepEqual } from 'fast-equals';\nimport escape from 'escape-html';\nimport { h } from './vdom';\nimport { isBRNode } from './selection';\nconst nodeMarkup = new WeakMap();\n\nconst br = <br/>;\nconst voidElements = {\n  area: true, base: true, br: true, col: true, embed: true, hr: true, img: true, input: true,\n  link: true, meta: true, param: true, source: true, track: true, wbr: true\n};\n\n\nexport function deltaToVdom(view, delta) {\n  const paper = view.paper;\n  const { blocks, markups, embeds, container } = paper;\n  const blockData = [];\n\n  delta.eachLine(({ ops, attributes }) => {\n    let inlineChildren = [];\n\n    // Collect block children\n    ops.forEach(op => {\n      if (op.insert) {\n        let children = [];\n        if (typeof op.insert === 'string') {\n          op.insert.split(/\\r/).forEach((child, i) => {\n            if (i !== 0) children.push(br);\n            child && children.push(child.replace(/  /g, '\\xA0 ').replace(/^ | $/g, '\\xA0'));\n          });\n        } else {\n          const embed = embeds.find(op.insert);\n          if (embed) {\n            const node = embed.vdom.call(paper, op.insert[embed.name]);\n            children.push(node);\n          }\n        }\n\n        if (op.attributes) {\n          // Sort them by the order found in markups and be efficient\n          Object.keys(op.attributes).sort((a, b) => markups.priority(b) - markups.priority(a)).forEach(name => {\n            const markup = markups.get(name);\n            if (markup) {\n              const node = markup.vdom.call(paper, children, op.attributes);\n              nodeMarkup.set(node, markup); // Store for merging\n              children = [ node ];\n            }\n          });\n        }\n        inlineChildren.push.apply(inlineChildren, children);\n      }\n    });\n\n    // Merge markups to optimize\n    inlineChildren = mergeChildren(inlineChildren);\n    if (!inlineChildren.length || inlineChildren[inlineChildren.length - 1] === br) {\n      inlineChildren.push(br);\n    }\n\n    let block = blocks.find(attributes);\n    if (!block) block = blocks.getDefault();\n\n    blockData.push([ block, inlineChildren, attributes ]);\n  });\n\n  // If a block has optimize=true on it, vdom will be called with all sibling nodes of the same block\n  let blockChildren = [], prevBlock;\n  let collect = [];\n  blockData.forEach((data, i) => {\n    const [ block, children, attr ] = data;\n    if (block.optimize) {\n      collect.push([ children, attr ]);\n      const next = blockData[i + 1];\n      if (!next || next[0] !== block) {\n        const children = block.vdom.call(paper, collect);\n        blockChildren = blockChildren.concat(children);\n        collect = [];\n      }\n    } else {\n      const node = block.vdom.call(paper, children, attr);\n      decorateBlock(node, attr);\n      blockChildren.push(node);\n    }\n  });\n\n  return container.call(paper, blockChildren, view);\n}\n\n\nexport function decorateBlock(vdom, attr) {\n  if (!attr.attributes && !attr.classes) return vdom;\n  const { attributes, classes } = attr;\n  if (attributes) {\n    Object.keys(attributes).forEach(name => {\n      vdom.attributes[name] = attributes[name];\n    });\n  }\n  if (classes) {\n    const classArray = Object.keys(classes);\n    if (classArray.length) {\n      if (vdom.attributes.class) classArray.unshift(vdom.attributes.class);\n      vdom.attributes.class = classArray.join(' ');\n    }\n  }\n  return vdom;\n}\n\nfunction undecorateBlock(node, block, attr) {\n  const ignoreClasses = {};\n  const ignoreAttributes = { class: true };\n  block.selector.replace(/\\.([-\\w])/, (_, name) => ignoreClasses[name] = true);\n  block.selector.replace(/\\[([-\\w])[^\\]]\\]/, (_, name) => ignoreAttributes[name] = true);\n  const attributes = {};\n  let attrLength = node.attributes.length;\n\n  if (node.classList.length) {\n    attrLength--;\n    const classes = {};\n    let match = false;\n\n    for (let i = 0; i < node.classList.length; i++) {\n      const name = node.classList.item(i);\n      if (!ignoreClasses[name]) {\n        match = true;\n        classes[name] = true;\n      }\n    }\n    if (match) attr.classes = classes;\n  }\n\n  if (attrLength) {\n    const attributes = {};\n    let match = false;\n\n    for (let i = 0; i < node.attributes.length; i++) {\n      const attribute = node.attributes[i];\n      if (!ignoreAttributes[attribute.name]) {\n        match = true;\n        attributes[attribute.name] = attribute.value || true;\n      }\n    }\n    if (match) attr.attributes = attributes;\n  }\n  return attr;\n}\n\n\nexport function deltaFromDom(view, root = view.root, notInDOM) {\n  const paper = view.paper;\n  const { blocks, markups, embeds } = paper;\n\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || notInDOM || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n  const delta = new Delta();\n  let currentBlock, firstBlockSeen = false, node;\n\n  walker.currentNode = root;\n\n  while ((node = walker.nextNode())) {\n    const isBr = isBRNode(view, node);\n\n    if (node.nodeType === Node.TEXT_NODE || isBr) {\n      // BRs are represented with \\r, non-breaking spaces are space, and newlines should not exist\n      const text = isBr ? '\\r' : node.nodeValue.replace(/\\xA0/g, ' ').replace(/\\n/g, '');\n      if (!text) continue;\n      let parent = node.parentNode, attr = {};\n\n      while (parent && !blocks.matches(parent) && parent !== root) {\n        if (markups.matches(parent)) {\n          const markup = markups.find(parent);\n          attr[markup.name] = markup.dom ? markup.dom.call(paper, parent) : true;\n        }\n        parent = parent.parentNode;\n      }\n\n      // If the text was not inside a block, ignore it (space between block perhaps)\n      if (parent !== root) {\n        delta.insert(text, attr);\n      }\n    } else if (embeds.matches(node)) {\n      const embed = embeds.find(node);\n      if (embed) {\n        delta.insert({ [embed.name]: embed.dom.call(paper, node) });\n      }\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) delta.insert('\\n', currentBlock);\n      else firstBlockSeen = true;\n      const block = blocks.find(node);\n      if (block !== blocks.getDefault()) {\n        currentBlock = undecorateBlock(node, block, block.dom ? block.dom.call(paper, node) : { [block.name]: true });\n      } else {\n        currentBlock = undecorateBlock(node, block, {});\n      }\n    }\n  }\n  delta.insert('\\n', currentBlock);\n  return delta;\n}\n\n/**\n * Converts a delta object into an HTML string based off of the supplied Paper definition.\n */\nexport function deltaToHTML(view, delta) {\n  return childrenToHTML(deltaToVdom(view, delta).children);\n}\n\n/**\n * Converts an HTML string into a delta object based off of the supplied Paper definition.\n */\nexport function deltaFromHTML(view, html) {\n  const template = document.createElement('template');\n  template.innerHTML = '<div>' + html + '</div>';\n  return deltaFromDom(view, template.content.firstChild, true);\n}\n\n\n// Joins adjacent markup nodes\nfunction mergeChildren(oldChildren) {\n  const children = [];\n  oldChildren.forEach((next, i) => {\n    const prev = children[children.length - 1];\n\n    if (prev && typeof prev !== 'string' && typeof next !== 'string' && nodeMarkup.get(prev) &&\n      nodeMarkup.get(prev) === nodeMarkup.get(next) && deepEqual(prev.attributes, next.attributes))\n    {\n      prev.children = prev.children.concat(next.children);\n    } else {\n      children.push(next);\n    }\n  });\n  return children;\n}\n\n// vdom node to HTML string\nfunction nodeToHTML(node) {\n  const attr = Object.keys(node.attributes)\n    .reduce((attr, name) =>\n      `${attr} ${escape(name)}=\"${escape(node.attributes[name])}\"`, '');\n  const children = childrenToHTML(node.children);\n  const closingTag = children || !voidElements[node.name] ? `</${node.name}>` : '';\n  return `<${node.name}${attr}>${children}${closingTag}`;\n}\n\n// vdom children to HTML string\nfunction childrenToHTML(children) {\n  if (!children || !children.length) return '';\n  return children.reduce((html, child) => html + (child.name ? nodeToHTML(child) : escape(child).replace(/\\xA0/g, '&nbsp;')), '');\n}\n","import { h } from './vdom';\nimport { decorateBlock } from './dom';\n\n\nexport const paragraph = {\n  name: 'paragraph',\n  selector: 'p',\n  vdom: children => <p>{children}</p>,\n};\n\n\nexport const header = {\n  name: 'header',\n  selector: 'h1, h2, h3, h4, h5, h6',\n  defaultFollows: true,\n  dom: node => ({ header: parseInt(node.nodeName.replace('H', '')) }),\n  vdom: (children, attr) => {\n    const H = `h${attr.header}`;\n    return <H>{children}</H>;\n  },\n};\n\n\nexport const list = {\n  name: 'list',\n  selector: 'ul > li, ol > li',\n  optimize: true,\n  dom: node => {\n    let indent = -1, parent = node.parentNode;\n    const list = parent.nodeName === 'OL' ? 'ordered' : 'bullet';\n    while (parent) {\n      if (/^UL|OL$/.test(parent.nodeName)) indent++;\n      else if (parent.nodeName !== 'LI') break;\n      parent = parent.parentNode;\n    }\n    const attr = { list };\n    if (indent) attr.indent = indent;\n    return attr;\n  },\n  vdom: lists => {\n    const topLevelChildren = [];\n    const levels = [];\n    // e.g. levels = [ul, li, ul, li]\n\n    lists.forEach(([children, attr]) => {\n      const List = attr.list === 'ordered' ? 'ol' : 'ul';\n      const index = Math.min((attr.indent || 0) * 2, levels.length);\n      const item = decorateBlock(<li>{children}</li>, attr);\n      let list = levels[index];\n      if (list && list.name === List) {\n        list.children.push(item);\n      } else {\n        list = <List>{item}</List>;\n        const childrenArray = index ? levels[index - 1].children : topLevelChildren;\n        childrenArray.push(list);\n        levels[index] = list;\n      }\n      levels[index + 1] = item;\n      levels.length = index + 2;\n    });\n\n    return topLevelChildren;\n  },\n};\n\nexport const blockquote = {\n  name: 'blockquote',\n  selector: 'blockquote p',\n  optimize: true,\n  vdom: quotes => {\n    return <blockquote>{quotes.map(([children, attr]) => decorateBlock(<p>{children}</p>, attr))}</blockquote>;\n  },\n};\n","import { h } from './vdom';\n\n\nexport const bold = {\n  name: 'bold',\n  selector: 'strong, b',\n  vdom: children => <strong>{children}</strong>,\n};\n\n\nexport const italics = {\n  name: 'italic',\n  selector: 'em, i',\n  vdom: children => <em>{children}</em>,\n};\n\n\nexport const link = {\n  name: 'link',\n  selector: 'a[href]',\n  dom: node => node.href,\n  vdom: (children, attr) => <a href={attr.link} target=\"_blank\">{children}</a>,\n};\n","import { h } from './vdom';\n\n\nexport const image = {\n  name: 'image',\n  selector: 'img',\n  dom: node => node.src,\n  vdom: value => <img src={value}/>,\n};\n\n// To represent a collaborator's cursor, for use in decorators\nexport const cursor = {\n  name: 'cursor',\n  selector: 'span.cursor',\n  dom: node => ({ name: node.dataset.name, color: node.style.backgroundColor }),\n  vdom: value => {\n    return <span class=\"cursor\" data-name={value.name} style={ `background-color: ${value.color}` }></span>\n  },\n};\n","import { paragraph, header, list, blockquote } from './blocks';\nimport { bold, italics, link } from './markups';\nimport { image } from './embeds';\n\n\nexport default {\n  blocks: [ paragraph, header, list, blockquote ],\n  markups: [ bold, italics, link ],\n  embeds: [ image ],\n};\n","import { h } from './view/vdom';\n\nexport default class Paper {\n  constructor(types) {\n    this.blocks = new Types();\n    this.markups = new Types();\n    this.embeds = new Types();\n    this.container = types.container || container;\n    if (types && types.blocks) types.blocks.forEach(block => this.blocks.add(block));\n    if (types && types.markups) types.markups.forEach(markup => this.markups.add(markup));\n    if (types && types.embeds) types.embeds.forEach(embed => this.embeds.add(embed));\n  }\n}\n\n\nexport function container(children, view) {\n  return <div class=\"typewriter-editor\" contentEditable={view.enabled}>\n    {children && children.length ? children : this.blocks.getDefault().vdom()}\n  </div>;\n}\n\n\nclass Types {\n  constructor() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  add(definition, index) {\n    if (!definition.name || !definition.selector || !definition.vdom) {\n      throw new Error('DOMType definitions must include a name, selector, and vdom function');\n    }\n    if (this.types[definition.name]) this.remove(definition.name);\n    this.selector += (this.selector ? ', ' : '') + definition.selector;\n    this.types[definition.name] = definition;\n    if (typeof index !== 'number') {\n      this.priorities[name] = this.array.length;\n      this.array.push(definition);\n    } else {\n      this.array.splice(i, 0, definition);\n      this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    }\n  }\n\n  remove(name) {\n    if (!this.types[name]) return;\n    delete this.types[name];\n    this.array = this.array.filter(domType => domType.name !== name);\n    this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    this.selector = this.array.map(type => type.selector).join(', ');\n  }\n\n  clear() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  get(name) {\n    return this.types[name];\n  }\n\n  priority(name) {\n    return this.priorities[name];\n  }\n\n  getDefault() {\n    return this.array[0];\n  }\n\n  matches(node) {\n    if (node instanceof Node) {\n      return this.selector ? node.matches(this.selector) : false;\n    } else {\n      throw new Error('Cannot match against ' + node);\n    }\n  }\n\n  find(nodeOrAttr) {\n    if (nodeOrAttr instanceof Node) {\n      let i = this.array.length;\n      while (i--) {\n        let domType = this.array[i];\n        if (nodeOrAttr.matches(domType.selector)) return domType;\n      }\n    } else if (nodeOrAttr && typeof nodeOrAttr === 'object') {\n      let domType;\n      Object.keys(nodeOrAttr).some(name => domType = this.get(name));\n      return domType;\n    }\n  }\n}\n","/* global define, KeyboardEvent, module */\n\n(function () {\n\n  var keyboardeventKeyPolyfill = {\n    polyfill: polyfill,\n    keys: {\n      3: 'Cancel',\n      6: 'Help',\n      8: 'Backspace',\n      9: 'Tab',\n      12: 'Clear',\n      13: 'Enter',\n      16: 'Shift',\n      17: 'Control',\n      18: 'Alt',\n      19: 'Pause',\n      20: 'CapsLock',\n      27: 'Escape',\n      28: 'Convert',\n      29: 'NonConvert',\n      30: 'Accept',\n      31: 'ModeChange',\n      32: ' ',\n      33: 'PageUp',\n      34: 'PageDown',\n      35: 'End',\n      36: 'Home',\n      37: 'ArrowLeft',\n      38: 'ArrowUp',\n      39: 'ArrowRight',\n      40: 'ArrowDown',\n      41: 'Select',\n      42: 'Print',\n      43: 'Execute',\n      44: 'PrintScreen',\n      45: 'Insert',\n      46: 'Delete',\n      48: ['0', ')'],\n      49: ['1', '!'],\n      50: ['2', '@'],\n      51: ['3', '#'],\n      52: ['4', '$'],\n      53: ['5', '%'],\n      54: ['6', '^'],\n      55: ['7', '&'],\n      56: ['8', '*'],\n      57: ['9', '('],\n      91: 'OS',\n      93: 'ContextMenu',\n      144: 'NumLock',\n      145: 'ScrollLock',\n      181: 'VolumeMute',\n      182: 'VolumeDown',\n      183: 'VolumeUp',\n      186: [';', ':'],\n      187: ['=', '+'],\n      188: [',', '<'],\n      189: ['-', '_'],\n      190: ['.', '>'],\n      191: ['/', '?'],\n      192: ['`', '~'],\n      219: ['[', '{'],\n      220: ['\\\\', '|'],\n      221: [']', '}'],\n      222: [\"'\", '\"'],\n      224: 'Meta',\n      225: 'AltGraph',\n      246: 'Attn',\n      247: 'CrSel',\n      248: 'ExSel',\n      249: 'EraseEof',\n      250: 'Play',\n      251: 'ZoomOut'\n    }\n  };\n\n  // Function keys (F1-24).\n  var i;\n  for (i = 1; i < 25; i++) {\n    keyboardeventKeyPolyfill.keys[111 + i] = 'F' + i;\n  }\n\n  // Printable ASCII characters.\n  var letter = '';\n  for (i = 65; i < 91; i++) {\n    letter = String.fromCharCode(i);\n    keyboardeventKeyPolyfill.keys[i] = [letter.toLowerCase(), letter.toUpperCase()];\n  }\n\n  function polyfill () {\n    if (!('KeyboardEvent' in window) ||\n        'key' in KeyboardEvent.prototype) {\n      return false;\n    }\n\n    // Polyfill `key` on `KeyboardEvent`.\n    var proto = {\n      get: function (x) {\n        var key = keyboardeventKeyPolyfill.keys[this.which || this.keyCode];\n\n        if (Array.isArray(key)) {\n          key = key[+this.shiftKey];\n        }\n\n        return key;\n      }\n    };\n    Object.defineProperty(KeyboardEvent.prototype, 'key', proto);\n    return proto;\n  }\n\n  if (typeof define === 'function' && define.amd) {\n    define('keyboardevent-key-polyfill', keyboardeventKeyPolyfill);\n  } else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {\n    module.exports = keyboardeventKeyPolyfill;\n  } else if (window) {\n    window.keyboardeventKeyPolyfill = keyboardeventKeyPolyfill;\n  }\n\n})();\n","require('keyboardevent-key-polyfill').polyfill();\n\nvar modifierKeys = {\n  Control: true,\n  Meta: true,\n  Shift: true,\n  Alt: true\n};\n\n\n/**\n * Returns the textual representation of a shortcut given a keyboard event. Examples of shortcuts:\n * Cmd+L\n * Cmd+Shift+M\n * Ctrl+O\n * Backspace\n * T\n * Right\n * Shift+Down\n * Shift+F1\n *\n */\nexports.fromEvent = function(event) {\n  var shortcutArray = [];\n  var key = event.key;\n\n  if (event.metaKey) shortcutArray.push('Cmd');\n  if (event.ctrlKey) shortcutArray.push('Ctrl');\n  if (event.altKey) shortcutArray.push('Alt');\n  if (event.shiftKey) shortcutArray.push('Shift');\n\n  if (!modifierKeys[key]) {\n    // a and A, b and B, should be the same shortcut\n    if (key.length === 1) key = key.toUpperCase();\n    shortcutArray.push(key);\n  }\n\n  return shortcutArray.join('+');\n}\n","import EventDispatcher from './event-dispatcher';\nimport Editor from './editor';\nimport { renderChildren } from './view/vdom';\nimport defaultPaper from './view/defaultPaper';\nimport { getSelection, setSelection, getBrowserRange, getNodeAndOffset } from './view/selection';\nimport { deltaToVdom, deltaFromDom, deltaToHTML, deltaFromHTML } from './view/dom';\nimport Paper from './paper';\nimport shortcuts from 'shortcut-string';\nimport { shallowEqual } from 'fast-equals';\nimport diff from 'fast-diff';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst isMac = navigator.userAgent.indexOf('Macintosh') !== -1;\nconst modExpr = isMac ? /Cmd/ : /Ctrl/;\n\n/**\n * Triggers before each render inside an editor transaction. Use this event to alter the contents of the editor with\n * decorators which will only be visible in the view and will not save to the editor. To add decorators, simply use the\n * editor APIs to format text, insert embeds, etc.\n *\n * @event View#decorate\n */\n\n/**\n * Triggers right before the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#rendering\n */\n\n/**\n * Triggers when the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#render\n */\n\n/**\n * Triggers on a keydown event, calling listeners with the keydown event and a shortcut string. These shortcut strings\n * will contain all the modifiers being pressed along with the key. Examples are:\n * Ctrl+B, Ctrl+Shift+Tab, Alt+A, Enter, Shift+Enter, Cmd+Enter, Cmd+Backspace, Space, Tab, Ctrl+Shift+Alt+F11, Ctrl++\n *\n * In addition to the normal modifiers, Cmd, Ctrl, Alt, and Shift, a special modifier called Mod can be used to match\n * Cmd on Mac and Ctrl on other OSes. This allows Mod+B to be used for bold and work correctly on all systems.\n *\n * You can listen for all shortcuts using the \"shortcut\" event, or you can listen for a specific shortcut using\n * \"shortcut:{shortcut}\".\n *\n * @event View#shortcut\n * @event View#shortcut:{shortcut} E.g. \"shortcut:Mod+Bold\"\n */\n\n/**\n * The Typewriter View displays and Editor's contents and selection. The contents are displayed as HTML using a tiny\n * virtual dom implementation and Paper to describe the HTML. The selection is displayed with the native browser\n * selection.\n *\n * View also sends changes to the editor using contenteditable and a mutation observer to capture text entry, keyboard\n * shortcuts to capture other types of edits, and the native selectionchange event to update selection.\n */\nexport default class View extends EventDispatcher {\n\n  /**\n   * Create a new View to display an Editor's contents.\n   *\n   * @param {Editor} editor  A Typewriter editor this View will display the contents for\n   * @param {Object} options Options include:\n   *   @param {HTMLElement} root   The root HTML element of this view. If not provided, you must append view.root to the\n   *                               DOM yourself\n   *   @param {Object} paper       The blocks, markups, embeds, and/or container to be used in this editor\n   *   @param {Object} modules     Modules which can be used with this view\n   */\n  constructor(editor, options = {}) {\n    super();\n    if (!editor) throw new Error('Editor view requires an editor');\n    this.editor = editor;\n    this.root = options.root || document.createElement('div');\n    if (!options.root) this.root.className = 'typewriter-editor';\n    this.paper = new Paper({ ...defaultPaper, ...options.paper });\n    this.enable();\n    this.isMac = isMac;\n    this._settingEditorSelection = false;\n    this._settingBrowserSelection = false;\n    this.init();\n    this.modules = {};\n    if (options.modules) Object.keys(options.modules).forEach(key => this.modules[key] = options.modules[key](this));\n    this.render();\n  }\n\n  /**\n   * Returns whether or not the view has browser focus.\n   *\n   * @returns {Boolean} Whether the view has focus\n   */\n  hasFocus() {\n    return this.root.contains(this.root.ownerDocument.activeElement);\n  }\n\n  /**\n   * Focuses the view using the last known selection.\n   */\n  focus() {\n    if (this.lastSelection) this.editor.setSelection(this.lastSelection);\n    else this.root.focus();\n  }\n\n  /**\n   * Removes focus from the view.\n   */\n  blur() {\n    this.root.blur();\n  }\n\n  /**\n   * Disables view text entry and key shortcuts.\n   */\n  disable() {\n    this.enable(false);\n  }\n\n  /**\n   * Enables (or disables) view text entry and key shortcuts.\n   *\n   * @param {Boolean} enabled Whether to make it enabled or disabled, default being true\n   */\n  enable(enabled = true) {\n    this.enabled = enabled;\n    this.root.contentEditable = enabled;\n  }\n\n  /**\n   * Get the position and size of a range as it is displayed in the DOM relative to the top left of visible document.\n   * You can use `getBounds(editor.selection)` to find the coordinates of the current selection and display a popup at\n   * that location.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRect}   A native DOMRect object with the bounds of the range\n   */\n  getBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getBoundingClientRect();\n  }\n\n  /**\n   * Get all positions and sizes of a range as it is displayed in the DOM relative to the top left of visible document.\n   * This is different from `getBounds` because instead of a single bounding box you may get multiple rects such as when\n   * the selection is split across lines. You can use `getAllBounds` to draw a highlight behind the text within this\n   * range.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRectList}   A native DOMRect object with the bounds of the range\n   */\n  getAllBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getClientRects();\n  }\n\n  /**\n   * Get the HTML text of the View (minus any decorators). You could use this to store the HTML contents rather than\n   * storing the editor contents. If you don't care about collaborative editing this may be easier than storing Deltas.\n   *\n   * @returns {String} A string of HTML\n   */\n  getHTML() {\n    return deltaToHTML(this, this.editor.contents);\n  }\n\n  /**\n   * Set a string of HTML to be the contents of the editor. It will be parsed using Paper so incorrectly formatted HTML\n   * cannot be set in Typewriter.\n   *\n   * @param {String} html A string of HTML to set in the editor\n   * @param {*} source    The source of the change being made, api, user, or silent\n   */\n  setHTML(html, source) {\n    this.editor.setContents(deltaFromHTML(this, html), source);\n  }\n\n  /**\n   * Re-render the current editor state to the DOM.\n   */\n  render(changeEvent) {\n    let contents = this.editor.contents;\n    this.decorators = this.editor.getChange(() => this.fire('decorate', this.editor, changeEvent));\n    if (this.decorators.ops.length) {\n      contents = contents.compose(this.decorators);\n      this.reverseDecorators = contents.diff(this.editor.contents);\n    } else {\n      this.reverseDecorators = this.decorators;\n    }\n    const vdom = deltaToVdom(this, contents);\n    if (!this.enabled) vdom.attributes.contenteditable = undefined;\n    this.fire('rendering', changeEvent);\n    renderChildren(vdom, this.root);\n    this.updateBrowserSelection();\n    this.fire('render', changeEvent);\n  }\n\n  /**\n   * Update the browser's selection to match the editor's selection.\n   */\n  updateBrowserSelection() {\n    if (this._settingEditorSelection) return;\n    this._settingBrowserSelection = true;\n    this.setSelection(this.editor.selection);\n    setTimeout(() => this._settingBrowserSelection = false, 20); // sad hack :(\n  }\n\n  /**\n   * Update the editor's selection to match the browser's selection.\n   *\n   * @param {String} source The source of the selection change, api, user, or silent\n   */\n  updateEditorSelection(source = SOURCE_API) {\n    if (this._settingBrowserSelection) return this._settingBrowserSelection = false;\n    const range = this.getSelection();\n\n    // Store the last non-null selection for restoration on focus()\n    if (range) this.lastSelection = range;\n\n    this._settingEditorSelection = true;\n    this.editor.setSelection(range, source);\n    this._settingEditorSelection = false;\n\n    // If the selection was adjusted when set then update the browser's selection\n    if (!shallowEqual(range, this.editor.selection)) this.updateBrowserSelection();\n  }\n\n  /**\n   * Get the mapped editor range from the current browser selection.\n   *\n   * @returns {Array} A range (or null) that represents the current browser selection\n   */\n  getSelection(nativeRange) {\n    let range = getSelection(this, nativeRange);\n    if (range && this.reverseDecorators.ops.length) {\n      range = range.map(i => this.reverseDecorators.transform(i));\n    }\n    return range;\n  }\n\n  /**\n   * Set's the browser selection to the given range.\n   *\n   * @param {Array} range The range to set selection to\n   */\n  setSelection(range) {\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    setSelection(this, range);\n  }\n\n  /**\n   * Initializes the view, setting up listeners in the DOM and on the editor.\n   */\n  init() {\n    this.root.ownerDocument.execCommand('defaultParagraphSeparator', false, this.paper.blocks.getDefault().selector);\n\n    const onKeyDown = event => {\n      let shortcut = shortcuts.fromEvent(event);\n      this.fire(`shortcut:${shortcut}`, event, shortcut);\n      this.fire(`shortcut`, event, shortcut);\n      if (modExpr.test(shortcut)) {\n        shortcut = shortcut.replace(modExpr, 'Mod');\n        this.fire(`shortcut:${shortcut}`, event, shortcut);\n        this.fire(`shortcut`, event, shortcut);\n      }\n    };\n\n    const onSelectionChange = () => {\n      this.updateEditorSelection(SOURCE_USER);\n    };\n\n    const onTextChanging = ({ contents }) => {\n      // Prevent incorrect formats\n      return !contents.ops.some(op => {\n        if (typeof op.insert === 'object') {\n          return !this.paper.embeds.find(op.insert);\n        } else if (op.attributes) {\n          // If attributes is empty except for classes/attributes than it is the default block\n          if (!Object.keys(op.attributes).filter(key => key !== 'classes' && key !== 'attributes').length) return;\n          return !(this.paper.blocks.find(op.attributes) || this.paper.markups.find(op.attributes));\n        }\n      });\n    };\n\n    const onEditorChange = event => {\n      if (event.change) this.render(event);\n      this.updateBrowserSelection();\n    };\n\n    // Use mutation tracking during development to catch errors\n    // TODO delete this mutation observer when we're confident in core (or put it behind a development flag)\n    let checking = 0;\n    const devObserver = new MutationObserver(list => {\n      if (checking) clearTimeout(checking);\n      checking = setTimeout(() => {\n        checking = 0;\n        const diff = this.editor.contents.compose(this.decorators).diff(deltaFromDom(this));\n        if (diff.length()) {\n          console.error('Delta out of sync with DOM:', diff, deltaFromDom(this));\n        }\n      }, 20);\n    });\n    devObserver.observe(this.root, { characterData: true, characterDataOldValue: true, childList: true, attributes: true, subtree: true });\n\n\n    this.root.addEventListener('keydown', onKeyDown);\n    this.root.ownerDocument.addEventListener('selectionchange', onSelectionChange);\n    this.editor.on('text-changing', onTextChanging);\n    this.editor.on('editor-change', onEditorChange);\n    this.render();\n\n    this.uninit = () => {\n      devObserver.disconnect();\n      this.root.removeEventListener('keydown', onKeyDown);\n      this.root.ownerDocument.removeEventListener('selectionchange', onSelectionChange);\n      this.editor.off('text-changing', onTextChanging);\n      this.editor.off('editor-change', onEditorChange);\n      delete this.uninit;\n    }\n  }\n\n  /**\n   * Cleans up the listeners on the DOM and editor after they have been added.\n   */\n  uninit() {\n    // This is overwritten inside `init`\n  }\n\n  /**\n   * Clean up and allow modules to clean up before the editor is removed from the DOM.\n   */\n  destroy() {\n    this.uninit();\n    Object.keys(modules).forEach(key => {\n      const api = this.module[key];\n      if (api && typeof api.destroy === 'function') api.destroy();\n    });\n  }\n}\n","import { getNodeIndex } from '../view/selection';\nimport { deltaFromDom } from '../view/dom';\nimport diff from 'fast-diff';\n\nconst SOURCE_USER = 'user';\nconst lastWord = /\\w+[^\\w]*$/;\nconst firstWord = /^[^\\w]*\\w+/;\nconst lastLine = /[^\\n]*$/;\nconst firstLine = /^[^\\n]*/;\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function input() {\n  return view => {\n    const editor = view.editor;\n    const mutationOptions = {\n      characterData: true,\n      characterDataOldValue: true,\n      subtree: true,childList: true,\n      attributes: true\n    };\n\n    // Detects changes from spell-check and the user typing\n    function onMutate(list) {\n      const seen = new Set();\n      list = list.filter(m => {\n        if (seen.has(m.target)) return false;\n        seen.add(m.target);\n        return true;\n      });\n\n      const selection = view.getSelection();\n      const mutation = list[0];\n      const isTextChange = list.length === 1 && mutation.type === 'characterData' ||\n        (mutation.type === 'childList' && mutation.addedNodes.length === 1 &&\n         mutation.addedNodes[0].nodeType === Node.TEXT_NODE);\n\n      // Only one text node has been altered. Optimize for view most common case.\n      if (isTextChange) {\n        const change = editor.delta();\n        const node = mutation.type === 'characterData' ? mutation.target : mutation.addedNodes[0];\n        const index = view.reverseDecorators.transform(getNodeIndex(view, node));\n        change.retain(index);\n\n        if (mutation.type === 'characterData') {\n          const diffs = diff(mutation.oldValue.replace(/\\xA0/g, ' '), mutation.target.nodeValue.replace(/\\xA0/g, ' '));\n          diffs.forEach(([ action, string ]) => {\n            if (action === diff.EQUAL) change.retain(string.length);\n            else if (action === diff.DELETE) change.delete(string.length);\n            else if (action === diff.INSERT) {\n              change.insert(string, editor.activeFormats);\n            }\n          });\n          change.chop();\n        } else {\n          change.insert(node.nodeValue.replace(/\\xA0/g, ' '), editor.activeFormats);\n        }\n\n        if (change.ops.length) {\n          // console.log('changing a little', change);\n          editor.updateContents(change, SOURCE_USER, selection);\n        }\n      } else if (list.length === 1 && mutation.type === 'childList' &&\n        addedNodes.length === 1 && mutation.addedNodes[0].nodeType === Node.TEXT_NODE)\n      {\n\n      } else {\n        let contents = deltaFromDom(view, view.root);\n        contents = contents.compose(view.reverseDecorators);\n        const change = editor.contents.diff(contents);\n        // console.log('changing a lot (possibly)', change);\n        editor.updateContents(change, SOURCE_USER, selection);\n      }\n    }\n\n\n    function onEnter(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n\n      const line = editor.contents.getLine(from);\n      let attributes = line.attributes;\n      const block = view.paper.blocks.find(attributes);\n      const isDefault = !block;\n      const length = line.end - line.start - 1;\n      const atEnd = to === line.end - 1;\n      if (atEnd && !isDefault && block.defaultFollows) {\n        attributes = {};\n      }\n      if (!length && !isDefault && !block.defaultFollows && from === to) {\n        editor.formatLine(from, to, {}, SOURCE_USER);\n      } else {\n        let selection = from + 1;\n        if (from === to && atEnd) {\n          from++;\n          to++;\n        }\n        editor.insertText(from, to, '\\n', attributes, SOURCE_USER, selection);\n      }\n    }\n\n\n    function onShiftEnter(event) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n      editor.insertText(from, to, '\\r', null, SOURCE_USER);\n    }\n\n\n    function onBackspace(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from + to === 0) {\n        const line = editor.contents.getLine(from);\n        const block = view.paper.blocks.find(line.attributes);\n        if (block) editor.formatLine(0, {}, SOURCE_USER);\n      } else {\n        // The \"from\" block needs to stay the same. The \"to\" block gets merged into it\n        if (from === to) {\n          if (shortcut === 'Alt+Backspace' && view.isMac) {\n            const match = editor.getText().slice(0, from).match(lastWord);\n            if (match) from -= match[0].length;\n          } else if (shortcut === 'Mod+Backspace' && view.isMac) {\n            const match = editor.getText().slice(0, from).match(lastLine);\n            if (match) from -= match[0].length;\n          } else {\n            const line = editor.contents.getLine(from);\n            if (from === line.start) {\n              const block = view.paper.blocks.find(line.attributes);\n              if (block && !block.defaultFollows) {\n                const prevLine = editor.contents.getLine(line.start - 1);\n                const prevBlock = prevLine && view.paper.blocks.find(prevLine.attributes);\n                if (block !== prevBlock) {\n                  editor.formatLine(from, {}, SOURCE_USER);\n                  return;\n                }\n              }\n            }\n\n            from--;\n          }\n        }\n        editor.deleteText(from, to, SOURCE_USER);\n      }\n    }\n\n    function onDelete(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from === to && from === editor.length) return;\n\n      if (from === to) {\n        if (shortcut === 'Alt+Delete' && view.isMac) {\n          const match = editor.getText().slice(from).match(firstWord);\n          if (match) to += match[0].length;\n        } else {\n          to++;\n        }\n      }\n      editor.deleteText(from, to, SOURCE_USER);\n    }\n\n    function onTab(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      const direction = shortcut === 'Tab' || shortcut === 'Mod+]' ? 1 : -1;\n      const [ from, to ] = editor.getSelectedRange();\n      const lines = editor.contents.getLines(from, to);\n\n      editor.transaction(() => {\n        lines.forEach((line, i) => {\n          if (line.attributes.list) {\n            let prevLine = lines[i -1];\n            if (!prevLine && line.index > 0) prevLine = editor.contents.getLine(line.start - 1);\n            const prevIndent = prevLine && prevLine.attributes.list ? prevLine.attributes.indent || 0 : -1;\n\n            let indent = line.attributes.indent || 0;\n            indent += direction;\n            if (indent > prevIndent + 1) return console.log('will not indent too much');\n            if (indent < 0) {\n              editor.formatLine(line.start, {});\n            } else {\n              const attributes = { ...line.attributes, indent };\n              editor.formatLine(line.start, attributes);\n            }\n          }\n        });\n      }, SOURCE_USER);\n    }\n\n    const observer = new MutationObserver(onMutate);\n    observer.observe(view.root, mutationOptions);\n\n    // Don't observe the changes that occur when the view updates, we only want to respond to changes that happen\n    // outside of our API to read them back in\n    function onRendering() {\n      observer.disconnect();\n    }\n\n    // Once the view update is complete, continue observing for changes\n    function onRender() {\n      observer.observe(view.root, mutationOptions);\n    }\n\n    view.on('rendering', onRendering);\n    view.on('render', onRender);\n    view.on('shortcut:Enter', onEnter);\n    view.on('shortcut:Shift+Enter', onShiftEnter);\n    view.on('shortcut:Backspace', onBackspace);\n    view.on('shortcut:Alt+Backspace', onBackspace);\n    view.on('shortcut:Mod+Backspace', onBackspace);\n    view.on('shortcut:Delete', onDelete);\n    view.on('shortcut:Alt+Delete', onDelete);\n    view.on('shortcut:Tab', onTab);\n    view.on('shortcut:Shift+Tab', onTab);\n\n    return {\n      destroy() {\n        observer.disconnect();\n        view.off('rendering', onRendering);\n        view.off('render', onRender);\n        view.off('shortcut:Enter', onEnter);\n        view.off('shortcut:Shift+Enter', onShiftEnter);\n        view.off('shortcut:Backspace', onBackspace);\n        view.off('shortcut:Alt+Backspace', onBackspace);\n        view.off('shortcut:Mod+Backspace', onBackspace);\n        view.off('shortcut:Delete', onDelete);\n        view.off('shortcut:Alt+Delete', onDelete);\n        view.off('shortcut:Tab', onTab);\n        view.off('shortcut:Shift+Tab', onTab);\n      }\n    }\n  }\n}\n","const SOURCE_USER = 'user';\n\n\nexport const keymap = {\n  'Mod+B': editor => editor.toggleTextFormat(editor.selection, { bold: true }, SOURCE_USER),\n  'Mod+I': editor => editor.toggleTextFormat(editor.selection, { italic: true }, SOURCE_USER),\n  'Mod+1': editor => editor.toggleLineFormat(editor.selection, { header: 1 }, SOURCE_USER),\n  'Mod+2': editor => editor.toggleLineFormat(editor.selection, { header: 2 }, SOURCE_USER),\n  'Mod+3': editor => editor.toggleLineFormat(editor.selection, { header: 3 }, SOURCE_USER),\n  'Mod+4': editor => editor.toggleLineFormat(editor.selection, { header: 4 }, SOURCE_USER),\n  'Mod+5': editor => editor.toggleLineFormat(editor.selection, { header: 5 }, SOURCE_USER),\n  'Mod+6': editor => editor.toggleLineFormat(editor.selection, { header: 6 }, SOURCE_USER),\n  'Mod+0': editor => editor.formatLine(editor.selection, { }, SOURCE_USER),\n};\n\nexport const macKeymap = { ...keymap };\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function keyShortcuts(customShortcuts = {}) {\n  return view => {\n    const shortcuts = { ...(view.isMac ? macKeymap : keymap), ...customShortcuts };\n    const editor = view.editor;\n\n    function onShortcut(event, shortcut) {\n      if (event.defaultPrevented) return;\n      if (shortcut in shortcuts) {\n        event.preventDefault();\n        shortcuts[shortcut](editor);\n      }\n    }\n\n    view.on('shortcut', onShortcut);\n\n    return {\n      destroy() {\n        view.off('shortcut', onShortcut);\n      }\n    }\n  };\n}\n","const SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst defaultOptions = {\n  delay: 0,\n  maxStack: 500,\n};\n\n/**\n * History is a view module for storing user changes.\n *\n * Stores history for all user-generated changes. Like-changes will be combined until a selection or a delay timeout\n * cuts off the combining. E.g. if a user types \"Hello\" the 5 changes will be combined into one history entry. If\n * the user moves the cursor somewhere and then back to the end and types \" World\" the next 6 changes are combined\n * separately from the first 5 because selection changes add a cutoff history entries.\n *\n * The default options can be overridden by passing alternatives to history. To add a timeout to force a cutoff after\n * so many milliseconds set a delay like this:\n * ```js\n * view = new View(editor, {\n *   modules: {\n *     history: history({ delay: 4000 })\n *   }\n * })\n * ```\n */\nexport default function history(options = {}) {\n\n  return view => {\n    const editor = view.editor;\n    options = { ...defaultOptions, options };\n\n    const stack = options.stack || {\n      undo: [],\n      redo: [],\n    };\n    let lastRecorded = 0;\n    let lastAction;\n    let ignoreChange = false;\n\n    function undo(event) {\n      action(event, 'undo', 'redo');\n    }\n\n    function redo() {\n      action(event, 'redo', 'undo');\n    }\n\n    function cutoff() {\n      lastRecorded = 0;\n    }\n\n    function clear() {\n      stack.undo.length = 0;\n      stack.redo.length = 0;\n    }\n\n    function action(event, source, dest) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      if (stack[source].length === 0) return;\n      let entry = stack[source].pop();\n      stack[dest].push(entry);\n      cutoff();\n      ignoreChange = true;\n      if (typeof entry[source] === 'function') {\n        entry[source]();\n      } else {\n        editor.updateContents(entry[source], SOURCE_USER, entry[source + 'Selection']);\n      }\n      ignoreChange = false;\n    }\n\n    function record(change, contents, oldContents, selection, oldSelection) {\n      const timestamp = Date.now();\n      const action = getAction(change);\n      stack.redo.length = 0;\n\n      let undoChange = contents.diff(oldContents);\n      // Break combining if actions are different (e.g. a delete then an insert should break it)\n      if (!action || lastAction !== action) cutoff();\n      lastAction = action;\n\n      if (lastRecorded && (!options.delay || lastRecorded + options.delay > timestamp) && stack.undo.length > 0) {\n        // Combine with the last change\n        let entry = stack.undo.pop();\n        oldSelection = entry.undoSelection;\n        undoChange = undoChange.compose(entry.undo);\n        change = entry.redo.compose(change);\n      } else {\n        lastRecorded = timestamp;\n      }\n\n      stack.undo.push({\n        redo: change,\n        undo: undoChange,\n        redoSelection: selection,\n        undoSelection: oldSelection,\n      });\n\n      if (stack.undo.length > options.maxStack) {\n        stack.undo.shift();\n      }\n    }\n\n\n    function transform(change) {\n      stack.undo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n      stack.redo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n    }\n\n\n    function onTextChange({ change, contents, oldContents, selection, oldSelection, source }) {\n      if (ignoreChange) return;\n      if (source === SOURCE_USER) {\n        record(change, contents, oldContents, selection, oldSelection);\n      } else {\n        transform(change);\n      }\n    }\n\n    function onSelectionChange({ change }) {\n      if (change) return;\n      // Break the history merging when selection changes without a text change\n      cutoff();\n    }\n\n\n    editor.on('text-change', onTextChange);\n    editor.on('selection-change', onSelectionChange);\n    if (view.isMac) {\n      view.on('shortcut:Cmd+Z', undo);\n      view.on('shortcut:Cmd+Shift+Z', redo);\n    } else {\n      view.on('shortcut:Ctrl+Z', undo);\n      view.on('shortcut:Cmd+Y', redo);\n    }\n\n    return {\n      undo,\n      redo,\n      cutoff,\n      options,\n      destroy() {\n        editor.off('text-change', onTextChange);\n        editor.off('selection-change', onSelectionChange);\n        if (view.isMac) {\n          view.off('shortcut:Cmd+Z', undo);\n          view.off('shortcut:Cmd+Shift+Z', redo);\n        } else {\n          view.off('shortcut:Ctrl+Z', undo);\n          view.off('shortcut:Cmd+Y', redo);\n        }\n      }\n    }\n  }\n}\n\nfunction getAction(change) {\n  if (change.ops.length === 1 || change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes) {\n    const changeOp = change.ops[change.ops.length - 1];\n    if (changeOp.delete) return 'delete';\n    if (changeOp.insert === '\\n') return 'newline';\n    if (changeOp.insert) return 'insert';\n  }\n  return '';\n}\n","import { h } from '../view/vdom';\n\nexport default function placeholder(placeholder) {\n  return view => {\n\n    view.paper.markups.add({\n      name: 'placeholder',\n      selector: 'span.placholder',\n      vdom: children => <span class=\"placeholder\" style={{pointerEvents: 'none'}}>{children}</span>,\n    });\n\n    function onDecorate(editor) {\n      if (editor.length === 1) {\n        editor.insertText(placeholder, { placeholder: true });\n      }\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n","const SOURCE_USER = 'user';\nconst bullet = /^[-*] $/;\nconst ordered = /^(-?\\d+)\\. $/;\nconst header = /^#{1,6} $/;\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into a formatted block with the attributes returned by the\n * function. The function's argument will be the captured text from the regular expression.\n */\nexport const blockReplacements = [\n  [ /^(#{1,6}) $/, capture => ({ header: capture.length }) ],\n  [ /^[-*] $/, () => ({ list: 'bullet' }) ],\n  [ /^1\\. $/, () => ({ list: 'ordered' }) ],\n  [ /^> $/, () => ({ blockquote: true }) ],\n];\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into another string of text which is returned by the function.\n * The function's argument will be the captured text from the regular expression.\n */\nexport const textReplacements = [\n  [ /--$/, () => '—' ],\n  [ /\\.\\.\\.$/, () => '…' ],\n];\n\n/**\n * Allow text representations to format a block\n */\nexport function blockReplace(index, prefix) {\n  return blockReplacements.some(([ regexp, getAttributes ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      const attributes = getAttributes(match[1]);\n      const change = editor.getChange(() => {\n        editor.formatLine(index, attributes);\n        editor.deleteText(index - prefix.length, index);\n      });\n      editor.updateContents(change, SOURCE_USER, index - prefix.length);\n      return true;\n    }\n  });\n}\n\nexport function textReplace(index, prefix) {\n  return textReplacements.some(([ regexp, replaceWith ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      editor.insertText(index - match[0].length, index, replaceWith(match[1]), null, SOURCE_USER);\n      return true;\n    }\n  });\n}\n\nexport const defaultHandlers = [ blockReplace, textReplace ];\n\n\nexport default function(handlers = defaultHandlers) {\n\n  return view => {\n    const editor = view.editor;\n    let ignore = false;\n\n    function onTextChange({ change, source }) {\n      if (ignore || source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n      const index = editor.selection[1];\n      const text = editor.getExactText();\n      const lineStart = text.lastIndexOf('\\n', index - 1) + 1;\n      const prefix = text.slice(lineStart, index);\n\n      ignore = true;\n      handlers.some(handler => handler(index, prefix));\n      ignore = false;\n    }\n\n    editor.on('text-change', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-change', onTextChange);\n      }\n    }\n  };\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","\n/**\n * Replaces regular quotes with smart quotes as they are typed. Does not affect pasted content.\n * Uses the text-changing event to prevent the original change and replace it with the new one. This makes the smart-\n * quotes act more seemlessly and includes them as part of regular text undo/redo instead of breaking it like the smart-\n * entry conversions do.\n */\nexport default function smartQuotes() {\n  return view => {\n    const editor = view.editor;\n\n    function onTextChange({ change, source, selection }) {\n      if (source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n\n      const index = editor.selection[1];\n      const lastOp = change.ops[change.ops.length - 1];\n      const lastChars = editor.getText(index - 1, index) + lastOp.insert.slice(-1);\n\n      const replaced = lastChars.replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(\")$/, '“')\n              .replace(/\"$/, '”')\n              .replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(')$/, '‘')\n              .replace(/'$/, '’');\n\n      if (replaced !== lastChars) {\n        const quote = replaced.slice(-1);\n        lastOp.insert = lastOp.insert.slice(0, -1) + quote;\n        editor.updateContents(change, source, selection);\n        return false;\n      }\n    }\n\n    editor.on('text-changing', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-changing', onTextChange);\n      }\n    }\n  }\n}\n\n\n/**\n * Adds smartquotes to a document as a decorator. This does not affect the source, allowing you to store regular quotes\n * in your source data but display smart quotes to the user. Use this as an alternative to the module above, not in\n * addition to it.\n */\nexport function smartQuotesDecorator() {\n  return view => {\n    const quotes = [\n      [ /(^|\\s)\"/g, /(^|\\s)\"/, '$1“' ],\n      [ /\"/g, /\"/, '”'],\n      [ /\\b'/g, /'/, '’'],\n      [ /'/g, /'/, '‘'],\n    ];\n\n    function onDecorate(editor) {\n      let { text } = editor;\n      quotes.forEach(([ expr, replacer, replaceWith ]) => {\n        let match;\n        while ((match = expr.exec(text))) {\n          const replacement = match[0].replace(replacer, replaceWith);\n          text = text.slice(0, match.index) + replacement + text.slice(expr.lastIndex);\n          editor.insertText(match.index, expr.lastIndex, replacement);\n        }\n      });\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","function noop() {}\n\nfunction assign(tar, src) {\n\tfor (var k in src) tar[k] = src[k];\n\treturn tar;\n}\n\nfunction assignTrue(tar, src) {\n\tfor (var k in src) tar[k] = 1;\n\treturn tar;\n}\n\nfunction appendNode(node, target) {\n\ttarget.appendChild(node);\n}\n\nfunction insertNode(node, target, anchor) {\n\ttarget.insertBefore(node, anchor);\n}\n\nfunction detachNode(node) {\n\tnode.parentNode.removeChild(node);\n}\n\nfunction detachBetween(before, after) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction detachBefore(after) {\n\twhile (after.previousSibling) {\n\t\tafter.parentNode.removeChild(after.previousSibling);\n\t}\n}\n\nfunction detachAfter(before) {\n\twhile (before.nextSibling) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction reinsertBetween(before, after, target) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\ttarget.appendChild(before.parentNode.removeChild(before.nextSibling));\n\t}\n}\n\nfunction reinsertChildren(parent, target) {\n\twhile (parent.firstChild) target.appendChild(parent.firstChild);\n}\n\nfunction reinsertAfter(before, target) {\n\twhile (before.nextSibling) target.appendChild(before.nextSibling);\n}\n\nfunction reinsertBefore(after, target) {\n\tvar parent = after.parentNode;\n\twhile (parent.firstChild !== after) target.appendChild(parent.firstChild);\n}\n\nfunction destroyEach(iterations) {\n\tfor (var i = 0; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].d();\n\t}\n}\n\nfunction createFragment() {\n\treturn document.createDocumentFragment();\n}\n\nfunction createElement(name) {\n\treturn document.createElement(name);\n}\n\nfunction createSvgElement(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nfunction createText(data) {\n\treturn document.createTextNode(data);\n}\n\nfunction createComment() {\n\treturn document.createComment('');\n}\n\nfunction addListener(node, event, handler) {\n\tnode.addEventListener(event, handler, false);\n}\n\nfunction removeListener(node, event, handler) {\n\tnode.removeEventListener(event, handler, false);\n}\n\nfunction setAttribute(node, attribute, value) {\n\tnode.setAttribute(attribute, value);\n}\n\nfunction setAttributes(node, attributes) {\n\tfor (var key in attributes) {\n\t\tif (key in node) {\n\t\t\tnode[key] = attributes[key];\n\t\t} else {\n\t\t\tif (attributes[key] === undefined) removeAttribute(node, key);\n\t\t\telse setAttribute(node, key, attributes[key]);\n\t\t}\n\t}\n}\n\nfunction removeAttribute(node, attribute) {\n\tnode.removeAttribute(attribute);\n}\n\nfunction setXlinkAttribute(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\nfunction getBindingGroupValue(group) {\n\tvar value = [];\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.push(group[i].__value);\n\t}\n\treturn value;\n}\n\nfunction toNumber(value) {\n\treturn value === '' ? undefined : +value;\n}\n\nfunction timeRangesToArray(ranges) {\n\tvar array = [];\n\tfor (var i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\nfunction children (element) {\n\treturn Array.from(element.childNodes);\n}\n\nfunction claimElement (nodes, name, attributes, svg) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeName === name) {\n\t\t\tfor (var j = 0; j < node.attributes.length; j += 1) {\n\t\t\t\tvar attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) node.removeAttribute(attribute.name);\n\t\t\t}\n\t\t\treturn nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n\t\t}\n\t}\n\n\treturn svg ? createSvgElement(name) : createElement(name);\n}\n\nfunction claimText (nodes, data) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeType === 3) {\n\t\t\tnode.data = data;\n\t\t\treturn nodes.splice(i, 1)[0];\n\t\t}\n\t}\n\n\treturn createText(data);\n}\n\nfunction setInputType(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {}\n}\n\nfunction setStyle(node, key, value) {\n\tnode.style.setProperty(key, value);\n}\n\nfunction selectOption(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\n\t\tif (option.__value === value) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nfunction selectOptions(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\t\toption.selected = ~value.indexOf(option.__value);\n\t}\n}\n\nfunction selectValue(select) {\n\tvar selectedOption = select.querySelector(':checked') || select.options[0];\n\treturn selectedOption && selectedOption.__value;\n}\n\nfunction selectMultipleValue(select) {\n\treturn [].map.call(select.querySelectorAll(':checked'), function(option) {\n\t\treturn option.__value;\n\t});\n}\n\nfunction destroyBlock(block, lookup) {\n\tblock.u();\n\tblock.d();\n\tlookup[block.key] = null;\n}\n\nfunction outroAndDestroyBlock(block, lookup) {\n\tblock.o(function() {\n\t\tdestroyBlock(block, lookup);\n\t});\n}\n\nfunction updateKeyedEach(old_blocks, component, changed, key_prop, dynamic, list, lookup, node, has_outro, create_each_block, intro_method, next, get_context) {\n\tvar o = old_blocks.length;\n\tvar n = list.length;\n\n\tvar i = o;\n\tvar old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\n\tvar new_blocks = [];\n\tvar new_lookup = {};\n\tvar deltas = {};\n\n\tvar i = n;\n\twhile (i--) {\n\t\tvar key = list[i][key_prop];\n\t\tvar block = lookup[key];\n\n\t\tif (!block) {\n\t\t\tblock = create_each_block(component, key, get_context(i));\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\tblock.p(changed, get_context(i));\n\t\t}\n\n\t\tnew_blocks[i] = new_lookup[key] = block;\n\n\t\tif (key in old_indexes) deltas[key] = Math.abs(i - old_indexes[key]);\n\t}\n\n\tvar will_move = {};\n\tvar did_move = {};\n\n\tvar destroy = has_outro ? outroAndDestroyBlock : destroyBlock;\n\n\tfunction insert(block) {\n\t\tblock[intro_method](node, next);\n\t\tlookup[block.key] = block;\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\n\twhile (o && n) {\n\t\tvar new_block = new_blocks[n - 1];\n\t\tvar old_block = old_blocks[o - 1];\n\t\tvar new_key = new_block.key;\n\t\tvar old_key = old_block.key;\n\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t}\n\n\t\telse if (!new_lookup[old_key]) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t}\n\n\t\telse if (!lookup[new_key] || will_move[new_key]) {\n\t\t\tinsert(new_block);\n\t\t}\n\n\t\telse if (did_move[old_key]) {\n\t\t\to--;\n\n\t\t} else if (deltas[new_key] > deltas[old_key]) {\n\t\t\tdid_move[new_key] = true;\n\t\t\tinsert(new_block);\n\n\t\t} else {\n\t\t\twill_move[old_key] = true;\n\t\t\to--;\n\t\t}\n\t}\n\n\twhile (o--) {\n\t\tvar old_block = old_blocks[o];\n\t\tif (!new_lookup[old_block.key]) destroy(old_block, lookup);\n\t}\n\n\twhile (n) insert(new_blocks[n - 1]);\n\n\treturn new_blocks;\n}\n\nfunction getSpreadUpdate(levels, updates) {\n\tvar update = {};\n\n\tvar to_null_out = {};\n\tvar accounted_for = {};\n\n\tvar i = levels.length;\n\twhile (i--) {\n\t\tvar o = levels[i];\n\t\tvar n = updates[i];\n\n\t\tif (n) {\n\t\t\tfor (var key in o) {\n\t\t\t\tif (!(key in n)) to_null_out[key] = 1;\n\t\t\t}\n\n\t\t\tfor (var key in n) {\n\t\t\t\tif (!accounted_for[key]) {\n\t\t\t\t\tupdate[key] = n[key];\n\t\t\t\t\taccounted_for[key] = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlevels[i] = n;\n\t\t} else {\n\t\t\tfor (var key in o) {\n\t\t\t\taccounted_for[key] = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (var key in to_null_out) {\n\t\tif (!(key in update)) update[key] = undefined;\n\t}\n\n\treturn update;\n}\n\nfunction linear(t) {\n\treturn t;\n}\n\nfunction generateRule(\n\ta,\n\tb,\n\tdelta,\n\tduration,\n\tease,\n\tfn\n) {\n\tvar keyframes = '{\\n';\n\n\tfor (var p = 0; p <= 1; p += 16.666 / duration) {\n\t\tvar t = a + delta * ease(p);\n\t\tkeyframes += p * 100 + '%{' + fn(t) + '}\\n';\n\t}\n\n\treturn keyframes + '100% {' + fn(b) + '}\\n}';\n}\n\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n\tvar hash = 5381;\n\tvar i = str.length;\n\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn hash >>> 0;\n}\n\nfunction wrapTransition(component, node, fn, params, intro, outgroup) {\n\tvar obj = fn(node, params);\n\tvar duration = obj.duration || 300;\n\tvar ease = obj.easing || linear;\n\tvar cssText;\n\n\t// TODO share <style> tag between all transitions?\n\tif (obj.css && !transitionManager.stylesheet) {\n\t\tvar style = createElement('style');\n\t\tdocument.head.appendChild(style);\n\t\ttransitionManager.stylesheet = style.sheet;\n\t}\n\n\tif (intro) {\n\t\tif (obj.css && obj.delay) {\n\t\t\tcssText = node.style.cssText;\n\t\t\tnode.style.cssText += obj.css(0);\n\t\t}\n\n\t\tif (obj.tick) obj.tick(0);\n\t}\n\n\treturn {\n\t\tt: intro ? 0 : 1,\n\t\trunning: false,\n\t\tprogram: null,\n\t\tpending: null,\n\t\trun: function(intro, callback) {\n\t\t\tvar program = {\n\t\t\t\tstart: window.performance.now() + (obj.delay || 0),\n\t\t\t\tintro: intro,\n\t\t\t\tcallback: callback\n\t\t\t};\n\n\t\t\tif (obj.delay) {\n\t\t\t\tthis.pending = program;\n\t\t\t} else {\n\t\t\t\tthis.start(program);\n\t\t\t}\n\n\t\t\tif (!this.running) {\n\t\t\t\tthis.running = true;\n\t\t\t\ttransitionManager.add(this);\n\t\t\t}\n\t\t},\n\t\tstart: function(program) {\n\t\t\tcomponent.fire(program.intro ? 'intro.start' : 'outro.start', { node: node });\n\n\t\t\tprogram.a = this.t;\n\t\t\tprogram.b = program.intro ? 1 : 0;\n\t\t\tprogram.delta = program.b - program.a;\n\t\t\tprogram.duration = duration * Math.abs(program.b - program.a);\n\t\t\tprogram.end = program.start + program.duration;\n\n\t\t\tif (obj.css) {\n\t\t\t\tif (obj.delay) node.style.cssText = cssText;\n\n\t\t\t\tprogram.rule = generateRule(\n\t\t\t\t\tprogram.a,\n\t\t\t\t\tprogram.b,\n\t\t\t\t\tprogram.delta,\n\t\t\t\t\tprogram.duration,\n\t\t\t\t\tease,\n\t\t\t\t\tobj.css\n\t\t\t\t);\n\n\t\t\t\ttransitionManager.addRule(program.rule, program.name = '__svelte_' + hash(program.rule));\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(function(anim) {\n\t\t\t\t\t\t// when introing, discard old animations if there are any\n\t\t\t\t\t\treturn anim && (program.delta < 0 || !/__svelte/.test(anim));\n\t\t\t\t\t})\n\t\t\t\t\t.concat(program.name + ' ' + program.duration + 'ms linear 1 forwards')\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tthis.program = program;\n\t\t\tthis.pending = null;\n\t\t},\n\t\tupdate: function(now) {\n\t\t\tvar program = this.program;\n\t\t\tif (!program) return;\n\n\t\t\tvar p = now - program.start;\n\t\t\tthis.t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (obj.tick) obj.tick(this.t);\n\t\t},\n\t\tdone: function() {\n\t\t\tvar program = this.program;\n\t\t\tthis.t = program.b;\n\t\t\tif (obj.tick) obj.tick(this.t);\n\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\tprogram.callback();\n\t\t\tprogram = null;\n\t\t\tthis.running = !!this.pending;\n\t\t},\n\t\tabort: function() {\n\t\t\tif (obj.tick) obj.tick(1);\n\t\t\tif (obj.css) transitionManager.deleteRule(node, this.program.name);\n\t\t\tthis.program = this.pending = null;\n\t\t\tthis.running = false;\n\t\t}\n\t};\n}\n\nvar transitionManager = {\n\trunning: false,\n\ttransitions: [],\n\tbound: null,\n\tstylesheet: null,\n\tactiveRules: {},\n\n\tadd: function(transition) {\n\t\tthis.transitions.push(transition);\n\n\t\tif (!this.running) {\n\t\t\tthis.running = true;\n\t\t\trequestAnimationFrame(this.bound || (this.bound = this.next.bind(this)));\n\t\t}\n\t},\n\n\taddRule: function(rule, name) {\n\t\tif (!this.activeRules[name]) {\n\t\t\tthis.activeRules[name] = true;\n\t\t\tthis.stylesheet.insertRule('@keyframes ' + name + ' ' + rule, this.stylesheet.cssRules.length);\n\t\t}\n\t},\n\n\tnext: function() {\n\t\tthis.running = false;\n\n\t\tvar now = window.performance.now();\n\t\tvar i = this.transitions.length;\n\n\t\twhile (i--) {\n\t\t\tvar transition = this.transitions[i];\n\n\t\t\tif (transition.program && now >= transition.program.end) {\n\t\t\t\ttransition.done();\n\t\t\t}\n\n\t\t\tif (transition.pending && now >= transition.pending.start) {\n\t\t\t\ttransition.start(transition.pending);\n\t\t\t}\n\n\t\t\tif (transition.running) {\n\t\t\t\ttransition.update(now);\n\t\t\t\tthis.running = true;\n\t\t\t} else if (!transition.pending) {\n\t\t\t\tthis.transitions.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (this.running) {\n\t\t\trequestAnimationFrame(this.bound);\n\t\t} else if (this.stylesheet) {\n\t\t\tvar i = this.stylesheet.cssRules.length;\n\t\t\twhile (i--) this.stylesheet.deleteRule(i);\n\t\t\tthis.activeRules = {};\n\t\t}\n\t},\n\n\tdeleteRule: function(node, name) {\n\t\tnode.style.animation = node.style.animation\n\t\t\t.split(', ')\n\t\t\t.filter(function(anim) {\n\t\t\t\treturn anim.indexOf(name) === -1;\n\t\t\t})\n\t\t\t.join(', ');\n\t}\n};\n\nfunction blankObject() {\n\treturn Object.create(null);\n}\n\nfunction destroy(detach) {\n\tthis.destroy = noop;\n\tthis.fire('destroy');\n\tthis.set = noop;\n\n\tif (detach !== false) this._fragment.u();\n\tthis._fragment.d();\n\tthis._fragment = null;\n\tthis._state = {};\n}\n\nfunction destroyDev(detach) {\n\tdestroy.call(this, detach);\n\tthis.destroy = function() {\n\t\tconsole.warn('Component was already destroyed');\n\t};\n}\n\nfunction _differs(a, b) {\n\treturn a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\n\nfunction _differsImmutable(a, b) {\n\treturn a != a ? b == b : a !== b;\n}\n\nfunction fire(eventName, data) {\n\tvar handlers =\n\t\teventName in this._handlers && this._handlers[eventName].slice();\n\tif (!handlers) return;\n\n\tfor (var i = 0; i < handlers.length; i += 1) {\n\t\tvar handler = handlers[i];\n\n\t\tif (!handler.__calling) {\n\t\t\thandler.__calling = true;\n\t\t\thandler.call(this, data);\n\t\t\thandler.__calling = false;\n\t\t}\n\t}\n}\n\nfunction get() {\n\treturn this._state;\n}\n\nfunction init(component, options) {\n\tcomponent._handlers = blankObject();\n\tcomponent._bind = options._bind;\n\n\tcomponent.options = options;\n\tcomponent.root = options.root || component;\n\tcomponent.store = component.root.store || options.store;\n}\n\nfunction on(eventName, handler) {\n\tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n\thandlers.push(handler);\n\n\treturn {\n\t\tcancel: function() {\n\t\t\tvar index = handlers.indexOf(handler);\n\t\t\tif (~index) handlers.splice(index, 1);\n\t\t}\n\t};\n}\n\nfunction run(fn) {\n\tfn();\n}\n\nfunction set(newState) {\n\tthis._set(assign({}, newState));\n\tif (this.root._lock) return;\n\tthis.root._lock = true;\n\tcallAll(this.root._beforecreate);\n\tcallAll(this.root._oncreate);\n\tcallAll(this.root._aftercreate);\n\tthis.root._lock = false;\n}\n\nfunction _set(newState) {\n\tvar oldState = this._state,\n\t\tchanged = {},\n\t\tdirty = false;\n\n\tfor (var key in newState) {\n\t\tif (this._differs(newState[key], oldState[key])) changed[key] = dirty = true;\n\t}\n\tif (!dirty) return;\n\n\tthis._state = assign(assign({}, oldState), newState);\n\tthis._recompute(changed, this._state);\n\tif (this._bind) this._bind(changed, this._state);\n\n\tif (this._fragment) {\n\t\tthis.fire(\"state\", { changed: changed, current: this._state, previous: oldState });\n\t\tthis._fragment.p(changed, this._state);\n\t\tthis.fire(\"update\", { changed: changed, current: this._state, previous: oldState });\n\t}\n}\n\nfunction setDev(newState) {\n\tif (typeof newState !== 'object') {\n\t\tthrow new Error(\n\t\t\tthis._debugName + '.set was called without an object of data key-values to update.'\n\t\t);\n\t}\n\n\tthis._checkReadOnly(newState);\n\tset.call(this, newState);\n}\n\nfunction callAll(fns) {\n\twhile (fns && fns.length) fns.shift()();\n}\n\nfunction _mount(target, anchor) {\n\tthis._fragment[this._fragment.i ? 'i' : 'm'](target, anchor || null);\n}\n\nfunction _unmount() {\n\tif (this._fragment) this._fragment.u();\n}\n\nfunction isPromise(value) {\n\treturn value && typeof value.then === 'function';\n}\n\nvar PENDING = {};\nvar SUCCESS = {};\nvar FAILURE = {};\n\nfunction removeFromStore() {\n\tthis.store._remove(this);\n}\n\nvar proto = {\n\tdestroy,\n\tget,\n\tfire,\n\ton,\n\tset,\n\t_recompute: noop,\n\t_set,\n\t_mount,\n\t_unmount,\n\t_differs\n};\n\nvar protoDev = {\n\tdestroy: destroyDev,\n\tget,\n\tfire,\n\ton,\n\tset: setDev,\n\t_recompute: noop,\n\t_set,\n\t_mount,\n\t_unmount,\n\t_differs\n};\n\nexport { blankObject, destroy, destroyDev, _differs, _differsImmutable, fire, get, init, on, run, set, _set, setDev, callAll, _mount, _unmount, isPromise, PENDING, SUCCESS, FAILURE, removeFromStore, proto, protoDev, appendNode, insertNode, detachNode, detachBetween, detachBefore, detachAfter, reinsertBetween, reinsertChildren, reinsertAfter, reinsertBefore, destroyEach, createFragment, createElement, createSvgElement, createText, createComment, addListener, removeListener, setAttribute, setAttributes, removeAttribute, setXlinkAttribute, getBindingGroupValue, toNumber, timeRangesToArray, children, claimElement, claimText, setInputType, setStyle, selectOption, selectOptions, selectValue, selectMultipleValue, destroyBlock, outroAndDestroyBlock, updateKeyedEach, getSpreadUpdate, linear, generateRule, hash, wrapTransition, transitionManager, noop, assign, assignTrue };\n","<div\n  ref:menu\n  style=\"top: {pos.top}px; left: {pos.left}px\"\n  class=\"menu{active ? ' active' : ''}{inputMode ? ' input-mode' : ''}\">\n  <div class=\"items\">\n    {#each items as item}\n      {#if item}\n        <button class=\"editor-menu-{item.name}{item.active ? ' active' : ''}\" on:click=\"onClick(item)\" disabled={item.disabled}>\n          <i class=\"typewriter-icon typewriter-{item.icon || item.name}\"></i>\n        </button>\n      {:else}\n        <div class=\"typewriter-separator\"></div>\n      {/if}\n    {/each}\n  </div>\n  <div class=\"link-input\">\n    <input ref:input bind:value=\"href\" on:keydown=\"onKeyDown(event)\" placeholder=\"https://example.com/\">\n    <i on:click=\"set({ inputMode: true,  })\" class=\"close\">×</i>\n  </div>\n</div>\n\n<script>\n  const SOURCE_USER = 'user';\n\n  export default {\n    data() {\n      return {\n        view: null,\n        active: false,\n        inputMode: false,\n        pos: { left: 0, top: 0 },\n        href: '',\n      };\n    },\n\n    oncreate() {\n      this.reposition();\n      this.on('state', ({ changed, current }) => {\n        if (!changed.view && !changed.range) return;\n        this.reposition();\n      });\n    },\n\n    computed: {\n      items: ({ view, range }) => {\n        if (!view) return [];\n\n        const editor = view.editor;\n        const { blocks, markups } = view.paper;\n        const { header, blockquote } = blocks.types;\n        const { bold, italic, link } = markups.types;\n        const format = editor.getFormat(range);\n        const items = [];\n\n        if (bold) {\n          items.push({\n            name: 'bold',\n            active: format.bold,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (italic) {\n          items.push({\n            name: 'italic',\n            active: format.italic,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (link) {\n          items.push({\n            name: 'link',\n            active: format.link,\n            action: 'onLinkClick'\n          });\n        }\n\n        if (items.length && (header || blockquote)) {\n          items.push(null);\n        }\n\n        if (header) {\n          items.push({\n            name: 'header',\n            icon: 'heading1',\n            active: format.header === 2,\n            action: 'onBlockClick',\n            value: 2\n          }, {\n            name: 'header',\n            icon: 'heading2',\n            active: format.header === 3,\n            action: 'onBlockClick',\n            value: 3\n          });\n        }\n\n        if (blockquote) {\n          items.push({\n            name: 'blockquote',\n            active: format.blockquote,\n            action: 'onBlockClick'\n          });\n        }\n\n        return items;\n      }\n    },\n\n    methods: {\n      reposition() {\n        const { view, range } = this.get();\n        let pos;\n        if (!view || !range) {\n          pos = { top: -100000, left: -100000 };\n        } else {\n          const menu = this.refs.menu;\n          const container = menu.offsetParent.getBoundingClientRect();\n          const target = view.getBounds(range);\n          pos = {\n            top: target.top - container.top - menu.offsetHeight,\n            left: target.left - container.left + target.width / 2 - menu.offsetWidth / 2,\n          };\n        }\n        this.set({ pos });\n      },\n\n      inputLink() {\n        this.set({ inputMode: true, href: '' });\n        this.refs.input.focus();\n      },\n\n      exitInput() {\n        this.set({ inputMode: false, href: '' });\n      },\n\n      createLink() {\n        let { href, view, range } = this.get();\n        href = href.trim();\n        if (href) {\n          view.editor.formatText(range, { link: href }, SOURCE_USER);\n        }\n        view.focus();\n        this.exitInput();\n      },\n\n      onMarkupClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleTextFormat(range, { [item.name]: true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onBlockClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleLineFormat(range, { [item.name]: item.value || true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onLinkClick() {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onHeaderClick(item) {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onClick(item) {\n        if (typeof this[item.action] === 'function') {\n          this[item.action](item);\n        }\n      },\n\n      onKeyDown(event) {\n        if (event.keyCode === 27) {\n          event.preventDefault();\n          this.exitInput();\n        } else if (event.keyCode === 13) {\n          event.preventDefault();\n          this.createLink();\n        }\n      }\n    }\n  }\n</script>\n\n<style>\n  @import url(https://fonts.googleapis.com/icon?family=Material+Icons);\n  .menu {\n    position: absolute;\n    background-image: linear-gradient(to bottom, rgba(49, 49, 47, .99), #262625);\n    border-radius: .25rem;\n    opacity: 0;\n    z-index: 10000;\n    margin-top: -7px;\n    white-space: nowrap;\n  }\n  .menu.active {\n    opacity: 1;\n    animation: pop-upwards 180ms forwards linear;\n    transition: top 75ms ease-out, left 75ms ease-out;\n  }\n  .menu::after {\n    content: '';\n    position: absolute;\n    bottom: -13px;\n    left: 50%;\n    margin-left: -7px;\n    border: 7px solid transparent;\n    border-top-color: #262625;\n  }\n  button {\n    height: 42px;\n    line-height: 42px;\n    vertical-align: middle;\n    border: none;\n    padding: 0 8px;\n    color: #fff;\n    background: none;\n    outline: none;\n    cursor: pointer;\n  }\n  button:first-child {\n    padding-left: 14px;\n  }\n  button:last-child {\n    padding-right: 14px;\n  }\n  button.active {\n    color: #74b6ff;\n  }\n  button[disabled] {\n    opacity: .5;\n    cursor: default;\n  }\n  .typewriter-icon {\n    display: inline-block;\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: inherit;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n  .typewriter-icon.typewriter-bold::before {\n    content: '\\E238';\n  }\n  .typewriter-icon.typewriter-italic::before {\n    content: '\\E23F';\n  }\n  .typewriter-icon.typewriter-link::before {\n    content: '\\E250';\n  }\n  .typewriter-icon.typewriter-heading1::before {\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-heading2::before {\n    font-size: .75em;\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-blockquote::before {\n    content: '\\E244';\n  }\n  .typewriter-separator {\n    display: inline-block;\n    vertical-align: middle;\n    width: 1px;\n    margin: 0 6px;\n    height: 24px;\n    background: rgba(0, 0, 0, .2);\n    box-shadow: 1px 0 rgba(255, 255, 255, .2);\n  }\n  @keyframes pop-upwards {\n    0% {\n      transform: matrix(.97, 0, 0, 1, 0, 12);\n      opacity: 0\n    }\n    20% {\n      transform: matrix(.99, 0, 0, 1, 0, 2);\n      opacity: .7\n    }\n    40% {\n      transform: matrix(1, 0, 0, 1, 0, -1);\n      opacity: 1\n    }\n    70% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n    100% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n  }\n\n  .link-input {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 100%;\n  }\n  .link-input input {\n    width: 100%;\n    height: 100%;\n    background: none;\n    border: none;\n    color: #f7f7f9;\n    padding: 10px 24px 10px 12px;\n    font-size: .875rem;\n    outline: none;\n    box-sizing: border-box;\n  }\n  .link-input .close {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    color: #f7f7f9;\n    opacity: .5;\n  }\n  .link-input .close:hover {\n    color: #f7f7f9;\n    opacity: 1;\n  }\n  .menu:not(.input-mode) .link-input {\n    display: none;\n  }\n  .menu.input-mode .items {\n    opacity: 0;\n  }\n</style>\n","import HoverMenu from '../ui/HoverMenu.html';\n\nexport default function hoverMenu() {\n\n  return view => {\n    const editor = view.editor;\n    let menu;\n\n\n    function show(range = editor.selection) {\n      if (!menu) {\n        menu = new HoverMenu({\n          target: view.root.parentNode,\n          data: { view, range },\n        });\n        requestAnimationFrame(() => menu.set({ active: true }));\n      } else {\n        menu.set({ range });\n      }\n    }\n\n    function hide() {\n      if (menu) menu.destroy();\n      menu = null;\n    }\n\n    function onEditorChange({ selection }) {\n      const validSelection = selection && selection[0] !== selection[1];\n      const inputMode = menu && menu.get().inputMode;\n      if (!validSelection) {\n        if (!inputMode) hide();\n        return;\n      }\n      let [ from, to ] = selection;\n\n      // Don't show when selection goes across lines\n      if (from > to) [ from, to ] = [ to, from ];\n      if (editor.contents.getLines(from, to).length > 1) return;\n\n      show();\n    }\n\n\n    editor.on('editor-change', onEditorChange);\n\n    return {\n      show,\n      hide,\n      destroy() {\n        editor.off('editor-change', onEditorChange);\n        hide();\n      }\n    }\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport Editor from './editor';\nimport View from './view';\nimport Paper from './paper';\nimport { h, render, renderChildren } from './view/vdom';\n\nimport input from './modules/input';\nimport keyShortcuts from './modules/key-shortcuts';\nimport history from './modules/history';\nimport placeholder from './modules/placeholder';\nimport smartEntry from './modules/smart-entry';\nimport smartQuotes, { smartQuotesDecorator } from './modules/smart-quotes';\nimport hoverMenu from './modules/hover-menu';\n\nconst defaultViewModules = {\n  input: input(),\n  keyShortcuts: keyShortcuts(),\n  history: history(),\n};\n\nexport {\n  EventDispatcher,\n  Delta,\n  Editor,\n  View,\n  Paper,\n  h,\n  input,\n  keyShortcuts,\n  history,\n  placeholder,\n  smartEntry,\n  smartQuotes,\n  smartQuotesDecorator,\n  hoverMenu,\n  defaultViewModules,\n};\n"],"names":["dispatcherEvents","WeakMap","EventDispatcher","type","listener","add","events","getEventListeners","delete","once","off","args","apply","on","uncanceled","forEach","obj","autocreate","get","set","Object","create","Set","createCustomEqual","NULL_CHARACTER","String","fromCharCode","Delta","ops","text","attributes","newOp","length","insert","keys","_push","retain","index","lastOp","unshift","deepEqual","babelHelpers.typeof","push","splice","pop","Iterator","predicate","filter","map","passed","failed","target","op","initial","reduce","entry","getOpLength","start","end","Infinity","iter","iterator","hasNext","nextOp","next","other","thisIter","otherIter","delta","peekType","Math","min","peekLength","thisOp","otherOp","composeAttributes","chop","slice","concat","strings","prep","Error","join","diffResult","diff","component","opLength","INSERT","DELETE","EQUAL","diffAttributes","newline","lineStart","currentIndex","peek","nextLength","newlineIndex","indexOf","line","from","to","lines","eachLine","at","getLines","some","getOps","priority","transformPosition","transformAttributes","offset","nextType","source","keepNull","key","undefined","retOp","substr","SOURCE_API","SOURCE_USER","SOURCE_SILENT","empty","Editor","options","contents","selection","activeFormats","modules","_normalizeRange","getContents","oldSelection","_normalizeSelection","i","shallowEqual","getTextFormat","event","fire","change","oldContents","normalizeContents","compose","transform","getSelectedRange","changeEvent","selectionChanged","newContents","updateContents","setContents","formats","getLineFormat","lineFormat","textFormat","split","cleanDelete","embed","value","combineFormats","seleciton","test","name","decorations","classes","getText","format","existing","formatLine","isSame","every","formatText","producer","singleChange","getChange","range","max","rest","Array","isArray","editor","getLine","lineChange","freeze","combined","merged","h","children","arguments","node","renderChildren","element","clone","eventListener","currentTarget","updateAttribute","isSvg","oldValue","addEventListener","removeEventListener","setAttribute","removeAttribute","createElement","document","createTextNode","createElementNS","appendChild","getElementAttributes","updateElement","oldAttributes","removeElement","parent","removeChild","patchChildren","childNodes","patch","nodeName","toLowerCase","newElement","insertBefore","nodeValue","getSelection","view","root","ownerDocument","defaultView","startContainer","anchorOffset","startOffset","endContainer","focusOffset","endOffset","collapsed","contains","anchorNode","anchorIndex","getNodeAndOffsetIndex","focusIndex","isCollapsed","focusNode","setSelection","hasFocus","activeElement","blur","setBaseAndExtent","getNodesForRange","focus","getBrowserRange","browserRange","createRange","setStart","setEnd","getNodeAndOffset","paper","blocks","embeds","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","nodeType","Node","TEXT_NODE","offsetParent","FILTER_ACCEPT","FILTER_REJECT","count","firstBlockSeen","currentNode","nextNode","size","matches","firstChild","isBRNode","nextSibling","parentNode","call","ELEMENT_NODE","getNodeIndex","previousNode","lastChild","markups","nodeMarkup","br","voidElements","base","col","hr","img","input","meta","param","track","wbr","deltaToVdom","container","blockData","inlineChildren","child","replace","find","vdom","sort","a","b","markup","mergeChildren","block","getDefault","blockChildren","collect","data","attr","optimize","decorateBlock","classArray","class","undecorateBlock","ignoreClasses","ignoreAttributes","selector","_","attrLength","classList","match","item","attribute","deltaFromDom","notInDOM","currentBlock","isBr","dom","deltaToHTML","childrenToHTML","deltaFromHTML","html","template","innerHTML","content","oldChildren","prev","nodeToHTML","escape","closingTag","paragraph","header","parseInt","H","list","indent","topLevelChildren","levels","List","childrenArray","blockquote","bold","italics","link","href","image","src","Paper","types","Types","enabled","array","priorities","definition","remove","domType","nodeOrAttr","define","isMac","navigator","userAgent","modExpr","View","className","defaultPaper","enable","_settingEditorSelection","_settingBrowserSelection","init","render","lastSelection","contentEditable","decorators","getBoundingClientRect","getClientRects","reverseDecorators","contenteditable","updateBrowserSelection","nativeRange","execCommand","onKeyDown","shortcut","shortcuts","fromEvent","onSelectionChange","updateEditorSelection","onTextChanging","onEditorChange","checking","devObserver","MutationObserver","clearTimeout","setTimeout","error","observe","characterData","characterDataOldValue","childList","subtree","uninit","disconnect","api","module","destroy","lastWord","firstWord","lastLine","mutationOptions","onMutate","seen","has","m","mutation","isTextChange","addedNodes","diffs","action","string","onEnter","defaultPrevented","preventDefault","isDefault","atEnd","defaultFollows","insertText","onShiftEnter","onBackspace","prevLine","prevBlock","deleteText","onDelete","onTab","direction","transaction","prevIndent","console","log","observer","onRendering","onRender","keymap","toggleTextFormat","italic","toggleLineFormat","macKeymap","keyShortcuts","customShortcuts","onShortcut","defaultOptions","history","stack","lastRecorded","lastAction","ignoreChange","undo","redo","cutoff","dest","record","timestamp","Date","now","getAction","undoChange","delay","undoSelection","maxStack","shift","onTextChange","changeOp","placeholder","pointerEvents","onDecorate","blockReplacements","capture","textReplacements","blockReplace","prefix","regexp","getAttributes","textReplace","replaceWith","defaultHandlers","handlers","ignore","isTextEntry","getExactText","lastIndexOf","handler","smartQuotes","lastChars","replaced","quote","smartQuotesDecorator","quotes","expr","replacer","exec","replacement","lastIndex","getFormat","items","left","top","pos","menu","refs","getBounds","offsetHeight","width","offsetWidth","inputMode","trim","exitInput","inputLink","keyCode","createLink","reposition","changed","current","active","icon","disabled","onClick","hoverMenu","show","HoverMenu","hide","validSelection","defaultViewModules"],"mappings":"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"}